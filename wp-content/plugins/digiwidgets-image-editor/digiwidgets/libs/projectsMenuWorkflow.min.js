/* global jQuery, wp, DWWPSettings, window, Mousetrap, Canvas2Image, fabric, ajaxurl */
window.projectMenuFunctions=function(e){var t=e("#wpwrap").height();e("#fade").css("height",t+"px"),e("#fade").show();var i={},a=document.getElementById("existingProjectContainer");a.style.visibility="visible";var n={action:"getExistingProjectTable"};e(window).bind("beforeunload",function(){var t=e("#wpwrap").height();e("#fade").css("height",t+"px"),e("#fade").show(),e("#loading-image").show()}),e("#maincontent").ajaxStart(function(){var t=e("#wpwrap").height();e("#fade").css("height",t+"px"),e("#fade").show(),e("#loading-image").show()}),e("#maincontent").ajaxStop(function(){e("#fade").hide()}),e.post(ajaxurl,n,function(t){e("#existingProjectContainer").append(t),e("#existingProjectContainer").css("height","auto");var i=e("#existingProjectContainer").height();e("#existingProjectContainer").css("height","100vh"),e("#wpfooter").css("position","relative"),e("#wpfooter").css("margin-top",i+"px")});var o={action:"dropdownChoices"};return e.post(ajaxurl,o,function(t){e("#templateDropdownNewProject").append(t),e("#templateDropdownDuplicateProject").append(t),e("#templateDropdown").append(t)}),i.clickNewProject=function(){var t=e("#existingProjectContainer").height();e("#fade").css("height",t+"px"),e("#fade").show(),e("#loading-image").hide();var i=document.getElementById("newProjectContainer");i.style.visibility="visible",e("#templateDropdown").prop("disabled",!1).removeClass("disabled")},i.clickDuplicateProject=function(t){var i=e("#existingProjectContainer").height();e("#fade").css("height",i+"px"),e("#fade").show(),e("#loading-image").hide();var a=document.getElementById("duplicateProjectContainer");a.style.visibility="visible",e("#templateDropdown").prop("disabled",!1).removeClass("disabled"),e('input[name="imageLink"]').val(t)},i.cancelNewProject=function(){e("#fade").hide(),e("#loading-image").show();var t=document.getElementById("newProjectContainer");t.style.visibility="hidden",t=document.getElementById("duplicateProjectContainer"),t.style.visibility="hidden"},i.deleteExistingProject=function(t){var i=window.confirm("Are you sure you wish to delete this project?\n\nThis action cannot be undone.");if(i){var a={action:"deleteExistingProject",image_id:parseInt(t)};e.post(ajaxurl,a,function(i){e("#record_"+t).remove();var a=e(".displaying-num:eq(0)"),n=parseInt(a.text().split(" ")[0])-1;1===n?(a.text("1 item"),e(".displaying-num:eq(1)").text("1 item")):(a.text(n+" items"),e(".displaying-num:eq(1)").text(n+" items"))})}},i.getEditor=function(e){var t="&imageLink="+e;window.location=window.location+t},e("#templateDropdownNewProject").change(function(){"createTemplate"===e(this).find("option:selected").val()?(e("#newTemplateContainer").slideDown(),e("#createTemplateTitle").prop("required",!0),e("#createTemplateWidth").prop("required",!0),e("#createTemplateHeight").prop("required",!0)):(e("#newTemplateContainer").slideUp(),e("#createTemplateTitle").prop("required",!1),e("#createTemplateWidth").prop("required",!1),e("#createTemplateHeight").prop("required",!1))}),e("#templateDropdownDuplicateProject").change(function(){"createTemplate"===e(this).find("option:selected").val()?(e("#duplicateTemplateContainer").slideDown(),e("#createDuplicateTemplateTitle").prop("required",!0),e("#createDuplicateTemplateWidth").prop("required",!0),e("#createDuplicateTemplateHeight").prop("required",!0)):(e("#duplicateTemplateContainer").slideUp(),e("#createDuplicateTemplateTitle").prop("required",!1),e("#createDuplicateTemplateWidth").prop("required",!1),e("#createDuplicateTemplateHeight").prop("required",!1))}),i.duplicateProject=function(){var t=document.getElementById("duplicateProjectContainer");t.style.visibility="hidden";var i=e('input[name="imageLink"]').val();e("#wpfooter").css("margin-top","0px");var a=e("#duplicateProjectTitle").val(),n={action:"createNewFromExistingProject",url:i,title:a};e.post(ajaxurl,n,function(t){var i=document.getElementById("templateDropdownDuplicateProject").value,n={title:"",width:"",height:""};if(i&&"createTemplate"!==i){i=i.split(","),n.width=i[0],n.height=i[1],n.title=i[2];var o="&imageLink="+t+"&template_width="+i[0]+"&template_height="+i[1]+"&template_title="+i[2]+"&project_title="+a;window.location=window.location+o}else{n.title=document.getElementById("createDuplicateTemplateTitle").value,n.width=document.getElementById("createDuplicateTemplateWidth").value,n.height=document.getElementById("createDuplicateTemplateHeight").value,i=[n.width,n.height,n.title];var l={action:"addNewTemplate",title:n.title,width:n.width,height:n.height};e.post(ajaxurl,l,function(e){var i="&imageLink="+t+"&template_width="+n.width+"&template_height="+n.height+"&template_title="+n.title+"&project_title="+a;window.location=window.location+i})}})},i.checkNewProjectInfo=function(){var t=wp.media({title:"Upload Image",multiple:!1,frame:"select",library:{type:"image"}}).open().on("select",function(i){var a=document.getElementById("newProjectContainer");a.style.visibility="hidden";var n=t.state().get("selection").first(),o=n.toJSON().url;e("#wpfooter").css("margin-top","0px");var l=e("#projectTitle").val(),r={action:"createNewFromExistingProject",url:o,title:l};e.post(ajaxurl,r,function(t){var i=document.getElementById("templateDropdownNewProject").value,a={title:"",width:"",height:""};if(i&&"createTemplate"!==i){i=i.split(","),a.width=i[0],a.height=i[1],a.title=i[2];var n="&imageLink="+t+"&template_width="+i[0]+"&template_height="+i[1]+"&template_title="+i[2]+"&project_title="+l;window.location=window.location+n}else{a.title=document.getElementById("createTemplateTitle").value,a.width=document.getElementById("createTemplateWidth").value,a.height=document.getElementById("createTemplateHeight").value,i=[a.width,a.height,a.title];var o={action:"addNewTemplate",title:a.title,width:a.width,height:a.height};e.post(ajaxurl,o,function(e){var i="&imageLink="+t+"&template_width="+a.width+"&template_height="+a.height+"&template_title="+a.title+"&project_title="+l;window.location=window.location+i})}})});e("#media-attachment-date-filters").css("width","200px")},e.extend({},i)}(jQuery);