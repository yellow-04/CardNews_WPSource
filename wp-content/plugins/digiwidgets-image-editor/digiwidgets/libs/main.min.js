/* build: `node build.js modules=ALL exclude=gestures,json minifier=uglifyjs` */
function InitializeCropping(){"use strict";function t(t,e){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))}var e=this;e.cropObject=null,e.el=null,e.disableActionButtons=!1,e.contextFillStyle="rgba(0, 0, 0, 0)";var i,n,r,o=!1,s={};return s.circle=function(t){t.save(),t.translate(this.cropLeft-this.cropWidth,this.cropTop-this.cropHeight),t.scale(this.cropWidth,this.cropHeight),t.arc(1,1,1,0,2*Math.PI,!1),t.restore()},s.square=function(t){t.rect(this.cropLeft,this.cropTop,this.cropWidth,this.cropHeight)},s.star=function(t){t.beginPath();var e=this.height,i=this.width;t.moveTo(0,-e/2),t.lineTo(i/12,-e/6),t.lineTo(i/2,-e/6),t.lineTo(i/6,e/6),t.lineTo(i/4,e/2),t.lineTo(0,i/4),t.lineTo(-i/4,e/2),t.lineTo(-i/6,e/6),t.lineTo(-i/2,-e/6),t.lineTo(-i/12,-e/6),t.lineTo(0,-e/2),t.closePath(),t.fill()},s.freeForm=function(t){t.moveTo(this.cropLeft,this.cropTop);for(var e=1;e<this.cropPoints.length;e++){var i=this.cropPoints[e].x,n=this.cropPoints[e].y,r=(n/Math.tan(this.cropAngle)-i)*Math.sin(this.cropAngle),o=n/Math.sin(this.cropAngle)-r/Math.tan(this.cropAngle);t.lineTo(o+this.cropLeft,r+this.cropTop)}t.lineTo(this.cropLeft,this.cropTop),t.closePath(),t.fillStyle=ImageFunctions.crop().contextFillStyle,t.fill()},e.getClipTo=function(t){return s[t]},e.setCanvas=function(t){i=t},e.startCropFunction=function(t){if(i.getActiveGroup())return window.alert("Please select only one image at a time for cropping."),void $("#cropToolOptions").toggle();var s;if(e.el&&null!==e.el){for(ImageFunctions.enableMenuButtons(),ImageFunctions.enableToolSetButtons(),$("#thumbnail").removeAttr("disabled"),s=0;s<i.getObjects().length-1;s++)i.item(s).selectable=!0;return i.remove(e.el),e.el=null,e.disableActionButtons=!1,n=e.cropObject,i.setActiveObject(e.cropObject),ImageFunctions.positionBtn(e.cropObject),i.renderAll(),ImageFunctions.enableToolSetButtons(),!0}if(ImageFunctions.disableMenuButtons(),ImageFunctions.disableToolSetButtons(),$("#textButton").prop("disabled",!0).addClass("disabled"),document.getElementById("textButton").style.pointerEvents="none",$("#thumbnail").attr("disabled","true"),!i.getActiveObject())return window.alert("Please select an object or layer"),!1;if(e.cropObject=i.getActiveObject(),e.disableActionButtons=!0,document.getElementById("inline-btn").style.visibility="hidden",t&&"circle"===t){r="exit",e.cropObject.cropType=t,$("#freeformCropOption").removeClass("cropSelected"),$("#squareCropOption").removeClass("cropSelected"),$("#circleCropOption").addClass("cropSelected");var a;a=e.cropObject.width*e.cropObject.scaleX>e.cropObject.height*e.cropObject.scaleY?e.cropObject.height*e.cropObject.scaleY/2:e.cropObject.width*e.cropObject.scaleX/2,e.el=new e.CircleZone({fill:"transparent",left:e.cropObject.left+e.cropObject.width*e.cropObject.scaleX/2-a,top:e.cropObject.top+e.cropObject.height*e.cropObject.scaleY/2-a,radius:a,width:e.cropObject.width*e.cropObject.scaleX,height:e.cropObject.width*e.cropObject.scaleX,hasRotatingPoint:!1,hasBorders:!0}),e.el.cropType=t,e.el.angle=e.cropObject.angle,e.el.angle%90===0&&(e.el.angle+=1e-6),e.el.radians=function(){return e.el.angle/180*Math.PI}}else"square"===t?(r="exit",e.cropObject.cropType=t,$("#freeformCropOption").removeClass("cropSelected"),$("#circleCropOption").removeClass("cropSelected"),$("#squareCropOption").addClass("cropSelected"),e.el=new e.CropZone({fill:"transparent",hasBorders:!0,originX:"left",originY:"top",left:0,top:0,width:200,height:200,cornerSize:20,transparentCorners:!0,lockRotation:!1,hasRotatingPoint:!1}),e.el.angle=e.cropObject.angle,e.el.angle%90===0&&(e.el.angle+=1e-6),e.el.radians=function(){return e.el.angle/180*Math.PI},e.el.left=e.cropObject.left,e.el.top=e.cropObject.top,e.el.width=e.cropObject.width*e.cropObject.scaleX,e.el.height=e.cropObject.height*e.cropObject.scaleY):"freeForm"===t&&($("#squareCropOption").removeClass("cropSelected"),$("#circleCropOption").removeClass("cropSelected"),$("#freeformCropOption").addClass("cropSelected"),e.cropObject.cropType=t,e.el=!0,o?r="add":(o=!0,r="add",i.observe("mouse:down",function(t){var n=i.getPointer(t.e);if("add"===r){var o=new fabric.Polygon([{x:n.x,y:n.y},{x:n.x+.5,y:n.y+.5}],{fill:"transparent",stroke:"#000000",strokeWidth:2,selectable:!1});e.el=o,i.add(e.el),r="edit"}else if("edit"===r&&e.el&&"polygon"===e.el.type){var s=e.el.get("points");s.push({x:n.x-e.el.get("left"),y:n.y-e.el.get("top")}),e.el.set({points:s}),i.renderAll()}})));if(t){for(s=0;s<i.getObjects().length;s++)i.item(s).selectable=!1;i.deactivateAll().renderAll(),("square"===t||"circle"===t)&&(i.add(e.el),i.setActiveObject(e.el))}var l=document.getElementById("cropToolOptions");return l.style.pointerEvents="auto",!0},e.cropFunction=function(){if(null===e.el)return void window.alert("Please select a crop area before cropping.");var n;e.el.angle%90===0&&(e.el.angle+=4e-4);var o,a,l,c;if("circle"===e.cropObject.cropType)o=e.el.oCoords.tl.x-e.cropObject.oCoords.tl.x,a=e.el.oCoords.tl.y-e.cropObject.oCoords.tl.y,l=(a/Math.tan(e.el.radians())-o)*Math.sin(e.el.radians()),c=a/Math.sin(e.el.radians())-l/Math.tan(e.el.radians()),c-=(e.cropObject.width*e.cropObject.scaleX-e.el.width*e.el.scaleX)/2,l-=(e.cropObject.height*e.cropObject.scaleY-e.el.height*e.el.scaleY)/2,l=1*l/e.cropObject.scaleY,c=1*c/e.cropObject.scaleX,e.cropObject.cropRadius=e.el.radius,e.cropObject.flipX&&(c*=-1),e.cropObject.flipY&&(l*=-1),e.cropObject.cropLeft=c,e.cropObject.cropTop=l,e.cropObject.cropWidth=e.el.width/2*e.el.scaleX/e.cropObject.scaleX,e.cropObject.cropHeight=e.el.height/2*e.el.scaleY/e.cropObject.scaleY,e.cropObject.cropType="circle",e.cropObject.clipTo=s.circle;else if("freeForm"===e.cropObject.cropType){for(n=0;n<i.getObjects().length;n++)i.item(n).selectable=!0;e.cropObject.cropPoints=[],e.el.points.forEach(function(t){e.cropObject.cropPoints.push({x:t.x/e.cropObject.scaleX,y:t.y/e.cropObject.scaleY})}),e.cropObject.angle%90===0&&(e.cropObject.angle+=1e-5),e.cropObject.cropAngle=e.cropObject.angle/180*Math.PI,o=e.el.left-e.cropObject.oCoords.tl.x,a=e.el.top-e.cropObject.oCoords.tl.y,l=(a/Math.tan(e.cropObject.cropAngle)-o)*Math.sin(e.cropObject.cropAngle),c=a/Math.sin(e.cropObject.cropAngle)-l/Math.tan(e.cropObject.cropAngle),l=1*l/e.cropObject.scaleY,c=1*c/e.cropObject.scaleX,c-=e.cropObject.width/2,l-=e.cropObject.height/2,e.cropObject.flipX&&(c*=-1),e.cropObject.flipY&&(l*=-1),e.cropObject.cropLeft=c,e.cropObject.cropTop=l,e.cropObject.clipTo=s.freeForm,r="exit"}else{o=e.el.oCoords.tl.x-e.cropObject.oCoords.tl.x,a=e.el.oCoords.tl.y-e.cropObject.oCoords.tl.y,l=(a/Math.tan(e.el.radians())-o)*Math.sin(e.el.radians()),c=a/Math.sin(e.el.radians())-l/Math.tan(e.el.radians()),l=1*l/e.cropObject.scaleY,c=1*c/e.cropObject.scaleX,c-=e.cropObject.width/2,l-=e.cropObject.height/2;var h=t(e.el.oCoords.tr.x-e.el.oCoords.tl.x,e.el.oCoords.tr.y-e.el.oCoords.tl.y),u=t(e.el.oCoords.bl.x-e.el.oCoords.tl.x,e.el.oCoords.bl.y-e.el.oCoords.tl.y);h=1*h/e.cropObject.scaleX,u=1*u/e.cropObject.scaleY,e.cropObject.flipX&&(c*=-1,h*=-1),e.cropObject.flipY&&(l*=-1,u*=-1);var f={oldLeft:e.cropObject.left,oldTop:e.cropObject.top,width:e.cropObject.width,height:e.cropObject.height};e.cropObject.lastCrop=f,e.cropObject.cropLeft=c,e.cropObject.cropTop=l,e.cropObject.cropWidth=h,e.cropObject.cropHeight=u,e.cropObject.clipTo=s.square;e.el.angle*Math.PI/180}for(n=0;n<i.getObjects().length-1;n++)i.item(n).selectable=!0;e.disableActionButtons=!1,i.remove(e.el),e.el=null,e.lastActive=e.cropObject,i.setActiveObject(e.cropObject),ImageFunctions.positionBtn(e.cropObject),i.renderAll(),ImageFunctions.saveCommandHistory("Crop Image"),ImageFunctions.enableMenuButtons(),ImageFunctions.enableToolSetButtons(),$("#cropToolOptions").hide(),$("#cropToolButton").removeClass("highlightOption"),$("#textButton").prop("disabled",!1).remove("disabled")},e.revertCropBoxFunction=function(){if(e.el&&"rect"===e.el.type||(e.el&&(i.remove(e.el),e.el=null),e.cropObject.cropType="square",e.el=new e.CropZone({fill:"transparent",hasBorders:!0,originX:"left",originY:"top",cornerSize:20,width:e.cropObject.width,height:e.cropObject.height,transparentCorners:!0,lockRotation:!1,hasRotatingPoint:!1}),e.el.radians=function(){return e.el.angle/180*Math.PI},r="exit"),e.el.oldBox)e.el.left=e.el.oldBox.left,e.el.top=e.el.oldBox.top,e.el.scaleX=e.el.oldBox.scaleX,e.el.scaleY=e.el.oldBox.scaleY,e.el.oldBox=null;else{var t={left:e.el.left,top:e.el.top,scaleX:e.el.scaleX,scaleY:e.el.scaleY};e.el.left=e.cropObject.left,e.el.top=e.cropObject.top,e.el.scaleX=e.cropObject.scaleX*e.cropObject.width/e.el.width,e.el.scaleY=e.cropObject.scaleY*e.cropObject.height/e.el.height,e.el.cropType="square",e.el.oldBox=t}i.add(e.el),i.setActiveObject(e.el),i.renderAll(),e.cropFunction()},e.CircleZone=fabric.util.createClass(fabric.Circle,{_render:function(t){this.callSuper("_render",t),this._renderOverlay(t)},_renderOverlay:function(e){var n,r=0,o=0;n=this.scaleX>this.scaleY?this.scaleY:this.scaleX;var s=2*t(i.height,i.width)/n;e.fillStyle="rgba(0, 0, 0, 0.5)",e.strokeStyle="rgba(0, 0, 0, 0)",e.beginPath(),e.moveTo(r,o-this.radius),e.lineTo(r,o-this.radius-s),e.arc(r,o,this.radius+s,-Math.PI/2,Math.PI/2),e.lineTo(r,o+this.radius),e.arc(r,o,this.radius,Math.PI/2,-Math.PI/2,!0),e.fill(),e.beginPath(),e.moveTo(r,o+this.radius),e.lineTo(r,o+this.radius+s),e.arc(r,o,this.radius+s,Math.PI/2,-Math.PI/2),e.lineTo(r,o-this.radius),e.arc(r,o,this.radius,-Math.PI/2,Math.PI/2,!0),e.fill()}}),e.CropZone=fabric.util.createClass(fabric.Rect,{_render:function(t){this.callSuper("_render",t);var e=(t.canvas,7),i=this.flipX?-1:1,n=this.flipY?-1:1,r=i/this.scaleX,o=n/this.scaleY;t.lineWidth=1,t.scale(r,o),t.fillStyle="rgba(0, 0, 0, 0.5)",this._renderOverlay(t),void 0!==t.setLineDash?t.setLineDash([e,e]):void 0!==t.mozDash&&(t.mozDash=[e,e]),t.strokeStyle="rgba(0, 0, 0, 0.2)",this._renderBorders(t),this._renderGrid(t),t.lineDashOffset=e,t.strokeStyle="rgba(255, 255, 255, 0.4)",this._renderBorders(t),this._renderGrid(t),t.scale(1/r,1/o)},_renderOverlay:function(t){var e=t.canvas,i=0,n=Math.ceil(-e.width-this.getLeft()),r=Math.ceil(-this.getWidth()/2),o=Math.ceil(this.getWidth()/2),s=Math.ceil(this.getWidth()/2+e.width),a=Math.ceil(-e.height-this.getTop()),l=Math.ceil(-this.getHeight()/2),c=Math.ceil(this.getHeight()/2),h=Math.ceil(this.getHeight()/2+e.height),u=Math.sqrt(Math.pow(e.height,2)+Math.pow(e.width,2));t.fillRect(n-u,a-u,s-n+2*u,l-a+i+u),t.fillRect(n-u,l,r-n+u,c-l+i),t.fillRect(o,l,s-o+u,c-l+i),t.fillRect(n-u,c,s-n+2*u,h-c+u)},_renderBorders:function(t){t.beginPath(),t.moveTo(-this.getWidth()/2,-this.getHeight()/2),t.lineTo(this.getWidth()/2,-this.getHeight()/2),t.lineTo(this.getWidth()/2,this.getHeight()/2),t.lineTo(-this.getWidth()/2,this.getHeight()/2),t.lineTo(-this.getWidth()/2,-this.getHeight()/2),t.stroke()},_renderGrid:function(t){t.beginPath(),t.moveTo(-this.getWidth()/2+1/3*this.getWidth(),-this.getHeight()/2),t.lineTo(-this.getWidth()/2+1/3*this.getWidth(),this.getHeight()/2),t.stroke(),t.beginPath(),t.moveTo(-this.getWidth()/2+2/3*this.getWidth(),-this.getHeight()/2),t.lineTo(-this.getWidth()/2+2/3*this.getWidth(),this.getHeight()/2),t.stroke(),t.beginPath(),t.moveTo(-this.getWidth()/2,-this.getHeight()/2+1/3*this.getHeight()),t.lineTo(this.getWidth()/2,-this.getHeight()/2+1/3*this.getHeight()),t.stroke(),t.beginPath(),t.moveTo(-this.getWidth()/2,-this.getHeight()/2+2/3*this.getHeight()),t.lineTo(this.getWidth()/2,-this.getHeight()/2+2/3*this.getHeight()),t.stroke()}}),e}function ImageFunctionViewModel(){"use strict";var t=this;return t.tabs=ko.observableArray(),t.deactiveTabs=ko.observableArray(),t.deactiveTabs.push({name:"Choose a tab..."}),t.selected=ko.observable(null),t.sortedTabs=ko.computed(function(){var e=t.deactiveTabs().slice(0);return e.sort(function(t,e){return t.name.localeCompare(e.name)})}),t.scrollOverflow=ko.observable(!0),t.inactiveCount=0,t.inactive=ko.observable(!1),t.chosenId=ko.observable(),t.availableProjects=ko.observableArray(),t.currentCanvas=ko.observable(),t.active=!1,t.addProject=function(e){var i=!0;t.availableProjects().forEach(function(t){t.guid===e.guid&&t.title===e.title&&(i=!1)}),i&&t.availableProjects.push(e)},t.removeProject=function(e){t.active=!1;var i;for(i=0;i<t.availableProjects().length;i++)if(e===t.availableProjects()[i].guid){t.availableProjects.splice(i,1);break}t.active=!0},t.selectProject=function(e){t.active=!1,t.availableProjects().forEach(function(i){i.guid===e&&t.currentCanvas(i)}),t.active=!0},t.changeProject=function(){t.selectProject(ImageFunctions.trySelectExistingProject(t.currentCanvas().guid))},t.activateTab=function(e){e.active(!0),t.inactiveCount--,0===t.inactiveCount&&t.inactive(!1),t.deactiveTabs.remove(e),t.scrollOverflow(t.checkScrollWidth())},t.activateTabByName=function(e){for(var i=0;i<t.tabs().length;i++)if(e===t.tabs()[i].name)return void t.activateTab(t.tabs()[i])},t._addTab=function(e){t.tabs.push(e)},t._addTabAtIndex=function(e,i){t.tabs.splice(i,0,e),t.chosenId(e),t.scrollOverflow(t.checkScrollWidth())},t.addTabsDialog=function(){$("#chooseTabs").dialog({height:200,open:function(){$(this).css("height",this.height)},close:function(){this.height=$(this).css("height")}})},t.checkScrollWidth=function(){var t=document.getElementById("folders").scrollWidth;return 450>=t?!1:!0},t.deactivateSelectedTab=function(){t.deactivateTab(t.chosenId())},t.deactivateTab=function(e){e.active(!1),t.inactiveCount++,t.inactiveCount>0&&t.inactive(!0),t.deactiveTabs.push(e),t.scrollOverflow(t.checkScrollWidth())},t.goToTab=function(e){return e===t.chosenId()?void t.chosenId(null):void t.chosenId(e)},t.moveTabByName=function(e,i){for(var n,r=0;r<t.tabs().length;){if(t.tabs()[r].name===e){n=t.tabs()[r];break}r++}n&&(r>i?(t.removeTab(n),t.addTabAtIndex(n,i)):r!==i&&(t.removeTab(n),t.addTabAtIndex(n,i-1)))},t._removeTab=function(e){t.tabs.remove(e),t.chosenId(t.tabs()[0])},t}var fabric=fabric||{version:"1.5.0"};if("undefined"!=typeof exports&&(exports.fabric=fabric),"undefined"!=typeof document&&"undefined"!=typeof window?(fabric.document=document,fabric.window=window,window.fabric=fabric):(fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),fabric.document.createWindow?fabric.window=fabric.document.createWindow():fabric.window=fabric.document.parentWindow),fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement,fabric.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window,fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width"],fabric.DPI=96,fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",function(){function t(t,e){this.__eventListeners[t]&&(e?fabric.util.removeFromArray(this.__eventListeners[t],e):this.__eventListeners[t].length=0)}function e(t,e){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var i in t)this.on(i,t[i]);else this.__eventListeners[t]||(this.__eventListeners[t]=[]),this.__eventListeners[t].push(e);return this}function i(e,i){if(this.__eventListeners){if(0===arguments.length)this.__eventListeners={};else if(1===arguments.length&&"object"==typeof arguments[0])for(var n in e)t.call(this,n,e[n]);else t.call(this,e,i);return this}}function n(t,e){if(this.__eventListeners){var i=this.__eventListeners[t];if(i){for(var n=0,r=i.length;r>n;n++)i[n].call(this,e||{});return this}}}fabric.Observable={observe:e,stopObserving:i,fire:n,on:e,off:i,trigger:n}}(),fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var t=0,e=arguments.length;e>t;t++)this._onObjectAdded(arguments[t]);return this.renderOnAddRemove&&this.renderAll(),this},insertAt:function(t,e,i){var n=this.getObjects();return i?n[e]=t:n.splice(e,0,t),this._onObjectAdded(t),this.renderOnAddRemove&&this.renderAll(),this},remove:function(){for(var t,e=this.getObjects(),i=0,n=arguments.length;n>i;i++)t=e.indexOf(arguments[i]),-1!==t&&(e.splice(t,1),this._onObjectRemoved(arguments[i]));return this.renderOnAddRemove&&this.renderAll(),this},forEachObject:function(t,e){for(var i=this.getObjects(),n=i.length;n--;)t.call(e,i[n],n,i);return this},getObjects:function(t){return"undefined"==typeof t?this._objects:this._objects.filter(function(e){return e.type===t})},item:function(t){return this.getObjects()[t]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(t){return this.getObjects().indexOf(t)>-1},complexity:function(){return this.getObjects().reduce(function(t,e){return t+=e.complexity?e.complexity():0},0)}},function(t){var e=Math.sqrt,i=Math.atan2,n=Math.PI/180;fabric.util={removeFromArray:function(t,e){var i=t.indexOf(e);return-1!==i&&t.splice(i,1),t},getRandomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},degreesToRadians:function(t){return t*n},radiansToDegrees:function(t){return t/n},rotatePoint:function(t,e,i){var n=Math.sin(i),r=Math.cos(i);t.subtractEquals(e);var o=t.x*r-t.y*n,s=t.x*n+t.y*r;return new fabric.Point(o,s).addEquals(e)},transformPoint:function(t,e,i){return i?new fabric.Point(e[0]*t.x+e[2]*t.y,e[1]*t.x+e[3]*t.y):new fabric.Point(e[0]*t.x+e[2]*t.y+e[4],e[1]*t.x+e[3]*t.y+e[5])},invertTransform:function(t){var e=t.slice(),i=1/(t[0]*t[3]-t[1]*t[2]);e=[i*t[3],-i*t[1],-i*t[2],i*t[0],0,0];var n=fabric.util.transformPoint({x:t[4],y:t[5]},e);return e[4]=-n.x,e[5]=-n.y,e},toFixed:function(t,e){return parseFloat(Number(t).toFixed(e))},parseUnit:function(t,e){var i=/\D{0,2}$/.exec(t),n=parseFloat(t);switch(e||(e=fabric.Text.DEFAULT_SVG_FONT_SIZE),i[0]){case"mm":return n*fabric.DPI/25.4;case"cm":return n*fabric.DPI/2.54;case"in":return n*fabric.DPI;case"pt":return n*fabric.DPI/72;case"pc":return n*fabric.DPI/72*12;case"em":return n*e;default:return n}},falseFunction:function(){return!1},getKlass:function(t,e){return t=fabric.util.string.camelize(t.charAt(0).toUpperCase()+t.slice(1)),fabric.util.resolveNamespace(e)[t]},resolveNamespace:function(e){if(!e)return fabric;for(var i=e.split("."),n=i.length,r=t||fabric.window,o=0;n>o;++o)r=r[i[o]];return r},loadImage:function(t,e,i,n){if(!t)return void(e&&e.call(i,t));var r=fabric.util.createImage();r.onload=function(){e&&e.call(i,r),r=r.onload=r.onerror=null},r.onerror=function(){fabric.log("Error loading "+r.src),e&&e.call(i,null,!0),r=r.onload=r.onerror=null},0!==t.indexOf("data")&&"undefined"!=typeof n&&(r.crossOrigin=n),r.src=t},enlivenObjects:function(t,e,i,n){function r(){++s===a&&e&&e(o)}t=t||[];var o=[],s=0,a=t.length;return a?void t.forEach(function(t,e){if(!t||!t.type)return void r();var s=fabric.util.getKlass(t.type,i);s.async?s.fromObject(t,function(i,s){s||(o[e]=i,n&&n(t,o[e])),r()}):(o[e]=s.fromObject(t),n&&n(t,o[e]),r())}):void(e&&e(o))},groupSVGElements:function(t,e,i){var n;return n=new fabric.PathGroup(t,e),"undefined"!=typeof i&&n.setSourcePath(i),n},populateWithProperties:function(t,e,i){if(i&&"[object Array]"===Object.prototype.toString.call(i))for(var n=0,r=i.length;r>n;n++)i[n]in t&&(e[i[n]]=t[i[n]])},drawDashedLine:function(t,n,r,o,s,a){var l=o-n,c=s-r,h=e(l*l+c*c),u=i(c,l),f=a.length,d=0,p=!0;for(t.save(),t.translate(n,r),t.moveTo(0,0),t.rotate(u),n=0;h>n;)n+=a[d++%f],n>h&&(n=h),t[p?"lineTo":"moveTo"](n,0),p=!p;t.restore()},createCanvasElement:function(t){return t||(t=fabric.document.createElement("canvas")),!t.getContext&&"undefined"!=typeof G_vmlCanvasManager&&G_vmlCanvasManager.initElement(t),t},createImage:function(){return fabric.isLikelyNode?new(require("canvas").Image):fabric.document.createElement("img")},createAccessors:function(t){for(var e=t.prototype,i=e.stateProperties.length;i--;){var n=e.stateProperties[i],r=n.charAt(0).toUpperCase()+n.slice(1),o="set"+r,s="get"+r;e[s]||(e[s]=function(t){return new Function('return this.get("'+t+'")')}(n)),e[o]||(e[o]=function(t){return new Function("value",'return this.set("'+t+'", value)')}(n))}},clipContext:function(t,e){e.save(),e.beginPath(),t.clipTo(e),e.clip()},multiplyTransformMatrices:function(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]},getFunctionBody:function(t){return(String(t).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(t,e,i,n){n>0&&(e>n?e-=n:e=0,i>n?i-=n:i=0);for(var r=!0,o=t.getImageData(e,i,2*n||1,2*n||1),s=3,a=o.data.length;a>s;s+=4){var l=o.data[s];if(r=0>=l,r===!1)break}return o=null,r}}}("undefined"!=typeof exports?exports:this),function(){function t(t,n,o,s,l,c,h){var u=a.call(arguments);if(r[u])return r[u];var f=Math.PI,d=h*f/180,p=Math.sin(d),g=Math.cos(d),v=0,m=0;o=Math.abs(o),s=Math.abs(s);var b=-g*t*.5-p*n*.5,y=-g*n*.5+p*t*.5,C=o*o,x=s*s,w=y*y,_=b*b,S=C*x-C*w-x*_,O=0;if(0>S){var T=Math.sqrt(1-S/(C*x));o*=T,s*=T}else O=(l===c?-1:1)*Math.sqrt(S/(C*w+x*_));var k=O*o*y/s,j=-O*s*b/o,A=g*k-p*j+.5*t,I=p*k+g*j+.5*n,E=i(1,0,(b-k)/o,(y-j)/s),$=i((b-k)/o,(y-j)/s,(-b-k)/o,(-y-j)/s);0===c&&$>0?$-=2*f:1===c&&0>$&&($+=2*f);for(var D=Math.ceil(Math.abs($/f*2)),P=[],B=$/D,M=8/3*Math.sin(B/4)*Math.sin(B/4)/Math.sin(B/2),F=E+B,L=0;D>L;L++)P[L]=e(E,F,g,p,o,s,A,I,M,v,m),v=P[L][4],m=P[L][5],E=F,F+=B;return r[u]=P,P}function e(t,e,i,n,r,s,l,c,h,u,f){var d=a.call(arguments);if(o[d])return o[d];var p=Math.cos(t),g=Math.sin(t),v=Math.cos(e),m=Math.sin(e),b=i*r*v-n*s*m+l,y=n*r*v+i*s*m+c,C=u+h*(-i*r*g-n*s*p),x=f+h*(-n*r*g+i*s*p),w=b+h*(i*r*m+n*s*v),_=y+h*(n*r*m-i*s*v);return o[d]=[C,x,w,_,b,y],o[d]}function i(t,e,i,n){var r=Math.atan2(e,t),o=Math.atan2(n,i);return o>=r?o-r:2*Math.PI-(r-o)}function n(t,e,i,n,r,o,l,c){var h=a.call(arguments);if(s[h])return s[h];var u,f,d,p,g,v,m,b,y=Math.sqrt,C=Math.min,x=Math.max,w=Math.abs,_=[],S=[[],[]];f=6*t-12*i+6*r,u=-3*t+9*i-9*r+3*l,d=3*i-3*t;for(var O=0;2>O;++O)if(O>0&&(f=6*e-12*n+6*o,u=-3*e+9*n-9*o+3*c,d=3*n-3*e),w(u)<1e-12){if(w(f)<1e-12)continue;p=-d/f,p>0&&1>p&&_.push(p)}else m=f*f-4*d*u,0>m||(b=y(m),g=(-f+b)/(2*u),g>0&&1>g&&_.push(g),v=(-f-b)/(2*u),v>0&&1>v&&_.push(v));for(var T,k,j,A=_.length,I=A;A--;)p=_[A],j=1-p,T=j*j*j*t+3*j*j*p*i+3*j*p*p*r+p*p*p*l,S[0][A]=T,k=j*j*j*e+3*j*j*p*n+3*j*p*p*o+p*p*p*c,S[1][A]=k;S[0][I]=t,S[1][I]=e,S[0][I+1]=l,S[1][I+1]=c;var E=[{x:C.apply(null,S[0]),y:C.apply(null,S[1])},{x:x.apply(null,S[0]),y:x.apply(null,S[1])}];return s[h]=E,E}var r={},o={},s={},a=Array.prototype.join;fabric.util.drawArc=function(e,i,n,r){for(var o=r[0],s=r[1],a=r[2],l=r[3],c=r[4],h=r[5],u=r[6],f=[[],[],[],[]],d=t(h-i,u-n,o,s,l,c,a),p=0,g=d.length;g>p;p++)f[p][0]=d[p][0]+i,f[p][1]=d[p][1]+n,f[p][2]=d[p][2]+i,f[p][3]=d[p][3]+n,f[p][4]=d[p][4]+i,f[p][5]=d[p][5]+n,e.bezierCurveTo.apply(e,f[p])},fabric.util.getBoundsOfArc=function(e,i,r,o,s,a,l,c,h){for(var u=0,f=0,d=[],p=[],g=t(c-e,h-i,r,o,a,l,s),v=[[],[]],m=0,b=g.length;b>m;m++)d=n(u,f,g[m][0],g[m][1],g[m][2],g[m][3],g[m][4],g[m][5]),v[0].x=d[0].x+e,v[0].y=d[0].y+i,v[1].x=d[1].x+e,v[1].y=d[1].y+i,p.push(v[0]),p.push(v[1]),u=g[m][4],f=g[m][5];return p},fabric.util.getBoundsOfCurve=n}(),function(){function t(t,e){for(var i=r.call(arguments,2),n=[],o=0,s=t.length;s>o;o++)n[o]=i.length?t[o][e].apply(t[o],i):t[o][e].call(t[o]);return n}function e(t,e){return n(t,e,function(t,e){return t>=e})}function i(t,e){return n(t,e,function(t,e){return e>t})}function n(t,e,i){if(t&&0!==t.length){var n=t.length-1,r=e?t[n][e]:t[n];if(e)for(;n--;)i(t[n][e],r)&&(r=t[n][e]);else for(;n--;)i(t[n],r)&&(r=t[n]);return r}}var r=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(t){if(void 0===this||null===this)throw new TypeError;var e=Object(this),i=e.length>>>0;if(0===i)return-1;var n=0;if(arguments.length>0&&(n=Number(arguments[1]),n!==n?n=0:0!==n&&n!==Number.POSITIVE_INFINITY&&n!==Number.NEGATIVE_INFINITY&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=i)return-1;for(var r=n>=0?n:Math.max(i-Math.abs(n),0);i>r;r++)if(r in e&&e[r]===t)return r;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){for(var i=0,n=this.length>>>0;n>i;i++)i in this&&t.call(e,this[i],i,this)}),Array.prototype.map||(Array.prototype.map=function(t,e){for(var i=[],n=0,r=this.length>>>0;r>n;n++)n in this&&(i[n]=t.call(e,this[n],n,this));return i}),Array.prototype.every||(Array.prototype.every=function(t,e){for(var i=0,n=this.length>>>0;n>i;i++)if(i in this&&!t.call(e,this[i],i,this))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(t,e){for(var i=0,n=this.length>>>0;n>i;i++)if(i in this&&t.call(e,this[i],i,this))return!0;return!1}),Array.prototype.filter||(Array.prototype.filter=function(t,e){for(var i,n=[],r=0,o=this.length>>>0;o>r;r++)r in this&&(i=this[r],t.call(e,i,r,this)&&n.push(i));return n}),Array.prototype.reduce||(Array.prototype.reduce=function(t){var e,i=this.length>>>0,n=0;if(arguments.length>1)e=arguments[1];else for(;;){if(n in this){e=this[n++];break}if(++n>=i)throw new TypeError}for(;i>n;n++)n in this&&(e=t.call(null,e,this[n],n,this));return e}),fabric.util.array={invoke:t,min:i,max:e}}(),function(){function t(t,e){for(var i in e)t[i]=e[i];return t}function e(e){return t({},e)}fabric.util.object={extend:t,clone:e}}(),function(){function t(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})}function e(t,e){return t.charAt(0).toUpperCase()+(e?t.slice(1):t.slice(1).toLowerCase())}function i(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}),fabric.util.string={camelize:t,capitalize:e,escapeXml:i}}(),function(){var t=Array.prototype.slice,e=Function.prototype.apply,i=function(){};Function.prototype.bind||(Function.prototype.bind=function(n){var r,o=this,s=t.call(arguments,1);return r=s.length?function(){return e.call(o,this instanceof i?this:n,s.concat(t.call(arguments)))}:function(){return e.call(o,this instanceof i?this:n,arguments)},i.prototype=this.prototype,r.prototype=new i,r})}(),function(){function t(){}function e(t){var e=this.constructor.superclass.prototype[t];return arguments.length>1?e.apply(this,n.call(arguments,1)):e.call(this)}function i(){function i(){this.initialize.apply(this,arguments)}var o=null,a=n.call(arguments,0);"function"==typeof a[0]&&(o=a.shift()),i.superclass=o,i.subclasses=[],o&&(t.prototype=o.prototype,i.prototype=new t,o.subclasses.push(i));for(var l=0,c=a.length;c>l;l++)s(i,a[l],o);return i.prototype.initialize||(i.prototype.initialize=r),i.prototype.constructor=i,i.prototype.callSuper=e,i}var n=Array.prototype.slice,r=function(){},o=function(){for(var t in{toString:1})if("toString"===t)return!1;return!0}(),s=function(t,e,i){for(var n in e)n in t.prototype&&"function"==typeof t.prototype[n]&&(e[n]+"").indexOf("callSuper")>-1?t.prototype[n]=function(t){return function(){var n=this.constructor.superclass;this.constructor.superclass=i;var r=e[t].apply(this,arguments);return this.constructor.superclass=n,"initialize"!==t?r:void 0}}(n):t.prototype[n]=e[n],o&&(e.toString!==Object.prototype.toString&&(t.prototype.toString=e.toString),e.valueOf!==Object.prototype.valueOf&&(t.prototype.valueOf=e.valueOf))};fabric.util.createClass=i}(),function(){function t(t){var e,i,n=Array.prototype.slice.call(arguments,1),r=n.length;for(i=0;r>i;i++)if(e=typeof t[n[i]],!/^(?:function|object|unknown)$/.test(e))return!1;return!0}function e(t,e){return{handler:e,wrappedHandler:i(t,e)}}function i(t,e){return function(i){e.call(s(t),i||fabric.window.event)}}function n(t,e){return function(i){if(g[t]&&g[t][e])for(var n=g[t][e],r=0,o=n.length;o>r;r++)n[r].call(this,i||fabric.window.event)}}function r(t,e){t||(t=fabric.window.event);var i=t.target||(typeof t.srcElement!==l?t.srcElement:null),n=fabric.util.getScrollLeftTop(i,e);return{x:v(t)+n.left,y:m(t)+n.top}}function o(t,e,i){var n="touchend"===t.type?"changedTouches":"touches";return t[n]&&t[n][0]?t[n][0][e]-(t[n][0][e]-t[n][0][i])||t[i]:t[i]}var s,a,l="unknown",c=function(){var t=0;return function(e){return e.__uniqueID||(e.__uniqueID="uniqueID__"+t++)}}();!function(){var t={};s=function(e){return t[e]},a=function(e,i){t[e]=i}}();var h,u,f=t(fabric.document.documentElement,"addEventListener","removeEventListener")&&t(fabric.window,"addEventListener","removeEventListener"),d=t(fabric.document.documentElement,"attachEvent","detachEvent")&&t(fabric.window,"attachEvent","detachEvent"),p={},g={};f?(h=function(t,e,i){t.addEventListener(e,i,!1)},u=function(t,e,i){t.removeEventListener(e,i,!1)}):d?(h=function(t,i,n){var r=c(t);a(r,t),p[r]||(p[r]={}),p[r][i]||(p[r][i]=[]);var o=e(r,n);p[r][i].push(o),t.attachEvent("on"+i,o.wrappedHandler)},u=function(t,e,i){var n,r=c(t);if(p[r]&&p[r][e])for(var o=0,s=p[r][e].length;s>o;o++)n=p[r][e][o],n&&n.handler===i&&(t.detachEvent("on"+e,n.wrappedHandler),p[r][e][o]=null)}):(h=function(t,e,i){var r=c(t);if(g[r]||(g[r]={}),!g[r][e]){g[r][e]=[];var o=t["on"+e];o&&g[r][e].push(o),t["on"+e]=n(r,e)}g[r][e].push(i)},u=function(t,e,i){var n=c(t);if(g[n]&&g[n][e])for(var r=g[n][e],o=0,s=r.length;s>o;o++)r[o]===i&&r.splice(o,1)}),fabric.util.addListener=h,fabric.util.removeListener=u;var v=function(t){return typeof t.clientX!==l?t.clientX:0},m=function(t){return typeof t.clientY!==l?t.clientY:0};fabric.isTouchSupported&&(v=function(t){return o(t,"pageX","clientX")},m=function(t){return o(t,"pageY","clientY")}),fabric.util.getPointer=r,fabric.util.object.extend(fabric.util,fabric.Observable)}(),function(){function t(t,e){var i=t.style;if(!i)return t;if("string"==typeof e)return t.style.cssText+=";"+e,e.indexOf("opacity")>-1?o(t,e.match(/opacity:\s*(\d?\.?\d*)/)[1]):t;for(var n in e)if("opacity"===n)o(t,e[n]);else{var r="float"===n||"cssFloat"===n?"undefined"==typeof i.styleFloat?"cssFloat":"styleFloat":n;i[r]=e[n]}return t}var e=fabric.document.createElement("div"),i="string"==typeof e.style.opacity,n="string"==typeof e.style.filter,r=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,o=function(t){return t};i?o=function(t,e){return t.style.opacity=e,t}:n&&(o=function(t,e){var i=t.style;return t.currentStyle&&!t.currentStyle.hasLayout&&(i.zoom=1),r.test(i.filter)?(e=e>=.9999?"":"alpha(opacity="+100*e+")",i.filter=i.filter.replace(r,e)):i.filter+=" alpha(opacity="+100*e+")",t}),fabric.util.setStyle=t}(),function(){function t(t){return"string"==typeof t?fabric.document.getElementById(t):t}function e(t,e){var i=fabric.document.createElement(t);for(var n in e)"class"===n?i.className=e[n]:"for"===n?i.htmlFor=e[n]:i.setAttribute(n,e[n]);return i}function i(t,e){t&&-1===(" "+t.className+" ").indexOf(" "+e+" ")&&(t.className+=(t.className?" ":"")+e)}function n(t,i,n){return"string"==typeof i&&(i=e(i,n)),t.parentNode&&t.parentNode.replaceChild(i,t),i.appendChild(t),i}function r(t,e){var i,n,r=0,o=0,s=fabric.document.documentElement,a=fabric.document.body||{scrollLeft:0,scrollTop:0};for(n=t;t&&t.parentNode&&!i;)t=t.parentNode,1===t.nodeType&&"fixed"===fabric.util.getElementStyle(t,"position")&&(i=t),1===t.nodeType&&n!==e&&"absolute"===fabric.util.getElementStyle(t,"position")?(r=0,o=0):t===fabric.document?(r=a.scrollLeft||s.scrollLeft||0,o=a.scrollTop||s.scrollTop||0):(r+=t.scrollLeft||0,o+=t.scrollTop||0);return{left:r,top:o}}function o(t){var e,i,n=t&&t.ownerDocument,r={left:0,top:0},o={left:0,top:0},s={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!n)return{left:0,top:0};for(var a in s)o[s[a]]+=parseInt(h(t,a),10)||0;return e=n.documentElement,"undefined"!=typeof t.getBoundingClientRect&&(r=t.getBoundingClientRect()),i=fabric.util.getScrollLeftTop(t,null),{left:r.left+i.left-(e.clientLeft||0)+o.left,top:r.top+i.top-(e.clientTop||0)+o.top}}var s,a=Array.prototype.slice,l=function(t){return a.call(t,0)};try{s=l(fabric.document.childNodes)instanceof Array}catch(c){}s||(l=function(t){for(var e=new Array(t.length),i=t.length;i--;)e[i]=t[i];return e});var h;h=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(t,e){var i=fabric.document.defaultView.getComputedStyle(t,null);
return i?i[e]:void 0}:function(t,e){var i=t.style[e];return!i&&t.currentStyle&&(i=t.currentStyle[e]),i},function(){function t(t){return"undefined"!=typeof t.onselectstart&&(t.onselectstart=fabric.util.falseFunction),n?t.style[n]="none":"string"==typeof t.unselectable&&(t.unselectable="on"),t}function e(t){return"undefined"!=typeof t.onselectstart&&(t.onselectstart=null),n?t.style[n]="":"string"==typeof t.unselectable&&(t.unselectable=""),t}var i=fabric.document.documentElement.style,n="userSelect"in i?"userSelect":"MozUserSelect"in i?"MozUserSelect":"WebkitUserSelect"in i?"WebkitUserSelect":"KhtmlUserSelect"in i?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=t,fabric.util.makeElementSelectable=e}(),function(){function t(t,e){var i=fabric.document.getElementsByTagName("head")[0],n=fabric.document.createElement("script"),r=!0;n.onload=n.onreadystatechange=function(t){if(r){if("string"==typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)return;r=!1,e(t||fabric.window.event),n=n.onload=n.onreadystatechange=null}},n.src=t,i.appendChild(n)}fabric.util.getScript=t}(),fabric.util.getById=t,fabric.util.toArray=l,fabric.util.makeElement=e,fabric.util.addClass=i,fabric.util.wrapElement=n,fabric.util.getScrollLeftTop=r,fabric.util.getElementOffset=o,fabric.util.getElementStyle=h}(),function(){function t(t,e){return t+(/\?/.test(t)?"&":"?")+e}function e(){}function i(i,r){r||(r={});var o,s=r.method?r.method.toUpperCase():"GET",a=r.onComplete||function(){},l=n();return l.onreadystatechange=function(){4===l.readyState&&(a(l),l.onreadystatechange=e)},"GET"===s&&(o=null,"string"==typeof r.parameters&&(i=t(i,r.parameters))),l.open(s,i,!0),("POST"===s||"PUT"===s)&&l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),l.send(o),l}var n=function(){for(var t=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],e=t.length;e--;)try{var i=t[e]();if(i)return t[e]}catch(n){}}();fabric.util.request=i}(),fabric.log=function(){},fabric.warn=function(){},"undefined"!=typeof console&&["log","warn"].forEach(function(t){"undefined"!=typeof console[t]&&"function"==typeof console[t].apply&&(fabric[t]=function(){return console[t].apply(console,arguments)})}),function(){function t(t){e(function(i){t||(t={});var n,r=i||+new Date,o=t.duration||500,s=r+o,a=t.onChange||function(){},l=t.abort||function(){return!1},c=t.easing||function(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e},h="startValue"in t?t.startValue:0,u="endValue"in t?t.endValue:100,f=t.byValue||u-h;t.onStart&&t.onStart(),function d(i){n=i||+new Date;var u=n>s?o:n-r;return l()?void(t.onComplete&&t.onComplete()):(a(c(u,h,f,o)),n>s?void(t.onComplete&&t.onComplete()):void e(d))}(r)})}function e(){return i.apply(fabric.window,arguments)}var i=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(t){fabric.window.setTimeout(t,1e3/60)};fabric.util.animate=t,fabric.util.requestAnimFrame=e}(),function(){function t(t,e,i,n){return t<Math.abs(e)?(t=e,n=i/4):n=i/(2*Math.PI)*Math.asin(e/t),{a:t,c:e,p:i,s:n}}function e(t,e,i){return t.a*Math.pow(2,10*(e-=1))*Math.sin(2*(e*i-t.s)*Math.PI/t.p)}function i(t,e,i,n){return i*((t=t/n-1)*t*t+1)+e}function n(t,e,i,n){return t/=n/2,1>t?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e}function r(t,e,i,n){return i*(t/=n)*t*t*t+e}function o(t,e,i,n){return-i*((t=t/n-1)*t*t*t-1)+e}function s(t,e,i,n){return t/=n/2,1>t?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e}function a(t,e,i,n){return i*(t/=n)*t*t*t*t+e}function l(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e}function c(t,e,i,n){return t/=n/2,1>t?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e}function h(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e}function u(t,e,i,n){return i*Math.sin(t/n*(Math.PI/2))+e}function f(t,e,i,n){return-i/2*(Math.cos(Math.PI*t/n)-1)+e}function d(t,e,i,n){return 0===t?e:i*Math.pow(2,10*(t/n-1))+e}function p(t,e,i,n){return t===n?e+i:i*(-Math.pow(2,-10*t/n)+1)+e}function g(t,e,i,n){return 0===t?e:t===n?e+i:(t/=n/2,1>t?i/2*Math.pow(2,10*(t-1))+e:i/2*(-Math.pow(2,-10*--t)+2)+e)}function v(t,e,i,n){return-i*(Math.sqrt(1-(t/=n)*t)-1)+e}function m(t,e,i,n){return i*Math.sqrt(1-(t=t/n-1)*t)+e}function b(t,e,i,n){return t/=n/2,1>t?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e}function y(i,n,r,o){var s=1.70158,a=0,l=r;if(0===i)return n;if(i/=o,1===i)return n+r;a||(a=.3*o);var c=t(l,r,a,s);return-e(c,i,o)+n}function C(e,i,n,r){var o=1.70158,s=0,a=n;if(0===e)return i;if(e/=r,1===e)return i+n;s||(s=.3*r);var l=t(a,n,s,o);return l.a*Math.pow(2,-10*e)*Math.sin(2*(e*r-l.s)*Math.PI/l.p)+l.c+i}function x(i,n,r,o){var s=1.70158,a=0,l=r;if(0===i)return n;if(i/=o/2,2===i)return n+r;a||(a=.3*o*1.5);var c=t(l,r,a,s);return 1>i?-.5*e(c,i,o)+n:c.a*Math.pow(2,-10*(i-=1))*Math.sin(2*(i*o-c.s)*Math.PI/c.p)*.5+c.c+n}function w(t,e,i,n,r){return void 0===r&&(r=1.70158),i*(t/=n)*t*((r+1)*t-r)+e}function _(t,e,i,n,r){return void 0===r&&(r=1.70158),i*((t=t/n-1)*t*((r+1)*t+r)+1)+e}function S(t,e,i,n,r){return void 0===r&&(r=1.70158),t/=n/2,1>t?i/2*t*t*(((r*=1.525)+1)*t-r)+e:i/2*((t-=2)*t*(((r*=1.525)+1)*t+r)+2)+e}function O(t,e,i,n){return i-T(n-t,0,i,n)+e}function T(t,e,i,n){return(t/=n)<1/2.75?7.5625*i*t*t+e:2/2.75>t?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:2.5/2.75>t?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e}function k(t,e,i,n){return n/2>t?.5*O(2*t,0,i,n)+e:.5*T(2*t-n,0,i,n)+.5*i+e}fabric.util.ease={easeInQuad:function(t,e,i,n){return i*(t/=n)*t+e},easeOutQuad:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},easeInOutQuad:function(t,e,i,n){return t/=n/2,1>t?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},easeInCubic:function(t,e,i,n){return i*(t/=n)*t*t+e},easeOutCubic:i,easeInOutCubic:n,easeInQuart:r,easeOutQuart:o,easeInOutQuart:s,easeInQuint:a,easeOutQuint:l,easeInOutQuint:c,easeInSine:h,easeOutSine:u,easeInOutSine:f,easeInExpo:d,easeOutExpo:p,easeInOutExpo:g,easeInCirc:v,easeOutCirc:m,easeInOutCirc:b,easeInElastic:y,easeOutElastic:C,easeInOutElastic:x,easeInBack:w,easeOutBack:_,easeInOutBack:S,easeInBounce:O,easeOutBounce:T,easeInOutBounce:k}}(),function(t){"use strict";function e(t){return t in x?x[t]:t}function i(t,e,i,n){var r,o="[object Array]"===Object.prototype.toString.call(e);return"fill"!==t&&"stroke"!==t||"none"!==e?"strokeDashArray"===t?e=e.replace(/,/g," ").split(/\s+/).map(function(t){return parseFloat(t)}):"transformMatrix"===t?e=i&&i.transformMatrix?C(i.transformMatrix,p.parseTransformAttribute(e)):p.parseTransformAttribute(e):"visible"===t?(e="none"===e||"hidden"===e?!1:!0,i&&i.visible===!1&&(e=!1)):"originX"===t?e="start"===e?"left":"end"===e?"right":"center":r=o?e.map(y):y(e,n):e="",!o&&isNaN(r)?e:r}function n(t){for(var e in w)if(t[e]&&"undefined"!=typeof t[w[e]]&&0!==t[e].indexOf("url(")){var i=new p.Color(t[e]);t[e]=i.setAlpha(b(i.getAlpha()*t[w[e]],2)).toRgba()}return t}function r(t,n){var r,o;t.replace(/;$/,"").split(";").forEach(function(t){var s=t.split(":");r=e(s[0].trim().toLowerCase()),o=i(r,s[1].trim()),n[r]=o})}function o(t,n){var r,o;for(var s in t)"undefined"!=typeof t[s]&&(r=e(s.toLowerCase()),o=i(r,t[s]),n[r]=o)}function s(t,e){var i={};for(var n in p.cssRules[e])if(a(t,n.split(" ")))for(var r in p.cssRules[e][n])i[r]=p.cssRules[e][n][r];return i}function a(t,e){var i,n=!0;return i=c(t,e.pop()),i&&e.length&&(n=l(t,e)),i&&n&&0===e.length}function l(t,e){for(var i,n=!0;t.parentNode&&1===t.parentNode.nodeType&&e.length;)n&&(i=e.pop()),t=t.parentNode,n=c(t,i);return 0===e.length}function c(t,e){var i,n=t.nodeName,r=t.getAttribute("class"),o=t.getAttribute("id");if(i=new RegExp("^"+n,"i"),e=e.replace(i,""),o&&e.length&&(i=new RegExp("#"+o+"(?![a-zA-Z\\-]+)","i"),e=e.replace(i,"")),r&&e.length){r=r.split(" ");for(var s=r.length;s--;)i=new RegExp("\\."+r[s]+"(?![a-zA-Z\\-]+)","i"),e=e.replace(i,"")}return 0===e.length}function h(t){for(var e=t.getElementsByTagName("use");e.length;){for(var i,n=e[0],r=n.getAttribute("xlink:href").substr(1),o=n.getAttribute("x")||0,s=n.getAttribute("y")||0,a=t.getElementById(r).cloneNode(!0),l=(a.getAttribute("transform")||"")+" translate("+o+", "+s+")",c=0,h=n.attributes,u=h.length;u>c;c++){var f=h.item(c);"x"!==f.nodeName&&"y"!==f.nodeName&&"xlink:href"!==f.nodeName&&("transform"===f.nodeName?l=f.nodeValue+" "+l:a.setAttribute(f.nodeName,f.nodeValue))}a.setAttribute("transform",l),a.setAttribute("instantiated_by_use","1"),a.removeAttribute("id"),i=n.parentNode,i.replaceChild(a,n)}}function u(t,e,i){var n,r,o,s,a=t.getAttribute("viewBox"),l=1,c=1,h=0,u=0;if(a&&(a=a.match(_))&&(h=-parseFloat(a[1]),u=-parseFloat(a[2]),n=parseFloat(a[3]),r=parseFloat(a[4]),e&&e!==n&&(l=e/n),i&&i!==r&&(c=i/r),c=l=l>c?c:l,1!==l||1!==c||0!==h||0!==u)){if(o=" matrix("+l+" 0 0 "+c+" "+h*l+" "+u*c+") ","svg"===t.tagName){for(s=t.ownerDocument.createElement("g");null!=t.firstChild;)s.appendChild(t.firstChild);t.appendChild(s)}else s=t,o=s.getAttribute("transform")+o;s.setAttribute("transform",o)}}function f(t){var e=t.objects,i=t.options;return e=e.map(function(t){return p[v(t.type)].fromObject(t)}),{objects:e,options:i}}function d(t,e,i){e[i]&&e[i].toSVG&&t.push('<pattern x="0" y="0" id="',i,'Pattern" ','width="',e[i].source.width,'" height="',e[i].source.height,'" patternUnits="userSpaceOnUse">','<image x="0" y="0" ','width="',e[i].source.width,'" height="',e[i].source.height,'" xlink:href="',e[i].source.src,'"></image></pattern>')}var p=t.fabric||(t.fabric={}),g=p.util.object.extend,v=p.util.string.capitalize,m=p.util.object.clone,b=p.util.toFixed,y=p.util.parseUnit,C=p.util.multiplyTransformMatrices,x={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"originX"},w={stroke:"strokeOpacity",fill:"fillOpacity"};p.cssRules={},p.gradientDefs={},p.parseTransformAttribute=function(){function t(t,e){var i=e[0];t[0]=Math.cos(i),t[1]=Math.sin(i),t[2]=-Math.sin(i),t[3]=Math.cos(i)}function e(t,e){var i=e[0],n=2===e.length?e[1]:e[0];t[0]=i,t[3]=n}function i(t,e){t[2]=Math.tan(p.util.degreesToRadians(e[0]))}function n(t,e){t[1]=Math.tan(p.util.degreesToRadians(e[0]))}function r(t,e){t[4]=e[0],2===e.length&&(t[5]=e[1])}var o=[1,0,0,1,0,0],s=p.reNum,a="(?:\\s+,?\\s*|,\\s*)",l="(?:(skewX)\\s*\\(\\s*("+s+")\\s*\\))",c="(?:(skewY)\\s*\\(\\s*("+s+")\\s*\\))",h="(?:(rotate)\\s*\\(\\s*("+s+")(?:"+a+"("+s+")"+a+"("+s+"))?\\s*\\))",u="(?:(scale)\\s*\\(\\s*("+s+")(?:"+a+"("+s+"))?\\s*\\))",f="(?:(translate)\\s*\\(\\s*("+s+")(?:"+a+"("+s+"))?\\s*\\))",d="(?:(matrix)\\s*\\(\\s*("+s+")"+a+"("+s+")"+a+"("+s+")"+a+"("+s+")"+a+"("+s+")"+a+"("+s+")\\s*\\))",g="(?:"+d+"|"+f+"|"+u+"|"+h+"|"+l+"|"+c+")",v="(?:"+g+"(?:"+a+g+")*)",m="^\\s*(?:"+v+"?)\\s*$",b=new RegExp(m),y=new RegExp(g,"g");return function(s){var a=o.concat(),l=[];if(!s||s&&!b.test(s))return a;s.replace(y,function(s){var c=new RegExp(g).exec(s).filter(function(t){return""!==t&&null!=t}),h=c[1],u=c.slice(2).map(parseFloat);switch(h){case"translate":r(a,u);break;case"rotate":u[0]=p.util.degreesToRadians(u[0]),t(a,u);break;case"scale":e(a,u);break;case"skewX":i(a,u);break;case"skewY":n(a,u);break;case"matrix":a=u}l.push(a.concat()),a=o.concat()});for(var c=l[0];l.length>1;)l.shift(),c=p.util.multiplyTransformMatrices(c,l[0]);return c}}();var _=new RegExp("^\\s*("+p.reNum+"+)\\s*,?\\s*("+p.reNum+"+)\\s*,?\\s*("+p.reNum+"+)\\s*,?\\s*("+p.reNum+"+)\\s*$");p.parseSVGDocument=function(){function t(t,e){for(;t&&(t=t.parentNode);)if(e.test(t.nodeName)&&!t.getAttribute("instantiated_by_use"))return!0;return!1}var e=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/,i=/^(symbol|image|marker|pattern|view)$/;return function(n,r,o){if(n){h(n);var s,a,l=new Date,c=p.Object.__uid++,f=!1;if(n.getAttribute("width")&&"100%"!==n.getAttribute("width")&&(s=y(n.getAttribute("width"))),n.getAttribute("height")&&"100%"!==n.getAttribute("height")&&(a=y(n.getAttribute("height"))),!s||!a){var d=n.getAttribute("viewBox");d&&(d=d.match(_))?(s=parseFloat(d[3]),a=parseFloat(d[4])):f=!0}u(n,s,a);var g=p.util.toArray(n.getElementsByTagName("*"));if(0===g.length&&p.isLikelyNode){g=n.selectNodes('//*[name(.)!="svg"]');for(var v=[],b=0,C=g.length;C>b;b++)v[b]=g[b];g=v}var x=g.filter(function(n){return i.test(n.tagName)&&u(n,0,0),e.test(n.tagName)&&!t(n,/^(?:pattern|defs|symbol)$/)});if(!x||x&&!x.length)return void(r&&r([],{}));var w={width:s,height:a,svgUid:c,toBeParsed:f};p.gradientDefs[c]=p.getGradientDefs(n),p.cssRules[c]=p.getCSSRules(n),p.parseElements(x,function(t){p.documentParsingTime=new Date-l,r&&r(t,w)},m(w),o)}}}();var S={has:function(t,e){e(!1)},get:function(){},set:function(){}},O=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+p.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+p.reNum+"))?\\s+(.*)");g(p,{parseFontDeclaration:function(t,e){var i=t.match(O);if(i){var n=i[1],r=i[3],o=i[4],s=i[5],a=i[6];n&&(e.fontStyle=n),r&&(e.fontWeight=isNaN(parseFloat(r))?r:parseFloat(r)),o&&(e.fontSize=y(o)),a&&(e.fontFamily=a),s&&(e.lineHeight="normal"===s?1:s)}},getGradientDefs:function(t){var e,i,n,r,o=t.getElementsByTagName("linearGradient"),s=t.getElementsByTagName("radialGradient"),a=0,l=[],c={},h={};for(l.length=o.length+s.length,i=o.length;i--;)l[a++]=o[i];for(i=s.length;i--;)l[a++]=s[i];for(;a--;)e=l[a],r=e.getAttribute("xlink:href"),n=e.getAttribute("id"),r&&(h[n]=r.substr(1)),c[n]=e;for(n in h){var u=c[h[n]].cloneNode(!0);for(e=c[n];u.firstChild;)e.appendChild(u.firstChild)}return c},parseAttributes:function(t,r,o){if(t){var a,l,c={};"undefined"==typeof o&&(o=t.getAttribute("svgUid")),t.parentNode&&/^symbol|[g|a]$/i.test(t.parentNode.nodeName)&&(c=p.parseAttributes(t.parentNode,r,o)),l=c&&c.fontSize||t.getAttribute("font-size")||p.Text.DEFAULT_SVG_FONT_SIZE;var h=r.reduce(function(n,r){return a=t.getAttribute(r),a&&(r=e(r),a=i(r,a,c,l),n[r]=a),n},{});return h=g(h,g(s(t,o),p.parseStyleAttribute(t))),h.font&&p.parseFontDeclaration(h.font,h),n(g(c,h))}},parseElements:function(t,e,i,n){new p.ElementsParser(t,e,i,n).parse()},parseStyleAttribute:function(t){var e={},i=t.getAttribute("style");return i?("string"==typeof i?r(i,e):o(i,e),e):e},parsePointsAttribute:function(t){if(!t)return null;t=t.replace(/,/g," ").trim(),t=t.split(/\s+/);var e,i,n=[];for(e=0,i=t.length;i>e;e+=2)n.push({x:parseFloat(t[e]),y:parseFloat(t[e+1])});return n},getCSSRules:function(t){for(var n,r=t.getElementsByTagName("style"),o={},s=0,a=r.length;a>s;s++){var l=r[s].textContent;l=l.replace(/\/\*[\s\S]*?\*\//g,""),""!==l.trim()&&(n=l.match(/[^{]*\{[\s\S]*?\}/g),n=n.map(function(t){return t.trim()}),n.forEach(function(t){for(var n=t.match(/([\s\S]*?)\s*\{([^}]*)\}/),r={},s=n[2].trim(),a=s.replace(/;$/,"").split(/\s*;\s*/),l=0,c=a.length;c>l;l++){var h=a[l].split(/\s*:\s*/),u=e(h[0]),f=i(u,h[1],h[0]);r[u]=f}t=n[1],t.split(",").forEach(function(t){t=t.replace(/^svg/i,"").trim(),""!==t&&(o[t]=p.util.object.clone(r))})}))}return o},loadSVGFromURL:function(t,e,i){function n(n){var r=n.responseXML;r&&!r.documentElement&&p.window.ActiveXObject&&n.responseText&&(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),r&&r.documentElement&&p.parseSVGDocument(r.documentElement,function(i,n){S.set(t,{objects:p.util.array.invoke(i,"toObject"),options:n}),e(i,n)},i)}t=t.replace(/^\n\s*/,"").trim(),S.has(t,function(i){i?S.get(t,function(t){var i=f(t);e(i.objects,i.options)}):new p.util.request(t,{method:"get",onComplete:n})})},loadSVGFromString:function(t,e,i){t=t.trim();var n;if("undefined"!=typeof DOMParser){var r=new DOMParser;r&&r.parseFromString&&(n=r.parseFromString(t,"text/xml"))}else p.window.ActiveXObject&&(n=new ActiveXObject("Microsoft.XMLDOM"),n.async="false",n.loadXML(t.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));p.parseSVGDocument(n.documentElement,function(t,i){e(t,i)},i)},createSVGFontFacesMarkup:function(t){for(var e="",i=0,n=t.length;n>i;i++)"text"===t[i].type&&t[i].path&&(e+=["@font-face {","font-family: ",t[i].fontFamily,"; ","src: url('",t[i].path,"')","}"].join(""));return e&&(e=['<style type="text/css">',"<![CDATA[",e,"]]>","</style>"].join("")),e},createSVGRefElementsMarkup:function(t){var e=[];return d(e,t,"backgroundColor"),d(e,t,"overlayColor"),e.join("")}})}("undefined"!=typeof exports?exports:this),fabric.ElementsParser=function(t,e,i,n){this.elements=t,this.callback=e,this.options=i,this.reviver=n,this.svgUid=i&&i.svgUid||0},fabric.ElementsParser.prototype.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},fabric.ElementsParser.prototype.createObjects=function(){for(var t=0,e=this.elements.length;e>t;t++)this.elements[t].setAttribute("svgUid",this.svgUid),function(t,e){setTimeout(function(){t.createObject(t.elements[e],e)},0)}(this,t)},fabric.ElementsParser.prototype.createObject=function(t,e){var i=fabric[fabric.util.string.capitalize(t.tagName)];if(i&&i.fromElement)try{this._createObject(i,t,e)}catch(n){fabric.log(n)}else this.checkIfDone()},fabric.ElementsParser.prototype._createObject=function(t,e,i){if(t.async)t.fromElement(e,this.createCallback(i,e),this.options);else{var n=t.fromElement(e,this.options);this.resolveGradient(n,"fill"),this.resolveGradient(n,"stroke"),this.reviver&&this.reviver(e,n),this.instances[i]=n,this.checkIfDone()}},fabric.ElementsParser.prototype.createCallback=function(t,e){var i=this;return function(n){i.resolveGradient(n,"fill"),i.resolveGradient(n,"stroke"),i.reviver&&i.reviver(e,n),i.instances[t]=n,i.checkIfDone()}},fabric.ElementsParser.prototype.resolveGradient=function(t,e){var i=t.get(e);if(/^url\(/.test(i)){var n=i.slice(5,i.length-1);fabric.gradientDefs[this.svgUid][n]&&t.set(e,fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][n],t))}},fabric.ElementsParser.prototype.checkIfDone=function(){0===--this.numElements&&(this.instances=this.instances.filter(function(t){return null!=t}),this.callback(this.instances))},function(t){"use strict";function e(t,e){this.x=t,this.y=e}var i=t.fabric||(t.fabric={});return i.Point?void i.warn("fabric.Point is already defined"):(i.Point=e,void(e.prototype={constructor:e,add:function(t){return new e(this.x+t.x,this.y+t.y)},addEquals:function(t){return this.x+=t.x,this.y+=t.y,this},scalarAdd:function(t){return new e(this.x+t,this.y+t)},scalarAddEquals:function(t){return this.x+=t,this.y+=t,this},subtract:function(t){return new e(this.x-t.x,this.y-t.y)},subtractEquals:function(t){return this.x-=t.x,this.y-=t.y,this},scalarSubtract:function(t){return new e(this.x-t,this.y-t)},scalarSubtractEquals:function(t){return this.x-=t,this.y-=t,this},multiply:function(t){return new e(this.x*t,this.y*t)},multiplyEquals:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return new e(this.x/t,this.y/t)},divideEquals:function(t){return this.x/=t,this.y/=t,this},eq:function(t){return this.x===t.x&&this.y===t.y},lt:function(t){return this.x<t.x&&this.y<t.y},lte:function(t){return this.x<=t.x&&this.y<=t.y},gt:function(t){return this.x>t.x&&this.y>t.y},gte:function(t){return this.x>=t.x&&this.y>=t.y},lerp:function(t,i){return new e(this.x+(t.x-this.x)*i,this.y+(t.y-this.y)*i)},distanceFrom:function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},midPointFrom:function(t){return new e(this.x+(t.x-this.x)/2,this.y+(t.y-this.y)/2)},min:function(t){return new e(Math.min(this.x,t.x),Math.min(this.y,t.y))},max:function(t){return new e(Math.max(this.x,t.x),Math.max(this.y,t.y))},toString:function(){return this.x+","+this.y},setXY:function(t,e){this.x=t,this.y=e},setFromPoint:function(t){this.x=t.x,this.y=t.y},swap:function(t){var e=this.x,i=this.y;this.x=t.x,this.y=t.y,t.x=e,t.y=i}}))}("undefined"!=typeof exports?exports:this),function(t){"use strict";function e(t){this.status=t,this.points=[]}var i=t.fabric||(t.fabric={});return i.Intersection?void i.warn("fabric.Intersection is already defined"):(i.Intersection=e,i.Intersection.prototype={appendPoint:function(t){this.points.push(t)},appendPoints:function(t){this.points=this.points.concat(t)}},i.Intersection.intersectLineLine=function(t,n,r,o){var s,a=(o.x-r.x)*(t.y-r.y)-(o.y-r.y)*(t.x-r.x),l=(n.x-t.x)*(t.y-r.y)-(n.y-t.y)*(t.x-r.x),c=(o.y-r.y)*(n.x-t.x)-(o.x-r.x)*(n.y-t.y);if(0!==c){var h=a/c,u=l/c;h>=0&&1>=h&&u>=0&&1>=u?(s=new e("Intersection"),s.points.push(new i.Point(t.x+h*(n.x-t.x),t.y+h*(n.y-t.y)))):s=new e}else s=new e(0===a||0===l?"Coincident":"Parallel");return s},i.Intersection.intersectLinePolygon=function(t,i,n){for(var r=new e,o=n.length,s=0;o>s;s++){var a=n[s],l=n[(s+1)%o],c=e.intersectLineLine(t,i,a,l);r.appendPoints(c.points)}return r.points.length>0&&(r.status="Intersection"),r},i.Intersection.intersectPolygonPolygon=function(t,i){for(var n=new e,r=t.length,o=0;r>o;o++){var s=t[o],a=t[(o+1)%r],l=e.intersectLinePolygon(s,a,i);n.appendPoints(l.points)}return n.points.length>0&&(n.status="Intersection"),n},i.Intersection.intersectPolygonRectangle=function(t,n,r){var o=n.min(r),s=n.max(r),a=new i.Point(s.x,o.y),l=new i.Point(o.x,s.y),c=e.intersectLinePolygon(o,a,t),h=e.intersectLinePolygon(a,s,t),u=e.intersectLinePolygon(s,l,t),f=e.intersectLinePolygon(l,o,t),d=new e;return d.appendPoints(c.points),d.appendPoints(h.points),d.appendPoints(u.points),d.appendPoints(f.points),d.points.length>0&&(d.status="Intersection"),d},void 0)}("undefined"!=typeof exports?exports:this),function(t){"use strict";function e(t){t?this._tryParsingColor(t):this.setSource([0,0,0,1])}function i(t,e,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?t+6*(e-t)*i:.5>i?e:2/3>i?t+(e-t)*(2/3-i)*6:t}var n=t.fabric||(t.fabric={});return n.Color?void n.warn("fabric.Color is already defined."):(n.Color=e,n.Color.prototype={_tryParsingColor:function(t){var i;return t in e.colorNameMap&&(t=e.colorNameMap[t]),"transparent"===t?void this.setSource([255,255,255,0]):(i=e.sourceFromHex(t),i||(i=e.sourceFromRgb(t)),i||(i=e.sourceFromHsl(t)),i&&this.setSource(i),void 0)},_rgbToHsl:function(t,e,i){t/=255,e/=255,i/=255;var r,o,s,a=n.util.array.max([t,e,i]),l=n.util.array.min([t,e,i]);if(s=(a+l)/2,a===l)r=o=0;else{var c=a-l;switch(o=s>.5?c/(2-a-l):c/(a+l),a){case t:r=(e-i)/c+(i>e?6:0);break;case e:r=(i-t)/c+2;break;case i:r=(t-e)/c+4}r/=6}return[Math.round(360*r),Math.round(100*o),Math.round(100*s)]},getSource:function(){return this._source},setSource:function(t){this._source=t},toRgb:function(){var t=this.getSource();return"rgb("+t[0]+","+t[1]+","+t[2]+")"},toRgba:function(){var t=this.getSource();return"rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"},toHsl:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsl("+e[0]+","+e[1]+"%,"+e[2]+"%)"},toHsla:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsla("+e[0]+","+e[1]+"%,"+e[2]+"%,"+t[3]+")"},toHex:function(){var t,e,i,n=this.getSource();return t=n[0].toString(16),t=1===t.length?"0"+t:t,e=n[1].toString(16),e=1===e.length?"0"+e:e,i=n[2].toString(16),i=1===i.length?"0"+i:i,t.toUpperCase()+e.toUpperCase()+i.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(t){var e=this.getSource();return e[3]=t,this.setSource(e),this},toGrayscale:function(){var t=this.getSource(),e=parseInt((.3*t[0]+.59*t[1]+.11*t[2]).toFixed(0),10),i=t[3];return this.setSource([e,e,e,i]),this},toBlackWhite:function(t){var e=this.getSource(),i=(.3*e[0]+.59*e[1]+.11*e[2]).toFixed(0),n=e[3];return t=t||127,i=Number(i)<Number(t)?0:255,this.setSource([i,i,i,n]),this},overlayWith:function(t){t instanceof e||(t=new e(t));for(var i=[],n=this.getAlpha(),r=.5,o=this.getSource(),s=t.getSource(),a=0;3>a;a++)i.push(Math.round(o[a]*(1-r)+s[a]*r));return i[3]=n,this.setSource(i),this}},n.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,n.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,n.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,n.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},n.Color.fromRgb=function(t){return e.fromSource(e.sourceFromRgb(t))},n.Color.sourceFromRgb=function(t){var i=t.match(e.reRGBa);if(i){var n=parseInt(i[1],10)/(/%$/.test(i[1])?100:1)*(/%$/.test(i[1])?255:1),r=parseInt(i[2],10)/(/%$/.test(i[2])?100:1)*(/%$/.test(i[2])?255:1),o=parseInt(i[3],10)/(/%$/.test(i[3])?100:1)*(/%$/.test(i[3])?255:1);return[parseInt(n,10),parseInt(r,10),parseInt(o,10),i[4]?parseFloat(i[4]):1]}},n.Color.fromRgba=e.fromRgb,n.Color.fromHsl=function(t){return e.fromSource(e.sourceFromHsl(t))},n.Color.sourceFromHsl=function(t){var n=t.match(e.reHSLa);if(n){var r,o,s,a=(parseFloat(n[1])%360+360)%360/360,l=parseFloat(n[2])/(/%$/.test(n[2])?100:1),c=parseFloat(n[3])/(/%$/.test(n[3])?100:1);if(0===l)r=o=s=c;else{var h=.5>=c?c*(l+1):c+l-c*l,u=2*c-h;r=i(u,h,a+1/3),o=i(u,h,a),s=i(u,h,a-1/3)}return[Math.round(255*r),Math.round(255*o),Math.round(255*s),n[4]?parseFloat(n[4]):1]}},n.Color.fromHsla=e.fromHsl,n.Color.fromHex=function(t){return e.fromSource(e.sourceFromHex(t))},n.Color.sourceFromHex=function(t){if(t.match(e.reHex)){var i=t.slice(t.indexOf("#")+1),n=3===i.length,r=n?i.charAt(0)+i.charAt(0):i.substring(0,2),o=n?i.charAt(1)+i.charAt(1):i.substring(2,4),s=n?i.charAt(2)+i.charAt(2):i.substring(4,6);return[parseInt(r,16),parseInt(o,16),parseInt(s,16),1]}},n.Color.fromSource=function(t){var i=new e;return i.setSource(t),i},void 0)}("undefined"!=typeof exports?exports:this),function(){function t(t){var e,i,n,r=t.getAttribute("style"),o=t.getAttribute("offset");if(o=parseFloat(o)/(/%$/.test(o)?100:1),o=0>o?0:o>1?1:o,r){var s=r.split(/\s*;\s*/);""===s[s.length-1]&&s.pop();for(var a=s.length;a--;){var l=s[a].split(/\s*:\s*/),c=l[0].trim(),h=l[1].trim();"stop-color"===c?e=h:"stop-opacity"===c&&(n=h)}}return e||(e=t.getAttribute("stop-color")||"rgb(0,0,0)"),n||(n=t.getAttribute("stop-opacity")),e=new fabric.Color(e),i=e.getAlpha(),n=isNaN(parseFloat(n))?1:parseFloat(n),n*=i,{offset:o,color:e.toRgb(),opacity:n}}function e(t){return{x1:t.getAttribute("x1")||0,y1:t.getAttribute("y1")||0,x2:t.getAttribute("x2")||"100%",y2:t.getAttribute("y2")||0}}function i(t){return{x1:t.getAttribute("fx")||t.getAttribute("cx")||"50%",y1:t.getAttribute("fy")||t.getAttribute("cy")||"50%",r1:0,x2:t.getAttribute("cx")||"50%",y2:t.getAttribute("cy")||"50%",r2:t.getAttribute("r")||"50%"}}function n(t,e,i){var n,r=0,o=1,s="";for(var a in e)n=parseFloat(e[a],10),o="string"==typeof e[a]&&/^\d+%$/.test(e[a])?.01:1,"x1"===a||"x2"===a||"r2"===a?(o*="objectBoundingBox"===i?t.width:1,r="objectBoundingBox"===i?t.left||0:0):("y1"===a||"y2"===a)&&(o*="objectBoundingBox"===i?t.height:1,r="objectBoundingBox"===i?t.top||0:0),e[a]=n*o+r;if("ellipse"===t.type&&null!==e.r2&&"objectBoundingBox"===i&&t.rx!==t.ry){var l=t.ry/t.rx;s=" scale(1, "+l+")",e.y1&&(e.y1/=l),e.y2&&(e.y2/=l)}return s}fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,initialize:function(t){t||(t={});var e={};this.id=fabric.Object.__uid++,this.type=t.type||"linear",e={x1:t.coords.x1||0,y1:t.coords.y1||0,x2:t.coords.x2||0,y2:t.coords.y2||0},"radial"===this.type&&(e.r1=t.coords.r1||0,e.r2=t.coords.r2||0),this.coords=e,this.colorStops=t.colorStops.slice(),t.gradientTransform&&(this.gradientTransform=t.gradientTransform),this.offsetX=t.offsetX||this.offsetX,this.offsetY=t.offsetY||this.offsetY},addColorStop:function(t){for(var e in t){var i=new fabric.Color(t[e]);this.colorStops.push({offset:e,color:i.toRgb(),opacity:i.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(t){var e,i,n=fabric.util.object.clone(this.coords);if(this.colorStops.sort(function(t,e){return t.offset-e.offset}),!t.group||"path-group"!==t.group.type)for(var r in n)"x1"===r||"x2"===r||"r2"===r?n[r]+=this.offsetX-t.width/2:("y1"===r||"y2"===r)&&(n[r]+=this.offsetY-t.height/2);i='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"',this.gradientTransform&&(i+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" '),"linear"===this.type?e=["<linearGradient ",i,' x1="',n.x1,'" y1="',n.y1,'" x2="',n.x2,'" y2="',n.y2,'">\n']:"radial"===this.type&&(e=["<radialGradient ",i,' cx="',n.x2,'" cy="',n.y2,'" r="',n.r2,'" fx="',n.x1,'" fy="',n.y1,'">\n']);for(var o=0;o<this.colorStops.length;o++)e.push("<stop ",'offset="',100*this.colorStops[o].offset+"%",'" style="stop-color:',this.colorStops[o].color,null!=this.colorStops[o].opacity?";stop-opacity: "+this.colorStops[o].opacity:";",'"/>\n');return e.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),e.join("")},toLive:function(t,e){var i,n,r=fabric.util.object.clone(this.coords);if(this.type){if(e.group&&"path-group"===e.group.type)for(n in r)"x1"===n||"x2"===n?r[n]+=-this.offsetX+e.width/2:("y1"===n||"y2"===n)&&(r[n]+=-this.offsetY+e.height/2);if("text"===e.type||"i-text"===e.type)for(n in r)"x1"===n||"x2"===n?r[n]-=e.width/2:("y1"===n||"y2"===n)&&(r[n]-=e.height/2);"linear"===this.type?i=t.createLinearGradient(r.x1,r.y1,r.x2,r.y2):"radial"===this.type&&(i=t.createRadialGradient(r.x1,r.y1,r.r1,r.x2,r.y2,r.r2));for(var o=0,s=this.colorStops.length;s>o;o++){var a=this.colorStops[o].color,l=this.colorStops[o].opacity,c=this.colorStops[o].offset;"undefined"!=typeof l&&(a=new fabric.Color(a).setAlpha(l).toRgba()),i.addColorStop(parseFloat(c),a)}return i}}}),fabric.util.object.extend(fabric.Gradient,{fromElement:function(r,o){var s,a=r.getElementsByTagName("stop"),l="linearGradient"===r.nodeName?"linear":"radial",c=r.getAttribute("gradientUnits")||"objectBoundingBox",h=r.getAttribute("gradientTransform"),u=[],f={};"linear"===l?f=e(r):"radial"===l&&(f=i(r));for(var d=a.length;d--;)u.push(t(a[d]));s=n(o,f,c);var p=new fabric.Gradient({type:l,coords:f,colorStops:u,offsetX:-o.left,offsetY:-o.top});return(h||""!==s)&&(p.gradientTransform=fabric.parseTransformAttribute((h||"")+s)),p},forObject:function(t,e){return e||(e={}),n(t,e.coords,"userSpaceOnUse"),new fabric.Gradient(e)}})}(),fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(t){if(t||(t={}),this.id=fabric.Object.__uid++,t.source)if("string"==typeof t.source)if("undefined"!=typeof fabric.util.getFunctionBody(t.source))this.source=new Function(fabric.util.getFunctionBody(t.source));else{var e=this;this.source=fabric.util.createImage(),fabric.util.loadImage(t.source,function(t){e.source=t})}else this.source=t.source;t.repeat&&(this.repeat=t.repeat),t.offsetX&&(this.offsetX=t.offsetX),t.offsetY&&(this.offsetY=t.offsetY)},toObject:function(){var t;return"function"==typeof this.source?t=String(this.source):"string"==typeof this.source.src&&(t=this.source.src),{source:t,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(t){var e="function"==typeof this.source?this.source():this.source,i=e.width/t.getWidth(),n=e.height/t.getHeight(),r=this.offsetX/t.getWidth(),o=this.offsetY/t.getHeight(),s="";return("repeat-x"===this.repeat||"no-repeat"===this.repeat)&&(n=1),("repeat-y"===this.repeat||"no-repeat"===this.repeat)&&(i=1),e.src?s=e.src:e.toDataURL&&(s=e.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+r+'" y="'+o+'" width="'+i+'" height="'+n+'">\n<image x="0" y="0" width="'+e.width+'" height="'+e.height+'" xlink:href="'+s+'"></image>\n</pattern>\n';
},toLive:function(t){var e="function"==typeof this.source?this.source():this.source;if(!e)return"";if("undefined"!=typeof e.src){if(!e.complete)return"";if(0===e.naturalWidth||0===e.naturalHeight)return""}return t.createPattern(e,this.repeat)}}),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.toFixed;return e.Shadow?void e.warn("fabric.Shadow is already defined."):(e.Shadow=e.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(t){"string"==typeof t&&(t=this._parseShadow(t));for(var i in t)this[i]=t[i];this.id=e.Object.__uid++},_parseShadow:function(t){var i=t.trim(),n=e.Shadow.reOffsetsAndBlur.exec(i)||[],r=i.replace(e.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:r.trim(),offsetX:parseInt(n[1],10)||0,offsetY:parseInt(n[2],10)||0,blur:parseInt(n[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(t){var e="SourceAlpha",n=40,r=40;return t&&(t.fill===this.color||t.stroke===this.color)&&(e="SourceGraphic"),t.width&&t.height&&(n=100*i(Math.abs(this.offsetX/t.getWidth()),2)+20,r=100*i(Math.abs(this.offsetY/t.getHeight()),2)+20),'<filter id="SVGID_'+this.id+'" y="-'+r+'%" height="'+(100+2*r)+'%" x="-'+n+'%" width="'+(100+2*n)+'%" >\n	<feGaussianBlur in="'+e+'" stdDeviation="'+i(this.blur?this.blur/2:0,3)+'" result="blurOut"></feGaussianBlur>\n	<feColorMatrix result="matrixOut" in="blurOut" type="matrix" values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 0.30 0" ></feColorMatrix >\n	<feOffset dx="'+this.offsetX+'" dy="'+this.offsetY+'"></feOffset>\n	<feMerge>\n		<feMergeNode></feMergeNode>\n		<feMergeNode in="SourceGraphic"></feMergeNode>\n	</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY};var t={},i=e.Shadow.prototype;return this.color!==i.color&&(t.color=this.color),this.blur!==i.blur&&(t.blur=this.blur),this.offsetX!==i.offsetX&&(t.offsetX=this.offsetX),this.offsetY!==i.offsetY&&(t.offsetY=this.offsetY),t}}),void(e.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/))}("undefined"!=typeof exports?exports:this),function(){"use strict";if(fabric.StaticCanvas)return void fabric.warn("fabric.StaticCanvas is already defined.");var t=fabric.util.object.extend,e=fabric.util.getElementOffset,i=fabric.util.removeFromArray,n=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(t,e){e||(e={}),this._initStatic(t,e),fabric.StaticCanvas.activeInstance=this},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,preserveObjectStacking:!1,viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},_initStatic:function(t,e){this._objects=[],this._createLowerCanvas(t),this._initOptions(e),this._setImageSmoothing(),e.overlayImage&&this.setOverlayImage(e.overlayImage,this.renderAll.bind(this)),e.backgroundImage&&this.setBackgroundImage(e.backgroundImage,this.renderAll.bind(this)),e.backgroundColor&&this.setBackgroundColor(e.backgroundColor,this.renderAll.bind(this)),e.overlayColor&&this.setOverlayColor(e.overlayColor,this.renderAll.bind(this)),this.calcOffset()},calcOffset:function(){return this._offset=e(this.lowerCanvasEl),this},setOverlayImage:function(t,e,i){return this.__setBgOverlayImage("overlayImage",t,e,i)},setBackgroundImage:function(t,e,i){return this.__setBgOverlayImage("backgroundImage",t,e,i)},setOverlayColor:function(t,e){return this.__setBgOverlayColor("overlayColor",t,e)},setBackgroundColor:function(t,e){return this.__setBgOverlayColor("backgroundColor",t,e)},_setImageSmoothing:function(){var t=this.getContext();t.imageSmoothingEnabled=this.imageSmoothingEnabled,t.imageSmoothingEnabled=this.imageSmoothingEnabled,t.mozImageSmoothingEnabled=this.imageSmoothingEnabled,t.msImageSmoothingEnabled=this.imageSmoothingEnabled,t.oImageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(t,e,i,n){return"string"==typeof e?fabric.util.loadImage(e,function(e){this[t]=new fabric.Image(e,n),i&&i()},this,n&&n.crossOrigin):(n&&e.setOptions(n),this[t]=e,i&&i()),this},__setBgOverlayColor:function(t,e,i){if(e&&e.source){var n=this;fabric.util.loadImage(e.source,function(r){n[t]=new fabric.Pattern({source:r,repeat:e.repeat,offsetX:e.offsetX,offsetY:e.offsetY}),i&&i()})}else this[t]=e,i&&i();return this},_createCanvasElement:function(){var t=fabric.document.createElement("canvas");if(t.style||(t.style={}),!t)throw n;return this._initCanvasElement(t),t},_initCanvasElement:function(t){if(fabric.util.createCanvasElement(t),"undefined"==typeof t.getContext)throw n},_initOptions:function(t){for(var e in t)this[e]=t[e];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0,this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0,this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(t){this.lowerCanvasEl=fabric.util.getById(t)||this._createCanvasElement(),this._initCanvasElement(this.lowerCanvasEl),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(t,e){return this.setDimensions({width:t},e)},setHeight:function(t,e){return this.setDimensions({height:t},e)},setDimensions:function(t,e){var i;e=e||{};for(var n in t)i=t[n],e.cssOnly||(this._setBackstoreDimension(n,t[n]),i+="px"),e.backstoreOnly||this._setCssDimension(n,i);return e.cssOnly||this.renderAll(),this.calcOffset(),this},_setBackstoreDimension:function(t,e){return this.lowerCanvasEl[t]=e,this.upperCanvasEl&&(this.upperCanvasEl[t]=e),this.cacheCanvasEl&&(this.cacheCanvasEl[t]=e),this[t]=e,this},_setCssDimension:function(t,e){return this.lowerCanvasEl.style[t]=e,this.upperCanvasEl&&(this.upperCanvasEl.style[t]=e),this.wrapperEl&&(this.wrapperEl.style[t]=e),this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(t){var e=this.getActiveGroup();this.viewportTransform=t,this.renderAll();for(var i=0,n=this._objects.length;n>i;i++)this._objects[i].setCoords();return e&&e.setCoords(),this},zoomToPoint:function(t,e){var i=t;t=fabric.util.transformPoint(t,fabric.util.invertTransform(this.viewportTransform)),this.viewportTransform[0]=e,this.viewportTransform[3]=e;var n=fabric.util.transformPoint(t,this.viewportTransform);this.viewportTransform[4]+=i.x-n.x,this.viewportTransform[5]+=i.y-n.y,this.renderAll();for(var r=0,o=this._objects.length;o>r;r++)this._objects[r].setCoords();return this},setZoom:function(t){return this.zoomToPoint(new fabric.Point(0,0),t),this},absolutePan:function(t){this.viewportTransform[4]=-t.x,this.viewportTransform[5]=-t.y,this.renderAll();for(var e=0,i=this._objects.length;i>e;e++)this._objects[e].setCoords();return this},relativePan:function(t){return this.absolutePan(new fabric.Point(-t.x-this.viewportTransform[4],-t.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(t,e){if(e){t.save();var i=this.viewportTransform;t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this._shouldRenderObject(e)&&e.render(t),t.restore(),this.controlsAboveOverlay||e._renderControls(t)}},_shouldRenderObject:function(t){return t?t!==this.getActiveGroup()||!this.preserveObjectStacking:!1},_onObjectAdded:function(t){this.stateful&&t.setupState(),t.canvas=this,t.setCoords(),this.fire("object:added",{target:t}),t.fire("added")},_onObjectRemoved:function(t){this.getActiveObject()===t&&(this.fire("before:selection:cleared",{target:t}),this._discardActiveObject(),this.fire("selection:cleared")),this.fire("object:removed",{target:t}),t.fire("removed")},clearContext:function(t){return t.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.discardActiveGroup&&this.discardActiveGroup(),this.discardActiveObject&&this.discardActiveObject(),this.clearContext(this.contextContainer),this.contextTop&&this.clearContext(this.contextTop),this.fire("canvas:cleared"),this.renderAll(),this},renderAll:function(t){var e=this[t===!0&&this.interactive?"contextTop":"contextContainer"],i=this.getActiveGroup();return this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop),t||this.clearContext(e),this.fire("before:render"),this.clipTo&&fabric.util.clipContext(this,e),this._renderBackground(e),this._renderObjects(e,i),this._renderActiveGroup(e,i),this.clipTo&&e.restore(),this._renderOverlay(e),this.controlsAboveOverlay&&this.interactive&&this.drawControls(e),this.fire("after:render"),this},_renderObjects:function(t,e){var i,n;if(!e||this.preserveObjectStacking)for(i=0,n=this._objects.length;n>i;++i)this._draw(t,this._objects[i]);else for(i=0,n=this._objects.length;n>i;++i)this._objects[i]&&!e.contains(this._objects[i])&&this._draw(t,this._objects[i])},_renderActiveGroup:function(t,e){if(e){var i=[];this.forEachObject(function(t){e.contains(t)&&i.push(t)}),e._set("objects",i),this._draw(t,e)}},_renderBackground:function(t){this.backgroundColor&&(t.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(t):this.backgroundColor,t.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height)),this.backgroundImage&&this._draw(t,this.backgroundImage)},_renderOverlay:function(t){this.overlayColor&&(t.fillStyle=this.overlayColor.toLive?this.overlayColor.toLive(t):this.overlayColor,t.fillRect(this.overlayColor.offsetX||0,this.overlayColor.offsetY||0,this.width,this.height)),this.overlayImage&&this._draw(t,this.overlayImage)},renderTop:function(){var t=this.contextTop||this.contextContainer;this.clearContext(t),this.selection&&this._groupSelector&&this._drawSelection();var e=this.getActiveGroup();return e&&e.render(t),this._renderOverlay(t),this.fire("after:render"),this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(t){return this._centerObject(t,new fabric.Point(this.getCenter().left,t.getCenterPoint().y)),this.renderAll(),this},centerObjectV:function(t){return this._centerObject(t,new fabric.Point(t.getCenterPoint().x,this.getCenter().top)),this.renderAll(),this},centerObject:function(t){var e=this.getCenter();return this._centerObject(t,new fabric.Point(e.left,e.top)),this.renderAll(),this},_centerObject:function(t,e){return t.setPositionByOrigin(e,"center","center"),this},toDatalessJSON:function(t){return this.toDatalessObject(t)},toObject:function(t){return this._toObjectMethod("toObject",t)},toDatalessObject:function(t){return this._toObjectMethod("toDatalessObject",t)},_toObjectMethod:function(e,i){var n={objects:this._toObjects(e,i)};return t(n,this.__serializeBgOverlay()),fabric.util.populateWithProperties(this,n,i),n},_toObjects:function(t,e){return this.getObjects().map(function(i){return this._toObject(i,t,e)},this)},_toObject:function(t,e,i){var n;this.includeDefaultValues||(n=t.includeDefaultValues,t.includeDefaultValues=!1);var r=this._realizeGroupTransformOnObject(t),o=t[e](i);return this.includeDefaultValues||(t.includeDefaultValues=n),this._unwindGroupTransformOnObject(t,r),o},_realizeGroupTransformOnObject:function(t){var e=["angle","flipX","flipY","height","left","scaleX","scaleY","top","width"];if(t.group&&t.group===this.getActiveGroup()){var i={};return e.forEach(function(e){i[e]=t[e]}),this.getActiveGroup().realizeTransform(t),i}return null},_unwindGroupTransformOnObject:function(t,e){e&&t.set(e)},__serializeBgOverlay:function(){var t={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};return this.overlayColor&&(t.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor),this.backgroundImage&&(t.backgroundImage=this.backgroundImage.toObject()),this.overlayImage&&(t.overlayImage=this.overlayImage.toObject()),t},svgViewportTransformation:!0,toSVG:function(t,e){t||(t={});var i=[];return this._setSVGPreamble(i,t),this._setSVGHeader(i,t),this._setSVGBgOverlayColor(i,"backgroundColor"),this._setSVGBgOverlayImage(i,"backgroundImage"),this._setSVGObjects(i,e),this._setSVGBgOverlayColor(i,"overlayColor"),this._setSVGBgOverlayImage(i,"overlayImage"),i.push("</svg>"),i.join("")},_setSVGPreamble:function(t,e){e.suppressPreamble||t.push('<?xml version="1.0" encoding="',e.encoding||"UTF-8",'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(t,e){var i,n,r;e.viewBox?(i=e.viewBox.width,n=e.viewBox.height):(i=this.width,n=this.height,this.svgViewportTransformation||(r=this.viewportTransform,i/=r[0],n/=r[3])),t.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',i,'" ','height="',n,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,e.viewBox?'viewBox="'+e.viewBox.x+" "+e.viewBox.y+" "+e.viewBox.width+" "+e.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",fabric.version,"</desc>","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>")},_setSVGObjects:function(t,e){for(var i=0,n=this.getObjects(),r=n.length;r>i;i++){var o=n[i],s=this._realizeGroupTransformOnObject(o);t.push(o.toSVG(e)),this._unwindGroupTransformOnObject(o,s)}},_setSVGBgOverlayImage:function(t,e){this[e]&&this[e].toSVG&&t.push(this[e].toSVG())},_setSVGBgOverlayColor:function(t,e){this[e]&&this[e].source?t.push('<rect x="',this[e].offsetX,'" y="',this[e].offsetY,'" ','width="',"repeat-y"===this[e].repeat||"no-repeat"===this[e].repeat?this[e].source.width:this.width,'" height="',"repeat-x"===this[e].repeat||"no-repeat"===this[e].repeat?this[e].source.height:this.height,'" fill="url(#'+e+'Pattern)"',"></rect>"):this[e]&&"overlayColor"===e&&t.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[e],'"',"></rect>")},sendToBack:function(t){return i(this._objects,t),this._objects.unshift(t),this.renderAll&&this.renderAll()},bringToFront:function(t){return i(this._objects,t),this._objects.push(t),this.renderAll&&this.renderAll()},sendBackwards:function(t,e){var n=this._objects.indexOf(t);if(0!==n){var r=this._findNewLowerIndex(t,n,e);i(this._objects,t),this._objects.splice(r,0,t),this.renderAll&&this.renderAll()}return this},_findNewLowerIndex:function(t,e,i){var n;if(i){n=e;for(var r=e-1;r>=0;--r){var o=t.intersectsWithObject(this._objects[r])||t.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(t);if(o){n=r;break}}}else n=e-1;return n},bringForward:function(t,e){var n=this._objects.indexOf(t);if(n!==this._objects.length-1){var r=this._findNewUpperIndex(t,n,e);i(this._objects,t),this._objects.splice(r,0,t),this.renderAll&&this.renderAll()}return this},_findNewUpperIndex:function(t,e,i){var n;if(i){n=e;for(var r=e+1;r<this._objects.length;++r){var o=t.intersectsWithObject(this._objects[r])||t.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(t);if(o){n=r;break}}}else n=e+1;return n},moveTo:function(t,e){return i(this._objects,t),this._objects.splice(e,0,t),this.renderAll&&this.renderAll()},dispose:function(){return this.clear(),this.interactive&&this.removeListeners(),this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}}),t(fabric.StaticCanvas.prototype,fabric.Observable),t(fabric.StaticCanvas.prototype,fabric.Collection),t(fabric.StaticCanvas.prototype,fabric.DataURLExporter),t(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(t){var e=fabric.util.createCanvasElement();if(!e||!e.getContext)return null;var i=e.getContext("2d");if(!i)return null;switch(t){case"getImageData":return"undefined"!=typeof i.getImageData;case"setLineDash":return"undefined"!=typeof i.setLineDash;case"toDataURL":return"undefined"!=typeof e.toDataURL;case"toDataURLWithQuality":try{return e.toDataURL("image/jpeg",0),!0}catch(n){}return!1;default:return null}}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}(),fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeDashArray:null,setShadow:function(t){return this.shadow=new fabric.Shadow(t),this},_setBrushStyles:function(){var t=this.canvas.contextTop;t.strokeStyle=this.color,t.lineWidth=this.width,t.lineCap=this.strokeLineCap,t.lineJoin=this.strokeLineJoin,this.strokeDashArray&&fabric.StaticCanvas.supports("setLineDash")&&t.setLineDash(this.strokeDashArray)},_setShadow:function(){if(this.shadow){var t=this.canvas.contextTop;t.shadowColor=this.shadow.color,t.shadowBlur=this.shadow.blur,t.shadowOffsetX=this.shadow.offsetX,t.shadowOffsetY=this.shadow.offsetY}},_resetShadow:function(){var t=this.canvas.contextTop;t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0}}),function(){fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(t){this.canvas=t,this._points=[]},onMouseDown:function(t){this._prepareForDrawing(t),this._captureDrawingPath(t),this._render()},onMouseMove:function(t){this._captureDrawingPath(t),this.canvas.clearContext(this.canvas.contextTop),this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(t){var e=new fabric.Point(t.x,t.y);this._reset(),this._addPoint(e),this.canvas.contextTop.moveTo(e.x,e.y)},_addPoint:function(t){this._points.push(t)},_reset:function(){this._points.length=0,this._setBrushStyles(),this._setShadow()},_captureDrawingPath:function(t){var e=new fabric.Point(t.x,t.y);this._addPoint(e)},_render:function(){var t=this.canvas.contextTop,e=this.canvas.viewportTransform,i=this._points[0],n=this._points[1];t.save(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5]),t.beginPath(),2===this._points.length&&i.x===n.x&&i.y===n.y&&(i.x-=.5,n.x+=.5),t.moveTo(i.x,i.y);for(var r=1,o=this._points.length;o>r;r++){var s=i.midPointFrom(n);t.quadraticCurveTo(i.x,i.y,s.x,s.y),i=this._points[r],n=this._points[r+1]}t.lineTo(i.x,i.y),t.stroke(),t.restore()},convertPointsToSVGPath:function(t){var e=[],i=new fabric.Point(t[0].x,t[0].y),n=new fabric.Point(t[1].x,t[1].y);e.push("M ",t[0].x," ",t[0].y," ");for(var r=1,o=t.length;o>r;r++){var s=i.midPointFrom(n);e.push("Q ",i.x," ",i.y," ",s.x," ",s.y," "),i=new fabric.Point(t[r].x,t[r].y),r+1<t.length&&(n=new fabric.Point(t[r+1].x,t[r+1].y))}return e.push("L ",i.x," ",i.y," "),e},createPath:function(t){var e=new fabric.Path(t,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,originX:"center",originY:"center"});return this.shadow&&(this.shadow.affectStroke=!0,e.setShadow(this.shadow)),e},_finalizeAndAddPath:function(){var t=this.canvas.contextTop;t.closePath();var e=this.convertPointsToSVGPath(this._points).join("");if("M 0 0 Q 0 0 0 0 L 0 0"===e)return void this.canvas.renderAll();var i=this.createPath(e);this.canvas.add(i),i.setCoords(),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderAll(),this.canvas.fire("path:created",{path:i})}})}(),fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(t){this.canvas=t,this.points=[]},drawDot:function(t){var e=this.addPoint(t),i=this.canvas.contextTop,n=this.canvas.viewportTransform;i.save(),i.transform(n[0],n[1],n[2],n[3],n[4],n[5]),i.fillStyle=e.fill,i.beginPath(),i.arc(e.x,e.y,e.radius,0,2*Math.PI,!1),i.closePath(),i.fill(),i.restore()},onMouseDown:function(t){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(t)},onMouseMove:function(t){this.drawDot(t)},onMouseUp:function(){var t=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var e=[],i=0,n=this.points.length;n>i;i++){var r=this.points[i],o=new fabric.Circle({radius:r.radius,left:r.x,top:r.y,originX:"center",originY:"center",fill:r.fill});this.shadow&&o.setShadow(this.shadow),e.push(o)}var s=new fabric.Group(e,{originX:"center",originY:"center"});s.canvas=this.canvas,this.canvas.add(s),this.canvas.fire("path:created",{path:s}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=t,this.canvas.renderAll()},addPoint:function(t){var e=new fabric.Point(t.x,t.y),i=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,n=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return e.radius=i,e.fill=n,this.points.push(e),e}}),fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(t){this.canvas=t,this.sprayChunks=[]},onMouseDown:function(t){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(t),this.render()},onMouseMove:function(t){this.addSprayChunk(t),this.render()},onMouseUp:function(){var t=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var e=[],i=0,n=this.sprayChunks.length;n>i;i++)for(var r=this.sprayChunks[i],o=0,s=r.length;s>o;o++){var a=new fabric.Rect({width:r[o].width,height:r[o].width,left:r[o].x+1,top:r[o].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&a.setShadow(this.shadow),e.push(a)}this.optimizeOverlapping&&(e=this._getOptimizedRects(e));var l=new fabric.Group(e,{originX:"center",originY:"center"});l.canvas=this.canvas,this.canvas.add(l),this.canvas.fire("path:created",{path:l}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=t,this.canvas.renderAll()},_getOptimizedRects:function(t){for(var e,i={},n=0,r=t.length;r>n;n++)e=t[n].left+""+t[n].top,i[e]||(i[e]=t[n]);var o=[];for(e in i)o.push(i[e]);return o},render:function(){var t=this.canvas.contextTop;t.fillStyle=this.color;var e=this.canvas.viewportTransform;t.save(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5]);for(var i=0,n=this.sprayChunkPoints.length;n>i;i++){var r=this.sprayChunkPoints[i];"undefined"!=typeof r.opacity&&(t.globalAlpha=r.opacity),t.fillRect(r.x,r.y,r.width,r.width)}t.restore()},addSprayChunk:function(t){this.sprayChunkPoints=[];for(var e,i,n,r=this.width/2,o=0;o<this.density;o++){e=fabric.util.getRandomInt(t.x-r,t.x+r),i=fabric.util.getRandomInt(t.y-r,t.y+r),n=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var s=new fabric.Point(e,i);s.width=n,this.randomOpacity&&(s.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(s)}this.sprayChunks.push(this.sprayChunkPoints)}}),fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var t=20,e=5,i=fabric.document.createElement("canvas"),n=i.getContext("2d");return i.width=i.height=t+e,n.fillStyle=this.color,n.beginPath(),n.arc(t/2,t/2,t/2,0,2*Math.PI,!1),n.closePath(),n.fill(),i},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(t){var e=this.callSuper("createPath",t);return e.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction()}),e}}),function(){var t=fabric.util.getPointer,e=fabric.util.degreesToRadians,i=fabric.util.radiansToDegrees,n=Math.atan2,r=Math.abs,o=.5;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(t,e){e||(e={}),this._initStatic(t,e),this._initInteractive(),this._createCacheCanvas(),fabric.Canvas.activeInstance=this},uniScaleTransform:!1,centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this),this.calcOffset()},_resetCurrentTransform:function(t){var e=this._currentTransform;e.target.set({scaleX:e.original.scaleX,scaleY:e.original.scaleY,left:e.original.left,top:e.original.top}),this._shouldCenterTransform(t,e.target)?"rotate"===e.action?this._setOriginToCenter(e.target):("center"!==e.originX&&("right"===e.originX?e.mouseXSign=-1:e.mouseXSign=1),"center"!==e.originY&&("bottom"===e.originY?e.mouseYSign=-1:e.mouseYSign=1),e.originX="center",e.originY="center"):(e.originX=e.original.originX,e.originY=e.original.originY)},containsPoint:function(t,e){var i=this.getPointer(t,!0),n=this._normalizePointer(e,i);return e.containsPoint(n)||e._findTargetCorner(i)},_normalizePointer:function(t,e){var i,n=this.getActiveGroup(),r=e.x,o=e.y,s=n&&"group"!==t.type&&n.contains(t);return s&&(i=new fabric.Point(n.left,n.top),i=fabric.util.transformPoint(i,this.viewportTransform,!0),r-=i.x,o-=i.y),{x:r,y:o}},isTargetTransparent:function(t,e,i){var n=t.hasBorders,r=t.transparentCorners;t.hasBorders=t.transparentCorners=!1,this._draw(this.contextCache,t),t.hasBorders=n,t.transparentCorners=r;var o=fabric.util.isTransparent(this.contextCache,e,i,this.targetFindTolerance);return this.clearContext(this.contextCache),o},_shouldClearSelection:function(t,e){var i=this.getActiveGroup(),n=this.getActiveObject();return!e||e&&i&&!i.contains(e)&&i!==e&&!t.shiftKey||e&&!e.evented||e&&!e.selectable&&n&&n!==e},_shouldCenterTransform:function(t,e){if(e){var i,n=this._currentTransform;return"scale"===n.action||"scaleX"===n.action||"scaleY"===n.action?i=this.centeredScaling||e.centeredScaling:"rotate"===n.action&&(i=this.centeredRotation||e.centeredRotation),i?!t.altKey:t.altKey}},_getOriginFromCorner:function(t,e){var i={x:t.originX,y:t.originY};return"ml"===e||"tl"===e||"bl"===e?i.x="right":("mr"===e||"tr"===e||"br"===e)&&(i.x="left"),"tl"===e||"mt"===e||"tr"===e?i.y="bottom":("bl"===e||"mb"===e||"br"===e)&&(i.y="top"),i},_getActionFromCorner:function(t,e){var i="drag";return e&&(i="ml"===e||"mr"===e?"scaleX":"mt"===e||"mb"===e?"scaleY":"mtr"===e?"rotate":"scale"),i},_setupCurrentTransform:function(t,i){if(i){var n=this.getPointer(t),r=i._findTargetCorner(this.getPointer(t,!0)),o=this._getActionFromCorner(i,r),s=this._getOriginFromCorner(i,r);this._currentTransform={target:i,action:o,scaleX:i.scaleX,scaleY:i.scaleY,offsetX:n.x-i.left,offsetY:n.y-i.top,originX:s.x,originY:s.y,ex:n.x,ey:n.y,left:i.left,top:i.top,theta:e(i.angle),width:i.width*i.scaleX,mouseXSign:1,mouseYSign:1},this._currentTransform.original={left:i.left,top:i.top,scaleX:i.scaleX,scaleY:i.scaleY,originX:s.x,originY:s.y},this._resetCurrentTransform(t)}},_translateObject:function(t,e){var i=this._currentTransform.target;i.get("lockMovementX")||i.set("left",t-this._currentTransform.offsetX),i.get("lockMovementY")||i.set("top",e-this._currentTransform.offsetY)},_scaleObject:function(t,e,i){var n=this._currentTransform,r=n.target,o=r.get("lockScalingX"),s=r.get("lockScalingY"),a=r.get("lockScalingFlip");if(!o||!s){var l=r.translateToOriginPoint(r.getCenterPoint(),n.originX,n.originY),c=r.toLocalPoint(new fabric.Point(t,e),n.originX,n.originY);this._setLocalMouse(c,n),this._setObjectScale(c,n,o,s,i,a),r.setPositionByOrigin(l,n.originX,n.originY)}},_setObjectScale:function(t,e,i,n,r,o){var s=e.target,a=!1,l=!1,c=s.stroke?s.strokeWidth:0;e.newScaleX=t.x/(s.width+c/2),e.newScaleY=t.y/(s.height+c/2),o&&e.newScaleX<=0&&e.newScaleX<s.scaleX&&(a=!0),o&&e.newScaleY<=0&&e.newScaleY<s.scaleY&&(l=!0),"equally"!==r||i||n?r?"x"!==r||s.get("lockUniScaling")?"y"===r&&!s.get("lockUniScaling")&&(l||n||s.set("scaleY",e.newScaleY)):a||i||s.set("scaleX",e.newScaleX):(a||i||s.set("scaleX",e.newScaleX),l||n||s.set("scaleY",e.newScaleY)):a||l||this._scaleObjectEqually(t,s,e),a||l||this._flipObject(e,r)},_scaleObjectEqually:function(t,e,i){var n=t.y+t.x,r=e.stroke?e.strokeWidth:0,o=(e.height+r/2)*i.original.scaleY+(e.width+r/2)*i.original.scaleX;i.newScaleX=i.original.scaleX*n/o,i.newScaleY=i.original.scaleY*n/o,e.set("scaleX",i.newScaleX),e.set("scaleY",i.newScaleY)},_flipObject:function(t,e){t.newScaleX<0&&"y"!==e&&("left"===t.originX?t.originX="right":"right"===t.originX&&(t.originX="left")),t.newScaleY<0&&"x"!==e&&("top"===t.originY?t.originY="bottom":"bottom"===t.originY&&(t.originY="top"))},_setLocalMouse:function(t,e){var i=e.target;"right"===e.originX?t.x*=-1:"center"===e.originX&&(t.x*=2*e.mouseXSign,t.x<0&&(e.mouseXSign=-e.mouseXSign)),"bottom"===e.originY?t.y*=-1:"center"===e.originY&&(t.y*=2*e.mouseYSign,t.y<0&&(e.mouseYSign=-e.mouseYSign)),r(t.x)>i.padding?t.x<0?t.x+=i.padding:t.x-=i.padding:t.x=0,r(t.y)>i.padding?t.y<0?t.y+=i.padding:t.y-=i.padding:t.y=0},_rotateObject:function(t,e){var r=this._currentTransform;if(!r.target.get("lockRotation")){var o=n(r.ey-r.top,r.ex-r.left),s=n(e-r.top,t-r.left),a=i(s-o+r.theta);0>a&&(a=360+a),r.target.angle=a%360}},setCursor:function(t){this.upperCanvasEl.style.cursor=t},_resetObjectTransform:function(t){t.scaleX=1,t.scaleY=1,t.setAngle(0)},_drawSelection:function(){var t=this.contextTop,e=this._groupSelector,i=e.left,n=e.top,s=r(i),a=r(n);if(t.fillStyle=this.selectionColor,t.fillRect(e.ex-(i>0?0:-i),e.ey-(n>0?0:-n),s,a),t.lineWidth=this.selectionLineWidth,t.strokeStyle=this.selectionBorderColor,this.selectionDashArray.length>1){var l=e.ex+o-(i>0?0:s),c=e.ey+o-(n>0?0:a);t.beginPath(),fabric.util.drawDashedLine(t,l,c,l+s,c,this.selectionDashArray),fabric.util.drawDashedLine(t,l,c+a-1,l+s,c+a-1,this.selectionDashArray),fabric.util.drawDashedLine(t,l,c,l,c+a,this.selectionDashArray),fabric.util.drawDashedLine(t,l+s-1,c,l+s-1,c+a,this.selectionDashArray),t.closePath(),t.stroke()}else t.strokeRect(e.ex+o-(i>0?0:s),e.ey+o-(n>0?0:a),s,a)},_isLastRenderedObject:function(t){return this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(t,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(t,!0))},findTarget:function(t,e){if(!this.skipTargetFind){if(this._isLastRenderedObject(t))return this.lastRenderedObjectWithControlsAboveOverlay;var i=this.getActiveGroup();if(i&&!e&&this.containsPoint(t,i))return i;var n=this._searchPossibleTargets(t);return this._fireOverOutEvents(n),n}},_fireOverOutEvents:function(t){t?this._hoveredTarget!==t&&(this.fire("mouse:over",{target:t}),t.fire("mouseover"),this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout")),this._hoveredTarget=t):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},
_checkTarget:function(t,e,i){if(e&&e.visible&&e.evented&&this.containsPoint(t,e)){if(!this.perPixelTargetFind&&!e.perPixelTargetFind||e.isEditing)return!0;var n=this.isTargetTransparent(e,i.x,i.y);if(!n)return!0}},_searchPossibleTargets:function(t){for(var e,i=this.getPointer(t,!0),n=this._objects.length;n--;)if(!this._objects[n].group&&this._checkTarget(t,this._objects[n],i)){this.relatedTarget=this._objects[n],e=this._objects[n];break}return e},getPointer:function(e,i,n){n||(n=this.upperCanvasEl);var r,o=t(e,n),s=n.getBoundingClientRect(),a=s.width||0,l=s.height||0;return a&&l||("top"in s&&"bottom"in s&&(l=Math.abs(s.top-s.bottom)),"right"in s&&"left"in s&&(a=Math.abs(s.right-s.left))),this.calcOffset(),o.x=o.x-this._offset.left,o.y=o.y-this._offset.top,i||(o=fabric.util.transformPoint(o,fabric.util.invertTransform(this.viewportTransform))),r=0===a||0===l?{width:1,height:1}:{width:n.width/a,height:n.height/l},{x:o.x*r.width,y:o.y*r.height}},_createUpperCanvas:function(){var t=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement(),fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+t),this.wrapperEl.appendChild(this.upperCanvasEl),this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl),this._applyCanvasStyle(this.upperCanvasEl),this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(t){var e=this.getWidth()||t.width,i=this.getHeight()||t.height;fabric.util.setStyle(t,{position:"absolute",width:e+"px",height:i+"px",left:0,top:0}),t.width=e,t.height=i,fabric.util.makeElementUnselectable(t)},_copyCanvasStyle:function(t,e){e.style.cssText=t.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(t){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=t,t.set("active",!0)},setActiveObject:function(t,e){return this._setActiveObject(t),this.renderAll(),this.fire("object:selected",{target:t,e:e}),t.fire("selected",{e:e}),this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=null},discardActiveObject:function(t){return this._discardActiveObject(),this.renderAll(),this.fire("selection:cleared",{e:t}),this},_setActiveGroup:function(t){this._activeGroup=t,t&&t.set("active",!0)},setActiveGroup:function(t,e){return this._setActiveGroup(t),t&&(this.fire("object:selected",{target:t,e:e}),t.fire("selected",{e:e})),this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var t=this.getActiveGroup();t&&t.destroy(),this.setActiveGroup(null)},discardActiveGroup:function(t){return this._discardActiveGroup(),this.fire("selection:cleared",{e:t}),this},deactivateAll:function(){for(var t=this.getObjects(),e=0,i=t.length;i>e;e++)t[e].set("active",!1);return this._discardActiveGroup(),this._discardActiveObject(),this},deactivateAllWithDispatch:function(t){var e=this.getActiveGroup()||this.getActiveObject();return e&&this.fire("before:selection:cleared",{target:e,e:t}),this.deactivateAll(),e&&this.fire("selection:cleared",{e:t}),this},drawControls:function(t){var e=this.getActiveGroup();e?this._drawGroupControls(t,e):this._drawObjectsControls(t)},_drawGroupControls:function(t,e){e._renderControls(t)},_drawObjectsControls:function(t){for(var e=0,i=this._objects.length;i>e;++e)this._objects[e]&&this._objects[e].active&&(this._objects[e]._renderControls(t),this.lastRenderedObjectWithControlsAboveOverlay=this._objects[e])}});for(var s in fabric.StaticCanvas)"prototype"!==s&&(fabric.Canvas[s]=fabric.StaticCanvas[s]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){}),fabric.Element=fabric.Canvas}(),function(){var t={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},e=fabric.util.addListener,i=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this._bindEvents(),e(fabric.window,"resize",this._onResize),e(this.upperCanvasEl,"mousedown",this._onMouseDown),e(this.upperCanvasEl,"mousemove",this._onMouseMove),e(this.upperCanvasEl,"mousewheel",this._onMouseWheel),e(this.upperCanvasEl,"touchstart",this._onMouseDown),e(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof eventjs&&"add"in eventjs&&(eventjs.add(this.upperCanvasEl,"gesture",this._onGesture),eventjs.add(this.upperCanvasEl,"drag",this._onDrag),eventjs.add(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.add(this.upperCanvasEl,"shake",this._onShake),eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){i(fabric.window,"resize",this._onResize),i(this.upperCanvasEl,"mousedown",this._onMouseDown),i(this.upperCanvasEl,"mousemove",this._onMouseMove),i(this.upperCanvasEl,"mousewheel",this._onMouseWheel),i(this.upperCanvasEl,"touchstart",this._onMouseDown),i(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof eventjs&&"remove"in eventjs&&(eventjs.remove(this.upperCanvasEl,"gesture",this._onGesture),eventjs.remove(this.upperCanvasEl,"drag",this._onDrag),eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.remove(this.upperCanvasEl,"shake",this._onShake),eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(t,e){this.__onTransformGesture&&this.__onTransformGesture(t,e)},_onDrag:function(t,e){this.__onDrag&&this.__onDrag(t,e)},_onMouseWheel:function(t,e){this.__onMouseWheel&&this.__onMouseWheel(t,e)},_onOrientationChange:function(t,e){this.__onOrientationChange&&this.__onOrientationChange(t,e)},_onShake:function(t,e){this.__onShake&&this.__onShake(t,e)},_onLongPress:function(t,e){this.__onLongPress&&this.__onLongPress(t,e)},_onMouseDown:function(t){this.__onMouseDown(t),e(fabric.document,"touchend",this._onMouseUp),e(fabric.document,"touchmove",this._onMouseMove),i(this.upperCanvasEl,"mousemove",this._onMouseMove),i(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchstart"===t.type?i(this.upperCanvasEl,"mousedown",this._onMouseDown):(e(fabric.document,"mouseup",this._onMouseUp),e(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(t){if(this.__onMouseUp(t),i(fabric.document,"mouseup",this._onMouseUp),i(fabric.document,"touchend",this._onMouseUp),i(fabric.document,"mousemove",this._onMouseMove),i(fabric.document,"touchmove",this._onMouseMove),e(this.upperCanvasEl,"mousemove",this._onMouseMove),e(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchend"===t.type){var n=this;setTimeout(function(){e(n.upperCanvasEl,"mousedown",n._onMouseDown)},400)}},_onMouseMove:function(t){!this.allowTouchScrolling&&t.preventDefault&&t.preventDefault(),this.__onMouseMove(t)},_onResize:function(){this.calcOffset()},_shouldRender:function(t,e){var i=this.getActiveGroup()||this.getActiveObject();return!!(t&&(t.isMoving||t!==i)||!t&&i||!t&&!i&&!this._groupSelector||e&&this._previousPointer&&this.selection&&(e.x!==this._previousPointer.x||e.y!==this._previousPointer.y))},__onMouseUp:function(t){var e;if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(t);this._currentTransform?(this._finalizeCurrentTransform(),e=this._currentTransform.target):e=this.findTarget(t,!0);var i=this._shouldRender(e,this.getPointer(t));this._maybeGroupObjects(t),e&&(e.isMoving=!1),i&&this.renderAll(),this._handleCursorAndEvent(t,e)},_handleCursorAndEvent:function(t,e){this._setCursorFromEvent(t,e);var i=this;setTimeout(function(){i._setCursorFromEvent(t,e)},50),this.fire("mouse:up",{target:e,e:t}),e&&e.fire("mouseup",{e:t})},_finalizeCurrentTransform:function(){var t=this._currentTransform,e=t.target;e._scaling&&(e._scaling=!1),e.setCoords(),this.stateful&&e.hasStateChanged()&&(this.fire("object:modified",{target:e}),e.fire("modified")),this._restoreOriginXY(e)},_restoreOriginXY:function(t){if(this._previousOriginX&&this._previousOriginY){var e=t.translateToOriginPoint(t.getCenterPoint(),this._previousOriginX,this._previousOriginY);t.originX=this._previousOriginX,t.originY=this._previousOriginY,t.left=e.x,t.top=e.y,this._previousOriginX=null,this._previousOriginY=null}},_onMouseDownInDrawingMode:function(t){this._isCurrentlyDrawing=!0,this.discardActiveObject(t).renderAll(),this.clipTo&&fabric.util.clipContext(this,this.contextTop);var e=fabric.util.invertTransform(this.viewportTransform),i=fabric.util.transformPoint(this.getPointer(t,!0),e);this.freeDrawingBrush.onMouseDown(i),this.fire("mouse:down",{e:t});var n=this.findTarget(t);"undefined"!=typeof n&&n.fire("mousedown",{e:t,target:n})},_onMouseMoveInDrawingMode:function(t){if(this._isCurrentlyDrawing){var e=fabric.util.invertTransform(this.viewportTransform),i=fabric.util.transformPoint(this.getPointer(t,!0),e);this.freeDrawingBrush.onMouseMove(i)}this.setCursor(this.freeDrawingCursor),this.fire("mouse:move",{e:t});var n=this.findTarget(t);"undefined"!=typeof n&&n.fire("mousemove",{e:t,target:n})},_onMouseUpInDrawingMode:function(t){this._isCurrentlyDrawing=!1,this.clipTo&&this.contextTop.restore(),this.freeDrawingBrush.onMouseUp(),this.fire("mouse:up",{e:t});var e=this.findTarget(t);"undefined"!=typeof e&&e.fire("mouseup",{e:t,target:e})},__onMouseDown:function(t){var e="which"in t?1===t.which:1===t.button;if(e||fabric.isTouchSupported){if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(t);if(!this._currentTransform){var i=this.findTarget(t),n=this.getPointer(t,!0);this._previousPointer=n;var r=this._shouldRender(i,n),o=this._shouldGroup(t,i);this._shouldClearSelection(t,i)?this._clearSelection(t,i,n):o&&(this._handleGrouping(t,i),i=this.getActiveGroup()),i&&i.selectable&&!o&&(this._beforeTransform(t,i),this._setupCurrentTransform(t,i)),r&&this.renderAll(),this.fire("mouse:down",{target:i,e:t}),i&&i.fire("mousedown",{e:t})}}},_beforeTransform:function(t,e){this.stateful&&e.saveState(),e._findTargetCorner(this.getPointer(t))&&this.onBeforeScaleRotate(e),e!==this.getActiveGroup()&&e!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(e,t))},_clearSelection:function(t,e,i){this.deactivateAllWithDispatch(t),e&&e.selectable?this.setActiveObject(e,t):this.selection&&(this._groupSelector={ex:i.x,ey:i.y,top:0,left:0})},_setOriginToCenter:function(t){this._previousOriginX=this._currentTransform.target.originX,this._previousOriginY=this._currentTransform.target.originY;var e=t.getCenterPoint();t.originX="center",t.originY="center",t.left=e.x,t.top=e.y,this._currentTransform.left=t.left,this._currentTransform.top=t.top},_setCenterToOrigin:function(t){var e=t.translateToOriginPoint(t.getCenterPoint(),this._previousOriginX,this._previousOriginY);t.originX=this._previousOriginX,t.originY=this._previousOriginY,t.left=e.x,t.top=e.y,this._previousOriginX=null,this._previousOriginY=null},__onMouseMove:function(t){var e,i;if(this.isDrawingMode)return void this._onMouseMoveInDrawingMode(t);if(!("undefined"!=typeof t.touches&&t.touches.length>1)){var n=this._groupSelector;n?(i=this.getPointer(t,!0),n.left=i.x-n.ex,n.top=i.y-n.ey,this.renderTop()):this._currentTransform?this._transformObject(t):(e=this.findTarget(t),!e||e&&!e.selectable?this.setCursor(this.defaultCursor):this._setCursorFromEvent(t,e)),this.fire("mouse:move",{target:e,e:t}),e&&e.fire("mousemove",{e:t})}},_transformObject:function(t){var e=this.getPointer(t),i=this._currentTransform;i.reset=!1,i.target.isMoving=!0,this._beforeScaleTransform(t,i),this._performTransformAction(t,i,e),this.renderAll()},_performTransformAction:function(t,e,i){var n=i.x,r=i.y,o=e.target,s=e.action;"rotate"===s?(this._rotateObject(n,r),this._fire("rotating",o,t)):"scale"===s?(this._onScale(t,e,n,r),this._fire("scaling",o,t)):"scaleX"===s?(this._scaleObject(n,r,"x"),this._fire("scaling",o,t)):"scaleY"===s?(this._scaleObject(n,r,"y"),this._fire("scaling",o,t)):(this._translateObject(n,r),this._fire("moving",o,t),this.setCursor(this.moveCursor))},_fire:function(t,e,i){this.fire("object:"+t,{target:e,e:i}),e.fire(t,{e:i})},_beforeScaleTransform:function(t,e){if("scale"===e.action||"scaleX"===e.action||"scaleY"===e.action){var i=this._shouldCenterTransform(t,e.target);(i&&("center"!==e.originX||"center"!==e.originY)||!i&&"center"===e.originX&&"center"===e.originY)&&(this._resetCurrentTransform(t),e.reset=!0)}},_onScale:function(t,e,i,n){!t.shiftKey&&!this.uniScaleTransform||e.target.get("lockUniScaling")?(!e.reset&&"scale"===e.currentAction&&this._resetCurrentTransform(t,e.target),e.currentAction="scaleEqually",this._scaleObject(i,n,"equally")):(e.currentAction="scale",this._scaleObject(i,n))},_setCursorFromEvent:function(t,e){if(!e||!e.selectable)return this.setCursor(this.defaultCursor),!1;var i=this.getActiveGroup(),n=e._findTargetCorner&&(!i||!i.contains(e))&&e._findTargetCorner(this.getPointer(t,!0));return n?this._setCornerCursor(n,e):this.setCursor(e.hoverCursor||this.hoverCursor),!0},_setCornerCursor:function(e,i){if(e in t)this.setCursor(this._getRotatedCornerCursor(e,i));else{if("mtr"!==e||!i.hasRotatingPoint)return this.setCursor(this.defaultCursor),!1;this.setCursor(this.rotationCursor)}},_getRotatedCornerCursor:function(e,i){var n=Math.round(i.getAngle()%360/45);return 0>n&&(n+=8),n+=t[e],n%=8,this.cursorMap[n]}})}(),function(){var t=Math.min,e=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(t,e){var i=this.getActiveObject();return t.shiftKey&&(this.getActiveGroup()||i&&i!==e)&&this.selection},_handleGrouping:function(t,e){(e!==this.getActiveGroup()||(e=this.findTarget(t,!0),e&&!e.isType("group")))&&(this.getActiveGroup()?this._updateActiveGroup(e,t):this._createActiveGroup(e,t),this._activeGroup&&this._activeGroup.saveCoords())},_updateActiveGroup:function(t,e){var i=this.getActiveGroup();if(i.contains(t)){if(i.removeWithUpdate(t),this._resetObjectTransform(i),t.set("active",!1),1===i.size())return this.discardActiveGroup(e),void this.setActiveObject(i.item(0))}else i.addWithUpdate(t),this._resetObjectTransform(i);this.fire("selection:created",{target:i,e:e}),i.set("active",!0)},_createActiveGroup:function(t,e){if(this._activeObject&&t!==this._activeObject){var i=this._createGroup(t);i.addWithUpdate(),this.setActiveGroup(i),this._activeObject=null,this.fire("selection:created",{target:i,e:e})}t.set("active",!0)},_createGroup:function(t){var e=this.getObjects(),i=e.indexOf(this._activeObject)<e.indexOf(t),n=i?[this._activeObject,t]:[t,this._activeObject];return new fabric.Group(n,{canvas:this})},_groupSelectedObjects:function(t){var e=this._collectObjects();1===e.length?this.setActiveObject(e[0],t):e.length>1&&(e=new fabric.Group(e.reverse(),{canvas:this}),e.addWithUpdate(),this.setActiveGroup(e,t),e.saveCoords(),this.fire("selection:created",{target:e}),this.renderAll())},_collectObjects:function(){for(var i,n=[],r=this._groupSelector.ex,o=this._groupSelector.ey,s=r+this._groupSelector.left,a=o+this._groupSelector.top,l=new fabric.Point(t(r,s),t(o,a)),c=new fabric.Point(e(r,s),e(o,a)),h=r===s&&o===a,u=this._objects.length;u--&&(i=this._objects[u],!(i&&i.selectable&&i.visible&&(i.intersectsWithRect(l,c)||i.isContainedWithinRect(l,c)||i.containsPoint(l)||i.containsPoint(c))&&(i.set("active",!0),n.push(i),h))););return n},_maybeGroupObjects:function(t){this.selection&&this._groupSelector&&this._groupSelectedObjects(t);var e=this.getActiveGroup();e&&(e.setObjectsCoords().setCoords(),e.isMoving=!1,this.setCursor(this.defaultCursor)),this._groupSelector=null,this._currentTransform=null}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(t){t||(t={});var e=t.format||"png",i=t.quality||1,n=t.multiplier||1,r={left:t.left,top:t.top,width:t.width,height:t.height};return 1!==n?this.__toDataURLWithMultiplier(e,i,r,n):this.__toDataURL(e,i,r)},__toDataURL:function(t,e,i){this.renderAll(!0);var n=this.upperCanvasEl||this.lowerCanvasEl,r=this.__getCroppedCanvas(n,i);"jpg"===t&&(t="jpeg");var o=fabric.StaticCanvas.supports("toDataURLWithQuality")?(r||n).toDataURL("image/"+t,e):(r||n).toDataURL("image/"+t);return this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),r&&(r=null),o},__getCroppedCanvas:function(t,e){var i,n,r="left"in e||"top"in e||"width"in e||"height"in e;return r&&(i=fabric.util.createCanvasElement(),n=i.getContext("2d"),i.width=e.width||this.width,i.height=e.height||this.height,n.drawImage(t,-e.left||0,-e.top||0)),i},__toDataURLWithMultiplier:function(t,e,i,n){var r=this.getWidth(),o=this.getHeight(),s=r*n,a=o*n,l=this.getActiveObject(),c=this.getActiveGroup(),h=this.contextTop||this.contextContainer;n>1&&this.setWidth(s).setHeight(a),h.scale(n,n),i.left&&(i.left*=n),i.top&&(i.top*=n),i.width?i.width*=n:1>n&&(i.width=s),i.height?i.height*=n:1>n&&(i.height=a),c?this._tempRemoveBordersControlsFromGroup(c):l&&this.deactivateAll&&this.deactivateAll(),this.renderAll(!0);var u=this.__toDataURL(t,e,i);return this.width=r,this.height=o,h.scale(1/n,1/n),this.setWidth(r).setHeight(o),c?this._restoreBordersControlsOnGroup(c):l&&this.setActiveObject&&this.setActiveObject(l),this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),u},toDataURLWithMultiplier:function(t,e,i){return this.toDataURL({format:t,multiplier:e,quality:i})},_tempRemoveBordersControlsFromGroup:function(t){t.origHasControls=t.hasControls,t.origBorderColor=t.borderColor,t.hasControls=!0,t.borderColor="rgba(0,0,0,0)",t.forEachObject(function(t){t.origBorderColor=t.borderColor,t.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(t){t.hideControls=t.origHideControls,t.borderColor=t.origBorderColor,t.forEachObject(function(t){t.borderColor=t.origBorderColor,delete t.origBorderColor})}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(t,e,i){return this.loadFromJSON(t,e,i)},loadFromJSON:function(t,e,i){if(t){var n="string"==typeof t?JSON.parse(t):t;this.clear();var r=this;return this._enlivenObjects(n.objects,function(){r._setBgOverlay(n,e)},i),this}},_setBgOverlay:function(t,e){var i=this,n={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!(t.backgroundImage||t.overlayImage||t.background||t.overlay))return void(e&&e());var r=function(){n.backgroundImage&&n.overlayImage&&n.backgroundColor&&n.overlayColor&&(i.renderAll(),e&&e())};this.__setBgOverlay("backgroundImage",t.backgroundImage,n,r),this.__setBgOverlay("overlayImage",t.overlayImage,n,r),this.__setBgOverlay("backgroundColor",t.background,n,r),this.__setBgOverlay("overlayColor",t.overlay,n,r),r()},__setBgOverlay:function(t,e,i,n){var r=this;return e?void("backgroundImage"===t||"overlayImage"===t?fabric.Image.fromObject(e,function(e){r[t]=e,i[t]=!0,n&&n()}):this["set"+fabric.util.string.capitalize(t,!0)](e,function(){i[t]=!0,n&&n()})):void(i[t]=!0)},_enlivenObjects:function(t,e,i){var n=this;if(!t||0===t.length)return void(e&&e());var r=this.renderOnAddRemove;this.renderOnAddRemove=!1,fabric.util.enlivenObjects(t,function(t){t.forEach(function(t,e){n.insertAt(t,e,!0)}),n.renderOnAddRemove=r,e&&e()},null,i)},_toDataURL:function(t,e){this.clone(function(i){e(i.toDataURL(t))})},_toDataURLWithMultiplier:function(t,e,i){this.clone(function(n){i(n.toDataURLWithMultiplier(t,e))})},clone:function(t,e){var i=JSON.stringify(this.toJSON(e));this.cloneWithoutData(function(e){e.loadFromJSON(i,function(){t&&t(e)})})},cloneWithoutData:function(t){var e=fabric.document.createElement("canvas");e.width=this.getWidth(),e.height=this.getHeight();var i=new fabric.Canvas(e);i.clipTo=this.clipTo,this.backgroundImage?(i.setBackgroundImage(this.backgroundImage.src,function(){i.renderAll(),t&&t(i)}),i.backgroundImageOpacity=this.backgroundImageOpacity,i.backgroundImageStretch=this.backgroundImageStretch):t&&t(i)}}),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.toFixed,r=e.util.string.capitalize,o=e.util.degreesToRadians,s=e.StaticCanvas.supports("setLineDash");e.Object||(e.Object=e.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockScalingFlip:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor".split(" "),initialize:function(t){t&&this.setOptions(t)},_initGradient:function(t){t.fill&&t.fill.colorStops&&!(t.fill instanceof e.Gradient)&&this.set("fill",new e.Gradient(t.fill))},_initPattern:function(t){t.fill&&t.fill.source&&!(t.fill instanceof e.Pattern)&&this.set("fill",new e.Pattern(t.fill)),t.stroke&&t.stroke.source&&!(t.stroke instanceof e.Pattern)&&this.set("stroke",new e.Pattern(t.stroke))},_initClipping:function(t){if(t.clipTo&&"string"==typeof t.clipTo){var i=e.util.getFunctionBody(t.clipTo);"undefined"!=typeof i&&(this.clipTo=new Function("ctx",i))}},setOptions:function(t){for(var e in t)this.set(e,t[e]);this._initGradient(t),this._initPattern(t),this._initClipping(t)},transform:function(t,e){var i=e?this._getLeftTopCoords():this.getCenterPoint();t.translate(i.x,i.y),t.rotate(o(this.angle)),t.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(t){var i=e.Object.NUM_FRACTION_DIGITS,r={type:this.type,originX:this.originX,originY:this.originY,left:n(this.left,i),top:n(this.top,i),width:n(this.width,i),height:n(this.height,i),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:n(this.strokeWidth,i),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:n(this.strokeMiterLimit,i),scaleX:n(this.scaleX,i),scaleY:n(this.scaleY,i),angle:n(this.getAngle(),i),flipX:this.flipX,flipY:this.flipY,opacity:n(this.opacity,i),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation};return this.includeDefaultValues||(r=this._removeDefaultValues(r)),e.util.populateWithProperties(this,r,t),r},toDatalessObject:function(t){return this.toObject(t)},_removeDefaultValues:function(t){var i=e.util.getKlass(t.type).prototype,n=i.stateProperties;return n.forEach(function(e){t[e]===i[e]&&delete t[e]}),t},toString:function(){return"#<fabric."+r(this.type)+">"},get:function(t){return this[t]},_setObject:function(t){for(var e in t)this._set(e,t[e])},set:function(t,e){return"object"==typeof t?this._setObject(t):"function"==typeof e&&"clipTo"!==t?this._set(t,e(this.get(t))):this._set(t,e),this},_set:function(t,i){var r="scaleX"===t||"scaleY"===t;return r&&(i=this._constrainScale(i)),"scaleX"===t&&0>i?(this.flipX=!this.flipX,i*=-1):"scaleY"===t&&0>i?(this.flipY=!this.flipY,i*=-1):"width"===t||"height"===t?this.minScaleLimit=n(Math.min(.1,1/Math.max(this.width,this.height)),2):"shadow"===t&&i&&!(i instanceof e.Shadow)&&(i=new e.Shadow(i)),this[t]=i,this},toggle:function(t){var e=this.get(t);return"boolean"==typeof e&&this.set(t,!e),this},setSourcePath:function(t){return this.sourcePath=t,this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(t,i){0===this.width&&0===this.height||!this.visible||(t.save(),this._setupCompositeOperation(t),i||this.transform(t),this._setStrokeStyles(t),this._setFillStyles(t),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this._setOpacity(t),this._setShadow(t),this.clipTo&&e.util.clipContext(this,t),this._render(t,i),this.clipTo&&t.restore(),this._removeShadow(t),this._restoreCompositeOperation(t),t.restore())},_setOpacity:function(t){this.group&&this.group._setOpacity(t),t.globalAlpha*=this.opacity},_setStrokeStyles:function(t){this.stroke&&(t.lineWidth=this.strokeWidth,t.lineCap=this.strokeLineCap,t.lineJoin=this.strokeLineJoin,t.miterLimit=this.strokeMiterLimit,t.strokeStyle=this.stroke.toLive?this.stroke.toLive(t,this):this.stroke)},_setFillStyles:function(t){this.fill&&(t.fillStyle=this.fill.toLive?this.fill.toLive(t,this):this.fill)},_renderControls:function(t,i){if(this.active&&!i){var n=this.getViewportTransform();t.save();var r;this.group&&(r=e.util.transformPoint(this.group.getCenterPoint(),n),t.translate(r.x,r.y),t.rotate(o(this.group.angle))),r=e.util.transformPoint(this.getCenterPoint(),n,null!=this.group),this.group&&(r.x*=this.group.scaleX,r.y*=this.group.scaleY),t.translate(r.x,r.y),t.rotate(o(this.angle)),this.drawBorders(t),this.drawControls(t),t.restore()}},_setShadow:function(t){if(this.shadow){var e=this.canvas&&this.canvas.viewportTransform[0]||1,i=this.canvas&&this.canvas.viewportTransform[3]||1;t.shadowColor=this.shadow.color,t.shadowBlur=this.shadow.blur*(e+i)*(this.scaleX+this.scaleY)/4,t.shadowOffsetX=this.shadow.offsetX*e*this.scaleX,t.shadowOffsetY=this.shadow.offsetY*i*this.scaleY}},_removeShadow:function(t){this.shadow&&(t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0)},_renderFill:function(t){if(this.fill){if(t.save(),this.fill.gradientTransform){var e=this.fill.gradientTransform;t.transform.apply(t,e)}this.fill.toLive&&t.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0),"evenodd"===this.fillRule?t.fill("evenodd"):t.fill(),t.restore(),this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t)}},_renderStroke:function(t){if(this.stroke&&0!==this.strokeWidth){if(t.save(),this.strokeDashArray)1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),s?(t.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(t)):this._renderDashedStroke&&this._renderDashedStroke(t),t.stroke();else{if(this.stroke.gradientTransform){var e=this.stroke.gradientTransform;t.transform.apply(t,e)}this._stroke?this._stroke(t):t.stroke()}this._removeShadow(t),t.restore()}},clone:function(t,i){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(i),t):new e.Object(this.toObject(i))},cloneAsImage:function(t){var i=this.toDataURL();return e.util.loadImage(i,function(i){t&&t(new e.Image(i))}),this},toDataURL:function(t){t||(t={});var i=e.util.createCanvasElement(),n=this.getBoundingRect();i.width=n.width,i.height=n.height,e.util.wrapElement(i,"div");var r=new e.StaticCanvas(i);"jpg"===t.format&&(t.format="jpeg"),"jpeg"===t.format&&(r.backgroundColor="#fff");var o={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",!1),this.setPositionByOrigin(new e.Point(i.width/2,i.height/2),"center","center");var s=this.canvas;r.add(this);var a=r.toDataURL(t);return this.set(o).setCoords(),this.canvas=s,r.dispose(),r=null,a},isType:function(t){return this.type===t},complexity:function(){return 0},toJSON:function(t){return this.toObject(t)},setGradient:function(t,i){i||(i={});var n={colorStops:[]};n.type=i.type||(i.r1||i.r2?"radial":"linear"),n.coords={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2},(i.r1||i.r2)&&(n.coords.r1=i.r1,n.coords.r2=i.r2);for(var r in i.colorStops){var o=new e.Color(i.colorStops[r]);n.colorStops.push({offset:r,color:o.toRgb(),opacity:o.getAlpha()})}return this.set(t,e.Gradient.forObject(this,n))},setPatternFill:function(t){return this.set("fill",new e.Pattern(t))},setShadow:function(t){return this.set("shadow",t?new e.Shadow(t):null)},setColor:function(t){return this.set("fill",t),this},setAngle:function(t){var e=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return e&&this._setOriginToCenter(),this.set("angle",t),e&&this._resetOrigin(),this},centerH:function(){return this.canvas.centerObjectH(this),this},centerV:function(){return this.canvas.centerObjectV(this),this},center:function(){return this.canvas.centerObject(this),this},remove:function(){return this.canvas.remove(this),this},getLocalPointer:function(t,e){e=e||this.canvas.getPointer(t);var i=this.translateToOriginPoint(this.getCenterPoint(),"left","top");return{x:e.x-i.x,y:e.y-i.y}},_setupCompositeOperation:function(t){this.globalCompositeOperation&&(this._prevGlobalCompositeOperation=t.globalCompositeOperation,t.globalCompositeOperation=this.globalCompositeOperation)},_restoreCompositeOperation:function(t){this.globalCompositeOperation&&this._prevGlobalCompositeOperation&&(t.globalCompositeOperation=this._prevGlobalCompositeOperation)}}),e.util.createAccessors(e.Object),e.Object.prototype.rotate=e.Object.prototype.setAngle,i(e.Object.prototype,e.Observable),e.Object.NUM_FRACTION_DIGITS=16,e.Object.__uid=0)}("undefined"!=typeof exports?exports:this),function(){var t=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{translateToCenterPoint:function(e,i,n){var r=e.x,o=e.y,s=this.stroke?this.strokeWidth:0;return"left"===i?r=e.x+(this.getWidth()+s*this.scaleX)/2:"right"===i&&(r=e.x-(this.getWidth()+s*this.scaleX)/2),"top"===n?o=e.y+(this.getHeight()+s*this.scaleY)/2:"bottom"===n&&(o=e.y-(this.getHeight()+s*this.scaleY)/2),fabric.util.rotatePoint(new fabric.Point(r,o),e,t(this.angle))},translateToOriginPoint:function(e,i,n){var r=e.x,o=e.y,s=this.stroke?this.strokeWidth:0;return"left"===i?r=e.x-(this.getWidth()+s*this.scaleX)/2:"right"===i&&(r=e.x+(this.getWidth()+s*this.scaleX)/2),"top"===n?o=e.y-(this.getHeight()+s*this.scaleY)/2:"bottom"===n&&(o=e.y+(this.getHeight()+s*this.scaleY)/2),fabric.util.rotatePoint(new fabric.Point(r,o),e,t(this.angle))},getCenterPoint:function(){var t=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(t,this.originX,this.originY)},getPointByOrigin:function(t,e){var i=this.getCenterPoint();return this.translateToOriginPoint(i,t,e)},toLocalPoint:function(e,i,n){var r,o,s=this.getCenterPoint(),a=this.stroke?this.strokeWidth:0;return i&&n?(r="left"===i?s.x-(this.getWidth()+a*this.scaleX)/2:"right"===i?s.x+(this.getWidth()+a*this.scaleX)/2:s.x,o="top"===n?s.y-(this.getHeight()+a*this.scaleY)/2:"bottom"===n?s.y+(this.getHeight()+a*this.scaleY)/2:s.y):(r=this.left,
o=this.top),fabric.util.rotatePoint(new fabric.Point(e.x,e.y),s,-t(this.angle)).subtractEquals(new fabric.Point(r,o))},setPositionByOrigin:function(t,e,i){var n=this.translateToCenterPoint(t,e,i),r=this.translateToOriginPoint(n,this.originX,this.originY);this.set("left",r.x),this.set("top",r.y)},adjustPosition:function(e){var i=t(this.angle),n=this.getWidth()/2,r=Math.cos(i)*n,o=Math.sin(i)*n,s=this.getWidth(),a=Math.cos(i)*s,l=Math.sin(i)*s;"center"===this.originX&&"left"===e||"right"===this.originX&&"center"===e?(this.left-=r,this.top-=o):"left"===this.originX&&"center"===e||"center"===this.originX&&"right"===e?(this.left+=r,this.top+=o):"left"===this.originX&&"right"===e?(this.left+=a,this.top+=l):"right"===this.originX&&"left"===e&&(this.left-=a,this.top-=l),this.setCoords(),this.originX=e},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var t=this.getCenterPoint();this.originX="center",this.originY="center",this.left=t.x,this.top=t.y},_resetOrigin:function(){var t=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=t.x,this.top=t.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","center")}})}(),function(){var t=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(t,e){var i=this.oCoords,n=new fabric.Point(i.tl.x,i.tl.y),r=new fabric.Point(i.tr.x,i.tr.y),o=new fabric.Point(i.bl.x,i.bl.y),s=new fabric.Point(i.br.x,i.br.y),a=fabric.Intersection.intersectPolygonRectangle([n,r,s,o],t,e);return"Intersection"===a.status},intersectsWithObject:function(t){function e(t){return{tl:new fabric.Point(t.tl.x,t.tl.y),tr:new fabric.Point(t.tr.x,t.tr.y),bl:new fabric.Point(t.bl.x,t.bl.y),br:new fabric.Point(t.br.x,t.br.y)}}var i=e(this.oCoords),n=e(t.oCoords),r=fabric.Intersection.intersectPolygonPolygon([i.tl,i.tr,i.br,i.bl],[n.tl,n.tr,n.br,n.bl]);return"Intersection"===r.status},isContainedWithinObject:function(t){var e=t.getBoundingRect(),i=new fabric.Point(e.left,e.top),n=new fabric.Point(e.left+e.width,e.top+e.height);return this.isContainedWithinRect(i,n)},isContainedWithinRect:function(t,e){var i=this.getBoundingRect();return i.left>=t.x&&i.left+i.width<=e.x&&i.top>=t.y&&i.top+i.height<=e.y},containsPoint:function(t){var e=this._getImageLines(this.oCoords),i=this._findCrossPoints(t,e);return 0!==i&&i%2===1},_getImageLines:function(t){return{topline:{o:t.tl,d:t.tr},rightline:{o:t.tr,d:t.br},bottomline:{o:t.br,d:t.bl},leftline:{o:t.bl,d:t.tl}}},_findCrossPoints:function(t,e){var i,n,r,o,s,a,l,c=0;for(var h in e)if(l=e[h],!(l.o.y<t.y&&l.d.y<t.y||l.o.y>=t.y&&l.d.y>=t.y||(l.o.x===l.d.x&&l.o.x>=t.x?(s=l.o.x,a=t.y):(i=0,n=(l.d.y-l.o.y)/(l.d.x-l.o.x),r=t.y-i*t.x,o=l.o.y-n*l.o.x,s=-(r-o)/(i-n),a=r+i*s),s>=t.x&&(c+=1),2!==c)))break;return c},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var t=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],e=fabric.util.array.min(t),i=fabric.util.array.max(t),n=Math.abs(e-i),r=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],o=fabric.util.array.min(r),s=fabric.util.array.max(r),a=Math.abs(o-s);return{left:e,top:o,width:n,height:a}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(t){return Math.abs(t)<this.minScaleLimit?0>t?-this.minScaleLimit:this.minScaleLimit:t},scale:function(t){return t=this._constrainScale(t),0>t&&(this.flipX=!this.flipX,this.flipY=!this.flipY,t*=-1),this.scaleX=t,this.scaleY=t,this.setCoords(),this},scaleToWidth:function(t){var e=this.getBoundingRectWidth()/this.getWidth();return this.scale(t/this.width/e)},scaleToHeight:function(t){var e=this.getBoundingRectHeight()/this.getHeight();return this.scale(t/this.height/e)},setCoords:function(){var e=t(this.angle),i=this.getViewportTransform(),n=function(t){return fabric.util.transformPoint(t,i)},r=this._calculateCurrentDimensions(!1),o=r.x,s=r.y;0>o&&(o=Math.abs(o));var a=Math.sqrt(Math.pow(o/2,2)+Math.pow(s/2,2)),l=Math.atan(isFinite(s/o)?s/o:0),c=Math.cos(l+e)*a,h=Math.sin(l+e)*a,u=Math.sin(e),f=Math.cos(e),d=this.getCenterPoint(),p=new fabric.Point(o,s),g=new fabric.Point(d.x-c,d.y-h),v=new fabric.Point(g.x+p.x*f,g.y+p.x*u),m=n(new fabric.Point(g.x-p.y*u,g.y+p.y*f)),b=n(new fabric.Point(v.x-p.y*u,v.y+p.y*f)),y=n(g),C=n(v),x=new fabric.Point((y.x+m.x)/2,(y.y+m.y)/2),w=new fabric.Point((C.x+y.x)/2,(C.y+y.y)/2),_=new fabric.Point((b.x+C.x)/2,(b.y+C.y)/2),S=new fabric.Point((b.x+m.x)/2,(b.y+m.y)/2),O=new fabric.Point(w.x+u*this.rotatingPointOffset,w.y-f*this.rotatingPointOffset);return this.oCoords={tl:y,tr:C,br:b,bl:m,ml:x,mt:w,mr:_,mb:S,mtr:O},this._setCornerCoords&&this._setCornerCoords(),this}})}(),fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(t){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,t):this.canvas.sendBackwards(this,t),this},bringForward:function(t){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,t):this.canvas.bringForward(this,t),this},moveTo:function(t){return this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,t):this.canvas.moveTo(this,t),this}}),fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(){var t=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",e=this.fillRule,i=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",n=this.strokeWidth?this.strokeWidth:"0",r=this.strokeDashArray?this.strokeDashArray.join(" "):"",o=this.strokeLineCap?this.strokeLineCap:"butt",s=this.strokeLineJoin?this.strokeLineJoin:"miter",a=this.strokeMiterLimit?this.strokeMiterLimit:"4",l="undefined"!=typeof this.opacity?this.opacity:"1",c=this.visible?"":" visibility: hidden;",h=this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":"";return["stroke: ",i,"; ","stroke-width: ",n,"; ","stroke-dasharray: ",r,"; ","stroke-linecap: ",o,"; ","stroke-linejoin: ",s,"; ","stroke-miterlimit: ",a,"; ","fill: ",t,"; ","fill-rule: ",e,"; ","opacity: ",l,";",h,c].join("")},getSvgTransform:function(){if(this.group&&"path-group"===this.group.type)return"";var t=fabric.util.toFixed,e=this.getAngle(),i=!this.canvas||this.canvas.svgViewportTransformation?this.getViewportTransform():[1,0,0,1,0,0],n=fabric.util.transformPoint(this.getCenterPoint(),i),r=fabric.Object.NUM_FRACTION_DIGITS,o="path-group"===this.type?"":"translate("+t(n.x,r)+" "+t(n.y,r)+")",s=0!==e?" rotate("+t(e,r)+")":"",a=1===this.scaleX&&1===this.scaleY&&1===i[0]&&1===i[3]?"":" scale("+t(this.scaleX*i[0],r)+" "+t(this.scaleY*i[3],r)+")",l="path-group"===this.type?this.width*i[0]:0,c=this.flipX?" matrix(-1 0 0 1 "+l+" 0) ":"",h="path-group"===this.type?this.height*i[3]:0,u=this.flipY?" matrix(1 0 0 -1 0 "+h+")":"";return[o,s,a,c,u].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+") ":""},_createBaseSVGMarkup:function(){var t=[];return this.fill&&this.fill.toLive&&t.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&t.push(this.stroke.toSVG(this,!1)),this.shadow&&t.push(this.shadow.toSVG(this)),t}}),fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(t){return this.get(t)!==this.originalState[t]},this)},saveState:function(t){return this.stateProperties.forEach(function(t){this.originalState[t]=this.get(t)},this),t&&t.stateProperties&&t.stateProperties.forEach(function(t){this.originalState[t]=this.get(t)},this),this},setupState:function(){return this.originalState={},this.saveState(),this}}),function(){var t=fabric.util.degreesToRadians,e=function(){return"undefined"!=typeof G_vmlCanvasManager};fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(t){if(!this.hasControls||!this.active)return!1;var e,i,n=t.x,r=t.y;for(var o in this.oCoords)if(this.isControlVisible(o)&&("mtr"!==o||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==o&&"mr"!==o&&"mb"!==o&&"ml"!==o)&&(i=this._getImageLines(this.oCoords[o].corner),e=this._findCrossPoints({x:n,y:r},i),0!==e&&e%2===1))return this.__corner=o,o;return!1},_setCornerCoords:function(){var e,i,n=this.oCoords,r=t(45-this.angle),o=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,s=o*Math.cos(r),a=o*Math.sin(r);for(var l in n)e=n[l].x,i=n[l].y,n[l].corner={tl:{x:e-a,y:i-s},tr:{x:e+s,y:i-a},bl:{x:e-s,y:i+a},br:{x:e+a,y:i+s}}},_calculateCurrentDimensions:function(t){var e=this.getViewportTransform(),i=this.strokeWidth,n=this.width,r=this.height,o="round"===this.strokeLineCap||"square"===this.strokeLineCap,s="line"===this.type&&0===this.width,a="line"===this.type&&0===this.height,l=s||a,c=o&&a||!l,h=o&&s||!l;return s?n=i:a&&(r=i),c&&(n+=0>n?-i:i),h&&(r+=0>r?-i:i),n=n*this.scaleX+2*this.padding,r=r*this.scaleY+2*this.padding,t?fabric.util.transformPoint(new fabric.Point(n,r),e,!0):{x:n,y:r}},drawBorders:function(t){if(!this.hasBorders)return this;t.save(),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,t.strokeStyle=this.borderColor,t.lineWidth=1/this.borderScaleFactor;var e=this._calculateCurrentDimensions(!0),i=e.x,n=e.y;if(this.group&&(i*=this.group.scaleX,n*=this.group.scaleY),t.strokeRect(~~-(i/2)-.5,~~-(n/2)-.5,~~i+1,~~n+1),this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls){var r=-n/2;t.beginPath(),t.moveTo(0,r),t.lineTo(0,r-this.rotatingPointOffset),t.closePath(),t.stroke()}return t.restore(),this},drawControls:function(t){if(!this.hasControls)return this;var e=this._calculateCurrentDimensions(!0),i=e.x,n=e.y,r=-(i/2),o=-(n/2),s=this.cornerSize/2,a=this.transparentCorners?"strokeRect":"fillRect";return t.save(),t.lineWidth=1,t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,t.strokeStyle=t.fillStyle=this.cornerColor,this._drawControl("tl",t,a,r-s,o-s),this._drawControl("tr",t,a,r+i-s,o-s),this._drawControl("bl",t,a,r-s,o+n-s),this._drawControl("br",t,a,r+i-s,o+n-s),this.get("lockUniScaling")||(this._drawControl("mt",t,a,r+i/2-s,o-s),this._drawControl("mb",t,a,r+i/2-s,o+n-s),this._drawControl("mr",t,a,r+i-s,o+n/2-s),this._drawControl("ml",t,a,r-s,o+n/2-s)),this.hasRotatingPoint&&this._drawControl("mtr",t,a,r+i/2-s,o-this.rotatingPointOffset-s),t.restore(),this},_drawControl:function(t,i,n,r,o){if(this.isControlVisible(t)){var s=this.cornerSize;e()||this.transparentCorners||i.clearRect(r,o,s,s),i[n](r,o,s,s)}},isControlVisible:function(t){return this._getControlsVisibility()[t]},setControlVisible:function(t,e){return this._getControlsVisibility()[t]=e,this},setControlsVisibility:function(t){t||(t={});for(var e in t)this.setControlVisible(e,t[e]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(t,e){e=e||{};var i=function(){},n=e.onComplete||i,r=e.onChange||i,o=this;return fabric.util.animate({startValue:t.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(e){t.set("left",e),o.renderAll(),r()},onComplete:function(){t.setCoords(),n()}}),this},fxCenterObjectV:function(t,e){e=e||{};var i=function(){},n=e.onComplete||i,r=e.onChange||i,o=this;return fabric.util.animate({startValue:t.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(e){t.set("top",e),o.renderAll(),r()},onComplete:function(){t.setCoords(),n()}}),this},fxRemove:function(t,e){e=e||{};var i=function(){},n=e.onComplete||i,r=e.onChange||i,o=this;return fabric.util.animate({startValue:t.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){t.set("active",!1)},onChange:function(e){t.set("opacity",e),o.renderAll(),r()},onComplete:function(){o.remove(t),n()}}),this}}),fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var t,e,i=[];for(t in arguments[0])i.push(t);for(var n=0,r=i.length;r>n;n++)t=i[n],e=n!==r-1,this._animate(t,arguments[0][t],arguments[1],e)}else this._animate.apply(this,arguments);return this},_animate:function(t,e,i,n){var r,o=this;e=e.toString(),i=i?fabric.util.object.clone(i):{},~t.indexOf(".")&&(r=t.split("."));var s=r?this.get(r[0])[r[1]]:this.get(t);"from"in i||(i.from=s),e=~e.indexOf("=")?s+parseFloat(e.replace("=","")):parseFloat(e),fabric.util.animate({startValue:i.from,endValue:e,byValue:i.by,easing:i.easing,duration:i.duration,abort:i.abort&&function(){return i.abort.call(o)},onChange:function(e){r?o[r[0]][r[1]]=e:o.set(t,e),n||i.onChange&&i.onChange()},onComplete:function(){n||(o.setCoords(),i.onComplete&&i.onComplete())}})}}),function(t){"use strict";function e(t,e){var i=t.origin,n=t.axis1,r=t.axis2,o=t.dimension,s=e.nearest,a=e.center,l=e.farthest;return function(){switch(this.get(i)){case s:return Math.min(this.get(n),this.get(r));case a:return Math.min(this.get(n),this.get(r))+.5*this.get(o);case l:return Math.max(this.get(n),this.get(r))}}}var i=t.fabric||(t.fabric={}),n=i.util.object.extend,r={x1:1,x2:1,y1:1,y2:1},o=i.StaticCanvas.supports("setLineDash");return i.Line?void i.warn("fabric.Line is already defined"):(i.Line=i.util.createClass(i.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(t,e){e=e||{},t||(t=[0,0,0,0]),this.callSuper("initialize",e),this.set("x1",t[0]),this.set("y1",t[1]),this.set("x2",t[2]),this.set("y2",t[3]),this._setWidthHeight(e)},_setWidthHeight:function(t){t||(t={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in t?t.left:this._getLeftToOriginX(),this.top="top"in t?t.top:this._getTopToOriginY()},_set:function(t,e){return this.callSuper("_set",t,e),"undefined"!=typeof r[t]&&this._setWidthHeight(),this},_getLeftToOriginX:e({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:e({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(t,e){if(t.beginPath(),e){var i=this.getCenterPoint();t.translate(i.x-this.strokeWidth/2,i.y-this.strokeWidth/2)}if(!this.strokeDashArray||this.strokeDashArray&&o){var n=this.calcLinePoints();t.moveTo(n.x1,n.y1),t.lineTo(n.x2,n.y2)}t.lineWidth=this.strokeWidth;var r=t.strokeStyle;t.strokeStyle=this.stroke||t.fillStyle,this.stroke&&this._renderStroke(t),t.strokeStyle=r},_renderDashedStroke:function(t){var e=this.calcLinePoints();t.beginPath(),i.util.drawDashedLine(t,e.x1,e.y1,e.x2,e.y2,this.strokeDashArray),t.closePath()},toObject:function(t){return n(this.callSuper("toObject",t),this.calcLinePoints())},calcLinePoints:function(){var t=this.x1<=this.x2?-1:1,e=this.y1<=this.y2?-1:1,i=t*this.width*.5,n=e*this.height*.5,r=t*this.width*-.5,o=e*this.height*-.5;return{x1:i,x2:r,y1:n,y2:o}},toSVG:function(t){var e=this._createBaseSVGMarkup(),i={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};return this.group&&"path-group"===this.group.type||(i=this.calcLinePoints()),e.push("<line ",'x1="',i.x1,'" y1="',i.y1,'" x2="',i.x2,'" y2="',i.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),t?t(e.join("")):e.join("")},complexity:function(){return 1}}),i.Line.ATTRIBUTE_NAMES=i.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),i.Line.fromElement=function(t,e){var r=i.parseAttributes(t,i.Line.ATTRIBUTE_NAMES),o=[r.x1||0,r.y1||0,r.x2||0,r.y2||0];return new i.Line(o,n(r,e))},i.Line.fromObject=function(t){var e=[t.x1,t.y1,t.x2,t.y2];return new i.Line(e,t)},void 0)}("undefined"!=typeof exports?exports:this),function(t){"use strict";function e(t){return"radius"in t&&t.radius>=0}var i=t.fabric||(t.fabric={}),n=Math.PI,r=i.util.object.extend;return i.Circle?void i.warn("fabric.Circle is already defined."):(i.Circle=i.util.createClass(i.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*n,initialize:function(t){t=t||{},this.callSuper("initialize",t),this.set("radius",t.radius||0),this.startAngle=t.startAngle||this.startAngle,this.endAngle=t.endAngle||this.endAngle},_set:function(t,e){return this.callSuper("_set",t,e),"radius"===t&&this.setRadius(e),this},toObject:function(t){return r(this.callSuper("toObject",t),{radius:this.get("radius"),startAngle:this.startAngle,endAngle:this.endAngle})},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=0,r=0,o=(this.endAngle-this.startAngle)%(2*n);if(0===o)this.group&&"path-group"===this.group.type&&(i=this.left+this.radius,r=this.top+this.radius),e.push("<circle ",'cx="'+i+'" cy="'+r+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');else{var s=Math.cos(this.startAngle)*this.radius,a=Math.sin(this.startAngle)*this.radius,l=Math.cos(this.endAngle)*this.radius,c=Math.sin(this.endAngle)*this.radius,h=o>n?"1":"0";e.push('<path d="M '+s+" "+a," A "+this.radius+" "+this.radius," 0 ",+h+" 1"," "+l+" "+c,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')}return t?t(e.join("")):e.join("")},_render:function(t,e){t.beginPath(),t.arc(e?this.left+this.radius:0,e?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1),this._renderFill(t),this._renderStroke(t)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(t){this.radius=t,this.set("width",2*t).set("height",2*t)},complexity:function(){return 1}}),i.Circle.ATTRIBUTE_NAMES=i.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),i.Circle.fromElement=function(t,n){n||(n={});var o=i.parseAttributes(t,i.Circle.ATTRIBUTE_NAMES);if(!e(o))throw new Error("value of `r` attribute is required and can not be negative");o.left=o.left||0,o.top=o.top||0;var s=new i.Circle(r(o,n));return s.left-=s.radius,s.top-=s.radius,s},i.Circle.fromObject=function(t){return new i.Circle(t)},void 0)}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={});return e.Triangle?void e.warn("fabric.Triangle is already defined"):(e.Triangle=e.util.createClass(e.Object,{type:"triangle",initialize:function(t){t=t||{},this.callSuper("initialize",t),this.set("width",t.width||100).set("height",t.height||100)},_render:function(t){var e=this.width/2,i=this.height/2;t.beginPath(),t.moveTo(-e,i),t.lineTo(0,-i),t.lineTo(e,i),t.closePath(),this._renderFill(t),this._renderStroke(t)},_renderDashedStroke:function(t){var i=this.width/2,n=this.height/2;t.beginPath(),e.util.drawDashedLine(t,-i,n,0,-n,this.strokeDashArray),e.util.drawDashedLine(t,0,-n,i,n,this.strokeDashArray),e.util.drawDashedLine(t,i,n,-i,n,this.strokeDashArray),t.closePath()},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=this.width/2,n=this.height/2,r=[-i+" "+n,"0 "+-n,i+" "+n].join(",");return e.push("<polygon ",'points="',r,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),t?t(e.join("")):e.join("")},complexity:function(){return 1}}),void(e.Triangle.fromObject=function(t){return new e.Triangle(t)}))}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=2*Math.PI,n=e.util.object.extend;return e.Ellipse?void e.warn("fabric.Ellipse is already defined."):(e.Ellipse=e.util.createClass(e.Object,{type:"ellipse",rx:0,ry:0,initialize:function(t){t=t||{},this.callSuper("initialize",t),this.set("rx",t.rx||0),this.set("ry",t.ry||0)},_set:function(t,e){switch(this.callSuper("_set",t,e),t){case"rx":this.rx=e,this.set("width",2*e);break;case"ry":this.ry=e,this.set("height",2*e)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(t){return n(this.callSuper("toObject",t),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=0,n=0;return this.group&&"path-group"===this.group.type&&(i=this.left+this.rx,n=this.top+this.ry),e.push("<ellipse ",'cx="',i,'" cy="',n,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),t?t(e.join("")):e.join("")},_render:function(t,e){t.beginPath(),t.save(),t.transform(1,0,0,this.ry/this.rx,0,0),t.arc(e?this.left+this.rx:0,e?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,i,!1),t.restore(),this._renderFill(t),this._renderStroke(t)},complexity:function(){return 1}}),e.Ellipse.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),e.Ellipse.fromElement=function(t,i){i||(i={});var r=e.parseAttributes(t,e.Ellipse.ATTRIBUTE_NAMES);r.left=r.left||0,r.top=r.top||0;var o=new e.Ellipse(n(r,i));return o.top-=o.ry,o.left-=o.rx,o},e.Ellipse.fromObject=function(t){return new e.Ellipse(t)},void 0)}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;if(e.Rect)return void console.warn("fabric.Rect is already defined");var n=e.Object.prototype.stateProperties.concat();n.push("rx","ry","x","y"),e.Rect=e.util.createClass(e.Object,{stateProperties:n,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(t){t=t||{},this.callSuper("initialize",t),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(t,e){if(1===this.width&&1===this.height)return void t.fillRect(0,0,1,1);var i=this.rx?Math.min(this.rx,this.width/2):0,n=this.ry?Math.min(this.ry,this.height/2):0,r=this.width,o=this.height,s=e?this.left:-this.width/2,a=e?this.top:-this.height/2,l=0!==i||0!==n,c=.4477152502;t.beginPath(),t.moveTo(s+i,a),t.lineTo(s+r-i,a),l&&t.bezierCurveTo(s+r-c*i,a,s+r,a+c*n,s+r,a+n),t.lineTo(s+r,a+o-n),l&&t.bezierCurveTo(s+r,a+o-c*n,s+r-c*i,a+o,s+r-i,a+o),t.lineTo(s+i,a+o),l&&t.bezierCurveTo(s+c*i,a+o,s,a+o-c*n,s,a+o-n),t.lineTo(s,a+n),l&&t.bezierCurveTo(s,a+c*n,s+c*i,a,s+i,a),t.closePath(),this._renderFill(t),this._renderStroke(t)},_renderDashedStroke:function(t){var i=-this.width/2,n=-this.height/2,r=this.width,o=this.height;t.beginPath(),e.util.drawDashedLine(t,i,n,i+r,n,this.strokeDashArray),e.util.drawDashedLine(t,i+r,n,i+r,n+o,this.strokeDashArray),e.util.drawDashedLine(t,i+r,n+o,i,n+o,this.strokeDashArray),e.util.drawDashedLine(t,i,n+o,i,n,this.strokeDashArray),t.closePath()},toObject:function(t){var e=i(this.callSuper("toObject",t),{rx:this.get("rx")||0,ry:this.get("ry")||0});return this.includeDefaultValues||this._removeDefaultValues(e),e},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=this.left,n=this.top;return this.group&&"path-group"===this.group.type||(i=-this.width/2,n=-this.height/2),e.push("<rect ",'x="',i,'" y="',n,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),t?t(e.join("")):e.join("")},complexity:function(){return 1}}),e.Rect.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),e.Rect.fromElement=function(t,n){if(!t)return null;n=n||{};var r=e.parseAttributes(t,e.Rect.ATTRIBUTE_NAMES);r.left=r.left||0,r.top=r.top||0;var o=new e.Rect(i(n?e.util.object.clone(n):{},r));return o.visible=o.width>0&&o.height>0,o},e.Rect.fromObject=function(t){return new e.Rect(t)}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={});return e.Polyline?void e.warn("fabric.Polyline is already defined"):(e.Polyline=e.util.createClass(e.Object,{type:"polyline",points:null,minX:0,minY:0,initialize:function(t,i){return e.Polygon.prototype.initialize.call(this,t,i)},_calcDimensions:function(){return e.Polygon.prototype._calcDimensions.call(this)},_applyPointOffset:function(){return e.Polygon.prototype._applyPointOffset.call(this)},toObject:function(t){return e.Polygon.prototype.toObject.call(this,t)},toSVG:function(t){return e.Polygon.prototype.toSVG.call(this,t)},_render:function(t){e.Polygon.prototype.commonRender.call(this,t)&&(this._renderFill(t),this._renderStroke(t))},_renderDashedStroke:function(t){var i,n;t.beginPath();for(var r=0,o=this.points.length;o>r;r++)i=this.points[r],n=this.points[r+1]||i,e.util.drawDashedLine(t,i.x,i.y,n.x,n.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),e.Polyline.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polyline.fromElement=function(t,i){if(!t)return null;i||(i={});var n=e.parsePointsAttribute(t.getAttribute("points")),r=e.parseAttributes(t,e.Polyline.ATTRIBUTE_NAMES);return new e.Polyline(n,e.util.object.extend(r,i))},e.Polyline.fromObject=function(t){var i=t.points;return new e.Polyline(i,t,!0)},void 0)}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.array.min,r=e.util.array.max,o=e.util.toFixed;return e.Polygon?void e.warn("fabric.Polygon is already defined"):(e.Polygon=e.util.createClass(e.Object,{type:"polygon",points:null,minX:0,minY:0,initialize:function(t,e){e=e||{},this.points=t||[],this.callSuper("initialize",e),this._calcDimensions(),"top"in e||(this.top=this.minY),"left"in e||(this.left=this.minX)},_calcDimensions:function(){var t=this.points,e=n(t,"x"),i=n(t,"y"),o=r(t,"x"),s=r(t,"y");this.width=o-e||0,this.height=s-i||0,this.minX=e||0,this.minY=i||0},_applyPointOffset:function(){this.points.forEach(function(t){t.x-=this.minX+this.width/2,t.y-=this.minY+this.height/2},this)},toObject:function(t){return i(this.callSuper("toObject",t),{points:this.points.concat()})},toSVG:function(t){for(var e=[],i=this._createBaseSVGMarkup(),n=0,r=this.points.length;r>n;n++)e.push(o(this.points[n].x,2),",",o(this.points[n].y,2)," ");return i.push("<",this.type," ",'points="',e.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n'),t?t(i.join("")):i.join("")},_render:function(t){this.commonRender(t)&&(this._renderFill(t),(this.stroke||this.strokeDashArray)&&(t.closePath(),this._renderStroke(t)))},commonRender:function(t){var e,i=this.points.length;if(!i||isNaN(this.points[i-1].y))return!1;t.beginPath(),this._applyPointOffset&&((!this.group||"path-group"!==this.group.type)&&this._applyPointOffset(),this._applyPointOffset=null),t.moveTo(this.points[0].x,this.points[0].y);for(var n=0;i>n;n++)e=this.points[n],t.lineTo(e.x,e.y);return!0},_renderDashedStroke:function(t){e.Polyline.prototype._renderDashedStroke.call(this,t),t.closePath()},complexity:function(){return this.points.length}}),e.Polygon.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polygon.fromElement=function(t,n){if(!t)return null;n||(n={});var r=e.parsePointsAttribute(t.getAttribute("points")),o=e.parseAttributes(t,e.Polygon.ATTRIBUTE_NAMES);return new e.Polygon(r,i(o,n))},e.Polygon.fromObject=function(t){return new e.Polygon(t.points,t,!0)},void 0)}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.array.min,n=e.util.array.max,r=e.util.object.extend,o=Object.prototype.toString,s=e.util.drawArc,a={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},l={m:"l",M:"L"};return e.Path?void e.warn("fabric.Path is already defined"):(e.Path=e.util.createClass(e.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(t,e){if(e=e||{},this.setOptions(e),!t)throw new Error("`path` argument is required");var i="[object Array]"===o.call(t);this.path=i?t:t.match&&t.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path&&(i||(this.path=this._parsePath()),this._setPositionDimensions(),e.sourcePath&&this.setSourcePath(e.sourcePath))},_setPositionDimensions:function(){var t=this._parseDimensions();this.minX=t.left,this.minY=t.top,this.width=t.width,this.height=t.height,t.left+="center"===this.originX?this.width/2:"right"===this.originX?this.width:0,t.top+="center"===this.originY?this.height/2:"bottom"===this.originY?this.height:0,this.top=this.top||t.top,this.left=this.left||t.left,this.pathOffset=this.pathOffset||{x:this.minX+this.width/2,y:this.minY+this.height/2}},_render:function(t){var e,i,n,r=null,o=0,a=0,l=0,c=0,h=0,u=0,f=-this.pathOffset.x,d=-this.pathOffset.y;this.group&&"path-group"===this.group.type&&(f=0,d=0),t.beginPath();for(var p=0,g=this.path.length;g>p;++p){switch(e=this.path[p],e[0]){case"l":l+=e[1],c+=e[2],t.lineTo(l+f,c+d);break;case"L":l=e[1],c=e[2],t.lineTo(l+f,c+d);break;case"h":l+=e[1],t.lineTo(l+f,c+d);break;case"H":l=e[1],t.lineTo(l+f,c+d);break;case"v":c+=e[1],t.lineTo(l+f,c+d);break;case"V":c=e[1],t.lineTo(l+f,c+d);break;case"m":l+=e[1],c+=e[2],o=l,a=c,t.moveTo(l+f,c+d);break;case"M":l=e[1],c=e[2],o=l,a=c,t.moveTo(l+f,c+d);break;case"c":i=l+e[5],n=c+e[6],h=l+e[3],u=c+e[4],t.bezierCurveTo(l+e[1]+f,c+e[2]+d,h+f,u+d,i+f,n+d),l=i,c=n;break;case"C":l=e[5],c=e[6],h=e[3],u=e[4],t.bezierCurveTo(e[1]+f,e[2]+d,h+f,u+d,l+f,c+d);break;case"s":i=l+e[3],n=c+e[4],null===r[0].match(/[CcSs]/)?(h=l,u=c):(h=2*l-h,u=2*c-u),t.bezierCurveTo(h+f,u+d,l+e[1]+f,c+e[2]+d,i+f,n+d),h=l+e[1],u=c+e[2],l=i,c=n;break;case"S":i=e[3],n=e[4],null===r[0].match(/[CcSs]/)?(h=l,u=c):(h=2*l-h,u=2*c-u),t.bezierCurveTo(h+f,u+d,e[1]+f,e[2]+d,i+f,n+d),l=i,c=n,h=e[1],u=e[2];break;case"q":i=l+e[3],n=c+e[4],h=l+e[1],u=c+e[2],t.quadraticCurveTo(h+f,u+d,i+f,n+d),l=i,c=n;break;case"Q":i=e[3],n=e[4],t.quadraticCurveTo(e[1]+f,e[2]+d,i+f,n+d),l=i,c=n,h=e[1],u=e[2];break;case"t":i=l+e[1],n=c+e[2],null===r[0].match(/[QqTt]/)?(h=l,u=c):(h=2*l-h,u=2*c-u),t.quadraticCurveTo(h+f,u+d,i+f,n+d),l=i,c=n;break;case"T":i=e[1],n=e[2],null===r[0].match(/[QqTt]/)?(h=l,u=c):(h=2*l-h,u=2*c-u),t.quadraticCurveTo(h+f,u+d,i+f,n+d),l=i,c=n;break;case"a":s(t,l+f,c+d,[e[1],e[2],e[3],e[4],e[5],e[6]+l+f,e[7]+c+d]),l+=e[6],c+=e[7];break;case"A":s(t,l+f,c+d,[e[1],e[2],e[3],e[4],e[5],e[6]+f,e[7]+d]),l=e[6],c=e[7];break;case"z":case"Z":l=o,c=a,t.closePath()}r=e}this._renderFill(t),this._renderStroke(t)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(t){var e=r(this.callSuper("toObject",t),{path:this.path.map(function(t){return t.slice()}),pathOffset:this.pathOffset});return this.sourcePath&&(e.sourcePath=this.sourcePath),this.transformMatrix&&(e.transformMatrix=this.transformMatrix),e},toDatalessObject:function(t){var e=this.toObject(t);return this.sourcePath&&(e.path=this.sourcePath),delete e.sourcePath,e},toSVG:function(t){for(var e=[],i=this._createBaseSVGMarkup(),n="",r=0,o=this.path.length;o>r;r++)e.push(this.path[r].join(" "));var s=e.join(" ");return this.group&&"path-group"===this.group.type||(n=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") "),i.push("<path ",'d="',s,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),n,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n"),t?t(i.join("")):i.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var t,e,i,n,r,o=[],s=[],c=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,h=0,u=this.path.length;u>h;h++){for(t=this.path[h],n=t.slice(1).trim(),s.length=0;i=c.exec(n);)s.push(i[0]);r=[t.charAt(0)];for(var f=0,d=s.length;d>f;f++)e=parseFloat(s[f]),isNaN(e)||r.push(e);var p=r[0],g=a[p.toLowerCase()],v=l[p]||p;if(r.length-1>g)for(var m=1,b=r.length;b>m;m+=g)o.push([p].concat(r.slice(m,m+g))),
p=v;else o.push(r)}return o},_parseDimensions:function(){for(var t,r,o,s,a=[],l=[],c=null,h=0,u=0,f=0,d=0,p=0,g=0,v=0,m=this.path.length;m>v;++v){switch(t=this.path[v],t[0]){case"l":f+=t[1],d+=t[2],s=[];break;case"L":f=t[1],d=t[2],s=[];break;case"h":f+=t[1],s=[];break;case"H":f=t[1],s=[];break;case"v":d+=t[1],s=[];break;case"V":d=t[1],s=[];break;case"m":f+=t[1],d+=t[2],h=f,u=d,s=[];break;case"M":f=t[1],d=t[2],h=f,u=d,s=[];break;case"c":r=f+t[5],o=d+t[6],p=f+t[3],g=d+t[4],s=e.util.getBoundsOfCurve(f,d,f+t[1],d+t[2],p,g,r,o),f=r,d=o;break;case"C":f=t[5],d=t[6],p=t[3],g=t[4],s=e.util.getBoundsOfCurve(f,d,t[1],t[2],p,g,f,d);break;case"s":r=f+t[3],o=d+t[4],null===c[0].match(/[CcSs]/)?(p=f,g=d):(p=2*f-p,g=2*d-g),s=e.util.getBoundsOfCurve(f,d,p,g,f+t[1],d+t[2],r,o),p=f+t[1],g=d+t[2],f=r,d=o;break;case"S":r=t[3],o=t[4],null===c[0].match(/[CcSs]/)?(p=f,g=d):(p=2*f-p,g=2*d-g),s=e.util.getBoundsOfCurve(f,d,p,g,t[1],t[2],r,o),f=r,d=o,p=t[1],g=t[2];break;case"q":r=f+t[3],o=d+t[4],p=f+t[1],g=d+t[2],s=e.util.getBoundsOfCurve(f,d,p,g,p,g,r,o),f=r,d=o;break;case"Q":p=t[1],g=t[2],s=e.util.getBoundsOfCurve(f,d,p,g,p,g,t[3],t[4]),f=t[3],d=t[4];break;case"t":r=f+t[1],o=d+t[2],null===c[0].match(/[QqTt]/)?(p=f,g=d):(p=2*f-p,g=2*d-g),s=e.util.getBoundsOfCurve(f,d,p,g,p,g,r,o),f=r,d=o;break;case"T":r=t[1],o=t[2],null===c[0].match(/[QqTt]/)?(p=f,g=d):(p=2*f-p,g=2*d-g),s=e.util.getBoundsOfCurve(f,d,p,g,p,g,r,o),f=r,d=o;break;case"a":s=e.util.getBoundsOfArc(f,d,t[1],t[2],t[3],t[4],t[5],t[6]+f,t[7]+d),f+=t[6],d+=t[7];break;case"A":s=e.util.getBoundsOfArc(f,d,t[1],t[2],t[3],t[4],t[5],t[6],t[7]),f=t[6],d=t[7];break;case"z":case"Z":f=h,d=u}c=t,s.forEach(function(t){a.push(t.x),l.push(t.y)}),a.push(f),l.push(d)}var b=i(a),y=i(l),C=n(a),x=n(l),w=C-b,_=x-y,S={left:b,top:y,width:w,height:_};return S}}),e.Path.fromObject=function(t,i){"string"==typeof t.path?e.loadSVGFromURL(t.path,function(n){var r=n[0],o=t.path;delete t.path,e.util.object.extend(r,t),r.setSourcePath(o),i(r)}):i(new e.Path(t.path,t))},e.Path.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(["d"]),e.Path.fromElement=function(t,i,n){var o=e.parseAttributes(t,e.Path.ATTRIBUTE_NAMES);i&&i(new e.Path(o.d,r(o,n)))},e.Path.async=!0,void 0)}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.array.invoke,r=e.Object.prototype.toObject;return e.PathGroup?void e.warn("fabric.PathGroup is already defined"):(e.PathGroup=e.util.createClass(e.Path,{type:"path-group",fill:"",initialize:function(t,e){e=e||{},this.paths=t||[];for(var i=this.paths.length;i--;)this.paths[i].group=this;e.toBeParsed&&(this.parseDimensionsFromPaths(e),delete e.toBeParsed),this.setOptions(e),this.setCoords(),e.sourcePath&&this.setSourcePath(e.sourcePath)},parseDimensionsFromPaths:function(t){for(var i,n,r,o,s,a=[],l=[],c=this.transformMatrix,h=this.paths.length;h--;){r=this.paths[h],o=r.height+r.strokeWidth,s=r.width+r.strokeWidth,i=[{x:r.left,y:r.top},{x:r.left+s,y:r.top},{x:r.left,y:r.top+o},{x:r.left+s,y:r.top+o}];for(var u=0;u<i.length;u++)n=i[u],c&&(n=e.util.transformPoint(n,c,!1)),a.push(n.x),l.push(n.y)}t.width=Math.max.apply(null,a),t.height=Math.max.apply(null,l)},render:function(t){if(this.visible){t.save(),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this.transform(t),this._setShadow(t),this.clipTo&&e.util.clipContext(this,t),t.translate(-this.width/2,-this.height/2);for(var i=0,n=this.paths.length;n>i;++i)this.paths[i].render(t,!0);this.clipTo&&t.restore(),this._removeShadow(t),t.restore()}},_set:function(t,e){if("fill"===t&&e&&this.isSameColor())for(var i=this.paths.length;i--;)this.paths[i]._set(t,e);return this.callSuper("_set",t,e)},toObject:function(t){var e=i(r.call(this,t),{paths:n(this.getObjects(),"toObject",t)});return this.sourcePath&&(e.sourcePath=this.sourcePath),e},toDatalessObject:function(t){var e=this.toObject(t);return this.sourcePath&&(e.paths=this.sourcePath),e},toSVG:function(t){for(var e=this.getObjects(),i=this.getPointByOrigin("left","top"),n="translate("+i.x+" "+i.y+")",r=["<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransformMatrix(),n,this.getSvgTransform(),'" ',">\n"],o=0,s=e.length;s>o;o++)r.push(e[o].toSVG(t));return r.push("</g>\n"),t?t(r.join("")):r.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var t=(this.getObjects()[0].get("fill")||"").toLowerCase();return this.getObjects().every(function(e){return(e.get("fill")||"").toLowerCase()===t})},complexity:function(){return this.paths.reduce(function(t,e){return t+(e&&e.complexity?e.complexity():0)},0)},getObjects:function(){return this.paths}}),e.PathGroup.fromObject=function(t,i){"string"==typeof t.paths?e.loadSVGFromURL(t.paths,function(n){var r=t.paths;delete t.paths;var o=e.util.groupSVGElements(n,t,r);i(o)}):e.util.enlivenObjects(t.paths,function(n){delete t.paths,i(new e.PathGroup(n,t))})},e.PathGroup.async=!0,void 0)}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.array.min,r=e.util.array.max,o=e.util.array.invoke;if(!e.Group){var s={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};e.Group=e.util.createClass(e.Object,e.Collection,{type:"group",initialize:function(t,e){e=e||{},this._objects=t||[];for(var i=this._objects.length;i--;)this._objects[i].group=this;this.originalState={},this.callSuper("initialize"),e.originX&&(this.originX=e.originX),e.originY&&(this.originY=e.originY),this._calcBounds(),this._updateObjectsCoords(),this.callSuper("initialize",e),this.setCoords(),this.saveCoords()},_updateObjectsCoords:function(){this.forEachObject(this._updateObjectCoords,this)},_updateObjectCoords:function(t){var e=t.getLeft(),i=t.getTop(),n=this.getCenterPoint();t.set({originalLeft:e,originalTop:i,left:e-n.x,top:i-n.y}),t.setCoords(),t.__origHasControls=t.hasControls,t.hasControls=!1},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(t){return this._restoreObjectsState(),t&&(this._objects.push(t),t.group=this),this.forEachObject(this._setObjectActive,this),this._calcBounds(),this._updateObjectsCoords(),this},_setObjectActive:function(t){t.set("active",!0),t.group=this},removeWithUpdate:function(t){return this._moveFlippedObject(t),this._restoreObjectsState(),this.forEachObject(this._setObjectActive,this),this.remove(t),this._calcBounds(),this._updateObjectsCoords(),this},_onObjectAdded:function(t){t.group=this},_onObjectRemoved:function(t){delete t.group,t.set("active",!1)},delegatedProperties:{fill:!0,opacity:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(t,e){if(t in this.delegatedProperties)for(var i=this._objects.length;i--;)this._objects[i].set(t,e);this.callSuper("_set",t,e)},toObject:function(t){return i(this.callSuper("toObject",t),{objects:o(this._objects,"toObject",t)})},render:function(t){if(this.visible){t.save(),this.clipTo&&e.util.clipContext(this,t),this.transform(t);for(var i=0,n=this._objects.length;n>i;i++)this._renderObject(this._objects[i],t);this.clipTo&&t.restore(),t.restore()}},_renderControls:function(t,e){this.callSuper("_renderControls",t,e);for(var i=0,n=this._objects.length;n>i;i++)this._objects[i]._renderControls(t)},_renderObject:function(t,e){var i=t.hasRotatingPoint;t.visible&&(t.hasRotatingPoint=!1,t.render(e),t.hasRotatingPoint=i)},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(t){return this._moveFlippedObject(t),this._setObjectPosition(t),t},_moveFlippedObject:function(t){var e=t.get("originX"),i=t.get("originY"),n=t.getCenterPoint();t.set({originX:"center",originY:"center",left:n.x,top:n.y}),this._toggleFlipping(t);var r=t.getPointByOrigin(e,i);return t.set({originX:e,originY:i,left:r.x,top:r.y}),this},_toggleFlipping:function(t){this.flipX&&(t.toggle("flipX"),t.set("left",-t.get("left")),t.setAngle(-t.getAngle())),this.flipY&&(t.toggle("flipY"),t.set("top",-t.get("top")),t.setAngle(-t.getAngle()))},_restoreObjectState:function(t){return this._setObjectPosition(t),t.setCoords(),t.hasControls=t.__origHasControls,delete t.__origHasControls,t.set("active",!1),t.setCoords(),delete t.group,this},_setObjectPosition:function(t){var e=this.getCenterPoint(),i=this._getRotatedLeftTop(t);t.set({angle:t.getAngle()+this.getAngle(),left:e.x+i.left,top:e.y+i.top,scaleX:t.get("scaleX")*this.get("scaleX"),scaleY:t.get("scaleY")*this.get("scaleY")})},_getRotatedLeftTop:function(t){var e=this.getAngle()*(Math.PI/180);return{left:-Math.sin(e)*t.getTop()*this.get("scaleY")+Math.cos(e)*t.getLeft()*this.get("scaleX"),top:Math.cos(e)*t.getTop()*this.get("scaleY")+Math.sin(e)*t.getLeft()*this.get("scaleX")}},destroy:function(){return this._objects.forEach(this._moveFlippedObject,this),this._restoreObjectsState()},saveCoords:function(){return this._originalLeft=this.get("left"),this._originalTop=this.get("top"),this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){return this.forEachObject(function(t){t.setCoords()}),this},_calcBounds:function(t){for(var e,i,n=[],r=[],o=["tr","br","bl","tl"],s=0,a=this._objects.length;a>s;++s){e=this._objects[s],e.setCoords();for(var l=0;l<o.length;l++)i=o[l],n.push(e.oCoords[i].x),r.push(e.oCoords[i].y)}this.set(this._getBounds(n,r,t))},_getBounds:function(t,i,o){var s=e.util.invertTransform(this.getViewportTransform()),a=e.util.transformPoint(new e.Point(n(t),n(i)),s),l=e.util.transformPoint(new e.Point(r(t),r(i)),s),c={width:l.x-a.x||0,height:l.y-a.y||0};return o||(c.left=a.x||0,c.top=a.y||0,"center"===this.originX&&(c.left+=c.width/2),"right"===this.originX&&(c.left+=c.width),"center"===this.originY&&(c.top+=c.height/2),"bottom"===this.originY&&(c.top+=c.height)),c},toSVG:function(t){for(var e=["<g ",'transform="',this.getSvgTransform(),'">\n'],i=0,n=this._objects.length;n>i;i++)e.push(this._objects[i].toSVG(t));return e.push("</g>\n"),t?t(e.join("")):e.join("")},get:function(t){if(t in s){if(this[t])return this[t];for(var e=0,i=this._objects.length;i>e;e++)if(this._objects[e][t])return!0;return!1}return t in this.delegatedProperties?this._objects[0]&&this._objects[0].get(t):this[t]}}),e.Group.fromObject=function(t,i){e.util.enlivenObjects(t.objects,function(n){delete t.objects,i&&i(new e.Group(n,t))})},e.Group.async=!0}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=fabric.util.object.extend;return t.fabric||(t.fabric={}),t.fabric.Image?void fabric.warn("fabric.Image is already defined."):(fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",_lastScaleX:1,_lastScaleY:1,initialize:function(t,e){e||(e={}),this.filters=[],this.resizeFilters=[],this.callSuper("initialize",e),this._initElement(t,e),this._initConfig(e),e.filters&&(this.filters=e.filters,this.applyFilters())},getElement:function(){return this._element},setElement:function(t,e,i){return this._element=t,this._originalElement=t,this._initConfig(i),0!==this.filters.length?this.applyFilters(e):e&&e(),this},setCrossOrigin:function(t){return this.crossOrigin=t,this._element.crossOrigin=t,this},getOriginalSize:function(){var t=this.getElement();return{width:t.width,height:t.height}},_stroke:function(t){t.save(),this._setStrokeStyles(t),t.beginPath(),t.strokeRect(-this.width/2,-this.height/2,this.width,this.height),t.closePath(),t.restore()},_renderDashedStroke:function(t){var e=-this.width/2,i=-this.height/2,n=this.width,r=this.height;t.save(),this._setStrokeStyles(t),t.beginPath(),fabric.util.drawDashedLine(t,e,i,e+n,i,this.strokeDashArray),fabric.util.drawDashedLine(t,e+n,i,e+n,i+r,this.strokeDashArray),fabric.util.drawDashedLine(t,e+n,i+r,e,i+r,this.strokeDashArray),fabric.util.drawDashedLine(t,e,i+r,e,i,this.strokeDashArray),t.closePath(),t.restore()},toObject:function(t){return e(this.callSuper("toObject",t),{src:this._originalElement.src||this._originalElement._src,filters:this.filters.map(function(t){return t&&t.toObject()}),crossOrigin:this.crossOrigin,alignX:this.alignX,alignY:this.alignY,meetOrSlice:this.meetOrSlice})},toSVG:function(t){var e=[],i=-this.width/2,n=-this.height/2,r="none";if(this.group&&"path-group"===this.group.type&&(i=this.left,n=this.top),"none"!==this.alignX&&"none"!==this.alignY&&(r="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice),e.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n','<image xlink:href="',this.getSvgSrc(),'" x="',i,'" y="',n,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',r,'"',"></image>\n"),this.stroke||this.strokeDashArray){var o=this.fill;this.fill=null,e.push("<rect ",'x="',i,'" y="',n,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=o}return e.push("</g>\n"),t?t(e.join("")):e.join("")},getSrc:function(){return this.getElement()?this.getElement().src||this.getElement()._src:void 0},setSrc:function(t,e,i){fabric.util.loadImage(t,function(t){return this.setElement(t,e,i)},this,i&&i.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(t,e){this.constructor.fromObject(this.toObject(e),t)},applyFilters:function(t,e,i,n){if(e=e||this.filters,i=i||this._originalElement){var r=i,o=fabric.util.createCanvasElement(),s=fabric.util.createImage(),a=this;return o.width=r.width,o.height=r.height,o.getContext("2d").drawImage(r,0,0,r.width,r.height),0===e.length?(this._element=i,t&&t(),o):(e.forEach(function(t){t&&t.applyTo(o,t.scaleX||a.scaleX,t.scaleY||a.scaleY),!n&&t&&"Resize"===t.type&&(a.width*=t.scaleX,a.height*=t.scaleY)}),s.width=o.width,s.height=o.height,fabric.isLikelyNode?(s.src=o.toBuffer(void 0,fabric.Image.pngCompression),a._element=s,!n&&(a._filteredEl=s),t&&t()):(s.onload=function(){a._element=s,!n&&(a._filteredEl=s),t&&t(),s.onload=o=r=null},s.src=o.toDataURL("image/png")),o)}},_render:function(t,e){var i,n,r,o=this._findMargins();i=e?this.left:-this.width/2,n=e?this.top:-this.height/2,"slice"===this.meetOrSlice&&(t.beginPath(),t.rect(i,n,this.width,this.height),t.clip()),this.isMoving===!1&&this.resizeFilters.length&&this._needsResize()?(this._lastScaleX=this.scaleX,this._lastScaleY=this.scaleY,r=this.applyFilters(null,this.resizeFilters,this._filteredEl||this._originalElement,!0)):r=this._element,r&&t.drawImage(r,i+o.marginX,n+o.marginY,o.width,o.height),this._renderStroke(t)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var t,e,i=this.width,n=this.height,r=0,o=0;return("none"!==this.alignX||"none"!==this.alignY)&&(t=[this.width/this._element.width,this.height/this._element.height],e="meet"===this.meetOrSlice?Math.min.apply(null,t):Math.max.apply(null,t),i=this._element.width*e,n=this._element.height*e,"Mid"===this.alignX&&(r=(this.width-i)/2),"Max"===this.alignX&&(r=this.width-i),"Mid"===this.alignY&&(o=(this.height-n)/2),"Max"===this.alignY&&(o=this.height-n)),{width:i,height:n,marginX:r,marginY:o}},_resetWidthHeight:function(){var t=this.getElement();this.set("width",t.width),this.set("height",t.height)},_initElement:function(t){this.setElement(fabric.util.getById(t)),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(t){t||(t={}),this.setOptions(t),this._setWidthHeight(t),this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(t,e){t.filters&&t.filters.length?fabric.util.enlivenObjects(t.filters,function(t){e&&e(t)},"fabric.Image.filters"):e&&e()},_setWidthHeight:function(t){this.width="width"in t?t.width:this.getElement()?this.getElement().width||0:0,this.height="height"in t?t.height:this.getElement()?this.getElement().height||0:0},complexity:function(){return 1}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(t,e){fabric.util.loadImage(t.src,function(i){fabric.Image.prototype._initFilters.call(t,t,function(n){t.filters=n||[];var r=new fabric.Image(i,t);e&&e(r)})},null,t.crossOrigin)},fabric.Image.fromURL=function(t,e,i){fabric.util.loadImage(t,function(t){e&&e(new fabric.Image(t,i))},null,i&&i.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href".split(" ")),fabric.Image.fromElement=function(t,i,n){var r,o,s,a=fabric.parseAttributes(t,fabric.Image.ATTRIBUTE_NAMES),l="xMidYMid",c="meet";a.preserveAspectRatio&&(s=a.preserveAspectRatio.split(" ")),s&&s.length&&(c=s.pop(),"meet"!==c&&"slice"!==c?(l=c,c="meet"):s.length&&(l=s.pop())),r="none"!==l?l.slice(1,4):"none",o="none"!==l?l.slice(5,8):"none",a.alignX=r,a.alignY=o,a.meetOrSlice=c,fabric.Image.fromURL(a["xlink:href"],i,e(n?fabric.util.object.clone(n):{},a))},fabric.Image.async=!0,fabric.Image.pngCompression=1,void 0)}("undefined"!=typeof exports?exports:this),fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var t=this.getAngle()%360;return t>0?90*Math.round((t-1)/90):90*Math.round(t/90)},straighten:function(){return this.setAngle(this._getAngleValueForStraighten()),this},fxStraighten:function(t){t=t||{};var e=function(){},i=t.onComplete||e,n=t.onChange||e,r=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(t){r.setAngle(t),n()},onComplete:function(){r.setCoords(),i()},onStart:function(){r.set("active",!1)}}),this}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(t){return t.straighten(),this.renderAll(),this},fxStraightenObject:function(t){return t.fxStraighten({onChange:this.renderAll.bind(this)}),this}}),fabric.Image.filters=fabric.Image.filters||{},fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",initialize:function(t){t&&this.setOptions(t)},setOptions:function(t){for(var e in t)this[e]=t[e]},toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}}),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.Image.filters.Brightness=e.util.createClass(e.Image.filters.BaseFilter,{type:"Brightness",initialize:function(t){t=t||{},this.brightness=t.brightness||0},applyTo:function(t){for(var e=t.getContext("2d"),i=e.getImageData(0,0,t.width,t.height),n=i.data,r=this.brightness,o=0,s=n.length;s>o;o+=4)n[o]+=r,n[o+1]+=r,n[o+2]+=r;e.putImageData(i,0,0)},toObject:function(){return i(this.callSuper("toObject"),{brightness:this.brightness})}}),e.Image.filters.Brightness.fromObject=function(t){return new e.Image.filters.Brightness(t)}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.Image.filters.Convolute=e.util.createClass(e.Image.filters.BaseFilter,{type:"Convolute",initialize:function(t){t=t||{},this.opaque=t.opaque,this.matrix=t.matrix||[0,0,0,0,1,0,0,0,0];var i=e.util.createCanvasElement();this.tmpCtx=i.getContext("2d")},_createImageData:function(t,e){return this.tmpCtx.createImageData(t,e)},applyTo:function(t){for(var e=this.matrix,i=t.getContext("2d"),n=i.getImageData(0,0,t.width,t.height),r=Math.round(Math.sqrt(e.length)),o=Math.floor(r/2),s=n.data,a=n.width,l=n.height,c=a,h=l,u=this._createImageData(c,h),f=u.data,d=this.opaque?1:0,p=0;h>p;p++)for(var g=0;c>g;g++){for(var v=p,m=g,b=4*(p*c+g),y=0,C=0,x=0,w=0,_=0;r>_;_++)for(var S=0;r>S;S++){var O=v+_-o,T=m+S-o;if(!(0>O||O>l||0>T||T>a)){var k=4*(O*a+T),j=e[_*r+S];y+=s[k]*j,C+=s[k+1]*j,x+=s[k+2]*j,w+=s[k+3]*j}}f[b]=y,f[b+1]=C,f[b+2]=x,f[b+3]=w+d*(255-w)}i.putImageData(u,0,0)},toObject:function(){return i(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),e.Image.filters.Convolute.fromObject=function(t){return new e.Image.filters.Convolute(t)}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.Image.filters.GradientTransparency=e.util.createClass(e.Image.filters.BaseFilter,{type:"GradientTransparency",initialize:function(t){t=t||{},this.threshold=t.threshold||100},applyTo:function(t){for(var e=t.getContext("2d"),i=e.getImageData(0,0,t.width,t.height),n=i.data,r=this.threshold,o=n.length,s=0,a=n.length;a>s;s+=4)n[s+3]=r+255*(o-s)/o;e.putImageData(i,0,0)},toObject:function(){return i(this.callSuper("toObject"),{threshold:this.threshold})}}),e.Image.filters.GradientTransparency.fromObject=function(t){return new e.Image.filters.GradientTransparency(t)}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={});e.Image.filters.Grayscale=e.util.createClass(e.Image.filters.BaseFilter,{type:"Grayscale",applyTo:function(t){for(var e,i=t.getContext("2d"),n=i.getImageData(0,0,t.width,t.height),r=n.data,o=n.width*n.height*4,s=0;o>s;)e=(r[s]+r[s+1]+r[s+2])/3,r[s]=e,r[s+1]=e,r[s+2]=e,s+=4;i.putImageData(n,0,0)}}),e.Image.filters.Grayscale.fromObject=function(){return new e.Image.filters.Grayscale}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={});e.Image.filters.Invert=e.util.createClass(e.Image.filters.BaseFilter,{type:"Invert",applyTo:function(t){var e,i=t.getContext("2d"),n=i.getImageData(0,0,t.width,t.height),r=n.data,o=r.length;for(e=0;o>e;e+=4)r[e]=255-r[e],r[e+1]=255-r[e+1],r[e+2]=255-r[e+2];i.putImageData(n,0,0)}}),e.Image.filters.Invert.fromObject=function(){return new e.Image.filters.Invert}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.Image.filters.Mask=e.util.createClass(e.Image.filters.BaseFilter,{type:"Mask",initialize:function(t){t=t||{},this.mask=t.mask,this.channel=[0,1,2,3].indexOf(t.channel)>-1?t.channel:0},applyTo:function(t){if(this.mask){var i,n=t.getContext("2d"),r=n.getImageData(0,0,t.width,t.height),o=r.data,s=this.mask.getElement(),a=e.util.createCanvasElement(),l=this.channel,c=r.width*r.height*4;a.width=s.width,a.height=s.height,a.getContext("2d").drawImage(s,0,0,s.width,s.height);var h=a.getContext("2d").getImageData(0,0,s.width,s.height),u=h.data;for(i=0;c>i;i+=4)o[i+3]=u[i+l];n.putImageData(r,0,0)}},toObject:function(){return i(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}}),e.Image.filters.Mask.fromObject=function(t,i){e.util.loadImage(t.mask.src,function(n){t.mask=new e.Image(n,t.mask),i&&i(new e.Image.filters.Mask(t))})},e.Image.filters.Mask.async=!0}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.Image.filters.Noise=e.util.createClass(e.Image.filters.BaseFilter,{type:"Noise",initialize:function(t){t=t||{},this.noise=t.noise||0},applyTo:function(t){for(var e,i=t.getContext("2d"),n=i.getImageData(0,0,t.width,t.height),r=n.data,o=this.noise,s=0,a=r.length;a>s;s+=4)e=(.5-Math.random())*o,r[s]+=e,r[s+1]+=e,r[s+2]+=e;i.putImageData(n,0,0)},toObject:function(){return i(this.callSuper("toObject"),{noise:this.noise})}}),e.Image.filters.Noise.fromObject=function(t){return new e.Image.filters.Noise(t)}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.Image.filters.Pixelate=e.util.createClass(e.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(t){t=t||{},this.blocksize=t.blocksize||4},applyTo:function(t){var e,i,n,r,o,s,a,l=t.getContext("2d"),c=l.getImageData(0,0,t.width,t.height),h=c.data,u=c.height,f=c.width;for(i=0;u>i;i+=this.blocksize)for(n=0;f>n;n+=this.blocksize){e=4*i*f+4*n,r=h[e],o=h[e+1],s=h[e+2],a=h[e+3];for(var d=i,p=i+this.blocksize;p>d;d++)for(var g=n,v=n+this.blocksize;v>g;g++)e=4*d*f+4*g,h[e]=r,h[e+1]=o,h[e+2]=s,h[e+3]=a}l.putImageData(c,0,0)},toObject:function(){return i(this.callSuper("toObject"),{blocksize:this.blocksize})}}),e.Image.filters.Pixelate.fromObject=function(t){return new e.Image.filters.Pixelate(t)}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.Image.filters.RemoveWhite=e.util.createClass(e.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(t){t=t||{},this.threshold=t.threshold||30,this.distance=t.distance||20},applyTo:function(t){for(var e,i,n,r=t.getContext("2d"),o=r.getImageData(0,0,t.width,t.height),s=o.data,a=this.threshold,l=this.distance,c=255-a,h=Math.abs,u=0,f=s.length;f>u;u+=4)e=s[u],i=s[u+1],n=s[u+2],e>c&&i>c&&n>c&&h(e-i)<l&&h(e-n)<l&&h(i-n)<l&&(s[u+3]=1);r.putImageData(o,0,0)},toObject:function(){return i(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}}),e.Image.filters.RemoveWhite.fromObject=function(t){return new e.Image.filters.RemoveWhite(t)}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={});e.Image.filters.Sepia=e.util.createClass(e.Image.filters.BaseFilter,{type:"Sepia",applyTo:function(t){var e,i,n=t.getContext("2d"),r=n.getImageData(0,0,t.width,t.height),o=r.data,s=o.length;for(e=0;s>e;e+=4)i=.3*o[e]+.59*o[e+1]+.11*o[e+2],o[e]=i+100,o[e+1]=i+50,o[e+2]=i+255;n.putImageData(r,0,0)}}),e.Image.filters.Sepia.fromObject=function(){return new e.Image.filters.Sepia}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={});e.Image.filters.Sepia2=e.util.createClass(e.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(t){var e,i,n,r,o=t.getContext("2d"),s=o.getImageData(0,0,t.width,t.height),a=s.data,l=a.length;for(e=0;l>e;e+=4)i=a[e],n=a[e+1],r=a[e+2],a[e]=(.393*i+.769*n+.189*r)/1.351,a[e+1]=(.349*i+.686*n+.168*r)/1.203,a[e+2]=(.272*i+.534*n+.131*r)/2.14;o.putImageData(s,0,0)}}),e.Image.filters.Sepia2.fromObject=function(){return new e.Image.filters.Sepia2}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.Image.filters.Tint=e.util.createClass(e.Image.filters.BaseFilter,{type:"Tint",initialize:function(t){t=t||{},this.color=t.color||"#000000",this.opacity="undefined"!=typeof t.opacity?t.opacity:new e.Color(this.color).getAlpha()},applyTo:function(t){var i,n,r,o,s,a,l,c,h,u=t.getContext("2d"),f=u.getImageData(0,0,t.width,t.height),d=f.data,p=d.length;for(h=new e.Color(this.color).getSource(),n=h[0]*this.opacity,r=h[1]*this.opacity,o=h[2]*this.opacity,c=1-this.opacity,i=0;p>i;i+=4)s=d[i],a=d[i+1],l=d[i+2],d[i]=n+s*c,d[i+1]=r+a*c,d[i+2]=o+l*c;u.putImageData(f,0,0)},toObject:function(){return i(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}}),e.Image.filters.Tint.fromObject=function(t){return new e.Image.filters.Tint(t)}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.Image.filters.Multiply=e.util.createClass(e.Image.filters.BaseFilter,{type:"Multiply",initialize:function(t){t=t||{},this.color=t.color||"#000000"},applyTo:function(t){var i,n,r=t.getContext("2d"),o=r.getImageData(0,0,t.width,t.height),s=o.data,a=s.length;for(n=new e.Color(this.color).getSource(),i=0;a>i;i+=4)s[i]*=n[0]/255,s[i+1]*=n[1]/255,s[i+2]*=n[2]/255;r.putImageData(o,0,0)},toObject:function(){return i(this.callSuper("toObject"),{color:this.color})}}),e.Image.filters.Multiply.fromObject=function(t){return new e.Image.filters.Multiply(t)}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric;e.Image.filters.Blend=e.util.createClass({type:"Blend",initialize:function(t){t=t||{},this.color=t.color||"#000",this.image=t.image||!1,this.mode=t.mode||"multiply",this.alpha=t.alpha||1},applyTo:function(t){var i,n,r,o,s,a,l,c,h,u,f=t.getContext("2d"),d=f.getImageData(0,0,t.width,t.height),p=d.data,g=!1;if(this.image){g=!0;var v=e.util.createCanvasElement();v.width=this.image.width,v.height=this.image.height;var m=new e.StaticCanvas(v);m.add(this.image);var b=m.getContext("2d");u=b.getImageData(0,0,m.width,m.height).data}else u=new e.Color(this.color).getSource(),i=u[0]*this.alpha,n=u[1]*this.alpha,r=u[2]*this.alpha;for(var y=0,C=p.length;C>y;y+=4)switch(o=p[y],s=p[y+1],a=p[y+2],g&&(i=u[y]*this.alpha,n=u[y+1]*this.alpha,r=u[y+2]*this.alpha),this.mode){case"multiply":p[y]=o*i/255,p[y+1]=s*n/255,p[y+2]=a*r/255;break;case"screen":p[y]=1-(1-o)*(1-i),p[y+1]=1-(1-s)*(1-n),p[y+2]=1-(1-a)*(1-r);break;case"add":p[y]=Math.min(255,o+i),p[y+1]=Math.min(255,s+n),p[y+2]=Math.min(255,a+r);break;case"diff":case"difference":p[y]=Math.abs(o-i),p[y+1]=Math.abs(s-n),p[y+2]=Math.abs(a-r);break;case"subtract":l=o-i,c=s-n,h=a-r,p[y]=0>l?0:l,p[y+1]=0>c?0:c,p[y+2]=0>h?0:h;break;case"darken":p[y]=Math.min(o,i),p[y+1]=Math.min(s,n),p[y+2]=Math.min(a,r);break;case"lighten":p[y]=Math.max(o,i),p[y+1]=Math.max(s,n),p[y+2]=Math.max(a,r)}f.putImageData(d,0,0)},toObject:function(){return{color:this.color,image:this.image,mode:this.mode,alpha:this.alpha}}}),e.Image.filters.Blend.fromObject=function(t){return new e.Image.filters.Blend(t)}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=Math.pow,n=Math.floor,r=Math.sqrt,o=Math.abs,s=Math.max,a=Math.round,l=Math.sin,c=Math.ceil;e.Image.filters.Resize=e.util.createClass(e.Image.filters.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,applyTo:function(t,e,i){this.rcpScaleX=1/e,this.rcpScaleY=1/i;var n,r=t.width,o=t.height,s=a(r*e),l=a(o*i);"sliceHack"===this.resizeType&&(n=this.sliceByTwo(t,r,o,s,l)),"hermite"===this.resizeType&&(n=this.hermiteFastResize(t,r,o,s,l)),"bilinear"===this.resizeType&&(n=this.bilinearFiltering(t,r,o,s,l)),"lanczos"===this.resizeType&&(n=this.lanczosResize(t,r,o,s,l)),t.width=s,t.height=l,t.getContext("2d").putImageData(n,0,0)},sliceByTwo:function(t,i,r,o,a){var l,c=t.getContext("2d"),h=.5,u=.5,f=1,d=1,p=!1,g=!1,v=i,m=r,b=e.util.createCanvasElement(),y=b.getContext("2d");for(o=n(o),a=n(a),b.width=s(o,i),b.height=s(a,r),o>i&&(h=2,f=-1),a>r&&(u=2,d=-1),l=c.getImageData(0,0,i,r),t.width=s(o,i),t.height=s(a,r),c.putImageData(l,0,0);!p||!g;)i=v,r=m,o*f<n(v*h*f)?v=n(v*h):(v=o,p=!0),a*d<n(m*u*d)?m=n(m*u):(m=a,g=!0),l=c.getImageData(0,0,i,r),y.putImageData(l,0,0),c.clearRect(0,0,v,m),c.drawImage(b,0,0,i,r,0,0,v,m);return c.getImageData(0,0,o,a)},lanczosResize:function(t,e,s,a,h){function u(t){return function(e){if(e>t)return 0;if(e*=Math.PI,o(e)<1e-16)return 1;var i=e/t;return l(e)*l(i)/e/i}}function f(t){var l,c,u,d,p,j,A,I,E,$,D;for(T.x=(t+.5)*y,k.x=n(T.x),l=0;h>l;l++){for(T.y=(l+.5)*C,k.y=n(T.y),p=0,j=0,A=0,I=0,E=0,c=k.x-_;c<=k.x+_;c++)if(!(0>c||c>=e)){$=n(1e3*o(c-T.x)),O[$]||(O[$]={});for(var P=k.y-S;P<=k.y+S;P++)0>P||P>=s||(D=n(1e3*o(P-T.y)),O[$][D]||(O[$][D]=b(r(i($*x,2)+i(D*w,2))/1e3)),u=O[$][D],u>0&&(d=4*(P*e+c),p+=u,j+=u*v[d],A+=u*v[d+1],I+=u*v[d+2],E+=u*v[d+3]))}d=4*(l*a+t),m[d]=j/p,m[d+1]=A/p,m[d+2]=I/p,m[d+3]=E/p}return++t<a?f(t):g}var d=t.getContext("2d"),p=d.getImageData(0,0,e,s),g=d.getImageData(0,0,a,h),v=p.data,m=g.data,b=u(this.lanczosLobes),y=this.rcpScaleX,C=this.rcpScaleY,x=2/this.rcpScaleX,w=2/this.rcpScaleY,_=c(y*this.lanczosLobes/2),S=c(C*this.lanczosLobes/2),O={},T={},k={};return f(0)},bilinearFiltering:function(t,e,i,r,o){var s,a,l,c,h,u,f,d,p,g,v,m,b,y=0,C=this.rcpScaleX,x=this.rcpScaleY,w=t.getContext("2d"),_=4*(e-1),S=w.getImageData(0,0,e,i),O=S.data,T=w.getImageData(0,0,r,o),k=T.data;for(f=0;o>f;f++)for(d=0;r>d;d++)for(h=n(C*d),u=n(x*f),p=C*d-h,g=x*f-u,b=4*(u*e+h),v=0;4>v;v++)s=O[b+v],a=O[b+4+v],l=O[b+_+v],c=O[b+_+4+v],m=s*(1-p)*(1-g)+a*p*(1-g)+l*g*(1-p)+c*p*g,k[y++]=m;return T},hermiteFastResize:function(t,e,i,s,a){for(var l=this.rcpScaleX,h=this.rcpScaleY,u=c(l/2),f=c(h/2),d=t.getContext("2d"),p=d.getImageData(0,0,e,i),g=p.data,v=d.getImageData(0,0,s,a),m=v.data,b=0;a>b;b++)for(var y=0;s>y;y++){for(var C=4*(y+b*s),x=0,w=0,_=0,S=0,O=0,T=0,k=0,j=(b+.5)*h,A=n(b*h);(b+1)*h>A;A++)for(var I=o(j-(A+.5))/f,E=(y+.5)*l,$=I*I,D=n(y*l);(y+1)*l>D;D++){
var P=o(E-(D+.5))/u,B=r($+P*P);B>1&&-1>B||(x=2*B*B*B-3*B*B+1,x>0&&(P=4*(D+A*e),k+=x*g[P+3],_+=x,g[P+3]<255&&(x=x*g[P+3]/250),S+=x*g[P],O+=x*g[P+1],T+=x*g[P+2],w+=x))}m[C]=S/w,m[C+1]=O/w,m[C+2]=T/w,m[C+3]=k/_}return v},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaley:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),e.Image.filters.Resize.fromObject=function(){return new e.Image.filters.Resize}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.object.clone,r=e.util.toFixed,o=e.StaticCanvas.supports("setLineDash");if(e.Text)return void e.warn("fabric.Text is already defined");var s=e.Object.prototype.stateProperties.concat();s.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor"),e.Text=e.util.createClass(e.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,text:!0,textAlign:!0},_reNewline:/\r?\n/,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.16,textBackgroundColor:"",stateProperties:s,stroke:null,shadow:null,_fontSizeFraction:.25,_fontSizeMult:1.13,initialize:function(t,e){e=e||{},this.text=t,this.__skipDimension=!0,this.setOptions(e),this.__skipDimension=!1,this._initDimensions()},_initDimensions:function(t){if(!this.__skipDimension){t||(t=e.util.createCanvasElement().getContext("2d"),this._setTextStyles(t)),this._textLines=this.text.split(this._reNewline),this._clearCache();var i=this.textAlign;this.textAlign="left",this.width=this._getTextWidth(t),this.textAlign=i,this.height=this._getTextHeight(t)}},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(t){this.clipTo&&e.util.clipContext(this,t),this._renderTextBackground(t),this._renderText(t),this._renderTextDecoration(t),this.clipTo&&t.restore()},_renderText:function(t){t.save(),this._translateForTextAlign(t),this._setOpacity(t),this._setShadow(t),this._setupCompositeOperation(t),this._renderTextFill(t),this._renderTextStroke(t),this._restoreCompositeOperation(t),this._removeShadow(t),t.restore()},_translateForTextAlign:function(t){"left"!==this.textAlign&&"justify"!==this.textAlign&&t.translate("center"===this.textAlign?this.width/2:this.width,0)},_setTextStyles:function(t){t.textBaseline="alphabetic",this.skipTextAlign||(t.textAlign=this.textAlign),t.font=this._getFontDeclaration()},_getTextHeight:function(){return this._textLines.length*this._getHeightOfLine()},_getTextWidth:function(t){for(var e=this._getLineWidth(t,0),i=1,n=this._textLines.length;n>i;i++){var r=this._getLineWidth(t,i);r>e&&(e=r)}return e},_renderChars:function(t,e,i,n,r){e[t](i,n,r)},_renderTextLine:function(t,e,i,n,r,o){if(r-=this.fontSize*this._fontSizeFraction,"justify"!==this.textAlign)return void this._renderChars(t,e,i,n,r,o);var s=this._getLineWidth(e,o),a=this.width;if(a>=s)for(var l=i.split(/\s+/),c=this._getWidthOfWords(e,i,o),h=a-c,u=l.length-1,f=h/u,d=0,p=0,g=l.length;g>p;p++)this._renderChars(t,e,l[p],n+d,r,o),d+=e.measureText(l[p]).width+f;else this._renderChars(t,e,i,n,r,o)},_getWidthOfWords:function(t,e){return t.measureText(e.replace(/\s+/g,"")).width},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextFill:function(t){if(this.fill||this._skipFillStrokeCheck){for(var e=0,i=0,n=this._textLines.length;n>i;i++){var r=this._getHeightOfLine(t,i),o=r/this.lineHeight;this._renderTextLine("fillText",t,this._textLines[i],this._getLeftOffset(),this._getTopOffset()+e+o,i),e+=r}this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t)}},_renderTextStroke:function(t){if(this.stroke&&0!==this.strokeWidth||this._skipFillStrokeCheck){var e=0;t.save(),this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),o&&t.setLineDash(this.strokeDashArray)),t.beginPath();for(var i=0,n=this._textLines.length;n>i;i++){var r=this._getHeightOfLine(t,i),s=r/this.lineHeight;this._renderTextLine("strokeText",t,this._textLines[i],this._getLeftOffset(),this._getTopOffset()+e+s,i),e+=r}t.closePath(),t.restore()}},_getHeightOfLine:function(){return this.fontSize*this._fontSizeMult*this.lineHeight},_renderTextBackground:function(t){this._renderTextBoxBackground(t),this._renderTextLinesBackground(t)},_renderTextBoxBackground:function(t){this.backgroundColor&&(t.save(),t.fillStyle=this.backgroundColor,t.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),t.restore())},_renderTextLinesBackground:function(t){var e=0,i=this._getHeightOfLine();if(this.textBackgroundColor){t.save(),t.fillStyle=this.textBackgroundColor;for(var n=0,r=this._textLines.length;r>n;n++){if(""!==this._textLines[n]){var o=this._getLineWidth(t,n),s=this._getLineLeftOffset(o);t.fillRect(this._getLeftOffset()+s,this._getTopOffset()+e,o,this.fontSize*this._fontSizeMult)}e+=i}t.restore()}},_getLineLeftOffset:function(t){return"center"===this.textAlign?(this.width-t)/2:"right"===this.textAlign?this.width-t:0},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__lineOffsets=[]},_shouldClearCache:function(){var t=!1;for(var e in this._dimensionAffectingProps)this["__"+e]!==this[e]&&(this["__"+e]=this[e],t=!0);return t},_getLineWidth:function(t,e){return this.__lineWidths[e]?this.__lineWidths[e]:(this.__lineWidths[e]=t.measureText(this._textLines[e]).width,this.__lineWidths[e])},_renderTextDecoration:function(t){function e(e){var r,o,s,a,l=0;for(r=0,o=n._textLines.length;o>r;r++){var c=n._getLineWidth(t,r),h=n._getLineLeftOffset(c),u=n._getHeightOfLine(t,r);for(s=0,a=e.length;a>s;s++)t.fillRect(n._getLeftOffset()+h,l+(n._fontSizeMult-1+e[s])*n.fontSize-i,c,n.fontSize/15);l+=u}}if(this.textDecoration){var i=this.height/2,n=this,r=[];this.textDecoration.indexOf("underline")>-1&&r.push(.85),this.textDecoration.indexOf("line-through")>-1&&r.push(.43),this.textDecoration.indexOf("overline")>-1&&r.push(-.12),r.length>0&&e(r)}},_getFontDeclaration:function(){return[e.isLikelyNode?this.fontWeight:this.fontStyle,e.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",e.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(t,e){this.visible&&(t.save(),this._setTextStyles(t),this._shouldClearCache()&&this._initDimensions(t),e||this.transform(t),this._setStrokeStyles(t),this._setFillStyles(t),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this.group&&"path-group"===this.group.type&&t.translate(this.left,this.top),this._render(t),t.restore())},toObject:function(t){var e=i(this.callSuper("toObject",t),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,textBackgroundColor:this.textBackgroundColor});return this.includeDefaultValues||this._removeDefaultValues(e),e},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=this._getSVGLeftTopOffsets(this.ctx),n=this._getSVGTextAndBg(i.textTop,i.textLeft);return this._wrapSVGTextAndBg(e,n),t?t(e.join("")):e.join("")},_getSVGLeftTopOffsets:function(t){var e=this._getHeightOfLine(t,0),i=-this.width/2,n=0;return{textLeft:i+(this.group&&"path-group"===this.group.type?this.left:0),textTop:n+(this.group&&"path-group"===this.group.type?-this.top:0),lineTop:e}},_wrapSVGTextAndBg:function(t,e){t.push('	<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n',e.textBgRects.join(""),"		<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" >',e.textSpans.join(""),"</text>\n","	</g>\n")},_getSVGTextAndBg:function(t,e){var i=[],n=[],r=0;this._setSVGBg(n);for(var o=0,s=this._textLines.length;s>o;o++)this.textBackgroundColor&&this._setSVGTextLineBg(n,o,e,t,r),this._setSVGTextLineText(o,i,r,e,t,n),r+=this._getHeightOfLine(this.ctx,o);return{textSpans:i,textBgRects:n}},_setSVGTextLineText:function(t,i,n,o,s){var a=this.fontSize*(this._fontSizeMult-this._fontSizeFraction)-s+n-this.height/2;i.push('<tspan x="',r(o+this._getLineLeftOffset(this.__lineWidths[t]),4),'" ','y="',r(a,4),'" ',this._getFillAttributes(this.fill),">",e.util.string.escapeXml(this._textLines[t]),"</tspan>")},_setSVGTextLineBg:function(t,e,i,n,o){t.push("		<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',r(i+this._getLineLeftOffset(this.__lineWidths[e]),4),'" y="',r(o-this.height/2,4),'" width="',r(this.__lineWidths[e],4),'" height="',r(this._getHeightOfLine(this.ctx,e)/this.lineHeight,4),'"></rect>\n')},_setSVGBg:function(t){this.backgroundColor&&t.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',r(-this.width/2,4),'" y="',r(-this.height/2,4),'" width="',r(this.width,4),'" height="',r(this.height,4),'"></rect>\n')},_getFillAttributes:function(t){var i=t&&"string"==typeof t?new e.Color(t):"";return i&&i.getSource()&&1!==i.getAlpha()?'opacity="'+i.getAlpha()+'" fill="'+i.setAlpha(1).toRgb()+'"':'fill="'+t+'"'},_set:function(t,e){this.callSuper("_set",t,e),t in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),e.Text.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")),e.Text.DEFAULT_SVG_FONT_SIZE=16,e.Text.fromElement=function(t,i){if(!t)return null;var n=e.parseAttributes(t,e.Text.ATTRIBUTE_NAMES);i=e.util.object.extend(i?e.util.object.clone(i):{},n),i.top=i.top||0,i.left=i.left||0,"dx"in n&&(i.left+=n.dx),"dy"in n&&(i.top+=n.dy),"fontSize"in i||(i.fontSize=e.Text.DEFAULT_SVG_FONT_SIZE),i.originX||(i.originX="left");var r=t.textContent.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),o=new e.Text(r,i),s=0;return"left"===o.originX&&(s=o.getWidth()/2),"right"===o.originX&&(s=-o.getWidth()/2),o.set({left:o.getLeft()+s,top:o.getTop()-o.getHeight()/2+o.fontSize*(.18+o._fontSizeFraction)}),o},e.Text.fromObject=function(t){return new e.Text(t.text,n(t))},e.util.createAccessors(e.Text)}("undefined"!=typeof exports?exports:this),function(){var t=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,styles:null,caching:!0,_skipFillStrokeCheck:!1,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,_charWidthsCache:{},initialize:function(t,e){this.styles=e?e.styles||{}:{},this.callSuper("initialize",t,e),this.initBehavior()},_clearCache:function(){this.callSuper("_clearCache"),this.__maxFontHeights=[],this.__widthOfSpace=[]},isEmptyStyles:function(){if(!this.styles)return!0;var t=this.styles;for(var e in t)for(var i in t[e])for(var n in t[e][i])return!1;return!0},setSelectionStart:function(t){t=Math.max(t,0),this.selectionStart!==t&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}),this.selectionStart=t),this._updateTextarea()},setSelectionEnd:function(t){t=Math.min(t,this.text.length),this.selectionEnd!==t&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}),this.selectionEnd=t),this._updateTextarea()},getSelectionStyles:function(t,e){if(2===arguments.length){for(var i=[],n=t;e>n;n++)i.push(this.getSelectionStyles(n));return i}var r=this.get2DCursorLocation(t);return this.styles[r.lineIndex]?this.styles[r.lineIndex][r.charIndex]||{}:{}},setSelectionStyles:function(t){if(this.selectionStart===this.selectionEnd)this._extendStyles(this.selectionStart,t);else for(var e=this.selectionStart;e<this.selectionEnd;e++)this._extendStyles(e,t);return this._clearCache(),this},_extendStyles:function(t,e){var i=this.get2DCursorLocation(t);this.styles[i.lineIndex]||(this.styles[i.lineIndex]={}),this.styles[i.lineIndex][i.charIndex]||(this.styles[i.lineIndex][i.charIndex]={}),fabric.util.object.extend(this.styles[i.lineIndex][i.charIndex],e)},_render:function(t){this.callSuper("_render",t),this.ctx=t,this.isEditing&&this.renderCursorOrSelection()},renderCursorOrSelection:function(){if(this.active){var t,e,i=this.text.split("");this.canvas.contextTop?(e=this.canvas.contextTop,e.save(),e.transform.apply(e,this.canvas.viewportTransform),this.transform(e)):(e=this.ctx,e.save()),this.selectionStart===this.selectionEnd?(t=this._getCursorBoundaries(i,"cursor"),this.renderCursor(t,e)):(t=this._getCursorBoundaries(i,"selection"),this.renderSelection(i,t,e)),e.restore()}},get2DCursorLocation:function(t){"undefined"==typeof t&&(t=this.selectionStart);var e=this.text.slice(0,t),i=e.split(this._reNewline);return{lineIndex:i.length-1,charIndex:i[i.length-1].length}},getCurrentCharStyle:function(t,e){var i=this.styles[t]&&this.styles[t][0===e?0:e-1];return{fontSize:i&&i.fontSize||this.fontSize,fill:i&&i.fill||this.fill,textBackgroundColor:i&&i.textBackgroundColor||this.textBackgroundColor,textDecoration:i&&i.textDecoration||this.textDecoration,fontFamily:i&&i.fontFamily||this.fontFamily,fontWeight:i&&i.fontWeight||this.fontWeight,fontStyle:i&&i.fontStyle||this.fontStyle,stroke:i&&i.stroke||this.stroke,strokeWidth:i&&i.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(t,e){return this.styles[t]&&this.styles[t][0===e?0:e-1]&&this.styles[t][0===e?0:e-1].fontSize||this.fontSize},getCurrentCharColor:function(t,e){return this.styles[t]&&this.styles[t][0===e?0:e-1]&&this.styles[t][0===e?0:e-1].fill||this.cursorColor},_getCursorBoundaries:function(t,e){var i=Math.round(this._getLeftOffset()),n=this._getTopOffset(),r=this._getCursorBoundariesOffsets(t,e);return{left:i,top:n,leftOffset:r.left+r.lineLeft,topOffset:r.top}},_getCursorBoundariesOffsets:function(t,e){for(var i=0,n=0,r=0,o=0,s=0,a=0;a<this.selectionStart;a++)"\n"===t[a]?(s=0,o+=this._getHeightOfLine(this.ctx,n),n++,r=0):(s+=this._getWidthOfChar(this.ctx,t[a],n,r),r++),i=this._getCachedLineOffset(n);return"cursor"===e&&(o+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,n)/this.lineHeight-this.getCurrentCharFontSize(n,r)*(1-this._fontSizeFraction)),{top:o,left:s,lineLeft:i}},_getCachedLineOffset:function(t){var e=this._getLineWidth(this.ctx,t);return this.__lineOffsets[t]||(this.__lineOffsets[t]=this._getLineLeftOffset(e))},renderCursor:function(t,e){var i=this.get2DCursorLocation(),n=i.lineIndex,r=i.charIndex,o=this.getCurrentCharFontSize(n,r),s=0===n&&0===r?this._getCachedLineOffset(n):t.leftOffset;e.fillStyle=this.getCurrentCharColor(n,r),e.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,e.fillRect(t.left+s,t.top+t.topOffset,this.cursorWidth/this.scaleX,o)},renderSelection:function(t,e,i){i.fillStyle=this.selectionColor;for(var n=this.get2DCursorLocation(this.selectionStart),r=this.get2DCursorLocation(this.selectionEnd),o=n.lineIndex,s=r.lineIndex,a=o;s>=a;a++){var l=this._getCachedLineOffset(a)||0,c=this._getHeightOfLine(this.ctx,a),h=0,u=this._textLines[a];if(a===o)for(var f=0,d=u.length;d>f;f++)f>=n.charIndex&&(a!==s||f<r.charIndex)&&(h+=this._getWidthOfChar(i,u[f],a,f)),f<n.charIndex&&(l+=this._getWidthOfChar(i,u[f],a,f));else if(a>o&&s>a)h+=this._getLineWidth(i,a)||5;else if(a===s)for(var p=0,g=r.charIndex;g>p;p++)h+=this._getWidthOfChar(i,u[p],a,p);i.fillRect(e.left+l,e.top+e.topOffset,h,c),e.topOffset+=c}},_renderChars:function(t,e,i,n,r,o){if(this.isEmptyStyles())return this._renderCharsFast(t,e,i,n,r);this.skipTextAlign=!0,n-="center"===this.textAlign?this.width/2:"right"===this.textAlign?this.width:0;var s,a=this._getHeightOfLine(e,o),l=this._getCachedLineOffset(o),c=i.split(""),h="";n+=l||0,e.save(),r-=a/this.lineHeight*this._fontSizeFraction;for(var u=0,f=c.length;f>=u;u++){s=s||this.getCurrentCharStyle(o,u);var d=this.getCurrentCharStyle(o,u+1);(this._hasStyleChanged(s,d)||u===f)&&(this._renderChar(t,e,o,u-1,h,n,r,a),h="",s=d),h+=c[u]}e.restore()},_renderCharsFast:function(t,e,i,n,r){this.skipTextAlign=!1,"fillText"===t&&this.fill&&this.callSuper("_renderChars",t,e,i,n,r),"strokeText"===t&&(this.stroke&&this.strokeWidth>0||this.skipFillStrokeCheck)&&this.callSuper("_renderChars",t,e,i,n,r)},_renderChar:function(t,e,i,n,r,o,s,a){var l,c,h,u=this._fontSizeFraction*a/this.lineHeight;if(this.styles&&this.styles[i]&&(l=this.styles[i][n])){var f=l.stroke||this.stroke,d=l.fill||this.fill;e.save(),c=this._applyCharStylesGetWidth(e,r,i,n,l),h=this._getHeightOfChar(e,r,i,n),d&&e.fillText(r,o,s),f&&e.strokeText(r,o,s),this._renderCharDecoration(e,l,o,s,u,c,h),e.restore(),e.translate(c,0)}else"strokeText"===t&&this.stroke&&e[t](r,o,s),"fillText"===t&&this.fill&&e[t](r,o,s),c=this._applyCharStylesGetWidth(e,r,i,n),this._renderCharDecoration(e,null,o,s,u,c,this.fontSize),e.translate(e.measureText(r).width,0)},_hasStyleChanged:function(t,e){return t.fill!==e.fill||t.fontSize!==e.fontSize||t.textBackgroundColor!==e.textBackgroundColor||t.textDecoration!==e.textDecoration||t.fontFamily!==e.fontFamily||t.fontWeight!==e.fontWeight||t.fontStyle!==e.fontStyle||t.stroke!==e.stroke||t.strokeWidth!==e.strokeWidth},_renderCharDecoration:function(t,e,i,n,r,o,s){var a=e?e.textDecoration||this.textDecoration:this.textDecoration;a&&(a.indexOf("underline")>-1&&t.fillRect(i,n+s/10,o,s/15),a.indexOf("line-through")>-1&&t.fillRect(i,n-s*(this._fontSizeFraction+this._fontSizeMult-1)+s/15,o,s/15),a.indexOf("overline")>-1&&t.fillRect(i,n-(this._fontSizeMult-this._fontSizeFraction)*s,o,s/15))},_renderTextLine:function(t,e,i,n,r,o){this.isEmptyStyles()||(r+=this.fontSize*(this._fontSizeFraction+.03)),this.callSuper("_renderTextLine",t,e,i,n,r,o)},_renderTextDecoration:function(t){return this.isEmptyStyles()?this.callSuper("_renderTextDecoration",t):void 0},_renderTextLinesBackground:function(t){if(this.textBackgroundColor||this.styles){t.save(),this.textBackgroundColor&&(t.fillStyle=this.textBackgroundColor);for(var e=0,i=0,n=this._textLines.length;n>i;i++){var r=this._getHeightOfLine(t,i);if(""!==this._textLines[i]){var o=this._getLineWidth(t,i),s=this._getCachedLineOffset(i);if(this.textBackgroundColor&&(t.fillStyle=this.textBackgroundColor,t.fillRect(this._getLeftOffset()+s,this._getTopOffset()+e,o,r/this.lineHeight)),this.styles[i])for(var a=0,l=this._textLines[i].length;l>a;a++)if(this.styles[i]&&this.styles[i][a]&&this.styles[i][a].textBackgroundColor){var c=this._textLines[i][a];t.fillStyle=this.styles[i][a].textBackgroundColor,t.fillRect(this._getLeftOffset()+s+this._getWidthOfCharsAt(t,i,a),this._getTopOffset()+e,this._getWidthOfChar(t,c,i,a)+1,r/this.lineHeight)}e+=r}else e+=r}t.restore()}},_getCacheProp:function(t,e){return t+e.fontFamily+e.fontSize+e.fontWeight+e.fontStyle+e.shadow},_applyCharStylesGetWidth:function(e,i,n,r,o){var s=o||this.styles[n]&&this.styles[n][r];s=s?t(s):{},this._applyFontStyles(s);var a=this._getCacheProp(i,s);if(this.isEmptyStyles()&&this._charWidthsCache[a]&&this.caching)return this._charWidthsCache[a];"string"==typeof s.shadow&&(s.shadow=new fabric.Shadow(s.shadow));var l=s.fill||this.fill;return e.fillStyle=l.toLive?l.toLive(e,this):l,s.stroke&&(e.strokeStyle=s.stroke&&s.stroke.toLive?s.stroke.toLive(e,this):s.stroke),e.lineWidth=s.strokeWidth||this.strokeWidth,e.font=this._getFontDeclaration.call(s),this._setShadow.call(s,e),this.caching?(this._charWidthsCache[a]||(this._charWidthsCache[a]=e.measureText(i).width),this._charWidthsCache[a]):e.measureText(i).width},_applyFontStyles:function(t){t.fontFamily||(t.fontFamily=this.fontFamily),t.fontSize||(t.fontSize=this.fontSize),t.fontWeight||(t.fontWeight=this.fontWeight),t.fontStyle||(t.fontStyle=this.fontStyle)},_getStyleDeclaration:function(e,i){return this.styles[e]&&this.styles[e][i]?t(this.styles[e][i]):{}},_getWidthOfChar:function(t,e,i,n){if("justify"===this.textAlign&&/\s/.test(e))return this._getWidthOfSpace(t,i);var r=this._getStyleDeclaration(i,n);this._applyFontStyles(r);var o=this._getCacheProp(e,r);if(this._charWidthsCache[o]&&this.caching)return this._charWidthsCache[o];if(t){t.save();var s=this._applyCharStylesGetWidth(t,e,i,n);return t.restore(),s}},_getHeightOfChar:function(t,e,i,n){return this.styles[i]&&this.styles[i][n]?this.styles[i][n].fontSize||this.fontSize:this.fontSize},_getHeightOfCharAt:function(t,e,i){var n=this._textLines[e][i];return this._getHeightOfChar(t,n,e,i)},_getWidthOfCharsAt:function(t,e,i){var n,r,o=0;for(n=0;i>n;n++)r=this._textLines[e][n],o+=this._getWidthOfChar(t,r,e,n);return o},_getLineWidth:function(t,e){return this.__lineWidths[e]?this.__lineWidths[e]:(this.__lineWidths[e]=this._getWidthOfCharsAt(t,e,this._textLines[e].length),this.__lineWidths[e])},_getWidthOfSpace:function(t,e){if(this.__widthOfSpace[e])return this.__widthOfSpace[e];var i=this._textLines[e],n=this._getWidthOfWords(t,i,e),r=this.width-n,o=i.length-i.replace(/\s+/g,"").length,s=r/o;return this.__widthOfSpace[e]=s,s},_getWidthOfWords:function(t,e,i){for(var n=0,r=0;r<e.length;r++){var o=e[r];o.match(/\s/)||(n+=this._getWidthOfChar(t,o,i,r))}return n},_getHeightOfLine:function(t,e){if(this.__lineHeights[e])return this.__lineHeights[e];for(var i=this._textLines[e],n=this._getHeightOfChar(t,i[0],e,0),r=1,o=i.length;o>r;r++){var s=this._getHeightOfChar(t,i[r],e,r);s>n&&(n=s)}return this.__maxFontHeights[e]=n,this.__lineHeights[e]=n*this.lineHeight*this._fontSizeMult,this.__lineHeights[e]},_getTextHeight:function(t){for(var e=0,i=0,n=this._textLines.length;n>i;i++)e+=this._getHeightOfLine(t,i);return e},_renderTextBoxBackground:function(t){this.backgroundColor&&(t.save(),t.fillStyle=this.backgroundColor,t.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),t.restore())},toObject:function(e){return fabric.util.object.extend(this.callSuper("toObject",e),{styles:t(this.styles)})}}),fabric.IText.fromObject=function(e){return new fabric.IText(e.text,t(e))}}(),function(){var t=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation()},initSelectedHandler:function(){this.on("selected",function(){var t=this;setTimeout(function(){t.selected=!0},100)})},initAddedHandler:function(){var t=this;this.on("added",function(){this.canvas&&!this.canvas._hasITextHandlers&&(this.canvas._hasITextHandlers=!0,this._initCanvasHandlers()),t.canvas&&(t.canvas._iTextInstances=t.canvas._iTextInstances||[],t.canvas._iTextInstances.push(t))})},initRemovedHandler:function(){var t=this;this.on("removed",function(){t.canvas&&(t.canvas._iTextInstances=t.canvas._iTextInstances||[],fabric.util.removeFromArray(t.canvas._iTextInstances,t))})},_initCanvasHandlers:function(){var t=this;this.canvas.on("selection:cleared",function(){fabric.IText.prototype.exitEditingOnOthers(t.canvas)}),this.canvas.on("mouse:up",function(){t.canvas._iTextInstances&&t.canvas._iTextInstances.forEach(function(t){t.__isMousedown=!1})}),this.canvas.on("object:selected",function(){fabric.IText.prototype.exitEditingOnOthers(t.canvas)})},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(t,e,i,n){var r;return r={isAborted:!1,abort:function(){this.isAborted=!0}},t.animate("_currentCursorOpacity",e,{duration:i,onComplete:function(){r.isAborted||t[n]()},onChange:function(){t.canvas&&(t.canvas.clearContext(t.canvas.contextTop||t.ctx),t.renderCursorOrSelection())},abort:function(){return r.isAborted}}),r},_onTickComplete:function(){var t=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){t._currentTickCompleteState=t._animateCursor(t,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(t){var e=this,i=t?0:this.cursorDelay;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),this._currentCursorOpacity=1,this.canvas&&(this.canvas.clearContext(this.canvas.contextTop||this.ctx),this.renderCursorOrSelection()),this._cursorTimeout2&&clearTimeout(this._cursorTimeout2),this._cursorTimeout2=setTimeout(function(){e._tick()},i)},abortCursorAnimation:function(){this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,this.canvas&&this.canvas.clearContext(this.canvas.contextTop||this.ctx)},selectAll:function(){this.setSelectionStart(0),this.setSelectionEnd(this.text.length)},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(t){var e=0,i=t-1;if(this._reSpace.test(this.text.charAt(i)))for(;this._reSpace.test(this.text.charAt(i));)e++,i--;for(;/\S/.test(this.text.charAt(i))&&i>-1;)e++,i--;return t-e},findWordBoundaryRight:function(t){var e=0,i=t;if(this._reSpace.test(this.text.charAt(i)))for(;this._reSpace.test(this.text.charAt(i));)e++,i++;for(;/\S/.test(this.text.charAt(i))&&i<this.text.length;)e++,i++;return t+e},findLineBoundaryLeft:function(t){for(var e=0,i=t-1;!/\n/.test(this.text.charAt(i))&&i>-1;)e++,i--;return t-e},findLineBoundaryRight:function(t){for(var e=0,i=t;!/\n/.test(this.text.charAt(i))&&i<this.text.length;)e++,i++;return t+e},getNumNewLinesInSelectedText:function(){for(var t=this.getSelectedText(),e=0,i=0,n=t.split(""),r=n.length;r>i;i++)"\n"===n[i]&&e++;return e},searchWordBoundary:function(t,e){for(var i=this._reSpace.test(this.text.charAt(t))?t-1:t,n=this.text.charAt(i),r=/[ \n\.,;!\?\-]/;!r.test(n)&&i>0&&i<this.text.length;)i+=e,n=this.text.charAt(i);return r.test(n)&&"\n"!==n&&(i+=1===e?0:1),i},selectWord:function(t){var e=this.searchWordBoundary(t,-1),i=this.searchWordBoundary(t,1);this.setSelectionStart(e),this.setSelectionEnd(i)},selectLine:function(t){var e=this.findLineBoundaryLeft(t),i=this.findLineBoundaryRight(t);this.setSelectionStart(e),this.setSelectionEnd(i)},enterEditing:function(){return!this.isEditing&&this.editable?(this.canvas&&this.exitEditingOnOthers(this.canvas),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._tick(),this.fire("editing:entered"),this.canvas?(this.canvas.renderAll(),this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this):this):void 0},exitEditingOnOthers:function(t){t._iTextInstances&&t._iTextInstances.forEach(function(t){t.selected=!1,t.isEditing&&t.exitEditing()})},initMouseMoveHandler:function(){var t=this;this.canvas.on("mouse:move",function(e){if(t.__isMousedown&&t.isEditing){var i=t.getSelectionStartFromPointer(e.e);i>=t.__selectionStartOnMouseDown?(t.setSelectionStart(t.__selectionStartOnMouseDown),t.setSelectionEnd(i)):(t.setSelectionStart(i),t.setSelectionEnd(t.__selectionStartOnMouseDown))}})},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){this.hiddenTextarea&&(this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart,this.hiddenTextarea.selectionEnd=this.selectionEnd)},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){return this.selected=!1,this.isEditing=!1,this.selectable=!0,this.selectionEnd=this.selectionStart,this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this.fire("editing:exited"),this.canvas&&this.canvas.fire("text:editing:exited",{target:this}),this},_removeExtraneousStyles:function(){for(var t in this.styles)this._textLines[t]||delete this.styles[t]},_removeCharsFromTo:function(t,e){for(var i=e;i!==t;){var n=this.get2DCursorLocation(i).charIndex;i--;var r=this.get2DCursorLocation(i).charIndex,o=r>n;o?this.removeStyleObject(o,i+1):this.removeStyleObject(0===this.get2DCursorLocation(i).charIndex,i)}this.text=this.text.slice(0,t)+this.text.slice(e),this._clearCache()},insertChars:function(t,e){var i="\n"===this.text.slice(this.selectionStart,this.selectionStart+1);this.text=this.text.slice(0,this.selectionStart)+t+this.text.slice(this.selectionEnd),this.selectionStart===this.selectionEnd&&this.insertStyleObjects(t,i,e),this.setSelectionStart(this.selectionStart+t.length),this.setSelectionEnd(this.selectionStart),this._clearCache(),this.canvas&&this.canvas.renderAll(),this.setCoords(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this})},insertNewlineStyleObject:function(e,i,n){this.shiftLineStyles(e,1),this.styles[e+1]||(this.styles[e+1]={});var r=this.styles[e][i-1],o={};if(n)o[0]=t(r),this.styles[e+1]=o;else{for(var s in this.styles[e])parseInt(s,10)>=i&&(o[parseInt(s,10)-i]=this.styles[e][s],delete this.styles[e][s]);this.styles[e+1]=o}this._clearCache()},insertCharStyleObject:function(e,i,n){var r=this.styles[e],o=t(r);0===i&&!n&&(i=1);for(var s in o){var a=parseInt(s,10);a>=i&&(r[a+1]=o[a])}this.styles[e][i]=n||t(r[i-1]),this._clearCache()},insertStyleObjects:function(t,e,i){var n=this.get2DCursorLocation(),r=n.lineIndex,o=n.charIndex;this.styles[r]||(this.styles[r]={}),"\n"===t?this.insertNewlineStyleObject(r,o,e):i?this._insertStyles(this.copiedStyles):this.insertCharStyleObject(r,o)},_insertStyles:function(t){for(var e=0,i=t.length;i>e;e++){var n=this.get2DCursorLocation(this.selectionStart+e),r=n.lineIndex,o=n.charIndex;this.insertCharStyleObject(r,o,t[e])}},shiftLineStyles:function(e,i){var n=t(this.styles);for(var r in this.styles){var o=parseInt(r,10);o>e&&(this.styles[o+i]=n[o])}},removeStyleObject:function(e,i){var n=this.get2DCursorLocation(i),r=n.lineIndex,o=n.charIndex;if(e){var s=this._textLines[r-1],a=s?s.length:0;this.styles[r-1]||(this.styles[r-1]={});for(o in this.styles[r])this.styles[r-1][parseInt(o,10)+a]=this.styles[r][o];this.shiftLineStyles(r,-1)}else{var l=this.styles[r];if(l){var c=this.selectionStart===this.selectionEnd?-1:0;delete l[o+c]}var h=t(l);for(var u in h){var f=parseInt(u,10);f>=o&&0!==f&&(l[f-1]=h[f],delete l[f])}}},insertNewline:function(){this.insertChars("\n")}})}(),fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(t){this.__newClickTime=+new Date;var e=this.canvas.getPointer(t.e);this.isTripleClick(e)?(this.fire("tripleclick",t),this._stopEvent(t.e)):this.isDoubleClick(e)&&(this.fire("dblclick",t),
this._stopEvent(t.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=e,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected},isDoubleClick:function(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y&&this.__lastIsEditing},isTripleClick:function(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y},_stopEvent:function(t){t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler(),this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},initClicks:function(){this.on("dblclick",function(t){this.selectWord(this.getSelectionStartFromPointer(t.e))}),this.on("tripleclick",function(t){this.selectLine(this.getSelectionStartFromPointer(t.e))})},initMousedownHandler:function(){this.on("mousedown",function(t){var e=this.canvas.getPointer(t.e);this.__mousedownX=e.x,this.__mousedownY=e.y,this.__isMousedown=!0,this.hiddenTextarea&&this.canvas&&this.canvas.wrapperEl.appendChild(this.hiddenTextarea),this.selected&&this.setCursorByClick(t.e),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.initDelayedCursor(!0))})},_isObjectMoved:function(t){var e=this.canvas.getPointer(t);return this.__mousedownX!==e.x||this.__mousedownY!==e.y},initMouseupHandler:function(){this.on("mouseup",function(t){this.__isMousedown=!1,this._isObjectMoved(t.e)||(this.__lastSelected&&(this.enterEditing(),this.initDelayedCursor(!0)),this.selected=!0)})},setCursorByClick:function(t){var e=this.getSelectionStartFromPointer(t);t.shiftKey?e<this.selectionStart?(this.setSelectionEnd(this.selectionStart),this.setSelectionStart(e)):this.setSelectionEnd(e):(this.setSelectionStart(e),this.setSelectionEnd(e))},_getLocalRotatedPointer:function(t){var e=this.canvas.getPointer(t),i=new fabric.Point(e.x,e.y),n=new fabric.Point(this.left,this.top),r=fabric.util.rotatePoint(i,n,fabric.util.degreesToRadians(-this.angle));return this.getLocalPointer(t,r)},getSelectionStartFromPointer:function(t){for(var e,i,n=this._getLocalRotatedPointer(t),r=0,o=0,s=0,a=0,l=0,c=this._textLines.length;c>l;l++){i=this._textLines[l].split(""),s+=this._getHeightOfLine(this.ctx,l)*this.scaleY;var h=this._getLineWidth(this.ctx,l),u=this._getLineLeftOffset(h);o=u*this.scaleX,this.flipX&&(this._textLines[l]=i.reverse().join(""));for(var f=0,d=i.length;d>f;f++){var p=i[f];r=o,o+=this._getWidthOfChar(this.ctx,p,l,this.flipX?d-f:f)*this.scaleX;{if(!(s<=n.y||o<=n.x))return this._getNewSelectionStartFromOffset(n,r,o,a+l,d);a++}}if(n.y<s)return this._getNewSelectionStartFromOffset(n,r,o,a+l,d)}return"undefined"==typeof e?this.text.length:void 0},_getNewSelectionStartFromOffset:function(t,e,i,n,r){var o=t.x-e,s=i-t.x,a=s>o?0:1,l=n+a;return this.flipX&&(l=r-l),l>this.text.length&&(l=this.text.length),l}}),fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.style.cssText="position: fixed; bottom: 20px; left: 0px; opacity: 0; width: 0px; height: 0px; z-index: -999;",fabric.document.body.appendChild(this.hiddenTextarea),fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),fabric.util.addListener(this.hiddenTextarea,"keypress",this.onKeyPress.bind(this)),fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},_keysMap:{8:"removeChars",9:"exitEditing",27:"exitEditing",13:"insertNewline",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMap:{65:"selectAll",88:"cut"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(t){if(this.isEditing){if(t.keyCode in this._keysMap)this[this._keysMap[t.keyCode]](t);else{if(!(t.keyCode in this._ctrlKeysMap&&(t.ctrlKey||t.metaKey)))return;this[this._ctrlKeysMap[t.keyCode]](t)}t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.canvas.renderAll()}},forwardDelete:function(t){this.selectionStart===this.selectionEnd&&this.moveCursorRight(t),this.removeChars(t)},copy:function(t){var e=this.getSelectedText(),i=this._getClipboardData(t);i&&i.setData("text",e),this.copiedText=e,this.copiedStyles=this.getSelectionStyles(this.selectionStart,this.selectionEnd)},paste:function(t){var e=null,i=this._getClipboardData(t);e=i?i.getData("text"):this.copiedText,e&&this.insertChars(e,!0)},cut:function(t){this.selectionStart!==this.selectionEnd&&(this.copy(),this.removeChars(t))},_getClipboardData:function(t){return t&&(t.clipboardData||fabric.window.clipboardData)},onKeyPress:function(t){!this.isEditing||t.metaKey||t.ctrlKey||(0!==t.which&&this.insertChars(String.fromCharCode(t.which)),t.stopPropagation())},getDownCursorOffset:function(t,e){var i,n,r=e?this.selectionEnd:this.selectionStart,o=this.text.slice(0,r),s=this.text.slice(r),a=o.slice(o.lastIndexOf("\n")+1),l=s.match(/(.*)\n?/)[1],c=(s.match(/.*\n(.*)\n?/)||{})[1]||"",h=this.get2DCursorLocation(r);if(h.lineIndex===this._textLines.length-1||t.metaKey||34===t.keyCode)return this.text.length-r;var u=this._getLineWidth(this.ctx,h.lineIndex);n=this._getLineLeftOffset(u);for(var f=n,d=h.lineIndex,p=0,g=a.length;g>p;p++)i=a[p],f+=this._getWidthOfChar(this.ctx,i,d,p);var v=this._getIndexOnNextLine(h,c,f);return l.length+1+v},_getIndexOnNextLine:function(t,e,i){for(var n,r=t.lineIndex+1,o=this._getLineWidth(this.ctx,r),s=this._getLineLeftOffset(o),a=s,l=0,c=0,h=e.length;h>c;c++){var u=e[c],f=this._getWidthOfChar(this.ctx,u,r,c);if(a+=f,a>i){n=!0;var d=a-f,p=a,g=Math.abs(d-i),v=Math.abs(p-i);l=g>v?c+1:c;break}}return n||(l=e.length),l},moveCursorDown:function(t){this.abortCursorAnimation(),this._currentCursorOpacity=1;var e=this.getDownCursorOffset(t,"right"===this._selectionDirection);t.shiftKey?this.moveCursorDownWithShift(e):this.moveCursorDownWithoutShift(e),this.initDelayedCursor()},moveCursorDownWithoutShift:function(t){this._selectionDirection="right",this.setSelectionStart(this.selectionStart+t),this.setSelectionEnd(this.selectionStart)},swapSelectionPoints:function(){var t=this.selectionEnd;this.setSelectionEnd(this.selectionStart),this.setSelectionStart(t)},moveCursorDownWithShift:function(t){this.selectionEnd===this.selectionStart&&(this._selectionDirection="right"),"right"===this._selectionDirection?this.setSelectionEnd(this.selectionEnd+t):this.setSelectionStart(this.selectionStart+t),this.selectionEnd<this.selectionStart&&"left"===this._selectionDirection&&(this.swapSelectionPoints(),this._selectionDirection="right"),this.selectionEnd>this.text.length&&this.setSelectionEnd(this.text.length)},getUpCursorOffset:function(t,e){var i=e?this.selectionEnd:this.selectionStart,n=this.get2DCursorLocation(i);if(0===n.lineIndex||t.metaKey||33===t.keyCode)return i;for(var r,o=this.text.slice(0,i),s=o.slice(o.lastIndexOf("\n")+1),a=(o.match(/\n?(.*)\n.*$/)||{})[1]||"",l=this._getLineWidth(this.ctx,n.lineIndex),c=this._getLineLeftOffset(l),h=c,u=n.lineIndex,f=0,d=s.length;d>f;f++)r=s[f],h+=this._getWidthOfChar(this.ctx,r,u,f);var p=this._getIndexOnPrevLine(n,a,h);return a.length-p+s.length},_getIndexOnPrevLine:function(t,e,i){for(var n,r=t.lineIndex-1,o=this._getLineWidth(this.ctx,r),s=this._getLineLeftOffset(o),a=s,l=0,c=0,h=e.length;h>c;c++){var u=e[c],f=this._getWidthOfChar(this.ctx,u,r,c);if(a+=f,a>i){n=!0;var d=a-f,p=a,g=Math.abs(d-i),v=Math.abs(p-i);l=g>v?c:c-1;break}}return n||(l=e.length-1),l},moveCursorUp:function(t){this.abortCursorAnimation(),this._currentCursorOpacity=1;var e=this.getUpCursorOffset(t,"right"===this._selectionDirection);t.shiftKey?this.moveCursorUpWithShift(e):this.moveCursorUpWithoutShift(e),this.initDelayedCursor()},moveCursorUpWithShift:function(t){this.selectionEnd===this.selectionStart&&(this._selectionDirection="left"),"right"===this._selectionDirection?this.setSelectionEnd(this.selectionEnd-t):this.setSelectionStart(this.selectionStart-t),this.selectionEnd<this.selectionStart&&"right"===this._selectionDirection&&(this.swapSelectionPoints(),this._selectionDirection="left")},moveCursorUpWithoutShift:function(t){this.selectionStart===this.selectionEnd&&this.setSelectionStart(this.selectionStart-t),this.setSelectionEnd(this.selectionStart),this._selectionDirection="left"},moveCursorLeft:function(t){(0!==this.selectionStart||0!==this.selectionEnd)&&(this.abortCursorAnimation(),this._currentCursorOpacity=1,t.shiftKey?this.moveCursorLeftWithShift(t):this.moveCursorLeftWithoutShift(t),this.initDelayedCursor())},_move:function(t,e,i){var n="selectionStart"===e?"setSelectionStart":"setSelectionEnd";t.altKey?this[n](this["findWordBoundary"+i](this[e])):t.metaKey||35===t.keyCode||36===t.keyCode?this[n](this["findLineBoundary"+i](this[e])):this[n](this[e]+("Left"===i?-1:1))},_moveLeft:function(t,e){this._move(t,e,"Left")},_moveRight:function(t,e){this._move(t,e,"Right")},moveCursorLeftWithoutShift:function(t){this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this._moveLeft(t,"selectionStart"),this.setSelectionEnd(this.selectionStart)},moveCursorLeftWithShift:function(t){"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(t,"selectionEnd"):(this._selectionDirection="left",this._moveLeft(t,"selectionStart"),"\n"===this.text.charAt(this.selectionStart)&&this.setSelectionStart(this.selectionStart-1))},moveCursorRight:function(t){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||(this.abortCursorAnimation(),this._currentCursorOpacity=1,t.shiftKey?this.moveCursorRightWithShift(t):this.moveCursorRightWithoutShift(t),this.initDelayedCursor())},moveCursorRightWithShift:function(t){"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(t,"selectionStart"):(this._selectionDirection="right",this._moveRight(t,"selectionEnd"),"\n"===this.text.charAt(this.selectionEnd-1)&&this.setSelectionEnd(this.selectionEnd+1))},moveCursorRightWithoutShift:function(t){this._selectionDirection="right",this.selectionStart===this.selectionEnd?(this._moveRight(t,"selectionStart"),this.setSelectionEnd(this.selectionStart)):(this.setSelectionEnd(this.selectionEnd+this.getNumNewLinesInSelectedText()),this.setSelectionStart(this.selectionEnd))},removeChars:function(t){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(t):this._removeCharsFromTo(this.selectionStart,this.selectionEnd),this.setSelectionEnd(this.selectionStart),this._removeExtraneousStyles(),this._clearCache(),this.canvas&&this.canvas.renderAll(),this.setCoords(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(t){if(0!==this.selectionStart)if(t.metaKey){var e=this.findLineBoundaryLeft(this.selectionStart);this._removeCharsFromTo(e,this.selectionStart),this.setSelectionStart(e)}else if(t.altKey){var i=this.findWordBoundaryLeft(this.selectionStart);this._removeCharsFromTo(i,this.selectionStart),this.setSelectionStart(i)}else{var n="\n"===this.text.slice(this.selectionStart-1,this.selectionStart);this.removeStyleObject(n),this.setSelectionStart(this.selectionStart-1),this.text=this.text.slice(0,this.selectionStart)+this.text.slice(this.selectionStart+1)}}}),fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(t,e,i,n,r,o){this.styles[t]?this._setSVGTextLineChars(t,e,i,n,o):this.callSuper("_setSVGTextLineText",t,e,i,n,r)},_setSVGTextLineChars:function(t,e,i,n,r){for(var o=this._textLines[t].split(""),s=0,a=this._getSVGLineLeftOffset(t)-this.width/2,l=this._getSVGLineTopOffset(t),c=this._getHeightOfLine(this.ctx,t),h=0,u=o.length;u>h;h++){var f=this.styles[t][h]||{};e.push(this._createTextCharSpan(o[h],f,a,l.lineTop+l.offset,s));var d=this._getWidthOfChar(this.ctx,o[h],t,h);f.textBackgroundColor&&r.push(this._createTextCharBg(f,a,l.lineTop,c,d,s)),s+=d}},_getSVGLineLeftOffset:function(t){return fabric.util.toFixed(this._getLineLeftOffset(this.__lineWidths[t]),2)},_getSVGLineTopOffset:function(t){for(var e=0,i=0,n=0;t>n;n++)e+=this._getHeightOfLine(this.ctx,n);return i=this._getHeightOfLine(this.ctx,n),{lineTop:e,offset:(this._fontSizeMult-this._fontSizeFraction)*i/(this.lineHeight*this._fontSizeMult)}},_createTextCharBg:function(t,e,i,n,r,o){return['<rect fill="',t.textBackgroundColor,'" x="',e+o,'" y="',i-this.height/2,'" width="',r,'" height="',n/this.lineHeight,'"></rect>'].join("")},_createTextCharSpan:function(t,e,i,n,r){var o=this.getSvgStyles.call(fabric.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text"},e));return['<tspan x="',i+r,'" y="',n-this.height/2,'" ',e.fontFamily?'font-family="'+e.fontFamily.replace(/"/g,"'")+'" ':"",e.fontSize?'font-size="'+e.fontSize+'" ':"",e.fontStyle?'font-style="'+e.fontStyle+'" ':"",e.fontWeight?'font-weight="'+e.fontWeight+'" ':"",e.textDecoration?'text-decoration="'+e.textDecoration+'" ':"",'style="',o,'">',fabric.util.string.escapeXml(t),"</tspan>"].join("")}}),function(){function request(t,e,i){var n=URL.parse(t);n.port||(n.port=0===n.protocol.indexOf("https:")?443:80);var r=0===n.protocol.indexOf("https:")?HTTPS:HTTP,o=r.request({hostname:n.hostname,port:n.port,path:n.path,method:"GET"},function(t){var n="";e&&t.setEncoding(e),t.on("end",function(){i(n)}),t.on("data",function(e){200===t.statusCode&&(n+=e)})});o.on("error",function(t){t.errno===process.ECONNREFUSED?fabric.log("ECONNREFUSED: connection refused to "+n.hostname+":"+n.port):fabric.log(t.message)}),o.end()}function requestFs(t,e){var i=require("fs");i.readFile(t,function(t,i){if(t)throw fabric.log(t),t;e(i)})}if("undefined"==typeof document||"undefined"==typeof window){var DOMParser=require("xmldom").DOMParser,URL=require("url"),HTTP=require("http"),HTTPS=require("https"),Canvas=require("canvas"),Image=require("canvas").Image;fabric.util.loadImage=function(t,e,i){function n(n){r.src=new Buffer(n,"binary"),r._src=t,e&&e.call(i,r)}var r=new Image;t&&(t instanceof Buffer||0===t.indexOf("data"))?(r.src=r._src=t,e&&e.call(i,r)):t&&0!==t.indexOf("http")?requestFs(t,n):t?request(t,"binary",n):e&&e.call(i,t)},fabric.loadSVGFromURL=function(t,e,i){t=t.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim(),0!==t.indexOf("http")?requestFs(t,function(t){fabric.loadSVGFromString(t.toString(),e,i)}):request(t,"",function(t){fabric.loadSVGFromString(t,e,i)})},fabric.loadSVGFromString=function(t,e,i){var n=(new DOMParser).parseFromString(t);fabric.parseSVGDocument(n.documentElement,function(t,i){e&&e(t,i)},i)},fabric.util.getScript=function(url,callback){request(url,"",function(body){eval(body),callback&&callback()})},fabric.Image.fromObject=function(t,e){fabric.util.loadImage(t.src,function(i){var n=new fabric.Image(i);n._initConfig(t),n._initFilters(t,function(t){n.filters=t||[],e&&e(n)})})},fabric.createCanvasForNode=function(t,e,i,n){n=n||i;var r=fabric.document.createElement("canvas"),o=new Canvas(t||600,e||600,n);r.style={},r.width=o.width,r.height=o.height;var s=fabric.Canvas||fabric.StaticCanvas,a=new s(r,i);return a.contextContainer=o.getContext("2d"),a.nodeCanvas=o,a.Font=Canvas.Font,a},fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(t){return this.nodeCanvas.createJPEGStream(t)};var origSetWidth=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(t,e){return origSetWidth.call(this,t,e),this.nodeCanvas.width=t,this},fabric.Canvas&&(fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth);var origSetHeight=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(t,e){return origSetHeight.call(this,t,e),this.nodeCanvas.height=t,this},fabric.Canvas&&(fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight)}}(),"undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");+function(t){"use strict";var e=t.fn.jquery.split(" ")[0].split(".");if(e[0]<2&&e[1]<9||1==e[0]&&9==e[1]&&e[2]<1)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher")}(jQuery),+function(t){"use strict";function e(){var t=document.createElement("bootstrap"),e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var i in e)if(void 0!==t.style[i])return{end:e[i]};return!1}t.fn.emulateTransitionEnd=function(e){var i=!1,n=this;t(this).one("bsTransitionEnd",function(){i=!0});var r=function(){i||t(n).trigger(t.support.transition.end)};return setTimeout(r,e),this},t(function(){t.support.transition=e(),t.support.transition&&(t.event.special.bsTransitionEnd={bindType:t.support.transition.end,delegateType:t.support.transition.end,handle:function(e){return t(e.target).is(this)?e.handleObj.handler.apply(this,arguments):void 0}})})}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var i=t(this),r=i.data("bs.alert");r||i.data("bs.alert",r=new n(this)),"string"==typeof e&&r[e].call(i)})}var i='[data-dismiss="alert"]',n=function(e){t(e).on("click",i,this.close)};n.VERSION="3.3.5",n.TRANSITION_DURATION=150,n.prototype.close=function(e){function i(){s.detach().trigger("closed.bs.alert").remove()}var r=t(this),o=r.attr("data-target");o||(o=r.attr("href"),o=o&&o.replace(/.*(?=#[^\s]*$)/,""));var s=t(o);e&&e.preventDefault(),s.length||(s=r.closest(".alert")),s.trigger(e=t.Event("close.bs.alert")),e.isDefaultPrevented()||(s.removeClass("in"),t.support.transition&&s.hasClass("fade")?s.one("bsTransitionEnd",i).emulateTransitionEnd(n.TRANSITION_DURATION):i())};var r=t.fn.alert;t.fn.alert=e,t.fn.alert.Constructor=n,t.fn.alert.noConflict=function(){return t.fn.alert=r,this},t(document).on("click.bs.alert.data-api",i,n.prototype.close)}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var n=t(this),r=n.data("bs.button"),o="object"==typeof e&&e;r||n.data("bs.button",r=new i(this,o)),"toggle"==e?r.toggle():e&&r.setState(e)})}var i=function(e,n){this.$element=t(e),this.options=t.extend({},i.DEFAULTS,n),this.isLoading=!1};i.VERSION="3.3.5",i.DEFAULTS={loadingText:"loading..."},i.prototype.setState=function(e){var i="disabled",n=this.$element,r=n.is("input")?"val":"html",o=n.data();e+="Text",null==o.resetText&&n.data("resetText",n[r]()),setTimeout(t.proxy(function(){n[r](null==o[e]?this.options[e]:o[e]),"loadingText"==e?(this.isLoading=!0,n.addClass(i).attr(i,i)):this.isLoading&&(this.isLoading=!1,n.removeClass(i).removeAttr(i))},this),0)},i.prototype.toggle=function(){var t=!0,e=this.$element.closest('[data-toggle="buttons"]');if(e.length){var i=this.$element.find("input");"radio"==i.prop("type")?(i.prop("checked")&&(t=!1),e.find(".active").removeClass("active"),this.$element.addClass("active")):"checkbox"==i.prop("type")&&(i.prop("checked")!==this.$element.hasClass("active")&&(t=!1),this.$element.toggleClass("active")),i.prop("checked",this.$element.hasClass("active")),t&&i.trigger("change")}else this.$element.attr("aria-pressed",!this.$element.hasClass("active")),this.$element.toggleClass("active")};var n=t.fn.button;t.fn.button=e,t.fn.button.Constructor=i,t.fn.button.noConflict=function(){return t.fn.button=n,this},t(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(i){var n=t(i.target);n.hasClass("btn")||(n=n.closest(".btn")),e.call(n,"toggle"),t(i.target).is('input[type="radio"]')||t(i.target).is('input[type="checkbox"]')||i.preventDefault()}).on("focus.bs.button.data-api blur.bs.button.data-api",'[data-toggle^="button"]',function(e){t(e.target).closest(".btn").toggleClass("focus",/^focus(in)?$/.test(e.type))})}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var n=t(this),r=n.data("bs.carousel"),o=t.extend({},i.DEFAULTS,n.data(),"object"==typeof e&&e),s="string"==typeof e?e:o.slide;r||n.data("bs.carousel",r=new i(this,o)),"number"==typeof e?r.to(e):s?r[s]():o.interval&&r.pause().cycle()})}var i=function(e,i){this.$element=t(e),this.$indicators=this.$element.find(".carousel-indicators"),this.options=i,this.paused=null,this.sliding=null,this.interval=null,this.$active=null,this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",t.proxy(this.keydown,this)),"hover"==this.options.pause&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",t.proxy(this.pause,this)).on("mouseleave.bs.carousel",t.proxy(this.cycle,this))};i.VERSION="3.3.5",i.TRANSITION_DURATION=600,i.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},i.prototype.keydown=function(t){if(!/input|textarea/i.test(t.target.tagName)){switch(t.which){case 37:this.prev();break;case 39:this.next();break;default:return}t.preventDefault()}},i.prototype.cycle=function(e){return e||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(t.proxy(this.next,this),this.options.interval)),this},i.prototype.getItemIndex=function(t){return this.$items=t.parent().children(".item"),this.$items.index(t||this.$active)},i.prototype.getItemForDirection=function(t,e){var i=this.getItemIndex(e),n="prev"==t&&0===i||"next"==t&&i==this.$items.length-1;if(n&&!this.options.wrap)return e;var r="prev"==t?-1:1,o=(i+r)%this.$items.length;return this.$items.eq(o)},i.prototype.to=function(t){var e=this,i=this.getItemIndex(this.$active=this.$element.find(".item.active"));return t>this.$items.length-1||0>t?void 0:this.sliding?this.$element.one("slid.bs.carousel",function(){e.to(t)}):i==t?this.pause().cycle():this.slide(t>i?"next":"prev",this.$items.eq(t))},i.prototype.pause=function(e){return e||(this.paused=!0),this.$element.find(".next, .prev").length&&t.support.transition&&(this.$element.trigger(t.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},i.prototype.next=function(){return this.sliding?void 0:this.slide("next")},i.prototype.prev=function(){return this.sliding?void 0:this.slide("prev")},i.prototype.slide=function(e,n){var r=this.$element.find(".item.active"),o=n||this.getItemForDirection(e,r),s=this.interval,a="next"==e?"left":"right",l=this;if(o.hasClass("active"))return this.sliding=!1;var c=o[0],h=t.Event("slide.bs.carousel",{relatedTarget:c,direction:a});if(this.$element.trigger(h),!h.isDefaultPrevented()){if(this.sliding=!0,s&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var u=t(this.$indicators.children()[this.getItemIndex(o)]);u&&u.addClass("active")}var f=t.Event("slid.bs.carousel",{relatedTarget:c,direction:a});return t.support.transition&&this.$element.hasClass("slide")?(o.addClass(e),o[0].offsetWidth,r.addClass(a),o.addClass(a),r.one("bsTransitionEnd",function(){o.removeClass([e,a].join(" ")).addClass("active"),r.removeClass(["active",a].join(" ")),l.sliding=!1,setTimeout(function(){l.$element.trigger(f)},0)}).emulateTransitionEnd(i.TRANSITION_DURATION)):(r.removeClass("active"),o.addClass("active"),this.sliding=!1,this.$element.trigger(f)),s&&this.cycle(),this}};var n=t.fn.carousel;t.fn.carousel=e,t.fn.carousel.Constructor=i,t.fn.carousel.noConflict=function(){return t.fn.carousel=n,this};var r=function(i){var n,r=t(this),o=t(r.attr("data-target")||(n=r.attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,""));if(o.hasClass("carousel")){var s=t.extend({},o.data(),r.data()),a=r.attr("data-slide-to");a&&(s.interval=!1),e.call(o,s),a&&o.data("bs.carousel").to(a),i.preventDefault()}};t(document).on("click.bs.carousel.data-api","[data-slide]",r).on("click.bs.carousel.data-api","[data-slide-to]",r),t(window).on("load",function(){t('[data-ride="carousel"]').each(function(){var i=t(this);e.call(i,i.data())})})}(jQuery),+function(t){"use strict";function e(e){var i,n=e.attr("data-target")||(i=e.attr("href"))&&i.replace(/.*(?=#[^\s]+$)/,"");return t(n)}function i(e){return this.each(function(){var i=t(this),r=i.data("bs.collapse"),o=t.extend({},n.DEFAULTS,i.data(),"object"==typeof e&&e);!r&&o.toggle&&/show|hide/.test(e)&&(o.toggle=!1),r||i.data("bs.collapse",r=new n(this,o)),"string"==typeof e&&r[e]()})}var n=function(e,i){this.$element=t(e),this.options=t.extend({},n.DEFAULTS,i),this.$trigger=t('[data-toggle="collapse"][href="#'+e.id+'"],[data-toggle="collapse"][data-target="#'+e.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};n.VERSION="3.3.5",n.TRANSITION_DURATION=350,n.DEFAULTS={toggle:!0},n.prototype.dimension=function(){var t=this.$element.hasClass("width");return t?"width":"height"},n.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var e,r=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(r&&r.length&&(e=r.data("bs.collapse"),e&&e.transitioning))){var o=t.Event("show.bs.collapse");if(this.$element.trigger(o),!o.isDefaultPrevented()){r&&r.length&&(i.call(r,"hide"),e||r.data("bs.collapse",null));var s=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[s](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var a=function(){this.$element.removeClass("collapsing").addClass("collapse in")[s](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!t.support.transition)return a.call(this);var l=t.camelCase(["scroll",s].join("-"));this.$element.one("bsTransitionEnd",t.proxy(a,this)).emulateTransitionEnd(n.TRANSITION_DURATION)[s](this.$element[0][l])}}}},n.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var e=t.Event("hide.bs.collapse");if(this.$element.trigger(e),!e.isDefaultPrevented()){var i=this.dimension();this.$element[i](this.$element[i]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var r=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};return t.support.transition?void this.$element[i](0).one("bsTransitionEnd",t.proxy(r,this)).emulateTransitionEnd(n.TRANSITION_DURATION):r.call(this)}}},n.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},n.prototype.getParent=function(){return t(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(t.proxy(function(i,n){var r=t(n);this.addAriaAndCollapsedClass(e(r),r)},this)).end()},n.prototype.addAriaAndCollapsedClass=function(t,e){var i=t.hasClass("in");t.attr("aria-expanded",i),e.toggleClass("collapsed",!i).attr("aria-expanded",i)};var r=t.fn.collapse;t.fn.collapse=i,t.fn.collapse.Constructor=n,t.fn.collapse.noConflict=function(){return t.fn.collapse=r,this},t(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(n){var r=t(this);r.attr("data-target")||n.preventDefault();var o=e(r),s=o.data("bs.collapse"),a=s?"toggle":r.data();i.call(o,a)})}(jQuery),+function(t){"use strict";function e(e){var i=e.attr("data-target");i||(i=e.attr("href"),i=i&&/#[A-Za-z]/.test(i)&&i.replace(/.*(?=#[^\s]*$)/,""));var n=i&&t(i);return n&&n.length?n:e.parent()}function i(i){i&&3===i.which||(t(r).remove(),t(o).each(function(){var n=t(this),r=e(n),o={relatedTarget:this};r.hasClass("open")&&(i&&"click"==i.type&&/input|textarea/i.test(i.target.tagName)&&t.contains(r[0],i.target)||(r.trigger(i=t.Event("hide.bs.dropdown",o)),i.isDefaultPrevented()||(n.attr("aria-expanded","false"),r.removeClass("open").trigger("hidden.bs.dropdown",o))))}))}function n(e){return this.each(function(){var i=t(this),n=i.data("bs.dropdown");n||i.data("bs.dropdown",n=new s(this)),"string"==typeof e&&n[e].call(i)})}var r=".dropdown-backdrop",o='[data-toggle="dropdown"]',s=function(e){t(e).on("click.bs.dropdown",this.toggle)};s.VERSION="3.3.5",s.prototype.toggle=function(n){var r=t(this);if(!r.is(".disabled, :disabled")){var o=e(r),s=o.hasClass("open");if(i(),!s){"ontouchstart"in document.documentElement&&!o.closest(".navbar-nav").length&&t(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(t(this)).on("click",i);var a={relatedTarget:this};if(o.trigger(n=t.Event("show.bs.dropdown",a)),n.isDefaultPrevented())return;r.trigger("focus").attr("aria-expanded","true"),o.toggleClass("open").trigger("shown.bs.dropdown",a)}return!1}},s.prototype.keydown=function(i){if(/(38|40|27|32)/.test(i.which)&&!/input|textarea/i.test(i.target.tagName)){var n=t(this);if(i.preventDefault(),i.stopPropagation(),!n.is(".disabled, :disabled")){var r=e(n),s=r.hasClass("open");if(!s&&27!=i.which||s&&27==i.which)return 27==i.which&&r.find(o).trigger("focus"),n.trigger("click");var a=" li:not(.disabled):visible a",l=r.find(".dropdown-menu"+a);if(l.length){var c=l.index(i.target);38==i.which&&c>0&&c--,40==i.which&&c<l.length-1&&c++,~c||(c=0),l.eq(c).trigger("focus")}}}};var a=t.fn.dropdown;t.fn.dropdown=n,t.fn.dropdown.Constructor=s,t.fn.dropdown.noConflict=function(){return t.fn.dropdown=a,this},t(document).on("click.bs.dropdown.data-api",i).on("click.bs.dropdown.data-api",".dropdown form",function(t){t.stopPropagation()}).on("click.bs.dropdown.data-api",o,s.prototype.toggle).on("keydown.bs.dropdown.data-api",o,s.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",s.prototype.keydown)}(jQuery),+function(t){"use strict";function e(e,n){return this.each(function(){var r=t(this),o=r.data("bs.modal"),s=t.extend({},i.DEFAULTS,r.data(),"object"==typeof e&&e);o||r.data("bs.modal",o=new i(this,s)),"string"==typeof e?o[e](n):s.show&&o.show(n)})}var i=function(e,i){this.options=i,this.$body=t(document.body),this.$element=t(e),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,t.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};i.VERSION="3.3.5",i.TRANSITION_DURATION=300,i.BACKDROP_TRANSITION_DURATION=150,i.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},i.prototype.toggle=function(t){return this.isShown?this.hide():this.show(t)},i.prototype.show=function(e){var n=this,r=t.Event("show.bs.modal",{relatedTarget:e});this.$element.trigger(r),this.isShown||r.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',t.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){n.$element.one("mouseup.dismiss.bs.modal",function(e){t(e.target).is(n.$element)&&(n.ignoreBackdropClick=!0)})}),this.backdrop(function(){var r=t.support.transition&&n.$element.hasClass("fade");n.$element.parent().length||n.$element.appendTo(n.$body),n.$element.show().scrollTop(0),n.adjustDialog(),r&&n.$element[0].offsetWidth,n.$element.addClass("in"),n.enforceFocus();var o=t.Event("shown.bs.modal",{relatedTarget:e});r?n.$dialog.one("bsTransitionEnd",function(){n.$element.trigger("focus").trigger(o)}).emulateTransitionEnd(i.TRANSITION_DURATION):n.$element.trigger("focus").trigger(o)}))},i.prototype.hide=function(e){e&&e.preventDefault(),e=t.Event("hide.bs.modal"),this.$element.trigger(e),this.isShown&&!e.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),
t(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),t.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",t.proxy(this.hideModal,this)).emulateTransitionEnd(i.TRANSITION_DURATION):this.hideModal())},i.prototype.enforceFocus=function(){t(document).off("focusin.bs.modal").on("focusin.bs.modal",t.proxy(function(t){this.$element[0]===t.target||this.$element.has(t.target).length||this.$element.trigger("focus")},this))},i.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",t.proxy(function(t){27==t.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},i.prototype.resize=function(){this.isShown?t(window).on("resize.bs.modal",t.proxy(this.handleUpdate,this)):t(window).off("resize.bs.modal")},i.prototype.hideModal=function(){var t=this;this.$element.hide(),this.backdrop(function(){t.$body.removeClass("modal-open"),t.resetAdjustments(),t.resetScrollbar(),t.$element.trigger("hidden.bs.modal")})},i.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},i.prototype.backdrop=function(e){var n=this,r=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var o=t.support.transition&&r;if(this.$backdrop=t(document.createElement("div")).addClass("modal-backdrop "+r).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",t.proxy(function(t){return this.ignoreBackdropClick?void(this.ignoreBackdropClick=!1):void(t.target===t.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide()))},this)),o&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!e)return;o?this.$backdrop.one("bsTransitionEnd",e).emulateTransitionEnd(i.BACKDROP_TRANSITION_DURATION):e()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var s=function(){n.removeBackdrop(),e&&e()};t.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",s).emulateTransitionEnd(i.BACKDROP_TRANSITION_DURATION):s()}else e&&e()},i.prototype.handleUpdate=function(){this.adjustDialog()},i.prototype.adjustDialog=function(){var t=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&t?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!t?this.scrollbarWidth:""})},i.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},i.prototype.checkScrollbar=function(){var t=window.innerWidth;if(!t){var e=document.documentElement.getBoundingClientRect();t=e.right-Math.abs(e.left)}this.bodyIsOverflowing=document.body.clientWidth<t,this.scrollbarWidth=this.measureScrollbar()},i.prototype.setScrollbar=function(){var t=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing&&this.$body.css("padding-right",t+this.scrollbarWidth)},i.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad)},i.prototype.measureScrollbar=function(){var t=document.createElement("div");t.className="modal-scrollbar-measure",this.$body.append(t);var e=t.offsetWidth-t.clientWidth;return this.$body[0].removeChild(t),e};var n=t.fn.modal;t.fn.modal=e,t.fn.modal.Constructor=i,t.fn.modal.noConflict=function(){return t.fn.modal=n,this},t(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(i){var n=t(this),r=n.attr("href"),o=t(n.attr("data-target")||r&&r.replace(/.*(?=#[^\s]+$)/,"")),s=o.data("bs.modal")?"toggle":t.extend({remote:!/#/.test(r)&&r},o.data(),n.data());n.is("a")&&i.preventDefault(),o.one("show.bs.modal",function(t){t.isDefaultPrevented()||o.one("hidden.bs.modal",function(){n.is(":visible")&&n.trigger("focus")})}),e.call(o,s,this)})}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var n=t(this),r=n.data("bs.tooltip"),o="object"==typeof e&&e;(r||!/destroy|hide/.test(e))&&(r||n.data("bs.tooltip",r=new i(this,o)),"string"==typeof e&&r[e]())})}var i=function(t,e){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",t,e)};i.VERSION="3.3.5",i.TRANSITION_DURATION=150,i.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},i.prototype.init=function(e,i,n){if(this.enabled=!0,this.type=e,this.$element=t(i),this.options=this.getOptions(n),this.$viewport=this.options.viewport&&t(t.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var r=this.options.trigger.split(" "),o=r.length;o--;){var s=r[o];if("click"==s)this.$element.on("click."+this.type,this.options.selector,t.proxy(this.toggle,this));else if("manual"!=s){var a="hover"==s?"mouseenter":"focusin",l="hover"==s?"mouseleave":"focusout";this.$element.on(a+"."+this.type,this.options.selector,t.proxy(this.enter,this)),this.$element.on(l+"."+this.type,this.options.selector,t.proxy(this.leave,this))}}this.options.selector?this._options=t.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},i.prototype.getDefaults=function(){return i.DEFAULTS},i.prototype.getOptions=function(e){return e=t.extend({},this.getDefaults(),this.$element.data(),e),e.delay&&"number"==typeof e.delay&&(e.delay={show:e.delay,hide:e.delay}),e},i.prototype.getDelegateOptions=function(){var e={},i=this.getDefaults();return this._options&&t.each(this._options,function(t,n){i[t]!=n&&(e[t]=n)}),e},i.prototype.enter=function(e){var i=e instanceof this.constructor?e:t(e.currentTarget).data("bs."+this.type);return i||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i)),e instanceof t.Event&&(i.inState["focusin"==e.type?"focus":"hover"]=!0),i.tip().hasClass("in")||"in"==i.hoverState?void(i.hoverState="in"):(clearTimeout(i.timeout),i.hoverState="in",i.options.delay&&i.options.delay.show?void(i.timeout=setTimeout(function(){"in"==i.hoverState&&i.show()},i.options.delay.show)):i.show())},i.prototype.isInStateTrue=function(){for(var t in this.inState)if(this.inState[t])return!0;return!1},i.prototype.leave=function(e){var i=e instanceof this.constructor?e:t(e.currentTarget).data("bs."+this.type);return i||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i)),e instanceof t.Event&&(i.inState["focusout"==e.type?"focus":"hover"]=!1),i.isInStateTrue()?void 0:(clearTimeout(i.timeout),i.hoverState="out",i.options.delay&&i.options.delay.hide?void(i.timeout=setTimeout(function(){"out"==i.hoverState&&i.hide()},i.options.delay.hide)):i.hide())},i.prototype.show=function(){var e=t.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(e);var n=t.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(e.isDefaultPrevented()||!n)return;var r=this,o=this.tip(),s=this.getUID(this.type);this.setContent(),o.attr("id",s),this.$element.attr("aria-describedby",s),this.options.animation&&o.addClass("fade");var a="function"==typeof this.options.placement?this.options.placement.call(this,o[0],this.$element[0]):this.options.placement,l=/\s?auto?\s?/i,c=l.test(a);c&&(a=a.replace(l,"")||"top"),o.detach().css({top:0,left:0,display:"block"}).addClass(a).data("bs."+this.type,this),this.options.container?o.appendTo(this.options.container):o.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var h=this.getPosition(),u=o[0].offsetWidth,f=o[0].offsetHeight;if(c){var d=a,p=this.getPosition(this.$viewport);a="bottom"==a&&h.bottom+f>p.bottom?"top":"top"==a&&h.top-f<p.top?"bottom":"right"==a&&h.right+u>p.width?"left":"left"==a&&h.left-u<p.left?"right":a,o.removeClass(d).addClass(a)}var g=this.getCalculatedOffset(a,h,u,f);this.applyPlacement(g,a);var v=function(){var t=r.hoverState;r.$element.trigger("shown.bs."+r.type),r.hoverState=null,"out"==t&&r.leave(r)};t.support.transition&&this.$tip.hasClass("fade")?o.one("bsTransitionEnd",v).emulateTransitionEnd(i.TRANSITION_DURATION):v()}},i.prototype.applyPlacement=function(e,i){var n=this.tip(),r=n[0].offsetWidth,o=n[0].offsetHeight,s=parseInt(n.css("margin-top"),10),a=parseInt(n.css("margin-left"),10);isNaN(s)&&(s=0),isNaN(a)&&(a=0),e.top+=s,e.left+=a,t.offset.setOffset(n[0],t.extend({using:function(t){n.css({top:Math.round(t.top),left:Math.round(t.left)})}},e),0),n.addClass("in");var l=n[0].offsetWidth,c=n[0].offsetHeight;"top"==i&&c!=o&&(e.top=e.top+o-c);var h=this.getViewportAdjustedDelta(i,e,l,c);h.left?e.left+=h.left:e.top+=h.top;var u=/top|bottom/.test(i),f=u?2*h.left-r+l:2*h.top-o+c,d=u?"offsetWidth":"offsetHeight";n.offset(e),this.replaceArrow(f,n[0][d],u)},i.prototype.replaceArrow=function(t,e,i){this.arrow().css(i?"left":"top",50*(1-t/e)+"%").css(i?"top":"left","")},i.prototype.setContent=function(){var t=this.tip(),e=this.getTitle();t.find(".tooltip-inner")[this.options.html?"html":"text"](e),t.removeClass("fade in top bottom left right")},i.prototype.hide=function(e){function n(){"in"!=r.hoverState&&o.detach(),r.$element.removeAttr("aria-describedby").trigger("hidden.bs."+r.type),e&&e()}var r=this,o=t(this.$tip),s=t.Event("hide.bs."+this.type);return this.$element.trigger(s),s.isDefaultPrevented()?void 0:(o.removeClass("in"),t.support.transition&&o.hasClass("fade")?o.one("bsTransitionEnd",n).emulateTransitionEnd(i.TRANSITION_DURATION):n(),this.hoverState=null,this)},i.prototype.fixTitle=function(){var t=this.$element;(t.attr("title")||"string"!=typeof t.attr("data-original-title"))&&t.attr("data-original-title",t.attr("title")||"").attr("title","")},i.prototype.hasContent=function(){return this.getTitle()},i.prototype.getPosition=function(e){e=e||this.$element;var i=e[0],n="BODY"==i.tagName,r=i.getBoundingClientRect();null==r.width&&(r=t.extend({},r,{width:r.right-r.left,height:r.bottom-r.top}));var o=n?{top:0,left:0}:e.offset(),s={scroll:n?document.documentElement.scrollTop||document.body.scrollTop:e.scrollTop()},a=n?{width:t(window).width(),height:t(window).height()}:null;return t.extend({},r,s,a,o)},i.prototype.getCalculatedOffset=function(t,e,i,n){return"bottom"==t?{top:e.top+e.height,left:e.left+e.width/2-i/2}:"top"==t?{top:e.top-n,left:e.left+e.width/2-i/2}:"left"==t?{top:e.top+e.height/2-n/2,left:e.left-i}:{top:e.top+e.height/2-n/2,left:e.left+e.width}},i.prototype.getViewportAdjustedDelta=function(t,e,i,n){var r={top:0,left:0};if(!this.$viewport)return r;var o=this.options.viewport&&this.options.viewport.padding||0,s=this.getPosition(this.$viewport);if(/right|left/.test(t)){var a=e.top-o-s.scroll,l=e.top+o-s.scroll+n;a<s.top?r.top=s.top-a:l>s.top+s.height&&(r.top=s.top+s.height-l)}else{var c=e.left-o,h=e.left+o+i;c<s.left?r.left=s.left-c:h>s.right&&(r.left=s.left+s.width-h)}return r},i.prototype.getTitle=function(){var t,e=this.$element,i=this.options;return t=e.attr("data-original-title")||("function"==typeof i.title?i.title.call(e[0]):i.title)},i.prototype.getUID=function(t){do t+=~~(1e6*Math.random());while(document.getElementById(t));return t},i.prototype.tip=function(){if(!this.$tip&&(this.$tip=t(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},i.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},i.prototype.enable=function(){this.enabled=!0},i.prototype.disable=function(){this.enabled=!1},i.prototype.toggleEnabled=function(){this.enabled=!this.enabled},i.prototype.toggle=function(e){var i=this;e&&(i=t(e.currentTarget).data("bs."+this.type),i||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i))),e?(i.inState.click=!i.inState.click,i.isInStateTrue()?i.enter(i):i.leave(i)):i.tip().hasClass("in")?i.leave(i):i.enter(i)},i.prototype.destroy=function(){var t=this;clearTimeout(this.timeout),this.hide(function(){t.$element.off("."+t.type).removeData("bs."+t.type),t.$tip&&t.$tip.detach(),t.$tip=null,t.$arrow=null,t.$viewport=null})};var n=t.fn.tooltip;t.fn.tooltip=e,t.fn.tooltip.Constructor=i,t.fn.tooltip.noConflict=function(){return t.fn.tooltip=n,this}}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var n=t(this),r=n.data("bs.popover"),o="object"==typeof e&&e;(r||!/destroy|hide/.test(e))&&(r||n.data("bs.popover",r=new i(this,o)),"string"==typeof e&&r[e]())})}var i=function(t,e){this.init("popover",t,e)};if(!t.fn.tooltip)throw new Error("Popover requires tooltip.js");i.VERSION="3.3.5",i.DEFAULTS=t.extend({},t.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),i.prototype=t.extend({},t.fn.tooltip.Constructor.prototype),i.prototype.constructor=i,i.prototype.getDefaults=function(){return i.DEFAULTS},i.prototype.setContent=function(){var t=this.tip(),e=this.getTitle(),i=this.getContent();t.find(".popover-title")[this.options.html?"html":"text"](e),t.find(".popover-content").children().detach().end()[this.options.html?"string"==typeof i?"html":"append":"text"](i),t.removeClass("fade top bottom left right in"),t.find(".popover-title").html()||t.find(".popover-title").hide()},i.prototype.hasContent=function(){return this.getTitle()||this.getContent()},i.prototype.getContent=function(){var t=this.$element,e=this.options;return t.attr("data-content")||("function"==typeof e.content?e.content.call(t[0]):e.content)},i.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};var n=t.fn.popover;t.fn.popover=e,t.fn.popover.Constructor=i,t.fn.popover.noConflict=function(){return t.fn.popover=n,this}}(jQuery),+function(t){"use strict";function e(i,n){this.$body=t(document.body),this.$scrollElement=t(t(i).is(document.body)?window:i),this.options=t.extend({},e.DEFAULTS,n),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",t.proxy(this.process,this)),this.refresh(),this.process()}function i(i){return this.each(function(){var n=t(this),r=n.data("bs.scrollspy"),o="object"==typeof i&&i;r||n.data("bs.scrollspy",r=new e(this,o)),"string"==typeof i&&r[i]()})}e.VERSION="3.3.5",e.DEFAULTS={offset:10},e.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},e.prototype.refresh=function(){var e=this,i="offset",n=0;this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight(),t.isWindow(this.$scrollElement[0])||(i="position",n=this.$scrollElement.scrollTop()),this.$body.find(this.selector).map(function(){var e=t(this),r=e.data("target")||e.attr("href"),o=/^#./.test(r)&&t(r);return o&&o.length&&o.is(":visible")&&[[o[i]().top+n,r]]||null}).sort(function(t,e){return t[0]-e[0]}).each(function(){e.offsets.push(this[0]),e.targets.push(this[1])})},e.prototype.process=function(){var t,e=this.$scrollElement.scrollTop()+this.options.offset,i=this.getScrollHeight(),n=this.options.offset+i-this.$scrollElement.height(),r=this.offsets,o=this.targets,s=this.activeTarget;if(this.scrollHeight!=i&&this.refresh(),e>=n)return s!=(t=o[o.length-1])&&this.activate(t);if(s&&e<r[0])return this.activeTarget=null,this.clear();for(t=r.length;t--;)s!=o[t]&&e>=r[t]&&(void 0===r[t+1]||e<r[t+1])&&this.activate(o[t])},e.prototype.activate=function(e){this.activeTarget=e,this.clear();var i=this.selector+'[data-target="'+e+'"],'+this.selector+'[href="'+e+'"]',n=t(i).parents("li").addClass("active");n.parent(".dropdown-menu").length&&(n=n.closest("li.dropdown").addClass("active")),n.trigger("activate.bs.scrollspy")},e.prototype.clear=function(){t(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};var n=t.fn.scrollspy;t.fn.scrollspy=i,t.fn.scrollspy.Constructor=e,t.fn.scrollspy.noConflict=function(){return t.fn.scrollspy=n,this},t(window).on("load.bs.scrollspy.data-api",function(){t('[data-spy="scroll"]').each(function(){var e=t(this);i.call(e,e.data())})})}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var n=t(this),r=n.data("bs.tab");r||n.data("bs.tab",r=new i(this)),"string"==typeof e&&r[e]()})}var i=function(e){this.element=t(e)};i.VERSION="3.3.5",i.TRANSITION_DURATION=150,i.prototype.show=function(){var e=this.element,i=e.closest("ul:not(.dropdown-menu)"),n=e.data("target");if(n||(n=e.attr("href"),n=n&&n.replace(/.*(?=#[^\s]*$)/,"")),!e.parent("li").hasClass("active")){var r=i.find(".active:last a"),o=t.Event("hide.bs.tab",{relatedTarget:e[0]}),s=t.Event("show.bs.tab",{relatedTarget:r[0]});if(r.trigger(o),e.trigger(s),!s.isDefaultPrevented()&&!o.isDefaultPrevented()){var a=t(n);this.activate(e.closest("li"),i),this.activate(a,a.parent(),function(){r.trigger({type:"hidden.bs.tab",relatedTarget:e[0]}),e.trigger({type:"shown.bs.tab",relatedTarget:r[0]})})}}},i.prototype.activate=function(e,n,r){function o(){s.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),e.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),a?(e[0].offsetWidth,e.addClass("in")):e.removeClass("fade"),e.parent(".dropdown-menu").length&&e.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),r&&r()}var s=n.find("> .active"),a=r&&t.support.transition&&(s.length&&s.hasClass("fade")||!!n.find("> .fade").length);s.length&&a?s.one("bsTransitionEnd",o).emulateTransitionEnd(i.TRANSITION_DURATION):o(),s.removeClass("in")};var n=t.fn.tab;t.fn.tab=e,t.fn.tab.Constructor=i,t.fn.tab.noConflict=function(){return t.fn.tab=n,this};var r=function(i){i.preventDefault(),e.call(t(this),"show")};t(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',r).on("click.bs.tab.data-api",'[data-toggle="pill"]',r)}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var n=t(this),r=n.data("bs.affix"),o="object"==typeof e&&e;r||n.data("bs.affix",r=new i(this,o)),"string"==typeof e&&r[e]()})}var i=function(e,n){this.options=t.extend({},i.DEFAULTS,n),this.$target=t(this.options.target).on("scroll.bs.affix.data-api",t.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",t.proxy(this.checkPositionWithEventLoop,this)),this.$element=t(e),this.affixed=null,this.unpin=null,this.pinnedOffset=null,this.checkPosition()};i.VERSION="3.3.5",i.RESET="affix affix-top affix-bottom",i.DEFAULTS={offset:0,target:window},i.prototype.getState=function(t,e,i,n){var r=this.$target.scrollTop(),o=this.$element.offset(),s=this.$target.height();if(null!=i&&"top"==this.affixed)return i>r?"top":!1;if("bottom"==this.affixed)return null!=i?r+this.unpin<=o.top?!1:"bottom":t-n>=r+s?!1:"bottom";var a=null==this.affixed,l=a?r:o.top,c=a?s:e;return null!=i&&i>=r?"top":null!=n&&l+c>=t-n?"bottom":!1},i.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(i.RESET).addClass("affix");var t=this.$target.scrollTop(),e=this.$element.offset();return this.pinnedOffset=e.top-t},i.prototype.checkPositionWithEventLoop=function(){setTimeout(t.proxy(this.checkPosition,this),1)},i.prototype.checkPosition=function(){if(this.$element.is(":visible")){var e=this.$element.height(),n=this.options.offset,r=n.top,o=n.bottom,s=Math.max(t(document).height(),t(document.body).height());"object"!=typeof n&&(o=r=n),"function"==typeof r&&(r=n.top(this.$element)),"function"==typeof o&&(o=n.bottom(this.$element));var a=this.getState(s,e,r,o);if(this.affixed!=a){null!=this.unpin&&this.$element.css("top","");var l="affix"+(a?"-"+a:""),c=t.Event(l+".bs.affix");if(this.$element.trigger(c),c.isDefaultPrevented())return;this.affixed=a,this.unpin="bottom"==a?this.getPinnedOffset():null,this.$element.removeClass(i.RESET).addClass(l).trigger(l.replace("affix","affixed")+".bs.affix")}"bottom"==a&&this.$element.offset({top:s-e-o})}};var n=t.fn.affix;t.fn.affix=e,t.fn.affix.Constructor=i,t.fn.affix.noConflict=function(){return t.fn.affix=n,this},t(window).on("load",function(){t('[data-spy="affix"]').each(function(){var i=t(this),n=i.data();n.offset=n.offset||{},null!=n.offsetBottom&&(n.offset.bottom=n.offsetBottom),null!=n.offsetTop&&(n.offset.top=n.offsetTop),e.call(i,n)})})}(jQuery),function(){function t(t){var e,n,r,o,s,a;for(r=t.length,n=0,e="";r>n;){if(o=255&t.charCodeAt(n++),n==r){e+=i.charAt(o>>2),e+=i.charAt((3&o)<<4),e+="==";break}if(s=t.charCodeAt(n++),n==r){e+=i.charAt(o>>2),e+=i.charAt((3&o)<<4|(240&s)>>4),e+=i.charAt((15&s)<<2),e+="=";break}a=t.charCodeAt(n++),e+=i.charAt(o>>2),e+=i.charAt((3&o)<<4|(240&s)>>4),e+=i.charAt((15&s)<<2|(192&a)>>6),e+=i.charAt(63&a)}return e}function e(t){var e,i,r,o,s,a,l;for(a=t.length,s=0,l="";a>s;){do e=n[255&t.charCodeAt(s++)];while(a>s&&-1==e);if(-1==e)break;do i=n[255&t.charCodeAt(s++)];while(a>s&&-1==i);if(-1==i)break;l+=String.fromCharCode(e<<2|(48&i)>>4);do{if(r=255&t.charCodeAt(s++),61==r)return l;r=n[r]}while(a>s&&-1==r);if(-1==r)break;l+=String.fromCharCode((15&i)<<4|(60&r)>>2);do{if(o=255&t.charCodeAt(s++),61==o)return l;o=n[o]}while(a>s&&-1==o);if(-1==o)break;l+=String.fromCharCode((3&r)<<6|o)}return l}var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);window.btoa||(window.btoa=t),window.atob||(window.atob=e)}();var Canvas2Image=function(){var t=!1,e=document.createElement("canvas");if(e.getContext("2d")&&(t=!0),!t)return{saveAsBMP:function(){},saveAsPNG:function(){},saveAsJPEG:function(){}};var i=!!e.getContext("2d").getImageData,n=!!e.toDataURL,r=!!window.btoa,o="image/octet-stream",s=function(t){var e=parseInt(t.width),i=parseInt(t.height);return t.getContext("2d").getImageData(0,0,e,i)},a=function(t){var e="";if("string"==typeof t)e=t;else for(var i=t,n=0;n<i.length;n++)e+=String.fromCharCode(i[n]);return btoa(e)},l=function(t){var e=[],i=t.width,n=t.height;e.push(66),e.push(77);var r=i*n*3+54;e.push(r%256),r=Math.floor(r/256),e.push(r%256),r=Math.floor(r/256),e.push(r%256),r=Math.floor(r/256),e.push(r%256),e.push(0),e.push(0),e.push(0),e.push(0),e.push(54),e.push(0),e.push(0),e.push(0);var o=[];o.push(40),o.push(0),o.push(0),o.push(0);var s=i;o.push(s%256),s=Math.floor(s/256),o.push(s%256),s=Math.floor(s/256),o.push(s%256),s=Math.floor(s/256),o.push(s%256);var l=n;o.push(l%256),l=Math.floor(l/256),o.push(l%256),l=Math.floor(l/256),o.push(l%256),l=Math.floor(l/256),o.push(l%256),o.push(1),o.push(0),o.push(24),o.push(0),o.push(0),o.push(0),o.push(0),o.push(0);var c=i*n*3;o.push(c%256),c=Math.floor(c/256),o.push(c%256),c=Math.floor(c/256),o.push(c%256),c=Math.floor(c/256),o.push(c%256);for(var h=0;16>h;h++)o.push(0);var u=(4-3*i%4)%4,f=t.data,d="",p=n;do{for(var g=i*(p-1)*4,v="",m=0;i>m;m++){var b=4*m;v+=String.fromCharCode(f[g+b+2]),v+=String.fromCharCode(f[g+b+1]),v+=String.fromCharCode(f[g+b])}for(var y=0;u>y;y++)v+=String.fromCharCode(0);d+=v}while(--p);var C=a(e.concat(o))+a(d);return C},c=function(t){document.location.href=t},h=function(t,e){return"data:"+e+";base64,"+t},u=function(t){var e=document.createElement("img");return e.src=t,e},f=function(t,e,i){if(e&&i){var n=document.createElement("canvas");n.width=e,n.height=i,n.style.width=e+"px",n.style.height=i+"px";var r=n.getContext("2d");return r.drawImage(t,0,0,t.width,t.height,0,0,e,i),n}return t};return{saveAsPNG:function(t,e,i,r){if(!n)return!1;var s=f(t,i,r),a=s.toDataURL("image/png");return e?u(a):(c(a.replace("image/png",o)),!0)},saveAsJPEG:function(t,e,i,r){if(!n)return!1;var s=f(t,i,r),a="image/jpeg",l=s.toDataURL(a);return 5!=l.indexOf(a)?!1:e?u(l):(c(l.replace(a,o)),!0)},saveAsBMP:function(t,e,n,a){if(!i||!r)return!1;var d=f(t,n,a),p=s(d),g=l(p);return e?u(h(g,"image/bmp")):(c(h(g,o)),!0)}}}();!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports&&"object"==typeof module?module.exports=t:t(jQuery)}(function(t,e){"use strict";function i(e,i,n,r){for(var o=[],s=0;s<e.length;s++){var a=e[s];if(a){var l=tinycolor(a),c=l.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";c+=tinycolor.equals(i,a)?" sp-thumb-active":"";var h=l.toString(r.preferredFormat||"rgb"),u=v?"background-color:"+l.toRgbString():"filter:"+l.toFilter();o.push('<span title="'+h+'" data-color="'+l.toRgbString()+'" class="'+c+'"><span class="sp-thumb-inner" style="'+u+';" /></span>')}else{var f="sp-clear-display";o.push(t("<div />").append(t('<span data-color="" style="background-color:transparent;" class="'+f+'"></span>').attr("title",r.noColorSelectedText)).html())}}return"<div class='sp-cf "+n+"'>"+o.join("")+"</div>"}function n(){for(var t=0;t<p.length;t++)p[t]&&p[t].hide()}function r(e,i){var n=t.extend({},d,e);return n.callbacks={move:c(n.move,i),change:c(n.change,i),show:c(n.show,i),hide:c(n.hide,i),beforeShow:c(n.beforeShow,i)},n}function o(o,a){function c(){if(Y.showPaletteOnly&&(Y.showPalette=!0),Lt.text(Y.showPaletteOnly?Y.togglePaletteMoreText:Y.togglePaletteLessText),Y.palette){dt=Y.palette.slice(0),pt=t.isArray(dt[0])?dt:[dt],gt={};for(var e=0;e<pt.length;e++)for(var i=0;i<pt[e].length;i++){var n=tinycolor(pt[e][i]).toRgbString();gt[n]=!0}}_t.toggleClass("sp-flat",U),_t.toggleClass("sp-input-disabled",!Y.showInput),_t.toggleClass("sp-alpha-enabled",Y.showAlpha),_t.toggleClass("sp-clear-enabled",Kt),_t.toggleClass("sp-buttons-disabled",!Y.showButtons),_t.toggleClass("sp-palette-buttons-disabled",!Y.togglePaletteOnly),_t.toggleClass("sp-palette-disabled",!Y.showPalette),_t.toggleClass("sp-palette-only",Y.showPaletteOnly),_t.toggleClass("sp-initial-disabled",!Y.showInitial),_t.addClass(Y.className).addClass(Y.containerClassName),H()}function d(){function e(e){return e.data&&e.data.ignore?(D(t(e.target).closest(".sp-thumb-el").data("color")),M()):(D(t(e.target).closest(".sp-thumb-el").data("color")),M(),R(!0),Y.hideAfterPaletteSelect&&E()),!1}if(g&&_t.find("*:not(input)").attr("unselectable","on"),c(),Wt&&xt.after(Nt).hide(),Kt||Mt.hide(),U)xt.after(_t).hide();else{var i="parent"===Y.appendTo?xt.parent():t(Y.appendTo);1!==i.length&&(i=t("body")),i.append(_t)}y(),Gt.bind("click.spectrum touchstart.spectrum",function(e){wt||k(),e.stopPropagation(),t(e.target).is("input")||e.preventDefault()}),(xt.is(":disabled")||Y.disabled===!0)&&X(),_t.click(l),$t.change(T),$t.bind("paste",function(){setTimeout(T,1)}),$t.keydown(function(t){13==t.keyCode&&T()}),Bt.text(Y.cancelText),Bt.bind("click.spectrum",function(t){t.stopPropagation(),t.preventDefault(),$(),E()}),Mt.attr("title",Y.clearText),Mt.bind("click.spectrum",function(t){t.stopPropagation(),t.preventDefault(),Jt=!0,M(),U&&R(!0)}),Ft.text(Y.chooseText),Ft.bind("click.spectrum",function(t){t.stopPropagation(),t.preventDefault(),g&&$t.is(":focus")&&$t.trigger("change"),B()&&(R(!0),E())}),Lt.text(Y.showPaletteOnly?Y.togglePaletteMoreText:Y.togglePaletteLessText),Lt.bind("click.spectrum",function(t){t.stopPropagation(),t.preventDefault(),Y.showPaletteOnly=!Y.showPaletteOnly,Y.showPaletteOnly||U||_t.css("left","-="+(St.outerWidth(!0)+5)),c()}),h(It,function(t,e,i){ft=t/st,Jt=!1,i.shiftKey&&(ft=Math.round(10*ft)/10),M()},S,O),h(kt,function(t,e){ct=parseFloat(e/rt),Jt=!1,Y.showAlpha||(ft=1),M()},S,O),h(Ot,function(t,e,i){if(i.shiftKey){if(!yt){var n=ht*et,r=it-ut*it,o=Math.abs(t-n)>Math.abs(e-r);yt=o?"x":"y"}}else yt=null;var s=!yt||"x"===yt,a=!yt||"y"===yt;s&&(ht=parseFloat(t/et)),a&&(ut=parseFloat((it-e)/it)),Jt=!1,Y.showAlpha||(ft=1),M()},S,O),zt?(D(zt),F(),Vt=Ut||tinycolor(zt).format,C(zt)):F(),U&&j();var n=g?"mousedown.spectrum":"click.spectrum touchstart.spectrum";Dt.delegate(".sp-thumb-el",n,e),Pt.delegate(".sp-thumb-el:nth-child(1)",n,{ignore:!0},e)}function y(){if(q&&window.localStorage){try{var e=window.localStorage[q].split(",#");e.length>1&&(delete window.localStorage[q],t.each(e,function(t,e){C(e)}))}catch(i){}try{vt=window.localStorage[q].split(";")}catch(i){}}}function C(e){if(V){var i=tinycolor(e).toRgbString();if(!gt[i]&&-1===t.inArray(i,vt))for(vt.push(i);vt.length>mt;)vt.shift();if(q&&window.localStorage)try{window.localStorage[q]=vt.join(";")}catch(n){}}}function x(){var t=[];if(Y.showPalette)for(var e=0;e<vt.length;e++){var i=tinycolor(vt[e]).toRgbString();gt[i]||t.push(vt[e])}return t.reverse().slice(0,Y.maxSelectionSize)}function w(){var e=P(),n=t.map(pt,function(t,n){return i(t,e,"sp-palette-row sp-palette-row-"+n,Y)});y(),vt&&n.push(i(x(),e,"sp-palette-row sp-palette-row-selection",Y)),Dt.html(n.join(""))}function _(){if(Y.showInitial){var t=Yt,e=P();Pt.html(i([t,e],e,"sp-palette-row-initial",Y))}}function S(){(0>=it||0>=et||0>=rt)&&H(),tt=!0,_t.addClass(bt),yt=null,xt.trigger("dragstart.spectrum",[P()])}function O(){tt=!1,_t.removeClass(bt),xt.trigger("dragstop.spectrum",[P()])}function T(){var t=$t.val();if(null!==t&&""!==t||!Kt){var e=tinycolor(t);e.isValid()?(D(e),R(!0)):$t.addClass("sp-validation-error")}else D(null),R(!0)}function k(){Z?E():j()}function j(){var e=t.Event("beforeShow.spectrum");return Z?void H():(xt.trigger(e,[P()]),void(K.beforeShow(P())===!1||e.isDefaultPrevented()||(n(),Z=!0,t(Ct).bind("keydown.spectrum",A),t(Ct).bind("click.spectrum",I),t(window).bind("resize.spectrum",Q),Nt.addClass("sp-active"),_t.removeClass("sp-hidden"),H(),F(),Yt=P(),_(),K.show(Yt),xt.trigger("show.spectrum",[Yt]))))}function A(t){27===t.keyCode&&E()}function I(t){2!=t.button&&(tt||(qt?R(!0):$(),E()))}function E(){Z&&!U&&(Z=!1,t(Ct).unbind("keydown.spectrum",A),t(Ct).unbind("click.spectrum",I),t(window).unbind("resize.spectrum",Q),Nt.removeClass("sp-active"),_t.addClass("sp-hidden"),K.hide(P()),xt.trigger("hide.spectrum",[P()]))}function $(){D(Yt,!0)}function D(t,e){if(tinycolor.equals(t,P()))return void F();var i,n;!t&&Kt?Jt=!0:(Jt=!1,i=tinycolor(t),n=i.toHsv(),ct=n.h%360/360,ht=n.s,ut=n.v,ft=n.a),F(),i&&i.isValid()&&!e&&(Vt=Ut||i.getFormat())}function P(t){return t=t||{},Kt&&Jt?null:tinycolor.fromRatio({h:ct,s:ht,v:ut,a:Math.round(100*ft)/100},{format:t.format||Vt})}function B(){return!$t.hasClass("sp-validation-error")}function M(){F(),K.move(P()),xt.trigger("move.spectrum",[P()])}function F(){$t.removeClass("sp-validation-error"),L();var t=tinycolor.fromRatio({h:ct,s:1,v:1});Ot.css("background-color",t.toHexString());var e=Vt;1>ft&&(0!==ft||"name"!==e)&&("hex"===e||"hex3"===e||"hex6"===e||"name"===e)&&(e="rgb");var i=P({format:e}),n="";if(Xt.removeClass("sp-clear-display"),Xt.css("background-color","transparent"),!i&&Kt)Xt.addClass("sp-clear-display");else{var r=i.toHexString(),o=i.toRgbString();if(v||1===i.alpha?Xt.css("background-color",o):(Xt.css("background-color","transparent"),Xt.css("filter",i.toFilter())),Y.showAlpha){var s=i.toRgb();s.a=0;var a=tinycolor(s).toRgbString(),l="linear-gradient(left, "+a+", "+r+")";g?At.css("filter",tinycolor(a).toFilter({gradientType:1},r)):(At.css("background","-webkit-"+l),At.css("background","-moz-"+l),At.css("background","-ms-"+l),At.css("background","linear-gradient(to right, "+a+", "+r+")"));
}n=i.toString(e)}Y.showInput&&$t.val(n),Y.showPalette&&w(),_()}function L(){var t=ht,e=ut;if(Kt&&Jt)Et.hide(),jt.hide(),Tt.hide();else{Et.show(),jt.show(),Tt.show();var i=t*et,n=it-e*it;i=Math.max(-nt,Math.min(et-nt,i-nt)),n=Math.max(-nt,Math.min(it-nt,n-nt)),Tt.css({top:n+"px",left:i+"px"});var r=ft*st;Et.css({left:r-at/2+"px"});var o=ct*rt;jt.css({top:o-lt+"px"})}}function R(t){var e=P(),i="",n=!tinycolor.equals(e,Yt);e&&(i=e.toString(Vt),C(e)),Rt&&xt.val(i),t&&n&&(K.change(e),xt.trigger("change",[e]))}function H(){et=Ot.width(),it=Ot.height(),nt=Tt.height(),ot=kt.width(),rt=kt.height(),lt=jt.height(),st=It.width(),at=Et.width(),U||(_t.css("position","absolute"),Y.offset?_t.offset(Y.offset):_t.offset(s(_t,Gt))),L(),Y.showPalette&&w(),xt.trigger("reflow.spectrum")}function W(){xt.show(),Gt.unbind("click.spectrum touchstart.spectrum"),_t.remove(),Nt.remove(),p[Qt.id]=null}function N(i,n){return i===e?t.extend({},Y):n===e?Y[i]:(Y[i]=n,void c())}function G(){wt=!1,xt.attr("disabled",!1),Gt.removeClass("sp-disabled")}function X(){E(),wt=!0,xt.attr("disabled",!0),Gt.addClass("sp-disabled")}function z(t){Y.offset=t,H()}var Y=r(a,o),U=Y.flat,V=Y.showSelectionPalette,q=Y.localStorageKey,J=Y.theme,K=Y.callbacks,Q=u(H,10),Z=!1,tt=!1,et=0,it=0,nt=0,rt=0,ot=0,st=0,at=0,lt=0,ct=0,ht=0,ut=0,ft=1,dt=[],pt=[],gt={},vt=Y.selectionPalette.slice(0),mt=Y.maxSelectionSize,bt="sp-dragging",yt=null,Ct=o.ownerDocument,xt=(Ct.body,t(o)),wt=!1,_t=t(b,Ct).addClass(J),St=_t.find(".sp-picker-container"),Ot=_t.find(".sp-color"),Tt=_t.find(".sp-dragger"),kt=_t.find(".sp-hue"),jt=_t.find(".sp-slider"),At=_t.find(".sp-alpha-inner"),It=_t.find(".sp-alpha"),Et=_t.find(".sp-alpha-handle"),$t=_t.find(".sp-input"),Dt=_t.find(".sp-palette"),Pt=_t.find(".sp-initial"),Bt=_t.find(".sp-cancel"),Mt=_t.find(".sp-clear"),Ft=_t.find(".sp-choose"),Lt=_t.find(".sp-palette-toggle"),Rt=xt.is("input"),Ht=Rt&&"color"===xt.attr("type")&&f(),Wt=Rt&&!U,Nt=Wt?t(m).addClass(J).addClass(Y.className).addClass(Y.replacerClassName):t([]),Gt=Wt?Nt:xt,Xt=Nt.find(".sp-preview-inner"),zt=Y.color||Rt&&xt.val(),Yt=!1,Ut=Y.preferredFormat,Vt=Ut,qt=!Y.showButtons||Y.clickoutFiresChange,Jt=!zt,Kt=Y.allowEmpty&&!Ht;d();var Qt={show:j,hide:E,toggle:k,reflow:H,option:N,enable:G,disable:X,offset:z,set:function(t){D(t),R()},get:P,destroy:W,container:_t};return Qt.id=p.push(Qt)-1,Qt}function s(e,i){var n=0,r=e.outerWidth(),o=e.outerHeight(),s=i.outerHeight(),a=e[0].ownerDocument,l=a.documentElement,c=l.clientWidth+t(a).scrollLeft(),h=l.clientHeight+t(a).scrollTop(),u=i.offset();return u.top+=s,u.left-=Math.min(u.left,u.left+r>c&&c>r?Math.abs(u.left+r-c):0),u.top-=Math.min(u.top,u.top+o>h&&h>o?Math.abs(o+s-n):n),u}function a(){}function l(t){t.stopPropagation()}function c(t,e){var i=Array.prototype.slice,n=i.call(arguments,2);return function(){return t.apply(e,n.concat(i.call(arguments)))}}function h(e,i,n,r){function o(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),t.returnValue=!1}function s(t){if(h){if(g&&c.documentMode<9&&!t.button)return l();var n=t.originalEvent&&t.originalEvent.touches&&t.originalEvent.touches[0],r=n&&n.pageX||t.pageX,s=n&&n.pageY||t.pageY,a=Math.max(0,Math.min(r-u.left,d)),v=Math.max(0,Math.min(s-u.top,f));p&&o(t),i.apply(e,[a,v,t])}}function a(i){var r=i.which?3==i.which:2==i.button;r||h||n.apply(e,arguments)!==!1&&(h=!0,f=t(e).height(),d=t(e).width(),u=t(e).offset(),t(c).bind(v),t(c.body).addClass("sp-dragging"),s(i),o(i))}function l(){h&&(t(c).unbind(v),t(c.body).removeClass("sp-dragging"),setTimeout(function(){r.apply(e,arguments)},0)),h=!1}i=i||function(){},n=n||function(){},r=r||function(){};var c=document,h=!1,u={},f=0,d=0,p="ontouchstart"in window,v={};v.selectstart=o,v.dragstart=o,v["touchmove mousemove"]=s,v["touchend mouseup"]=l,t(e).bind("touchstart mousedown",a)}function u(t,e,i){var n;return function(){var r=this,o=arguments,s=function(){n=null,t.apply(r,o)};i&&clearTimeout(n),(i||!n)&&(n=setTimeout(s,e))}}function f(){return t.fn.spectrum.inputTypeColorSupport()}var d={beforeShow:a,move:a,change:a,show:a,hide:a,color:!1,flat:!1,showInput:!1,allowEmpty:!1,showButtons:!0,clickoutFiresChange:!0,showInitial:!1,showPalette:!1,showPaletteOnly:!1,hideAfterPaletteSelect:!1,togglePaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",togglePaletteMoreText:"more",togglePaletteLessText:"less",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected",preferredFormat:!1,className:"",containerClassName:"",replacerClassName:"",showAlpha:!1,theme:"sp-light",palette:[["#ffffff","#000000","#ff0000","#ff8000","#ffff00","#008000","#0000ff","#4b0082","#9400d3"]],selectionPalette:[],disabled:!1,offset:null},p=[],g=!!/msie/i.exec(window.navigator.userAgent),v=function(){function t(t,e){return!!~(""+t).indexOf(e)}var e=document.createElement("div"),i=e.style;return i.cssText="background-color:rgba(0,0,0,.5)",t(i.backgroundColor,"rgba")||t(i.backgroundColor,"hsla")}(),m=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","</div>"].join(""),b=function(){var t="";if(g)for(var e=1;6>=e;e++)t+="<div class='sp-"+e+"'></div>";return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","<div class='sp-palette-button-container sp-cf'>","<button type='button' class='sp-palette-toggle'></button>","</div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-clear sp-clear-display'>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",t,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button type='button' class='sp-choose'></button>","</div>","</div>","</div>"].join("")}(),y="spectrum.id";t.fn.spectrum=function(e,i){if("string"==typeof e){var n=this,r=Array.prototype.slice.call(arguments,1);return this.each(function(){var i=p[t(this).data(y)];if(i){var o=i[e];if(!o)throw new Error("Spectrum: no such method: '"+e+"'");"get"==e?n=i.get():"container"==e?n=i.container:"option"==e?n=i.option.apply(i,r):"destroy"==e?(i.destroy(),t(this).removeData(y)):o.apply(i,r)}}),n}return this.spectrum("destroy").each(function(){var i=t.extend({},e,t(this).data()),n=o(this,i);t(this).data(y,n.id)})},t.fn.spectrum.load=!0,t.fn.spectrum.loadOpts={},t.fn.spectrum.draggable=h,t.fn.spectrum.defaults=d,t.fn.spectrum.inputTypeColorSupport=function C(){if("undefined"==typeof C._cachedResult){var e=t("<input type='color'/>")[0];C._cachedResult="color"===e.type&&""!==e.value}return C._cachedResult},t.spectrum={},t.spectrum.localization={},t.spectrum.palettes={},t.fn.spectrum.processNativeColorInputs=function(){var e=t("input[type=color]");e.length&&!f()&&e.spectrum({preferredFormat:"hex6"})},function(){function t(t){var i={r:0,g:0,b:0},r=1,s=!1,a=!1;return"string"==typeof t&&(t=$(t)),"object"==typeof t&&(t.hasOwnProperty("r")&&t.hasOwnProperty("g")&&t.hasOwnProperty("b")?(i=e(t.r,t.g,t.b),s=!0,a="%"===String(t.r).substr(-1)?"prgb":"rgb"):t.hasOwnProperty("h")&&t.hasOwnProperty("s")&&t.hasOwnProperty("v")?(t.s=A(t.s),t.v=A(t.v),i=o(t.h,t.s,t.v),s=!0,a="hsv"):t.hasOwnProperty("h")&&t.hasOwnProperty("s")&&t.hasOwnProperty("l")&&(t.s=A(t.s),t.l=A(t.l),i=n(t.h,t.s,t.l),s=!0,a="hsl"),t.hasOwnProperty("a")&&(r=t.a)),r=w(r),{ok:s,format:t.format||a,r:L(255,R(i.r,0)),g:L(255,R(i.g,0)),b:L(255,R(i.b,0)),a:r}}function e(t,e,i){return{r:255*_(t,255),g:255*_(e,255),b:255*_(i,255)}}function i(t,e,i){t=_(t,255),e=_(e,255),i=_(i,255);var n,r,o=R(t,e,i),s=L(t,e,i),a=(o+s)/2;if(o==s)n=r=0;else{var l=o-s;switch(r=a>.5?l/(2-o-s):l/(o+s),o){case t:n=(e-i)/l+(i>e?6:0);break;case e:n=(i-t)/l+2;break;case i:n=(t-e)/l+4}n/=6}return{h:n,s:r,l:a}}function n(t,e,i){function n(t,e,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?t+6*(e-t)*i:.5>i?e:2/3>i?t+(e-t)*(2/3-i)*6:t}var r,o,s;if(t=_(t,360),e=_(e,100),i=_(i,100),0===e)r=o=s=i;else{var a=.5>i?i*(1+e):i+e-i*e,l=2*i-a;r=n(l,a,t+1/3),o=n(l,a,t),s=n(l,a,t-1/3)}return{r:255*r,g:255*o,b:255*s}}function r(t,e,i){t=_(t,255),e=_(e,255),i=_(i,255);var n,r,o=R(t,e,i),s=L(t,e,i),a=o,l=o-s;if(r=0===o?0:l/o,o==s)n=0;else{switch(o){case t:n=(e-i)/l+(i>e?6:0);break;case e:n=(i-t)/l+2;break;case i:n=(t-e)/l+4}n/=6}return{h:n,s:r,v:a}}function o(t,e,i){t=6*_(t,360),e=_(e,100),i=_(i,100);var n=M.floor(t),r=t-n,o=i*(1-e),s=i*(1-r*e),a=i*(1-(1-r)*e),l=n%6,c=[i,s,o,o,a,i][l],h=[a,i,i,s,o,o][l],u=[o,o,a,i,i,s][l];return{r:255*c,g:255*h,b:255*u}}function s(t,e,i,n){var r=[j(F(t).toString(16)),j(F(e).toString(16)),j(F(i).toString(16))];return n&&r[0].charAt(0)==r[0].charAt(1)&&r[1].charAt(0)==r[1].charAt(1)&&r[2].charAt(0)==r[2].charAt(1)?r[0].charAt(0)+r[1].charAt(0)+r[2].charAt(0):r.join("")}function a(t,e,i,n){var r=[j(I(n)),j(F(t).toString(16)),j(F(e).toString(16)),j(F(i).toString(16))];return r.join("")}function l(t,e){e=0===e?0:e||10;var i=W(t).toHsl();return i.s-=e/100,i.s=S(i.s),W(i)}function c(t,e){e=0===e?0:e||10;var i=W(t).toHsl();return i.s+=e/100,i.s=S(i.s),W(i)}function h(t){return W(t).desaturate(100)}function u(t,e){e=0===e?0:e||10;var i=W(t).toHsl();return i.l+=e/100,i.l=S(i.l),W(i)}function f(t,e){e=0===e?0:e||10;var i=W(t).toRgb();return i.r=R(0,L(255,i.r-F(255*-(e/100)))),i.g=R(0,L(255,i.g-F(255*-(e/100)))),i.b=R(0,L(255,i.b-F(255*-(e/100)))),W(i)}function d(t,e){e=0===e?0:e||10;var i=W(t).toHsl();return i.l-=e/100,i.l=S(i.l),W(i)}function p(t,e){var i=W(t).toHsl(),n=(F(i.h)+e)%360;return i.h=0>n?360+n:n,W(i)}function g(t){var e=W(t).toHsl();return e.h=(e.h+180)%360,W(e)}function v(t){var e=W(t).toHsl(),i=e.h;return[W(t),W({h:(i+120)%360,s:e.s,l:e.l}),W({h:(i+240)%360,s:e.s,l:e.l})]}function m(t){var e=W(t).toHsl(),i=e.h;return[W(t),W({h:(i+90)%360,s:e.s,l:e.l}),W({h:(i+180)%360,s:e.s,l:e.l}),W({h:(i+270)%360,s:e.s,l:e.l})]}function b(t){var e=W(t).toHsl(),i=e.h;return[W(t),W({h:(i+72)%360,s:e.s,l:e.l}),W({h:(i+216)%360,s:e.s,l:e.l})]}function y(t,e,i){e=e||6,i=i||30;var n=W(t).toHsl(),r=360/i,o=[W(t)];for(n.h=(n.h-(r*e>>1)+720)%360;--e;)n.h=(n.h+r)%360,o.push(W(n));return o}function C(t,e){e=e||6;for(var i=W(t).toHsv(),n=i.h,r=i.s,o=i.v,s=[],a=1/e;e--;)s.push(W({h:n,s:r,v:o})),o=(o+a)%1;return s}function x(t){var e={};for(var i in t)t.hasOwnProperty(i)&&(e[t[i]]=i);return e}function w(t){return t=parseFloat(t),(isNaN(t)||0>t||t>1)&&(t=1),t}function _(t,e){T(t)&&(t="100%");var i=k(t);return t=L(e,R(0,parseFloat(t))),i&&(t=parseInt(t*e,10)/100),M.abs(t-e)<1e-6?1:t%e/parseFloat(e)}function S(t){return L(1,R(0,t))}function O(t){return parseInt(t,16)}function T(t){return"string"==typeof t&&-1!=t.indexOf(".")&&1===parseFloat(t)}function k(t){return"string"==typeof t&&-1!=t.indexOf("%")}function j(t){return 1==t.length?"0"+t:""+t}function A(t){return 1>=t&&(t=100*t+"%"),t}function I(t){return Math.round(255*parseFloat(t)).toString(16)}function E(t){return O(t)/255}function $(t){t=t.replace(D,"").replace(P,"").toLowerCase();var e=!1;if(N[t])t=N[t],e=!0;else if("transparent"==t)return{r:0,g:0,b:0,a:0,format:"name"};var i;return(i=X.rgb.exec(t))?{r:i[1],g:i[2],b:i[3]}:(i=X.rgba.exec(t))?{r:i[1],g:i[2],b:i[3],a:i[4]}:(i=X.hsl.exec(t))?{h:i[1],s:i[2],l:i[3]}:(i=X.hsla.exec(t))?{h:i[1],s:i[2],l:i[3],a:i[4]}:(i=X.hsv.exec(t))?{h:i[1],s:i[2],v:i[3]}:(i=X.hsva.exec(t))?{h:i[1],s:i[2],v:i[3],a:i[4]}:(i=X.hex8.exec(t))?{a:E(i[1]),r:O(i[2]),g:O(i[3]),b:O(i[4]),format:e?"name":"hex8"}:(i=X.hex6.exec(t))?{r:O(i[1]),g:O(i[2]),b:O(i[3]),format:e?"name":"hex"}:(i=X.hex3.exec(t))?{r:O(i[1]+""+i[1]),g:O(i[2]+""+i[2]),b:O(i[3]+""+i[3]),format:e?"name":"hex"}:!1}var D=/^[\s,#]+/,P=/\s+$/,B=0,M=Math,F=M.round,L=M.min,R=M.max,H=M.random,W=function(e,i){if(e=e?e:"",i=i||{},e instanceof W)return e;if(!(this instanceof W))return new W(e,i);var n=t(e);this._originalInput=e,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=F(100*this._a)/100,this._format=i.format||n.format,this._gradientType=i.gradientType,this._r<1&&(this._r=F(this._r)),this._g<1&&(this._g=F(this._g)),this._b<1&&(this._b=F(this._b)),this._ok=n.ok,this._tc_id=B++};W.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var t=this.toRgb();return(299*t.r+587*t.g+114*t.b)/1e3},setAlpha:function(t){return this._a=w(t),this._roundA=F(100*this._a)/100,this},toHsv:function(){var t=r(this._r,this._g,this._b);return{h:360*t.h,s:t.s,v:t.v,a:this._a}},toHsvString:function(){var t=r(this._r,this._g,this._b),e=F(360*t.h),i=F(100*t.s),n=F(100*t.v);return 1==this._a?"hsv("+e+", "+i+"%, "+n+"%)":"hsva("+e+", "+i+"%, "+n+"%, "+this._roundA+")"},toHsl:function(){var t=i(this._r,this._g,this._b);return{h:360*t.h,s:t.s,l:t.l,a:this._a}},toHslString:function(){var t=i(this._r,this._g,this._b),e=F(360*t.h),n=F(100*t.s),r=F(100*t.l);return 1==this._a?"hsl("+e+", "+n+"%, "+r+"%)":"hsla("+e+", "+n+"%, "+r+"%, "+this._roundA+")"},toHex:function(t){return s(this._r,this._g,this._b,t)},toHexString:function(t){return"#"+this.toHex(t)},toHex8:function(){return a(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:F(this._r),g:F(this._g),b:F(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+F(this._r)+", "+F(this._g)+", "+F(this._b)+")":"rgba("+F(this._r)+", "+F(this._g)+", "+F(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:F(100*_(this._r,255))+"%",g:F(100*_(this._g,255))+"%",b:F(100*_(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+F(100*_(this._r,255))+"%, "+F(100*_(this._g,255))+"%, "+F(100*_(this._b,255))+"%)":"rgba("+F(100*_(this._r,255))+"%, "+F(100*_(this._g,255))+"%, "+F(100*_(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":this._a<1?!1:G[s(this._r,this._g,this._b,!0)]||!1},toFilter:function(t){var e="#"+a(this._r,this._g,this._b,this._a),i=e,n=this._gradientType?"GradientType = 1, ":"";if(t){var r=W(t);i=r.toHex8String()}return"progid:DXImageTransform.Microsoft.gradient("+n+"startColorstr="+e+",endColorstr="+i+")"},toString:function(t){var e=!!t;t=t||this._format;var i=!1,n=this._a<1&&this._a>=0,r=!e&&n&&("hex"===t||"hex6"===t||"hex3"===t||"name"===t);return r?"name"===t&&0===this._a?this.toName():this.toRgbString():("rgb"===t&&(i=this.toRgbString()),"prgb"===t&&(i=this.toPercentageRgbString()),("hex"===t||"hex6"===t)&&(i=this.toHexString()),"hex3"===t&&(i=this.toHexString(!0)),"hex8"===t&&(i=this.toHex8String()),"name"===t&&(i=this.toName()),"hsl"===t&&(i=this.toHslString()),"hsv"===t&&(i=this.toHsvString()),i||this.toHexString())},_applyModification:function(t,e){var i=t.apply(null,[this].concat([].slice.call(e)));return this._r=i._r,this._g=i._g,this._b=i._b,this.setAlpha(i._a),this},lighten:function(){return this._applyModification(u,arguments)},brighten:function(){return this._applyModification(f,arguments)},darken:function(){return this._applyModification(d,arguments)},desaturate:function(){return this._applyModification(l,arguments)},saturate:function(){return this._applyModification(c,arguments)},greyscale:function(){return this._applyModification(h,arguments)},spin:function(){return this._applyModification(p,arguments)},_applyCombination:function(t,e){return t.apply(null,[this].concat([].slice.call(e)))},analogous:function(){return this._applyCombination(y,arguments)},complement:function(){return this._applyCombination(g,arguments)},monochromatic:function(){return this._applyCombination(C,arguments)},splitcomplement:function(){return this._applyCombination(b,arguments)},triad:function(){return this._applyCombination(v,arguments)},tetrad:function(){return this._applyCombination(m,arguments)}},W.fromRatio=function(t,e){if("object"==typeof t){var i={};for(var n in t)t.hasOwnProperty(n)&&("a"===n?i[n]=t[n]:i[n]=A(t[n]));t=i}return W(t,e)},W.equals=function(t,e){return t&&e?W(t).toRgbString()==W(e).toRgbString():!1},W.random=function(){return W.fromRatio({r:H(),g:H(),b:H()})},W.mix=function(t,e,i){i=0===i?0:i||50;var n,r=W(t).toRgb(),o=W(e).toRgb(),s=i/100,a=2*s-1,l=o.a-r.a;n=a*l==-1?a:(a+l)/(1+a*l),n=(n+1)/2;var c=1-n,h={r:o.r*n+r.r*c,g:o.g*n+r.g*c,b:o.b*n+r.b*c,a:o.a*s+r.a*(1-s)};return W(h)},W.readability=function(t,e){var i=W(t),n=W(e),r=i.toRgb(),o=n.toRgb(),s=i.getBrightness(),a=n.getBrightness(),l=Math.max(r.r,o.r)-Math.min(r.r,o.r)+Math.max(r.g,o.g)-Math.min(r.g,o.g)+Math.max(r.b,o.b)-Math.min(r.b,o.b);return{brightness:Math.abs(s-a),color:l}},W.isReadable=function(t,e){var i=W.readability(t,e);return i.brightness>125&&i.color>500},W.mostReadable=function(t,e){for(var i=null,n=0,r=!1,o=0;o<e.length;o++){var s=W.readability(t,e[o]),a=s.brightness>125&&s.color>500,l=3*(s.brightness/125)+s.color/500;(a&&!r||a&&r&&l>n||!a&&!r&&l>n)&&(r=a,n=l,i=W(e[o]))}return i};var N=W.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},G=W.hexNames=x(N),X=function(){var t="[-\\+]?\\d+%?",e="[-\\+]?\\d*\\.\\d+%?",i="(?:"+e+")|(?:"+t+")",n="[\\s|\\(]+("+i+")[,|\\s]+("+i+")[,|\\s]+("+i+")\\s*\\)?",r="[\\s|\\(]+("+i+")[,|\\s]+("+i+")[,|\\s]+("+i+")[,|\\s]+("+i+")\\s*\\)?";return{rgb:new RegExp("rgb"+n),rgba:new RegExp("rgba"+r),hsl:new RegExp("hsl"+n),hsla:new RegExp("hsla"+r),hsv:new RegExp("hsv"+n),hsva:new RegExp("hsva"+r),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();window.tinycolor=W}(),t(function(){t.fn.spectrum.load&&t.fn.spectrum.processNativeColorInputs()})}),function(){!function(t){var e=this||(0,eval)("this"),i=e.document,n=e.navigator,r=e.jQuery,o=e.JSON;!function(t){"function"==typeof define&&define.amd?define(["exports","require"],t):t("function"==typeof require&&"object"==typeof exports&&"object"==typeof module?module.exports||exports:e.ko={})}(function(s,a){function l(t,e){return null===t||typeof t in d?t===e:!1}function c(e,i){var n;return function(){n||(n=setTimeout(function(){n=t,e()},i))}}function h(t,e){var i;return function(){clearTimeout(i),i=setTimeout(t,e)}}function u(t,e,i,n){f.d[t]={init:function(t,r,o,s,a){var l,c;return f.w(function(){var o=f.a.c(r()),s=!i!=!o,h=!c;(h||e||s!==l)&&(h&&f.Z.oa()&&(c=f.a.la(f.e.childNodes(t),!0)),s?(h||f.e.T(t,f.a.la(c)),f.Ja(n?n(a,o):a,t)):f.e.ma(t),l=s)},null,{q:t}),{controlsDescendantBindings:!0}}},f.h.ka[t]=!1,f.e.R[t]=!0}var f="undefined"!=typeof s?s:{};f.b=function(t,e){for(var i=t.split("."),n=f,r=0;r<i.length-1;r++)n=n[i[r]];n[i[i.length-1]]=e},f.D=function(t,e,i){t[e]=i},f.version="3.3.0",f.b("version",f.version),f.a=function(){function s(t,e){for(var i in t)t.hasOwnProperty(i)&&e(i,t[i])}function a(t,e){if(e)for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}function l(t,e){return t.__proto__=e,t}function c(t,e,i,n){var r=t[e].match(v)||[];f.a.o(i.match(v),function(t){f.a.ga(r,t,n)}),t[e]=r.join(" ")}var h={__proto__:[]}instanceof Array,u={},d={};u[n&&/Firefox\/2/i.test(n.userAgent)?"KeyboardEvent":"UIEvents"]=["keyup","keydown","keypress"],u.MouseEvents="click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave".split(" "),s(u,function(t,e){if(e.length)for(var i=0,n=e.length;n>i;i++)d[e[i]]=t});var p={propertychange:!0},g=i&&function(){for(var e=3,n=i.createElement("div"),r=n.getElementsByTagName("i");n.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->",r[0];);return e>4?e:t}(),v=/\S+/g;return{Bb:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],o:function(t,e){for(var i=0,n=t.length;n>i;i++)e(t[i],i)},m:function(t,e){if("function"==typeof Array.prototype.indexOf)return Array.prototype.indexOf.call(t,e);for(var i=0,n=t.length;n>i;i++)if(t[i]===e)return i;return-1},vb:function(t,e,i){for(var n=0,r=t.length;r>n;n++)if(e.call(i,t[n],n))return t[n];return null},ya:function(t,e){var i=f.a.m(t,e);i>0?t.splice(i,1):0===i&&t.shift()},wb:function(t){t=t||[];for(var e=[],i=0,n=t.length;n>i;i++)0>f.a.m(e,t[i])&&e.push(t[i]);return e},Ka:function(t,e){t=t||[];for(var i=[],n=0,r=t.length;r>n;n++)i.push(e(t[n],n));return i},xa:function(t,e){t=t||[];for(var i=[],n=0,r=t.length;r>n;n++)e(t[n],n)&&i.push(t[n]);return i},ia:function(t,e){if(e instanceof Array)t.push.apply(t,e);else for(var i=0,n=e.length;n>i;i++)t.push(e[i]);return t},ga:function(t,e,i){var n=f.a.m(f.a.cb(t),e);0>n?i&&t.push(e):i||t.splice(n,1)},za:h,extend:a,Fa:l,Ga:h?l:a,A:s,pa:function(t,e){if(!t)return t;var i,n={};for(i in t)t.hasOwnProperty(i)&&(n[i]=e(t[i],i,t));return n},Ra:function(t){for(;t.firstChild;)f.removeNode(t.firstChild)},Jb:function(t){t=f.a.O(t);for(var e=(t[0]&&t[0].ownerDocument||i).createElement("div"),n=0,r=t.length;r>n;n++)e.appendChild(f.S(t[n]));return e},la:function(t,e){for(var i=0,n=t.length,r=[];n>i;i++){var o=t[i].cloneNode(!0);r.push(e?f.S(o):o)}return r},T:function(t,e){if(f.a.Ra(t),e)for(var i=0,n=e.length;n>i;i++)t.appendChild(e[i])},Qb:function(t,e){var i=t.nodeType?[t]:t;if(0<i.length){for(var n=i[0],r=n.parentNode,o=0,s=e.length;s>o;o++)r.insertBefore(e[o],n);for(o=0,s=i.length;s>o;o++)f.removeNode(i[o])}},na:function(t,e){if(t.length){for(e=8===e.nodeType&&e.parentNode||e;t.length&&t[0].parentNode!==e;)t.splice(0,1);if(1<t.length){var i=t[0],n=t[t.length-1];for(t.length=0;i!==n;)if(t.push(i),i=i.nextSibling,!i)return;t.push(n)}}return t},Sb:function(t,e){7>g?t.setAttribute("selected",e):t.selected=e},ib:function(e){return null===e||e===t?"":e.trim?e.trim():e.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},Dc:function(t,e){return t=t||"",e.length>t.length?!1:t.substring(0,e.length)===e},jc:function(t,e){if(t===e)return!0;if(11===t.nodeType)return!1;if(e.contains)return e.contains(3===t.nodeType?t.parentNode:t);if(e.compareDocumentPosition)return 16==(16&e.compareDocumentPosition(t));for(;t&&t!=e;)t=t.parentNode;return!!t},Qa:function(t){return f.a.jc(t,t.ownerDocument.documentElement)},tb:function(t){return!!f.a.vb(t,f.a.Qa)},v:function(t){return t&&t.tagName&&t.tagName.toLowerCase()},n:function(t,e,i){var n=g&&p[e];if(!n&&r)r(t).bind(e,i);else if(n||"function"!=typeof t.addEventListener){if("undefined"==typeof t.attachEvent)throw Error("Browser doesn't support addEventListener or attachEvent");var o=function(e){i.call(t,e)},s="on"+e;t.attachEvent(s,o),f.a.C.fa(t,function(){t.detachEvent(s,o)})}else t.addEventListener(e,i,!1)},qa:function(t,n){if(!t||!t.nodeType)throw Error("element must be a DOM node when calling triggerEvent");var o;if("input"===f.a.v(t)&&t.type&&"click"==n.toLowerCase()?(o=t.type,o="checkbox"==o||"radio"==o):o=!1,r&&!o)r(t).trigger(n);else if("function"==typeof i.createEvent){if("function"!=typeof t.dispatchEvent)throw Error("The supplied element doesn't support dispatchEvent");o=i.createEvent(d[n]||"HTMLEvents"),o.initEvent(n,!0,!0,e,0,0,0,0,0,!1,!1,!1,!1,0,t),t.dispatchEvent(o)}else if(o&&t.click)t.click();else{if("undefined"==typeof t.fireEvent)throw Error("Browser doesn't support triggering events");t.fireEvent("on"+n)}},c:function(t){return f.F(t)?t():t},cb:function(t){return f.F(t)?t.B():t},Ia:function(t,e,i){var n;e&&("object"==typeof t.classList?(n=t.classList[i?"add":"remove"],f.a.o(e.match(v),function(e){n.call(t.classList,e)})):"string"==typeof t.className.baseVal?c(t.className,"baseVal",e,i):c(t,"className",e,i))},Ha:function(e,i){var n=f.a.c(i);(null===n||n===t)&&(n="");var r=f.e.firstChild(e);!r||3!=r.nodeType||f.e.nextSibling(r)?f.e.T(e,[e.ownerDocument.createTextNode(n)]):r.data=n,f.a.mc(e)},Rb:function(t,e){if(t.name=e,7>=g)try{t.mergeAttributes(i.createElement("<input name='"+t.name+"'/>"),!1)}catch(n){}},mc:function(t){g>=9&&(t=1==t.nodeType?t:t.parentNode,t.style&&(t.style.zoom=t.style.zoom))},kc:function(t){if(g){var e=t.style.width;t.style.width=0,t.style.width=e}},Bc:function(t,e){t=f.a.c(t),e=f.a.c(e);for(var i=[],n=t;e>=n;n++)i.push(n);return i},O:function(t){for(var e=[],i=0,n=t.length;n>i;i++)e.push(t[i]);return e},Hc:6===g,Ic:7===g,M:g,Db:function(t,e){for(var i=f.a.O(t.getElementsByTagName("input")).concat(f.a.O(t.getElementsByTagName("textarea"))),n="string"==typeof e?function(t){return t.name===e}:function(t){return e.test(t.name)},r=[],o=i.length-1;o>=0;o--)n(i[o])&&r.push(i[o]);return r},yc:function(t){return"string"==typeof t&&(t=f.a.ib(t))?o&&o.parse?o.parse(t):new Function("return "+t)():null},jb:function(t,e,i){if(!o||!o.stringify)throw Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");return o.stringify(f.a.c(t),e,i)},zc:function(t,e,n){n=n||{};var r=n.params||{},o=n.includeFields||this.Bb,a=t;if("object"==typeof t&&"form"===f.a.v(t))for(var a=t.action,l=o.length-1;l>=0;l--)for(var c=f.a.Db(t,o[l]),h=c.length-1;h>=0;h--)r[c[h].name]=c[h].value;e=f.a.c(e);var u=i.createElement("form");u.style.display="none",u.action=a,u.method="post";for(var d in e)t=i.createElement("input"),t.type="hidden",t.name=d,t.value=f.a.jb(f.a.c(e[d])),u.appendChild(t);s(r,function(t,e){var n=i.createElement("input");n.type="hidden",n.name=t,n.value=e,u.appendChild(n)}),i.body.appendChild(u),n.submitter?n.submitter(u):u.submit(),setTimeout(function(){u.parentNode.removeChild(u)},0)}}}(),f.b("utils",f.a),f.b("utils.arrayForEach",f.a.o),f.b("utils.arrayFirst",f.a.vb),f.b("utils.arrayFilter",f.a.xa),f.b("utils.arrayGetDistinctValues",f.a.wb),f.b("utils.arrayIndexOf",f.a.m),f.b("utils.arrayMap",f.a.Ka),f.b("utils.arrayPushAll",f.a.ia),f.b("utils.arrayRemoveItem",f.a.ya),f.b("utils.extend",f.a.extend),f.b("utils.fieldsIncludedWithJsonPost",f.a.Bb),f.b("utils.getFormFields",f.a.Db),f.b("utils.peekObservable",f.a.cb),f.b("utils.postJson",f.a.zc),f.b("utils.parseJson",f.a.yc),f.b("utils.registerEventHandler",f.a.n),f.b("utils.stringifyJson",f.a.jb),f.b("utils.range",f.a.Bc),f.b("utils.toggleDomNodeCssClass",f.a.Ia),f.b("utils.triggerEvent",f.a.qa),f.b("utils.unwrapObservable",f.a.c),f.b("utils.objectForEach",f.a.A),f.b("utils.addOrRemoveItem",f.a.ga),f.b("utils.setTextContent",f.a.Ha),f.b("unwrap",f.a.c),Function.prototype.bind||(Function.prototype.bind=function(t){var e=this;if(1===arguments.length)return function(){return e.apply(t,arguments)};var i=Array.prototype.slice.call(arguments,1);return function(){var n=i.slice(0);return n.push.apply(n,arguments),e.apply(t,n)}}),f.a.f=new function(){function e(e,o){var s=e[n];if(!s||"null"===s||!r[s]){if(!o)return t;s=e[n]="ko"+i++,r[s]={}}return r[s]}var i=0,n="__ko__"+(new Date).getTime(),r={};return{get:function(i,n){var r=e(i,!1);return r===t?t:r[n]},set:function(i,n,r){(r!==t||e(i,!1)!==t)&&(e(i,!0)[n]=r)},clear:function(t){var e=t[n];return e?(delete r[e],t[n]=null,!0):!1},I:function(){return i++ +n}}},f.b("utils.domData",f.a.f),f.b("utils.domData.clear",f.a.f.clear),f.a.C=new function(){function e(e,i){var r=f.a.f.get(e,n);return r===t&&i&&(r=[],f.a.f.set(e,n,r)),r}function i(t){var n=e(t,!1);if(n)for(var n=n.slice(0),r=0;r<n.length;r++)n[r](t);if(f.a.f.clear(t),f.a.C.cleanExternalData(t),s[t.nodeType])for(n=t.firstChild;t=n;)n=t.nextSibling,8===t.nodeType&&i(t)}var n=f.a.f.I(),o={1:!0,8:!0,9:!0},s={1:!0,9:!0};return{fa:function(t,i){if("function"!=typeof i)throw Error("Callback must be a function");e(t,!0).push(i)},Pb:function(i,r){var o=e(i,!1);o&&(f.a.ya(o,r),0==o.length&&f.a.f.set(i,n,t))},S:function(t){if(o[t.nodeType]&&(i(t),s[t.nodeType])){var e=[];f.a.ia(e,t.getElementsByTagName("*"));for(var n=0,r=e.length;r>n;n++)i(e[n])}return t},removeNode:function(t){f.S(t),t.parentNode&&t.parentNode.removeChild(t)},cleanExternalData:function(t){r&&"function"==typeof r.cleanData&&r.cleanData([t])}}},f.S=f.a.C.S,f.removeNode=f.a.C.removeNode,f.b("cleanNode",f.S),f.b("removeNode",f.removeNode),f.b("utils.domNodeDisposal",f.a.C),f.b("utils.domNodeDisposal.addDisposeCallback",f.a.C.fa),f.b("utils.domNodeDisposal.removeDisposeCallback",f.a.C.Pb),function(){f.a.ca=function(t,n){var o;if(r){if(r.parseHTML)o=r.parseHTML(t,n)||[];else if((o=r.clean([t],n))&&o[0]){for(var s=o[0];s.parentNode&&11!==s.parentNode.nodeType;)s=s.parentNode;s.parentNode&&s.parentNode.removeChild(s)}}else{(s=n)||(s=i),o=s.parentWindow||s.defaultView||e;var a=f.a.ib(t).toLowerCase(),s=s.createElement("div"),a=a.match(/^<(thead|tbody|tfoot)/)&&[1,"<table>","</table>"]||!a.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!a.indexOf("<td")||!a.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||[0,"",""],l="ignored<div>"+a[1]+t+a[2]+"</div>";for("function"==typeof o.innerShiv?s.appendChild(o.innerShiv(l)):s.innerHTML=l;a[0]--;)s=s.lastChild;o=f.a.O(s.lastChild.childNodes)}return o},f.a.gb=function(e,i){if(f.a.Ra(e),
i=f.a.c(i),null!==i&&i!==t)if("string"!=typeof i&&(i=i.toString()),r)r(e).html(i);else for(var n=f.a.ca(i,e.ownerDocument),o=0;o<n.length;o++)e.appendChild(n[o])}}(),f.b("utils.parseHtmlFragment",f.a.ca),f.b("utils.setHtml",f.a.gb),f.H=function(){function e(t,i){if(t)if(8==t.nodeType){var n=f.H.Lb(t.nodeValue);null!=n&&i.push({ic:t,wc:n})}else if(1==t.nodeType)for(var n=0,r=t.childNodes,o=r.length;o>n;n++)e(r[n],i)}var i={};return{$a:function(t){if("function"!=typeof t)throw Error("You can only pass a function to ko.memoization.memoize()");var e=(4294967296*(1+Math.random())|0).toString(16).substring(1)+(4294967296*(1+Math.random())|0).toString(16).substring(1);return i[e]=t,"<!--[ko_memo:"+e+"]-->"},Wb:function(e,n){var r=i[e];if(r===t)throw Error("Couldn't find any memo with ID "+e+". Perhaps it's already been unmemoized.");try{return r.apply(null,n||[]),!0}finally{delete i[e]}},Xb:function(t,i){var n=[];e(t,n);for(var r=0,o=n.length;o>r;r++){var s=n[r].ic,a=[s];i&&f.a.ia(a,i),f.H.Wb(n[r].wc,a),s.nodeValue="",s.parentNode&&s.parentNode.removeChild(s)}},Lb:function(t){return(t=t.match(/^\[ko_memo\:(.*?)\]$/))?t[1]:null}}}(),f.b("memoization",f.H),f.b("memoization.memoize",f.H.$a),f.b("memoization.unmemoize",f.H.Wb),f.b("memoization.parseMemoText",f.H.Lb),f.b("memoization.unmemoizeDomNodeAndDescendants",f.H.Xb),f.Sa={throttle:function(t,e){t.throttleEvaluation=e;var i=null;return f.j({read:t,write:function(n){clearTimeout(i),i=setTimeout(function(){t(n)},e)}})},rateLimit:function(t,e){var i,n,r;"number"==typeof e?i=e:(i=e.timeout,n=e.method),r="notifyWhenChangesStop"==n?h:c,t.Za(function(t){return r(t,i)})},notify:function(t,e){t.equalityComparer="always"==e?null:l}};var d={undefined:1,"boolean":1,number:1,string:1};f.b("extenders",f.Sa),f.Ub=function(t,e,i){this.da=t,this.La=e,this.hc=i,this.Gb=!1,f.D(this,"dispose",this.p)},f.Ub.prototype.p=function(){this.Gb=!0,this.hc()},f.Q=function(){f.a.Ga(this,f.Q.fn),this.G={},this.rb=1};var p={U:function(t,e,i){var n=this;i=i||"change";var r=new f.Ub(n,e?t.bind(e):t,function(){f.a.ya(n.G[i],r),n.ua&&n.ua(i)});return n.ja&&n.ja(i),n.G[i]||(n.G[i]=[]),n.G[i].push(r),r},notifySubscribers:function(t,e){if(e=e||"change","change"===e&&this.Yb(),this.Ba(e))try{f.k.xb();for(var i,n=this.G[e].slice(0),r=0;i=n[r];++r)i.Gb||i.La(t)}finally{f.k.end()}},Aa:function(){return this.rb},pc:function(t){return this.Aa()!==t},Yb:function(){++this.rb},Za:function(t){var e,i,n,r=this,o=f.F(r);r.ta||(r.ta=r.notifySubscribers,r.notifySubscribers=function(t,e){e&&"change"!==e?"beforeChange"===e?r.pb(t):r.ta(t,e):r.qb(t)});var s=t(function(){o&&n===r&&(n=r()),e=!1,r.Wa(i,n)&&r.ta(i=n)});r.qb=function(t){e=!0,n=t,s()},r.pb=function(t){e||(i=t,r.ta(t,"beforeChange"))}},Ba:function(t){return this.G[t]&&this.G[t].length},nc:function(t){if(t)return this.G[t]&&this.G[t].length||0;var e=0;return f.a.A(this.G,function(t,i){e+=i.length}),e},Wa:function(t,e){return!this.equalityComparer||!this.equalityComparer(t,e)},extend:function(t){var e=this;return t&&f.a.A(t,function(t,i){var n=f.Sa[t];"function"==typeof n&&(e=n(e,i)||e)}),e}};f.D(p,"subscribe",p.U),f.D(p,"extend",p.extend),f.D(p,"getSubscriptionsCount",p.nc),f.a.za&&f.a.Fa(p,Function.prototype),f.Q.fn=p,f.Hb=function(t){return null!=t&&"function"==typeof t.U&&"function"==typeof t.notifySubscribers},f.b("subscribable",f.Q),f.b("isSubscribable",f.Hb),f.Z=f.k=function(){function t(t){n.push(i),i=t}function e(){i=n.pop()}var i,n=[],r=0;return{xb:t,end:e,Ob:function(t){if(i){if(!f.Hb(t))throw Error("Only subscribable things can act as dependencies");i.La(t,t.ac||(t.ac=++r))}},u:function(i,n,r){try{return t(),i.apply(n,r||[])}finally{e()}},oa:function(){return i?i.w.oa():void 0},Ca:function(){return i?i.Ca:void 0}}}(),f.b("computedContext",f.Z),f.b("computedContext.getDependenciesCount",f.Z.oa),f.b("computedContext.isInitial",f.Z.Ca),f.b("computedContext.isSleeping",f.Z.Jc),f.b("ignoreDependencies",f.Gc=f.k.u),f.r=function(t){function e(){return 0<arguments.length?(e.Wa(i,arguments[0])&&(e.X(),i=arguments[0],e.W()),this):(f.k.Ob(e),i)}var i=t;return f.Q.call(e),f.a.Ga(e,f.r.fn),e.B=function(){return i},e.W=function(){e.notifySubscribers(i)},e.X=function(){e.notifySubscribers(i,"beforeChange")},f.D(e,"peek",e.B),f.D(e,"valueHasMutated",e.W),f.D(e,"valueWillMutate",e.X),e},f.r.fn={equalityComparer:l};var g=f.r.Ac="__ko_proto__";f.r.fn[g]=f.r,f.a.za&&f.a.Fa(f.r.fn,f.Q.fn),f.Ta=function(e,i){return null===e||e===t||e[g]===t?!1:e[g]===i?!0:f.Ta(e[g],i)},f.F=function(t){return f.Ta(t,f.r)},f.Da=function(t){return"function"==typeof t&&t[g]===f.r||"function"==typeof t&&t[g]===f.j&&t.qc?!0:!1},f.b("observable",f.r),f.b("isObservable",f.F),f.b("isWriteableObservable",f.Da),f.b("isWritableObservable",f.Da),f.ba=function(t){if(t=t||[],"object"!=typeof t||!("length"in t))throw Error("The argument passed when initializing an observable array must be an array, or null, or undefined.");return t=f.r(t),f.a.Ga(t,f.ba.fn),t.extend({trackArrayChanges:!0})},f.ba.fn={remove:function(t){for(var e=this.B(),i=[],n="function"!=typeof t||f.F(t)?function(e){return e===t}:t,r=0;r<e.length;r++){var o=e[r];n(o)&&(0===i.length&&this.X(),i.push(o),e.splice(r,1),r--)}return i.length&&this.W(),i},removeAll:function(e){if(e===t){var i=this.B(),n=i.slice(0);return this.X(),i.splice(0,i.length),this.W(),n}return e?this.remove(function(t){return 0<=f.a.m(e,t)}):[]},destroy:function(t){var e=this.B(),i="function"!=typeof t||f.F(t)?function(e){return e===t}:t;this.X();for(var n=e.length-1;n>=0;n--)i(e[n])&&(e[n]._destroy=!0);this.W()},destroyAll:function(e){return e===t?this.destroy(function(){return!0}):e?this.destroy(function(t){return 0<=f.a.m(e,t)}):[]},indexOf:function(t){var e=this();return f.a.m(e,t)},replace:function(t,e){var i=this.indexOf(t);i>=0&&(this.X(),this.B()[i]=e,this.W())}},f.a.o("pop push reverse shift sort splice unshift".split(" "),function(t){f.ba.fn[t]=function(){var e=this.B();return this.X(),this.yb(e,t,arguments),e=e[t].apply(e,arguments),this.W(),e}}),f.a.o(["slice"],function(t){f.ba.fn[t]=function(){var e=this();return e[t].apply(e,arguments)}}),f.a.za&&f.a.Fa(f.ba.fn,f.r.fn),f.b("observableArray",f.ba),f.Sa.trackArrayChanges=function(t){function e(){if(!n){n=!0;var e=t.notifySubscribers;t.notifySubscribers=function(t,i){return i&&"change"!==i||++o,e.apply(this,arguments)};var s=[].concat(t.B()||[]);r=null,i=t.U(function(e){if(e=[].concat(e||[]),t.Ba("arrayChange")){var i;(!r||o>1)&&(r=f.a.Ma(s,e,{sparse:!0})),i=r}s=e,r=null,o=0,i&&i.length&&t.notifySubscribers(i,"arrayChange")})}}if(!t.yb){var i,n=!1,r=null,o=0,s=t.ja,a=t.ua;t.ja=function(i){s&&s.call(t,i),"arrayChange"===i&&e()},t.ua=function(e){a&&a.call(t,e),"arrayChange"!==e||t.Ba("arrayChange")||(i.p(),n=!1)},t.yb=function(t,e,i){function s(t,e,i){return a[a.length]={status:t,value:e,index:i}}if(n&&!o){var a=[],l=t.length,c=i.length,h=0;switch(e){case"push":h=l;case"unshift":for(e=0;c>e;e++)s("added",i[e],h+e);break;case"pop":h=l-1;case"shift":l&&s("deleted",t[h],h);break;case"splice":e=Math.min(Math.max(0,0>i[0]?l+i[0]:i[0]),l);for(var l=1===c?l:Math.min(e+(i[1]||0),l),c=e+c-2,h=Math.max(l,c),u=[],d=[],p=2;h>e;++e,++p)l>e&&d.push(s("deleted",t[e],e)),c>e&&u.push(s("added",i[p],e));f.a.Cb(d,u);break;default:return}r=a}}}},f.w=f.j=function(e,i,n){function r(t,e,i){if(C&&e===c)throw Error("A 'pure' computed must not be called recursively");k[t]=i,i.sa=j++,i.ea=e.Aa()}function o(){var t,e;for(t in k)if(k.hasOwnProperty(t)&&(e=k[t],e.da.pc(e.ea)))return!0}function s(){!x&&k&&f.a.A(k,function(t,e){e.p&&e.p()}),k=null,j=0,b=!0,x=g=!1}function a(){var t=c.throttleEvaluation;t&&t>=0?(clearTimeout(A),A=setTimeout(function(){l(!0)},t)):c.nb?c.nb():l(!0)}function l(e){if(!v&&!b){if(O&&O()){if(!m)return void T()}else m=!1;v=!0;try{var n=k,o=j,s=C?t:!j;f.k.xb({La:function(t,e){b||(o&&n[e]?(r(e,t,n[e]),delete n[e],--o):k[e]||r(e,t,x?{da:t}:t.U(a)))},w:c,Ca:s}),k={},j=0;try{var l=i?y.call(i):y()}finally{f.k.end(),o&&!x&&f.a.A(n,function(t,e){e.p&&e.p()}),g=!1}c.Wa(p,l)&&(x||d(p,"beforeChange"),p=l,x?c.Yb():e&&d(p)),s&&d(p,"awake")}finally{v=!1}j||T()}}function c(){if(0<arguments.length){if("function"!=typeof w)throw Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return w.apply(i,arguments),this}return f.k.Ob(c),(g||x&&o())&&l(),p}function h(){return(g&&!j||x&&o())&&l(),p}function u(){return g||j>0}function d(t,e){c.notifySubscribers(t,e)}var p,g=!0,v=!1,m=!1,b=!1,y=e,C=!1,x=!1;if(y&&"object"==typeof y?(n=y,y=n.read):(n=n||{},y||(y=n.read)),"function"!=typeof y)throw Error("Pass a function that returns the value of the ko.computed");var w=n.write,_=n.disposeWhenNodeIsRemoved||n.q||null,S=n.disposeWhen||n.Pa,O=S,T=s,k={},j=0,A=null;i||(i=n.owner),f.Q.call(c),f.a.Ga(c,f.j.fn),c.B=h,c.oa=function(){return j},c.qc="function"==typeof w,c.p=function(){T()},c.$=u;var I=c.Za;return c.Za=function(t){I.call(c,t),c.nb=function(){c.pb(p),g=!0,c.qb(c)}},n.pure?(x=C=!0,c.ja=function(t){if(!b&&x&&"change"==t){if(x=!1,g||o())k=null,j=0,g=!0,l();else{var e=[];f.a.A(k,function(t,i){e[i.sa]=t}),f.a.o(e,function(t,e){var i=k[t],n=i.da.U(a);n.sa=e,n.ea=i.ea,k[t]=n})}b||d(p,"awake")}},c.ua=function(e){b||"change"!=e||c.Ba("change")||(f.a.A(k,function(t,e){e.p&&(k[t]={da:e.da,sa:e.sa,ea:e.ea},e.p())}),x=!0,d(t,"asleep"))},c.bc=c.Aa,c.Aa=function(){return x&&(g||o())&&l(),c.bc()}):n.deferEvaluation&&(c.ja=function(t){"change"!=t&&"beforeChange"!=t||h()}),f.D(c,"peek",c.B),f.D(c,"dispose",c.p),f.D(c,"isActive",c.$),f.D(c,"getDependenciesCount",c.oa),_&&(m=!0,_.nodeType&&(O=function(){return!f.a.Qa(_)||S&&S()})),x||n.deferEvaluation||l(),_&&u()&&_.nodeType&&(T=function(){f.a.C.Pb(_,T),s()},f.a.C.fa(_,T)),c},f.sc=function(t){return f.Ta(t,f.j)},p=f.r.Ac,f.j[p]=f.r,f.j.fn={equalityComparer:l},f.j.fn[p]=f.j,f.a.za&&f.a.Fa(f.j.fn,f.Q.fn),f.b("dependentObservable",f.j),f.b("computed",f.j),f.b("isComputed",f.sc),f.Nb=function(t,e){return"function"==typeof t?f.w(t,e,{pure:!0}):(t=f.a.extend({},t),t.pure=!0,f.w(t,e))},f.b("pureComputed",f.Nb),function(){function e(r,o,s){if(s=s||new n,r=o(r),"object"!=typeof r||null===r||r===t||r instanceof Date||r instanceof String||r instanceof Number||r instanceof Boolean)return r;var a=r instanceof Array?[]:{};return s.save(r,a),i(r,function(i){var n=o(r[i]);switch(typeof n){case"boolean":case"number":case"string":case"function":a[i]=n;break;case"object":case"undefined":var l=s.get(n);a[i]=l!==t?l:e(n,o,s)}}),a}function i(t,e){if(t instanceof Array){for(var i=0;i<t.length;i++)e(i);"function"==typeof t.toJSON&&e("toJSON")}else for(i in t)e(i)}function n(){this.keys=[],this.mb=[]}f.Vb=function(t){if(0==arguments.length)throw Error("When calling ko.toJS, pass the object you want to convert.");return e(t,function(t){for(var e=0;f.F(t)&&10>e;e++)t=t();return t})},f.toJSON=function(t,e,i){return t=f.Vb(t),f.a.jb(t,e,i)},n.prototype={save:function(t,e){var i=f.a.m(this.keys,t);i>=0?this.mb[i]=e:(this.keys.push(t),this.mb.push(e))},get:function(e){return e=f.a.m(this.keys,e),e>=0?this.mb[e]:t}}}(),f.b("toJS",f.Vb),f.b("toJSON",f.toJSON),function(){f.i={s:function(e){switch(f.a.v(e)){case"option":return!0===e.__ko__hasDomDataOptionValue__?f.a.f.get(e,f.d.options.ab):7>=f.a.M?e.getAttributeNode("value")&&e.getAttributeNode("value").specified?e.value:e.text:e.value;case"select":return 0<=e.selectedIndex?f.i.s(e.options[e.selectedIndex]):t;default:return e.value}},Y:function(e,i,n){switch(f.a.v(e)){case"option":switch(typeof i){case"string":f.a.f.set(e,f.d.options.ab,t),"__ko__hasDomDataOptionValue__"in e&&delete e.__ko__hasDomDataOptionValue__,e.value=i;break;default:f.a.f.set(e,f.d.options.ab,i),e.__ko__hasDomDataOptionValue__=!0,e.value="number"==typeof i?i:""}break;case"select":(""===i||null===i)&&(i=t);for(var r,o=-1,s=0,a=e.options.length;a>s;++s)if(r=f.i.s(e.options[s]),r==i||""==r&&i===t){o=s;break}(n||o>=0||i===t&&1<e.size)&&(e.selectedIndex=o);break;default:(null===i||i===t)&&(i=""),e.value=i}}}}(),f.b("selectExtensions",f.i),f.b("selectExtensions.readValue",f.i.s),f.b("selectExtensions.writeValue",f.i.Y),f.h=function(){function t(t){t=f.a.ib(t),123===t.charCodeAt(0)&&(t=t.slice(1,-1));var e,i=[],s=t.match(n),a=[],l=0;if(s){s.push(",");for(var c,h=0;c=s[h];++h){var u=c.charCodeAt(0);if(44===u){if(0>=l){i.push(e&&a.length?{key:e,value:a.join("")}:{unknown:e||a.join("")}),e=l=0,a=[];continue}}else if(58===u){if(!l&&!e&&1===a.length){e=a.pop();continue}}else 47===u&&h&&1<c.length?(u=s[h-1].match(r))&&!o[u[0]]&&(t=t.substr(t.indexOf(c)+1),s=t.match(n),s.push(","),h=-1,c="/"):40===u||123===u||91===u?++l:41===u||125===u||93===u?--l:e||a.length||34!==u&&39!==u||(c=c.slice(1,-1));a.push(c)}}return i}var e=["true","false","null","undefined"],i=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i,n=RegExp("\"(?:[^\"\\\\]|\\\\.)*\"|'(?:[^'\\\\]|\\\\.)*'|/(?:[^/\\\\]|\\\\.)*/w*|[^\\s:,/][^,\"'{}()/:[\\]]*[^\\s,\"'{}()/:[\\]]|[^\\s]","g"),r=/[\])"'A-Za-z0-9_$]+$/,o={"in":1,"return":1,"typeof":1},s={};return{ka:[],V:s,bb:t,Ea:function(n,r){function o(t,n){var r;if(!h){var u=f.getBindingHandler(t);if(u&&u.preprocess&&!(n=u.preprocess(n,t,o)))return;(u=s[t])&&(r=n,0<=f.a.m(e,r)?r=!1:(u=r.match(i),r=null===u?!1:u[1]?"Object("+u[1]+")"+u[2]:r),u=r),u&&l.push("'"+t+"':function(_z){"+r+"=_z}")}c&&(n="function(){return "+n+" }"),a.push("'"+t+"':"+n)}r=r||{};var a=[],l=[],c=r.valueAccessors,h=r.bindingParams,u="string"==typeof n?t(n):n;return f.a.o(u,function(t){o(t.key||t.unknown,t.value)}),l.length&&o("_ko_property_writers","{"+l.join(",")+" }"),a.join(",")},vc:function(t,e){for(var i=0;i<t.length;i++)if(t[i].key==e)return!0;return!1},ra:function(t,e,i,n,r){t&&f.F(t)?!f.Da(t)||r&&t.B()===n||t(n):(t=e.get("_ko_property_writers"))&&t[i]&&t[i](n)}}}(),f.b("expressionRewriting",f.h),f.b("expressionRewriting.bindingRewriteValidators",f.h.ka),f.b("expressionRewriting.parseObjectLiteral",f.h.bb),f.b("expressionRewriting.preProcessBindings",f.h.Ea),f.b("expressionRewriting._twoWayBindings",f.h.V),f.b("jsonExpressionRewriting",f.h),f.b("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",f.h.Ea),function(){function t(t){return 8==t.nodeType&&s.test(o?t.text:t.nodeValue)}function e(t){return 8==t.nodeType&&a.test(o?t.text:t.nodeValue)}function n(i,n){for(var r=i,o=1,s=[];r=r.nextSibling;){if(e(r)&&(o--,0===o))return s;s.push(r),t(r)&&o++}if(!n)throw Error("Cannot find closing comment tag to match: "+i.nodeValue);return null}function r(t,e){var i=n(t,e);return i?0<i.length?i[i.length-1].nextSibling:t.nextSibling:null}var o=i&&"<!--test-->"===i.createComment("test").text,s=o?/^\x3c!--\s*ko(?:\s+([\s\S]+))?\s*--\x3e$/:/^\s*ko(?:\s+([\s\S]+))?\s*$/,a=o?/^\x3c!--\s*\/ko\s*--\x3e$/:/^\s*\/ko\s*$/,l={ul:!0,ol:!0};f.e={R:{},childNodes:function(e){return t(e)?n(e):e.childNodes},ma:function(e){if(t(e)){e=f.e.childNodes(e);for(var i=0,n=e.length;n>i;i++)f.removeNode(e[i])}else f.a.Ra(e)},T:function(e,i){if(t(e)){f.e.ma(e);for(var n=e.nextSibling,r=0,o=i.length;o>r;r++)n.parentNode.insertBefore(i[r],n)}else f.a.T(e,i)},Mb:function(e,i){t(e)?e.parentNode.insertBefore(i,e.nextSibling):e.firstChild?e.insertBefore(i,e.firstChild):e.appendChild(i)},Fb:function(e,i,n){n?t(e)?e.parentNode.insertBefore(i,n.nextSibling):n.nextSibling?e.insertBefore(i,n.nextSibling):e.appendChild(i):f.e.Mb(e,i)},firstChild:function(i){return t(i)?!i.nextSibling||e(i.nextSibling)?null:i.nextSibling:i.firstChild},nextSibling:function(i){return t(i)&&(i=r(i)),i.nextSibling&&e(i.nextSibling)?null:i.nextSibling},oc:t,Fc:function(t){return(t=(o?t.text:t.nodeValue).match(s))?t[1]:null},Kb:function(i){if(l[f.a.v(i)]){var n=i.firstChild;if(n)do if(1===n.nodeType){var o;o=n.firstChild;var s=null;if(o)do if(s)s.push(o);else if(t(o)){var a=r(o,!0);a?o=a:s=[o]}else e(o)&&(s=[o]);while(o=o.nextSibling);if(o=s)for(s=n.nextSibling,a=0;a<o.length;a++)s?i.insertBefore(o[a],s):i.appendChild(o[a])}while(n=n.nextSibling)}}}}(),f.b("virtualElements",f.e),f.b("virtualElements.allowedBindings",f.e.R),f.b("virtualElements.emptyNode",f.e.ma),f.b("virtualElements.insertAfter",f.e.Fb),f.b("virtualElements.prepend",f.e.Mb),f.b("virtualElements.setDomNodeChildren",f.e.T),function(){f.L=function(){this.ec={}},f.a.extend(f.L.prototype,{nodeHasBindings:function(t){switch(t.nodeType){case 1:return null!=t.getAttribute("data-bind")||f.g.getComponentNameForNode(t);case 8:return f.e.oc(t);default:return!1}},getBindings:function(t,e){var i=this.getBindingsString(t,e),i=i?this.parseBindingsString(i,e,t):null;return f.g.sb(i,t,e,!1)},getBindingAccessors:function(t,e){var i=this.getBindingsString(t,e),i=i?this.parseBindingsString(i,e,t,{valueAccessors:!0}):null;return f.g.sb(i,t,e,!0)},getBindingsString:function(t){switch(t.nodeType){case 1:return t.getAttribute("data-bind");case 8:return f.e.Fc(t);default:return null}},parseBindingsString:function(t,e,i,n){try{var r,o=this.ec,s=t+(n&&n.valueAccessors||"");if(!(r=o[s])){var a,l="with($context){with($data||{}){return{"+f.h.Ea(t,n)+"}}}";a=new Function("$context","$element",l),r=o[s]=a}return r(e,i)}catch(c){throw c.message="Unable to parse bindings.\nBindings value: "+t+"\nMessage: "+c.message,c}}}),f.L.instance=new f.L}(),f.b("bindingProvider",f.L),function(){function i(t){return function(){return t}}function n(t){return t()}function o(t){return f.a.pa(f.k.u(t),function(e,i){return function(){return t()[i]}})}function s(t,e,n){return"function"==typeof t?o(t.bind(null,e,n)):f.a.pa(t,i)}function a(t,e){return o(this.getBindings.bind(this,t,e))}function l(t,e,i){var n,r=f.e.firstChild(e),o=f.L.instance,s=o.preprocessNode;if(s){for(;n=r;)r=f.e.nextSibling(n),s.call(o,n);r=f.e.firstChild(e)}for(;n=r;)r=f.e.nextSibling(n),c(t,n,i)}function c(t,e,i){var n=!0,r=1===e.nodeType;r&&f.e.Kb(e),(r&&i||f.L.instance.nodeHasBindings(e))&&(n=u(e,null,t,i).shouldBindDescendants),n&&!p[f.a.v(e)]&&l(t,e,!r)}function h(t){var e=[],i={},n=[];return f.a.A(t,function r(o){if(!i[o]){var s=f.getBindingHandler(o);s&&(s.after&&(n.push(o),f.a.o(s.after,function(e){if(t[e]){if(-1!==f.a.m(n,e))throw Error("Cannot combine the following bindings, because they have a cyclic dependency: "+n.join(", "));r(e)}}),n.length--),e.push({key:o,Eb:s})),i[o]=!0}}),e}function u(e,i,r,o){var s=f.a.f.get(e,g);if(!i){if(s)throw Error("You cannot apply bindings multiple times to the same element.");f.a.f.set(e,g,!0)}!s&&o&&f.Tb(e,r);var l;if(i&&"function"!=typeof i)l=i;else{var c=f.L.instance,u=c.getBindingAccessors||a,d=f.j(function(){return(l=i?i(r,e):u.call(c,e,r))&&r.K&&r.K(),l},null,{q:e});l&&d.$()||(d=null)}var p;if(l){var v=d?function(t){return function(){return n(d()[t])}}:function(t){return l[t]},m=function(){return f.a.pa(d?d():l,n)};m.get=function(t){return l[t]&&n(v(t))},m.has=function(t){return t in l},o=h(l),f.a.o(o,function(i){var n=i.Eb.init,o=i.Eb.update,s=i.key;if(8===e.nodeType&&!f.e.R[s])throw Error("The binding '"+s+"' cannot be used with virtual elements");try{"function"==typeof n&&f.k.u(function(){var i=n(e,v(s),m,r.$data,r);if(i&&i.controlsDescendantBindings){if(p!==t)throw Error("Multiple bindings ("+p+" and "+s+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");p=s}}),"function"==typeof o&&f.j(function(){o(e,v(s),m,r.$data,r)},null,{q:e})}catch(a){throw a.message='Unable to process binding "'+s+": "+l[s]+'"\nMessage: '+a.message,a}})}return{shouldBindDescendants:p===t}}function d(t){return t&&t instanceof f.N?t:new f.N(t)}f.d={};var p={script:!0,textarea:!0};f.getBindingHandler=function(t){return f.d[t]},f.N=function(e,i,n,r){var o,s=this,a="function"==typeof e&&!f.F(e),l=f.j(function(){var t=a?e():e,o=f.a.c(t);return i?(i.K&&i.K(),f.a.extend(s,i),l&&(s.K=l)):(s.$parents=[],s.$root=o,s.ko=f),s.$rawData=t,s.$data=o,n&&(s[n]=o),r&&r(s,i,o),s.$data},null,{Pa:function(){return o&&!f.a.tb(o)},q:!0});l.$()&&(s.K=l,l.equalityComparer=null,o=[],l.Zb=function(e){o.push(e),f.a.C.fa(e,function(e){f.a.ya(o,e),o.length||(l.p(),s.K=l=t)})})},f.N.prototype.createChildContext=function(t,e,i){return new f.N(t,this,e,function(t,e){t.$parentContext=e,t.$parent=e.$data,t.$parents=(e.$parents||[]).slice(0),t.$parents.unshift(t.$parent),i&&i(t)})},f.N.prototype.extend=function(t){return new f.N(this.K||this.$data,this,null,function(e,i){e.$rawData=i.$rawData,f.a.extend(e,"function"==typeof t?t():t)})};var g=f.a.f.I(),v=f.a.f.I();f.Tb=function(t,e){return 2!=arguments.length?f.a.f.get(t,v):(f.a.f.set(t,v,e),void(e.K&&e.K.Zb(t)))},f.va=function(t,e,i){return 1===t.nodeType&&f.e.Kb(t),u(t,e,d(i),!0)},f.cc=function(t,e,i){return i=d(i),f.va(t,s(e,i,t),i)},f.Ja=function(t,e){1!==e.nodeType&&8!==e.nodeType||l(d(t),e,!0)},f.ub=function(t,i){if(!r&&e.jQuery&&(r=e.jQuery),i&&1!==i.nodeType&&8!==i.nodeType)throw Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");i=i||e.document.body,c(d(t),i,!0)},f.Oa=function(e){switch(e.nodeType){case 1:case 8:var i=f.Tb(e);if(i)return i;if(e.parentNode)return f.Oa(e.parentNode)}return t},f.gc=function(e){return(e=f.Oa(e))?e.$data:t},f.b("bindingHandlers",f.d),f.b("applyBindings",f.ub),f.b("applyBindingsToDescendants",f.Ja),f.b("applyBindingAccessorsToNode",f.va),f.b("applyBindingsToNode",f.cc),f.b("contextFor",f.Oa),f.b("dataFor",f.gc)}(),function(t){function e(e,n){var s,a=r.hasOwnProperty(e)?r[e]:t;a?a.U(n):(a=r[e]=new f.Q,a.U(n),i(e,function(t,i){var n=!(!i||!i.synchronous);o[e]={definition:t,tc:n},delete r[e],s||n?a.notifySubscribers(t):setTimeout(function(){a.notifySubscribers(t)},0)}),s=!0)}function i(t,e){n("getConfig",[t],function(i){i?n("loadComponent",[t,i],function(t){e(t,i)}):e(null,null)})}function n(e,i,r,o){o||(o=f.g.loaders.slice(0));var s=o.shift();if(s){var a=s[e];if(a){var l=!1;if(a.apply(s,i.concat(function(t){l?r(null):null!==t?r(t):n(e,i,r,o)}))!==t&&(l=!0,!s.suppressLoaderExceptions))throw Error("Component loaders must supply values by invoking the callback, not by returning values synchronously.")}else n(e,i,r,o)}else r(null)}var r={},o={};f.g={get:function(i,n){var r=o.hasOwnProperty(i)?o[i]:t;r?r.tc?f.k.u(function(){n(r.definition)}):setTimeout(function(){n(r.definition)},0):e(i,n)},zb:function(t){delete o[t]},ob:n},f.g.loaders=[],f.b("components",f.g),f.b("components.get",f.g.get),f.b("components.clearCachedDefinition",f.g.zb)}(),function(){function t(t,e,i,n){function r(){0===--a&&n(o)}var o={},a=2,l=i.template;i=i.viewModel,l?s(e,l,function(e){f.g.ob("loadTemplate",[t,e],function(t){o.template=t,r()})}):r(),i?s(e,i,function(e){f.g.ob("loadViewModel",[t,e],function(t){o[h]=t,r()})}):r()}function n(t,e,i){if("function"==typeof e)i(function(t){return new e(t)});else if("function"==typeof e[h])i(e[h]);else if("instance"in e){var r=e.instance;i(function(){return r})}else"viewModel"in e?n(t,e.viewModel,i):t("Unknown viewModel value: "+e)}function r(t){switch(f.a.v(t)){case"script":return f.a.ca(t.text);case"textarea":return f.a.ca(t.value);case"template":if(o(t.content))return f.a.la(t.content.childNodes)}return f.a.la(t.childNodes)}function o(t){return e.DocumentFragment?t instanceof DocumentFragment:t&&11===t.nodeType}function s(t,i,n){"string"==typeof i.require?a||e.require?(a||e.require)([i.require],n):t("Uses require, but no AMD loader is present"):n(i)}function l(t){return function(e){throw Error("Component '"+t+"': "+e)}}var c={};f.g.register=function(t,e){if(!e)throw Error("Invalid configuration for "+t);if(f.g.Xa(t))throw Error("Component "+t+" is already registered");c[t]=e},f.g.Xa=function(t){return t in c},f.g.Ec=function(t){delete c[t],f.g.zb(t)},f.g.Ab={getConfig:function(t,e){e(c.hasOwnProperty(t)?c[t]:null)},loadComponent:function(e,i,n){var r=l(e);s(r,i,function(i){t(e,r,i,n)})},loadTemplate:function(t,n,s){if(t=l(t),"string"==typeof n)s(f.a.ca(n));else if(n instanceof Array)s(n);else if(o(n))s(f.a.O(n.childNodes));else if(n.element)if(n=n.element,e.HTMLElement?n instanceof HTMLElement:n&&n.tagName&&1===n.nodeType)s(r(n));else if("string"==typeof n){var a=i.getElementById(n);a?s(r(a)):t("Cannot find element with ID "+n)}else t("Unknown element type: "+n);else t("Unknown template value: "+n)},loadViewModel:function(t,e,i){n(l(t),e,i)}};var h="createViewModel";f.b("components.register",f.g.register),f.b("components.isRegistered",f.g.Xa),f.b("components.unregister",f.g.Ec),f.b("components.defaultLoader",f.g.Ab),f.g.loaders.push(f.g.Ab),f.g.$b=c}(),function(){function t(t,i){var n=t.getAttribute("params");if(n){var n=e.parseBindingsString(n,i,t,{valueAccessors:!0,bindingParams:!0}),n=f.a.pa(n,function(e){return f.w(e,null,{q:t})}),r=f.a.pa(n,function(e){var i=e.B();return e.$()?f.w({read:function(){return f.a.c(e())},write:f.Da(i)&&function(t){e()(t)},q:t}):i});return r.hasOwnProperty("$raw")||(r.$raw=n),r}return{$raw:{}}}f.g.getComponentNameForNode=function(t){return t=f.a.v(t),f.g.Xa(t)&&t},f.g.sb=function(e,i,n,r){if(1===i.nodeType){var o=f.g.getComponentNameForNode(i);if(o){if(e=e||{},e.component)throw Error('Cannot use the "component" binding on a custom element matching a component');var s={name:o,params:t(i,n)};e.component=r?function(){return s}:s}}return e};var e=new f.L;9>f.a.M&&(f.g.register=function(t){return function(e){return i.createElement(e),t.apply(this,arguments)}}(f.g.register),i.createDocumentFragment=function(t){return function(){var e,i=t(),n=f.g.$b;for(e in n)n.hasOwnProperty(e)&&i.createElement(e);return i}}(i.createDocumentFragment))}(),function(t){function e(t,e,i){if(e=e.template,!e)throw Error("Component '"+t+"' has no template");t=f.a.la(e),f.e.T(i,t)}function i(t,e,i,n){var r=t.createViewModel;return r?r.call(t,n,{element:e,templateNodes:i}):n}var n=0;f.d.component={init:function(r,o,s,a,l){function c(){var t=h&&h.dispose;"function"==typeof t&&t.call(h),u=null}var h,u,d=f.a.O(f.e.childNodes(r));return f.a.C.fa(r,c),f.w(function(){var s,a,p=f.a.c(o());if("string"==typeof p?s=p:(s=f.a.c(p.name),a=f.a.c(p.params)),!s)throw Error("No component name specified");var g=u=++n;f.g.get(s,function(n){if(u===g){if(c(),!n)throw Error("Unknown component '"+s+"'");e(s,n,r);var o=i(n,r,d,a);n=l.createChildContext(o,t,function(t){t.$component=o,t.$componentTemplateNodes=d}),h=o,f.Ja(n,r)}})},null,{q:r}),{controlsDescendantBindings:!0}}},f.e.R.component=!0}();var v={"class":"className","for":"htmlFor"};f.d.attr={update:function(e,i){var n=f.a.c(i())||{};f.a.A(n,function(i,n){n=f.a.c(n);var r=!1===n||null===n||n===t;r&&e.removeAttribute(i),8>=f.a.M&&i in v?(i=v[i],r?e.removeAttribute(i):e[i]=n):r||e.setAttribute(i,n.toString()),"name"===i&&f.a.Rb(e,r?"":n.toString())})}},function(){f.d.checked={after:["value","attr"],init:function(e,i,n){function r(){var t=e.checked,r=u?s():t;if(!f.Z.Ca()&&(!l||t)){var o=f.k.u(i);c?h!==r?(t&&(f.a.ga(o,r,!0),f.a.ga(o,h,!1)),h=r):f.a.ga(o,r,t):f.h.ra(o,n,"checked",r,!0)}}function o(){var t=f.a.c(i());e.checked=c?0<=f.a.m(t,s()):a?t:s()===t}var s=f.Nb(function(){return n.has("checkedValue")?f.a.c(n.get("checkedValue")):n.has("value")?f.a.c(n.get("value")):e.value}),a="checkbox"==e.type,l="radio"==e.type;if(a||l){var c=a&&f.a.c(i())instanceof Array,h=c?s():t,u=l||c;l&&!e.name&&f.d.uniqueName.init(e,function(){return!0}),f.w(r,null,{q:e}),f.a.n(e,"click",r),f.w(o,null,{q:e})}}},f.h.V.checked=!0,f.d.checkedValue={update:function(t,e){t.value=f.a.c(e())}}}(),f.d.css={update:function(t,e){var i=f.a.c(e());null!==i&&"object"==typeof i?f.a.A(i,function(e,i){i=f.a.c(i),f.a.Ia(t,e,i)}):(i=String(i||""),f.a.Ia(t,t.__ko__cssValue,!1),t.__ko__cssValue=i,f.a.Ia(t,i,!0))}},f.d.enable={update:function(t,e){var i=f.a.c(e());i&&t.disabled?t.removeAttribute("disabled"):i||t.disabled||(t.disabled=!0)}},f.d.disable={update:function(t,e){f.d.enable.update(t,function(){return!f.a.c(e())})}},f.d.event={init:function(t,e,i,n,r){var o=e()||{};f.a.A(o,function(o){"string"==typeof o&&f.a.n(t,o,function(t){var s,a=e()[o];if(a){try{var l=f.a.O(arguments);n=r.$data,l.unshift(n),s=a.apply(n,l)}finally{!0!==s&&(t.preventDefault?t.preventDefault():t.returnValue=!1)}!1===i.get(o+"Bubble")&&(t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation())}})})}},f.d.foreach={Ib:function(t){return function(){var e=t(),i=f.a.cb(e);return i&&"number"!=typeof i.length?(f.a.c(e),{foreach:i.data,as:i.as,includeDestroyed:i.includeDestroyed,afterAdd:i.afterAdd,beforeRemove:i.beforeRemove,afterRender:i.afterRender,beforeMove:i.beforeMove,afterMove:i.afterMove,templateEngine:f.P.Va}):{foreach:e,templateEngine:f.P.Va}}},init:function(t,e){return f.d.template.init(t,f.d.foreach.Ib(e))},update:function(t,e,i,n,r){return f.d.template.update(t,f.d.foreach.Ib(e),i,n,r)}},f.h.ka.foreach=!1,f.e.R.foreach=!0,f.d.hasfocus={init:function(t,e,i){function n(n){t.__ko_hasfocusUpdating=!0;var r=t.ownerDocument;if("activeElement"in r){var o;try{o=r.activeElement}catch(s){o=r.body}n=o===t}r=e(),f.h.ra(r,i,"hasfocus",n,!0),t.__ko_hasfocusLastValue=n,t.__ko_hasfocusUpdating=!1}var r=n.bind(null,!0),o=n.bind(null,!1);f.a.n(t,"focus",r),f.a.n(t,"focusin",r),f.a.n(t,"blur",o),f.a.n(t,"focusout",o)},update:function(t,e){var i=!!f.a.c(e());t.__ko_hasfocusUpdating||t.__ko_hasfocusLastValue===i||(i?t.focus():t.blur(),f.k.u(f.a.qa,null,[t,i?"focusin":"focusout"]))}},f.h.V.hasfocus=!0,f.d.hasFocus=f.d.hasfocus,f.h.V.hasFocus=!0,f.d.html={init:function(){return{controlsDescendantBindings:!0}},update:function(t,e){f.a.gb(t,e())}},u("if"),u("ifnot",!1,!0),u("with",!0,!1,function(t,e){return t.createChildContext(e)});var m={};f.d.options={init:function(t){if("select"!==f.a.v(t))throw Error("options binding applies only to SELECT elements");for(;0<t.length;)t.remove(0);return{controlsDescendantBindings:!0}},update:function(e,i,n){function r(){return f.a.xa(e.options,function(t){return t.selected})}function o(t,e,i){var n=typeof e;return"function"==n?e(t):"string"==n?t[e]:i}function s(t,i){if(g&&h)f.i.Y(e,f.a.c(n.get("value")),!0);else if(p.length){var r=0<=f.a.m(p,f.i.s(i[0]));f.a.Sb(i[0],r),g&&!r&&f.k.u(f.a.qa,null,[e,"change"])}}var a=e.multiple,l=0!=e.length&&a?e.scrollTop:null,c=f.a.c(i()),h=n.get("valueAllowUnset")&&n.has("value"),u=n.get("optionsIncludeDestroyed");i={};var d,p=[];h||(a?p=f.a.Ka(r(),f.i.s):0<=e.selectedIndex&&p.push(f.i.s(e.options[e.selectedIndex]))),c&&("undefined"==typeof c.length&&(c=[c]),d=f.a.xa(c,function(e){return u||e===t||null===e||!f.a.c(e._destroy)}),n.has("optionsCaption")&&(c=f.a.c(n.get("optionsCaption")),null!==c&&c!==t&&d.unshift(m)));var g=!1;i.beforeRemove=function(t){e.removeChild(t)},c=s,n.has("optionsAfterRender")&&"function"==typeof n.get("optionsAfterRender")&&(c=function(e,i){s(0,i),f.k.u(n.get("optionsAfterRender"),null,[i[0],e!==m?e:t])}),f.a.fb(e,d,function(i,r,s){return s.length&&(p=!h&&s[0].selected?[f.i.s(s[0])]:[],g=!0),r=e.ownerDocument.createElement("option"),i===m?(f.a.Ha(r,n.get("optionsCaption")),f.i.Y(r,t)):(s=o(i,n.get("optionsValue"),i),f.i.Y(r,f.a.c(s)),i=o(i,n.get("optionsText"),s),f.a.Ha(r,i)),[r]},i,c),f.k.u(function(){h?f.i.Y(e,f.a.c(n.get("value")),!0):(a?p.length&&r().length<p.length:p.length&&0<=e.selectedIndex?f.i.s(e.options[e.selectedIndex])!==p[0]:p.length||0<=e.selectedIndex)&&f.a.qa(e,"change")}),f.a.kc(e),l&&20<Math.abs(l-e.scrollTop)&&(e.scrollTop=l)}},f.d.options.ab=f.a.f.I(),f.d.selectedOptions={after:["options","foreach"],init:function(t,e,i){f.a.n(t,"change",function(){var n=e(),r=[];f.a.o(t.getElementsByTagName("option"),function(t){t.selected&&r.push(f.i.s(t))}),f.h.ra(n,i,"selectedOptions",r)})},update:function(t,e){if("select"!=f.a.v(t))throw Error("values binding applies only to SELECT elements");var i=f.a.c(e());i&&"number"==typeof i.length&&f.a.o(t.getElementsByTagName("option"),function(t){var e=0<=f.a.m(i,f.i.s(t));f.a.Sb(t,e)})}},f.h.V.selectedOptions=!0,f.d.style={update:function(e,i){var n=f.a.c(i()||{});f.a.A(n,function(i,n){n=f.a.c(n),(null===n||n===t||!1===n)&&(n=""),e.style[i]=n})}},f.d.submit={init:function(t,e,i,n,r){if("function"!=typeof e())throw Error("The value for a submit binding must be a function");f.a.n(t,"submit",function(i){var n,o=e();
try{n=o.call(r.$data,t)}finally{!0!==n&&(i.preventDefault?i.preventDefault():i.returnValue=!1)}})}},f.d.text={init:function(){return{controlsDescendantBindings:!0}},update:function(t,e){f.a.Ha(t,e())}},f.e.R.text=!0,function(){if(e&&e.navigator)var i=function(t){return t?parseFloat(t[1]):void 0},n=e.opera&&e.opera.version&&parseInt(e.opera.version()),r=e.navigator.userAgent,o=i(r.match(/^(?:(?!chrome).)*version\/([^ ]*) safari/i)),s=i(r.match(/Firefox\/([^ ]*)/));if(10>f.a.M)var a=f.a.f.I(),l=f.a.f.I(),c=function(t){var e=this.activeElement;(e=e&&f.a.f.get(e,l))&&e(t)},h=function(t,e){var i=t.ownerDocument;f.a.f.get(i,a)||(f.a.f.set(i,a,!0),f.a.n(i,"selectionchange",c)),f.a.f.set(t,l,e)};f.d.textInput={init:function(e,i,r){function a(t,i){f.a.n(e,t,i)}function l(){var n=f.a.c(i());(null===n||n===t)&&(n=""),p!==t&&n===p?setTimeout(l,4):e.value!==n&&(g=n,e.value=n)}function c(){d||(p=e.value,d=setTimeout(u,4))}function u(){clearTimeout(d),p=d=t;var n=e.value;g!==n&&(g=n,f.h.ra(i(),r,"textInput",n))}var d,p,g=e.value;10>f.a.M?(a("propertychange",function(t){"value"===t.propertyName&&u()}),8==f.a.M&&(a("keyup",u),a("keydown",u)),8<=f.a.M&&(h(e,u),a("dragend",c))):(a("input",u),5>o&&"textarea"===f.a.v(e)?(a("keydown",c),a("paste",c),a("cut",c)):11>n?a("keydown",c):4>s&&(a("DOMAutoComplete",u),a("dragdrop",u),a("drop",u))),a("change",u),f.w(l,null,{q:e})}},f.h.V.textInput=!0,f.d.textinput={preprocess:function(t,e,i){i("textInput",t)}}}(),f.d.uniqueName={init:function(t,e){if(e()){var i="ko_unique_"+ ++f.d.uniqueName.fc;f.a.Rb(t,i)}}},f.d.uniqueName.fc=0,f.d.value={after:["options","foreach"],init:function(t,e,i){if("input"!=t.tagName.toLowerCase()||"checkbox"!=t.type&&"radio"!=t.type){var n=["change"],r=i.get("valueUpdate"),o=!1,s=null;r&&("string"==typeof r&&(r=[r]),f.a.ia(n,r),n=f.a.wb(n));var a=function(){s=null,o=!1;var n=e(),r=f.i.s(t);f.h.ra(n,i,"value",r)};!f.a.M||"input"!=t.tagName.toLowerCase()||"text"!=t.type||"off"==t.autocomplete||t.form&&"off"==t.form.autocomplete||-1!=f.a.m(n,"propertychange")||(f.a.n(t,"propertychange",function(){o=!0}),f.a.n(t,"focus",function(){o=!1}),f.a.n(t,"blur",function(){o&&a()})),f.a.o(n,function(e){var i=a;f.a.Dc(e,"after")&&(i=function(){s=f.i.s(t),setTimeout(a,0)},e=e.substring(5)),f.a.n(t,e,i)});var l=function(){var n=f.a.c(e()),r=f.i.s(t);if(null!==s&&n===s)setTimeout(l,0);else if(n!==r)if("select"===f.a.v(t)){var o=i.get("valueAllowUnset"),r=function(){f.i.Y(t,n,o)};r(),o||n===f.i.s(t)?setTimeout(r,0):f.k.u(f.a.qa,null,[t,"change"])}else f.i.Y(t,n)};f.w(l,null,{q:t})}else f.va(t,{checkedValue:e})},update:function(){}},f.h.V.value=!0,f.d.visible={update:function(t,e){var i=f.a.c(e()),n="none"!=t.style.display;i&&!n?t.style.display="":!i&&n&&(t.style.display="none")}},function(t){f.d[t]={init:function(e,i,n,r,o){return f.d.event.init.call(this,e,function(){var e={};return e[t]=i(),e},n,r,o)}}}("click"),f.J=function(){},f.J.prototype.renderTemplateSource=function(){throw Error("Override renderTemplateSource")},f.J.prototype.createJavaScriptEvaluatorBlock=function(){throw Error("Override createJavaScriptEvaluatorBlock")},f.J.prototype.makeTemplateSource=function(t,e){if("string"==typeof t){e=e||i;var n=e.getElementById(t);if(!n)throw Error("Cannot find template with ID "+t);return new f.t.l(n)}if(1==t.nodeType||8==t.nodeType)return new f.t.ha(t);throw Error("Unknown template type: "+t)},f.J.prototype.renderTemplate=function(t,e,i,n){return t=this.makeTemplateSource(t,n),this.renderTemplateSource(t,e,i,n)},f.J.prototype.isTemplateRewritten=function(t,e){return!1===this.allowTemplateRewriting?!0:this.makeTemplateSource(t,e).data("isRewritten")},f.J.prototype.rewriteTemplate=function(t,e,i){t=this.makeTemplateSource(t,i),e=e(t.text()),t.text(e),t.data("isRewritten",!0)},f.b("templateEngine",f.J),f.kb=function(){function t(t,e,i,n){t=f.h.bb(t);for(var r=f.h.ka,o=0;o<t.length;o++){var s=t[o].key;if(r.hasOwnProperty(s)){var a=r[s];if("function"==typeof a){if(s=a(t[o].value))throw Error(s)}else if(!a)throw Error("This template engine does not support the '"+s+"' binding within its templates")}}return i="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+f.h.Ea(t,{valueAccessors:!0})+" } })()},'"+i.toLowerCase()+"')",n.createJavaScriptEvaluatorBlock(i)+e}var e=/(<([a-z]+\d*)(?:\s+(?!data-bind\s*=\s*)[a-z0-9\-]+(?:=(?:\"[^\"]*\"|\'[^\']*\'|[^>]*))?)*\s+)data-bind\s*=\s*(["'])([\s\S]*?)\3/gi,i=/\x3c!--\s*ko\b\s*([\s\S]*?)\s*--\x3e/g;return{lc:function(t,e,i){e.isTemplateRewritten(t,i)||e.rewriteTemplate(t,function(t){return f.kb.xc(t,e)},i)},xc:function(n,r){return n.replace(e,function(e,i,n,o,s){return t(s,i,n,r)}).replace(i,function(e,i){return t(i,"<!-- ko -->","#comment",r)})},dc:function(t,e){return f.H.$a(function(i,n){var r=i.nextSibling;r&&r.nodeName.toLowerCase()===e&&f.va(r,t,n)})}}}(),f.b("__tr_ambtns",f.kb.dc),function(){f.t={},f.t.l=function(t){this.l=t},f.t.l.prototype.text=function(){var t=f.a.v(this.l),t="script"===t?"text":"textarea"===t?"value":"innerHTML";if(0==arguments.length)return this.l[t];var e=arguments[0];"innerHTML"===t?f.a.gb(this.l,e):this.l[t]=e};var e=f.a.f.I()+"_";f.t.l.prototype.data=function(t){return 1===arguments.length?f.a.f.get(this.l,e+t):void f.a.f.set(this.l,e+t,arguments[1])};var i=f.a.f.I();f.t.ha=function(t){this.l=t},f.t.ha.prototype=new f.t.l,f.t.ha.prototype.text=function(){if(0==arguments.length){var e=f.a.f.get(this.l,i)||{};return e.lb===t&&e.Na&&(e.lb=e.Na.innerHTML),e.lb}f.a.f.set(this.l,i,{lb:arguments[0]})},f.t.l.prototype.nodes=function(){return 0==arguments.length?(f.a.f.get(this.l,i)||{}).Na:void f.a.f.set(this.l,i,{Na:arguments[0]})},f.b("templateSources",f.t),f.b("templateSources.domElement",f.t.l),f.b("templateSources.anonymousTemplate",f.t.ha)}(),function(){function e(t,e,i){var n;for(e=f.e.nextSibling(e);t&&(n=t)!==e;)t=f.e.nextSibling(n),i(n,t)}function i(t,i){if(t.length){var n=t[0],r=t[t.length-1],o=n.parentNode,s=f.L.instance,a=s.preprocessNode;if(a){if(e(n,r,function(t,e){var i=t.previousSibling,o=a.call(s,t);o&&(t===n&&(n=o[0]||e),t===r&&(r=o[o.length-1]||i))}),t.length=0,!n)return;n===r?t.push(n):(t.push(n,r),f.a.na(t,o))}e(n,r,function(t){1!==t.nodeType&&8!==t.nodeType||f.ub(i,t)}),e(n,r,function(t){1!==t.nodeType&&8!==t.nodeType||f.H.Xb(t,[i])}),f.a.na(t,o)}}function n(t){return t.nodeType?t:0<t.length?t[0]:null}function r(t,e,r,o,a){a=a||{};var l=(t&&n(t)||r||{}).ownerDocument,c=a.templateEngine||s;if(f.kb.lc(r,c,l),r=c.renderTemplate(r,o,a,l),"number"!=typeof r.length||0<r.length&&"number"!=typeof r[0].nodeType)throw Error("Template engine must return an array of DOM nodes");switch(l=!1,e){case"replaceChildren":f.e.T(t,r),l=!0;break;case"replaceNode":f.a.Qb(t,r),l=!0;break;case"ignoreTargetNode":break;default:throw Error("Unknown renderMode: "+e)}return l&&(i(r,o),a.afterRender&&f.k.u(a.afterRender,null,[r,o.$data])),r}function o(t,e,i){return f.F(t)?t():"function"==typeof t?t(e,i):t}var s;f.hb=function(e){if(e!=t&&!(e instanceof f.J))throw Error("templateEngine must inherit from ko.templateEngine");s=e},f.eb=function(e,i,a,l,c){if(a=a||{},(a.templateEngine||s)==t)throw Error("Set a template engine before calling renderTemplate");if(c=c||"replaceChildren",l){var h=n(l);return f.j(function(){var t=i&&i instanceof f.N?i:new f.N(f.a.c(i)),s=o(e,t.$data,t),t=r(l,c,s,t,a);"replaceNode"==c&&(l=t,h=n(l))},null,{Pa:function(){return!h||!f.a.Qa(h)},q:h&&"replaceNode"==c?h.parentNode:h})}return f.H.$a(function(t){f.eb(e,i,a,t,"replaceNode")})},f.Cc=function(e,n,s,a,l){function c(t,e){i(e,u),s.afterRender&&s.afterRender(e,t),u=null}function h(t,i){u=l.createChildContext(t,s.as,function(t){t.$index=i});var n=o(e,t,u);return r(null,"ignoreTargetNode",n,u,s)}var u;return f.j(function(){var e=f.a.c(n)||[];"undefined"==typeof e.length&&(e=[e]),e=f.a.xa(e,function(e){return s.includeDestroyed||e===t||null===e||!f.a.c(e._destroy)}),f.k.u(f.a.fb,null,[a,e,h,s,c])},null,{q:a})};var a=f.a.f.I();f.d.template={init:function(t,e){var i=f.a.c(e());if("string"==typeof i||i.name)f.e.ma(t);else{if("nodes"in i){if(i=i.nodes||[],f.F(i))throw Error('The "nodes" option must be a plain, non-observable array.')}else i=f.e.childNodes(t);i=f.a.Jb(i),new f.t.ha(t).nodes(i)}return{controlsDescendantBindings:!0}},update:function(e,i,n,r,o){var s,l=i();i=f.a.c(l),n=!0,r=null,"string"==typeof i?i={}:(l=i.name,"if"in i&&(n=f.a.c(i["if"])),n&&"ifnot"in i&&(n=!f.a.c(i.ifnot)),s=f.a.c(i.data)),"foreach"in i?r=f.Cc(l||e,n&&i.foreach||[],i,e,o):n?(o="data"in i?o.createChildContext(s,i.as):o,r=f.eb(l||e,o,i,e)):f.e.ma(e),o=r,(s=f.a.f.get(e,a))&&"function"==typeof s.p&&s.p(),f.a.f.set(e,a,o&&o.$()?o:t)}},f.h.ka.template=function(t){return t=f.h.bb(t),1==t.length&&t[0].unknown||f.h.vc(t,"name")?null:"This template engine does not support anonymous templates nested within its templates"},f.e.R.template=!0}(),f.b("setTemplateEngine",f.hb),f.b("renderTemplate",f.eb),f.a.Cb=function(t,e,i){if(t.length&&e.length){var n,r,o,s,a;for(n=r=0;(!i||i>n)&&(s=t[r]);++r){for(o=0;a=e[o];++o)if(s.value===a.value){s.moved=a.index,a.moved=s.index,e.splice(o,1),n=o=0;break}n+=o}}},f.a.Ma=function(){function t(t,e,i,n,r){var o,s,a,l,c,h=Math.min,u=Math.max,d=[],p=t.length,g=e.length,v=g-p||1,m=p+g+1;for(o=0;p>=o;o++)for(l=a,d.push(a=[]),c=h(g,o+v),s=u(0,o-1);c>=s;s++)a[s]=s?o?t[o-1]===e[s-1]?l[s-1]:h(l[s]||m,a[s-1]||m)+1:s+1:o+1;for(h=[],u=[],v=[],o=p,s=g;o||s;)g=d[o][s]-1,s&&g===d[o][s-1]?u.push(h[h.length]={status:i,value:e[--s],index:s}):o&&g===d[o-1][s]?v.push(h[h.length]={status:n,value:t[--o],index:o}):(--s,--o,r.sparse||h.push({status:"retained",value:e[s]}));return f.a.Cb(u,v,10*p),h.reverse()}return function(e,i,n){return n="boolean"==typeof n?{dontLimitMoves:n}:n||{},e=e||[],i=i||[],e.length<=i.length?t(e,i,"added","deleted",n):t(i,e,"deleted","added",n)}}(),f.b("utils.compareArrays",f.a.Ma),function(){function e(e,i,n,r,o){var s=[],a=f.j(function(){var t=i(n,o,f.a.na(s,e))||[];0<s.length&&(f.a.Qb(s,t),r&&f.k.u(r,null,[n,t,o])),s.length=0,f.a.ia(s,t)},null,{q:e,Pa:function(){return!f.a.tb(s)}});return{aa:s,j:a.$()?a:t}}var i=f.a.f.I();f.a.fb=function(n,r,o,s,a){function l(t,e){C=u[e],m!==e&&(_[t]=C),C.Ua(m++),f.a.na(C.aa,n),g.push(C),y.push(C)}function c(t,e){if(t)for(var i=0,n=e.length;n>i;i++)e[i]&&f.a.o(e[i].aa,function(n){t(n,i,e[i].wa)})}r=r||[],s=s||{};var h=f.a.f.get(n,i)===t,u=f.a.f.get(n,i)||[],d=f.a.Ka(u,function(t){return t.wa}),p=f.a.Ma(d,r,s.dontLimitMoves),g=[],v=0,m=0,b=[],y=[];r=[];for(var C,x,w,_=[],d=[],S=0;x=p[S];S++)switch(w=x.moved,x.status){case"deleted":w===t&&(C=u[v],C.j&&C.j.p(),b.push.apply(b,f.a.na(C.aa,n)),s.beforeRemove&&(r[S]=C,y.push(C))),v++;break;case"retained":l(S,v++);break;case"added":w!==t?l(S,w):(C={wa:x.value,Ua:f.r(m++)},g.push(C),y.push(C),h||(d[S]=C))}c(s.beforeMove,_),f.a.o(b,s.beforeRemove?f.S:f.removeNode);for(var O,S=0,h=f.e.firstChild(n);C=y[S];S++){for(C.aa||f.a.extend(C,e(n,o,C.wa,a,C.Ua)),v=0;p=C.aa[v];h=p.nextSibling,O=p,v++)p!==h&&f.e.Fb(n,p,O);!C.rc&&a&&(a(C.wa,C.aa,C.Ua),C.rc=!0)}c(s.beforeRemove,r),c(s.afterMove,_),c(s.afterAdd,d),f.a.f.set(n,i,g)}}(),f.b("utils.setDomNodeChildrenFromArrayMapping",f.a.fb),f.P=function(){this.allowTemplateRewriting=!1},f.P.prototype=new f.J,f.P.prototype.renderTemplateSource=function(t,e,i,n){return(e=(9>f.a.M?0:t.nodes)?t.nodes():null)?f.a.O(e.cloneNode(!0).childNodes):(t=t.text(),f.a.ca(t,n))},f.P.Va=new f.P,f.hb(f.P.Va),f.b("nativeTemplateEngine",f.P),function(){f.Ya=function(){var t=this.uc=function(){if(!r||!r.tmpl)return 0;try{if(0<=r.tmpl.tag.tmpl.open.toString().indexOf("__"))return 2}catch(t){}return 1}();this.renderTemplateSource=function(e,n,o,s){if(s=s||i,o=o||{},2>t)throw Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.");var a=e.data("precompiled");return a||(a=e.text()||"",a=r.template(null,"{{ko_with $item.koBindingContext}}"+a+"{{/ko_with}}"),e.data("precompiled",a)),e=[n.$data],n=r.extend({koBindingContext:n},o.templateOptions),n=r.tmpl(a,e,n),n.appendTo(s.createElement("div")),r.fragments={},n},this.createJavaScriptEvaluatorBlock=function(t){return"{{ko_code ((function() { return "+t+" })()) }}"},this.addTemplate=function(t,e){i.write("<script type='text/html' id='"+t+"'>"+e+"</script>")},t>0&&(r.tmpl.tag.ko_code={open:"__.push($1 || '');"},r.tmpl.tag.ko_with={open:"with($1) {",close:"} "})},f.Ya.prototype=new f.J;var t=new f.Ya;0<t.uc&&f.hb(t),f.b("jqueryTmplTemplateEngine",f.Ya)}()})}()}(),function(t,e,i){function n(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent("on"+e,i)}function r(t){if("keypress"==t.type){var e=String.fromCharCode(t.which);return t.shiftKey||(e=e.toLowerCase()),e}return u[t.which]?u[t.which]:f[t.which]?f[t.which]:String.fromCharCode(t.which).toLowerCase()}function o(t){var e=[];return t.shiftKey&&e.push("shift"),t.altKey&&e.push("alt"),t.ctrlKey&&e.push("ctrl"),t.metaKey&&e.push("meta"),e}function s(t){return"shift"==t||"ctrl"==t||"alt"==t||"meta"==t}function a(t,e){var i,n,r,o=[];for(i=t,"+"===i?i=["+"]:(i=i.replace(/\+{2}/g,"+plus"),i=i.split("+")),r=0;r<i.length;++r)n=i[r],p[n]&&(n=p[n]),e&&"keypress"!=e&&d[n]&&(n=d[n],o.push("shift")),s(n)&&o.push(n);if(i=n,r=e,!r){if(!h){h={};for(var a in u)a>95&&112>a||u.hasOwnProperty(a)&&(h[u[a]]=a)}r=h[i]?"keydown":"keypress"}return"keypress"==r&&o.length&&(r="keydown"),{key:n,modifiers:o,action:r}}function l(t,i){return null===t||t===e?!1:t===i?!0:l(t.parentNode,i)}function c(t){function i(t){t=t||{};var e,i=!1;for(e in v)t[e]?i=!0:v[e]=0;i||(y=!1)}function l(t,e,i,n,r,o){var a,l,c=[],h=i.type;if(!p._callbacks[t])return[];for("keyup"==h&&s(t)&&(e=[t]),a=0;a<p._callbacks[t].length;++a)if(l=p._callbacks[t][a],(n||!l.seq||v[l.seq]==l.level)&&h==l.action){var u;(u="keypress"==h&&!i.metaKey&&!i.ctrlKey)||(u=l.modifiers,u=e.sort().join(",")===u.sort().join(",")),u&&(u=n&&l.seq==n&&l.level==o,(!n&&l.combo==r||u)&&p._callbacks[t].splice(a,1),c.push(l))}return c}function h(t,e,i,n){p.stopCallback(e,e.target||e.srcElement,i,n)||!1!==t(e,i)||(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation?e.stopPropagation():e.cancelBubble=!0)}function u(t){"number"!=typeof t.which&&(t.which=t.keyCode);var e=r(t);e&&("keyup"==t.type&&m===e?m=!1:p.handleKey(e,o(t),t))}function f(t,e,n,o){function s(e){return function(){y=e,++v[t],clearTimeout(g),g=setTimeout(i,1e3)}}function l(e){h(n,e,t),"keyup"!==o&&(m=r(e)),setTimeout(i,10)}for(var c=v[t]=0;c<e.length;++c){var u=c+1===e.length?l:s(o||a(e[c+1]).action);d(e[c],u,o,t,c)}}function d(t,e,i,n,r){p._directMap[t+":"+i]=e,t=t.replace(/\s+/g," ");var o=t.split(" ");1<o.length?f(t,o,e,i):(i=a(t,i),p._callbacks[i.key]=p._callbacks[i.key]||[],l(i.key,i.modifiers,{type:i.action},n,t,r),p._callbacks[i.key][n?"unshift":"push"]({callback:e,modifiers:i.modifiers,action:i.action,seq:n,level:r,combo:t}))}var p=this;if(t=t||e,!(p instanceof c))return new c(t);p.target=t,p._callbacks={},p._directMap={};var g,v={},m=!1,b=!1,y=!1;p._handleKey=function(t,e,n){var r,o=l(t,e,n);e={};var a=0,c=!1;for(r=0;r<o.length;++r)o[r].seq&&(a=Math.max(a,o[r].level));for(r=0;r<o.length;++r)o[r].seq?o[r].level==a&&(c=!0,e[o[r].seq]=1,h(o[r].callback,n,o[r].combo,o[r].seq)):c||h(o[r].callback,n,o[r].combo);o="keypress"==n.type&&b,n.type!=y||s(t)||o||i(e),b=c&&"keydown"==n.type},p._bindMultiple=function(t,e,i){for(var n=0;n<t.length;++n)d(t[n],e,i)},n(t,"keypress",u),n(t,"keydown",u),n(t,"keyup",u)}var h,u={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},f={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},d={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},p={option:"alt",command:"meta","return":"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"};for(i=1;20>i;++i)u[111+i]="f"+i;for(i=0;9>=i;++i)u[i+96]=i;c.prototype.bind=function(t,e,i){return t=t instanceof Array?t:[t],this._bindMultiple.call(this,t,e,i),this},c.prototype.unbind=function(t,e){return this.bind.call(this,t,function(){},e)},c.prototype.trigger=function(t,e){return this._directMap[t+":"+e]&&this._directMap[t+":"+e]({},t),this},c.prototype.reset=function(){return this._callbacks={},this._directMap={},this},c.prototype.stopCallback=function(t,e){return-1<(" "+e.className+" ").indexOf(" mousetrap ")||l(e,this.target)?!1:"INPUT"==e.tagName||"SELECT"==e.tagName||"TEXTAREA"==e.tagName||e.isContentEditable},c.prototype.handleKey=function(){return this._handleKey.apply(this,arguments)},c.init=function(){var t,i=c(e);for(t in i)"_"!==t.charAt(0)&&(c[t]=function(t){return function(){return i[t].apply(i,arguments)}}(t))},c.init(),t.Mousetrap=c,"undefined"!=typeof module&&module.exports&&(module.exports=c),"function"==typeof define&&define.amd&&define(function(){return c})}(window,document),window.ImageFunctions=function($,fabric){"use strict";function sendErrorFunction(){$("#sendErrorText").val(""),created=!0;var t=$("#sendErrorDialog");t.dialog("open"),t.removeClass("ui-widget"),$(".ui-dialog").css("z-index",10),$(".ui-widget-overlay").css("position","fixed"),$(".ui-widget-overlay").css("z-index",9)}function openModal(){$("#wpwrap").css("cursor","wait")}function closeModal(){$("#wpwrap").css("cursor","auto")}function setupDragAndDrop(){function t(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent?t.attachEvent("on"+e,i):t["on"+e]=i}function e(t){return t.preventDefault&&t.preventDefault(),!1}$(".canvas-container").attr("id","drag-and-drop");var i=document.getElementById("drag-and-drop");$(i).append($("<div><div class='centerElement upload-background-icon'/></div>").attr({id:"new-upload-background","class":"upload-background"})),$("#new-upload-background").css("display","none"),t(i,"dragover",e),t(i,"dragenter",toggleUploadBackground),t(i,"dragleave",toggleUploadBackground),t(i,"drop",handleExternalImage)}function toggleUploadBackground(t){t.preventDefault&&t.preventDefault();var e=$("#new-upload-background"),i=$("#canvas");e.css("width",i.css("width")),e.css("height",i.css("height")),e.toggle()}function handleExternalImage(t){t=t||window.event,toggleUploadBackground(t);var e=t.dataTransfer.files[0],i=new FileReader;return i.readAsDataURL(e),i.onload=function(){var t={action:"newUpload",base64data:this.result,title:e.name};$.post(ajaxurl,t,function(t){var e={};e.title="",e.width="",e.height="",addImageFromURL(t,!1,e)})},!1}function sendImageBackInGalleryBox(t){for(var e=0;e<imagesOfGalleryBox.length;e++)if(t.id===parseInt(imagesOfGalleryBox[e].id)&&e!==imagesOfGalleryBox.length-1){var i=e+1;$("#sortable li").eq(e).insertAfter($("#sortable li").eq(i));var n=imagesOfGalleryBox[e+1];imagesOfGalleryBox[e+1]=imagesOfGalleryBox[e],imagesOfGalleryBox[e]=n,e=imagesOfGalleryBox.length}}function sendImageBackToEndInGalleryBox(t){for(var e=0;e<imagesOfGalleryBox.length;e++)if(t.id===parseInt(imagesOfGalleryBox[e].id)&&e!==imagesOfGalleryBox.length-1){var i=imagesOfGalleryBox.length-1;$("#sortable li").eq(e).insertAfter($("#sortable li").eq(i));for(var n=imagesOfGalleryBox[e],r=e;r<imagesOfGalleryBox.length-1;r++)imagesOfGalleryBox[r]=imagesOfGalleryBox[r+1];imagesOfGalleryBox[imagesOfGalleryBox.length-1]=n,e=imagesOfGalleryBox.length}}function sendImageFowardInGalleryBox(t){for(var e=0;e<imagesOfGalleryBox.length;e++)if(t.id===parseInt(imagesOfGalleryBox[e].id)&&0!==e){var i=e-1;$("#sortable li").eq(e).insertBefore($("#sortable li").eq(i));var n=imagesOfGalleryBox[e-1];imagesOfGalleryBox[e-1]=imagesOfGalleryBox[e],imagesOfGalleryBox[e]=n,e=imagesOfGalleryBox.length}}function sendImageForwardToFrontInGalleryBox(t){for(var e=0;e<imagesOfGalleryBox.length;e++)if(t.id===parseInt(imagesOfGalleryBox[e].id)&&0!==e){var i=0;$("#sortable li").eq(e).insertBefore($("#sortable li").eq(i));for(var n=imagesOfGalleryBox[e],r=e;r>0;r--)imagesOfGalleryBox[r]=imagesOfGalleryBox[r-1];imagesOfGalleryBox[0]=n,e=imagesOfGalleryBox.length}}function removeFromGalleryBox(t){for(var e=0;e<imagesOfGalleryBox.length;e++)t.id===parseInt(imagesOfGalleryBox[e].id)&&($("#sortable li").eq(e).remove(),imagesOfGalleryBox.splice(e,1),e=imagesOfGalleryBox.length)}function updateFilterCSS(){var t=parseInt($("canvas").css("width")),e=parseInt($("canvas").css("height"));t+=120,e=e+160+(220-e);var i=$("#filter-controls");i.css("left",t+"px"),i.css("top",e+"px")}function getJSDate(){var t=new Date,e=""+t.getFullYear(),i=""+(t.getMonth()+1);1===i.length&&(i="0"+i);var n=""+t.getDate();1===n.length&&(n="0"+n);var r,o=""+t.getHours();r=12>o?"am":"pm",o>12&&(o-=12),1===o.length&&(o="0"+o);var s=""+t.getMinutes();return 1===s.length&&(s="0"+s),i+"-"+n+"-"+e+" | "+o+":"+s+r}function areObjectsOfType(t){if(!canvas.getActiveObject()&&!canvas.getActiveGroup())return!1;var e=canvas.getActiveObject();if(e)return e.type===t?!0:!1;var i=canvas.getActiveGroup(),n=!0;return i.forEachObject(function(e){e.type!==t&&(n=!1)}),n}function updateFilterControl(){$("#removewhite").is(":checked")?$("#removewhiteOptions").slideDown("slow"):$("#removewhiteOptions").slideUp("slow"),$("#removewhite").change(function(){$(this).is(":checked")?$("#removewhiteOptions").slideDown("slow"):$("#removewhiteOptions").slideUp("slow")}),$("#brightness").is(":checked")?$("#brightnessOptions").slideDown("slow"):$("#brightnessOptions").slideUp("slow"),$("#brightness").change(function(){$(this).is(":checked")?$("#brightnessOptions").slideDown("slow"):$("#brightnessOptions").slideUp("slow")}),$("#noise").is(":checked")?$("#noiseOptions").slideDown("slow"):$("#noiseOptions").slideUp("slow"),$("#noise").change(function(){$(this).is(":checked")?$("#noiseOptions").slideDown("slow"):$("#noiseOptions").slideUp("slow")}),$("#gradienttransparency").is(":checked")?$("#gradienttransparencyOptions").slideDown("slow"):$("#gradienttransparencyOptions").slideUp("slow"),$("#gradienttransparency").change(function(){$(this).is(":checked")?$("#gradienttransparencyOptions").slideDown("slow"):$("#gradienttransparencyOptions").slideUp("slow")}),$("#pixelate").is(":checked")?$("#pixelateOptions").slideDown("slow"):$("#pixelateOptions").slideUp("slow"),$("#pixelate").change(function(){$(this).is(":checked")?$("#pixelateOptions").slideDown("slow"):$("#pixelateOptions").slideUp("slow")}),$("#tint").is(":checked")?$("#tintOptions").slideDown("slow"):$("#tintOptions").slideUp("slow"),$("#tint").change(function(){$(this).is(":checked")?$("#tintOptions").slideDown("slow"):$("#tintOptions").slideUp("slow")}),$("#multiply").is(":checked")?$("#multiplyOptions").slideDown("slow"):$("#multiplyOptions").slideUp("slow"),$("#multiply").change(function(){$(this).is(":checked")?$("#multiplyOptions").slideDown("slow"):$("#multiplyOptions").slideUp("slow")}),$("#blend").is(":checked")?$("#blendOptions").slideDown("slow"):$("#blendOptions").slideUp("slow"),$("#blend").change(function(){$(this).is(":checked")?$("#blendOptions").slideDown("slow"):$("#blendOptions").slideUp("slow")}),$("#transparency").is(":checked")?$("#transparencyOptions").slideDown("slow"):$("#transparencyOptions").slideUp("slow"),$("#transparency").change(function(){$(this).is(":checked")?$("#transparencyOptions").slideDown("slow"):$("#transparencyOptions").slideUp("slow")}),$("#contrast").is(":checked")?$("#contrastOptions").slideDown("slow"):$("#contrastOptions").slideUp("slow"),$("#contrast").change(function(){$(this).is(":checked")?$("#contrastOptions").slideDown("slow"):$("#contrastOptions").slideUp("slow")})}function applyFilter(t,e){var i,n=canvas.getActiveObject(),r=["Grayscale","Invert","RemoveWhite","Sepia","Sepia2","Brightness","Noise","GradientTransparency","Pixelate","Convolute","Convolute","Convolute","Tint","Multiply","Blend","Contrast"],o=0;if(e!==!1)i="#"+r[t].toLowerCase(),$(i+"-color")&&($(i+"-color").spectrum("enable"),$(i+"-color").spectrum("set","rgb(0, 0, 0)")),14===t&&$("#blend-mode").prop("disabled",!1),n.filters.push(e),n.applyFilters(canvas.renderAll.bind(canvas));else{if(t>=12&&14>=t&&(i="#"+r[t].toLowerCase(),$(i+"-color")&&($(i+"-color").spectrum("disable"),$(i+"-color").spectrum("set",""))),9>t||t>11)for(o=0;n.filters&&o<n.filters.length&&n.filters[o].type!==r[t];o++);else for(o=0;n.filters&&o<n.filters.length&&("Convolute"!==n.filters[o].type||!(9===t&&n.filters[o].matrix[0]===1/9||10===t&&0===n.filters[o].matrix[0]||11===t&&1===n.filters[o].matrix[0]));o++);n.filters.splice(o,1),n.applyFilters(canvas.renderAll.bind(canvas)),14===t&&$("#blend-mode").prop("disabled",!0)}filterIsApplied=!0}function applyFilterValue(t,e,i){var n=canvas.getActiveObject(),r=["Grayscale","Invert","RemoveWhite","Sepia","Sepia2","Brightness","Noise","GradientTransparency","Pixelate","Blur","Sharpen","Emboss","Tint","Multiply","Blend","Contrast"],o=0;if(filter!==!1)for(o=0;n.filters&&o<n.filters.length;o++)n.filters[o].type===r[t]&&(n.filters[o][e]=i,n.applyFilters(canvas.renderAll.bind(canvas)));else{for(o=0;n.filters&&o<n.filters.length&&n.filters[o].type!==r[t];o++);for(;n.filters&&o<n.filters.length-1;o++)n.filters[o]=n.filters[o+1];n.filters[o]=null,n.applyFilters(canvas.renderAll.bind(canvas))}filterIsApplied=!0}function updateFilterCheckbox_select(){$(".filter-checkbox").prop("checked",!1),$("#tint-color").spectrum("disable"),$("#multiply-color").spectrum("disable"),$("#blend-color").spectrum("disable"),$(".filter-input-color").spectrum("set",""),$("#blend-mode").prop("disabled",!0),document.getElementById("remove-white-threshold").value="60",document.getElementById("remove-white-distance").value="10",document.getElementById("brightness-value").value="0",document.getElementById("noise-value").value="100",document.getElementById("gradient-transparency-value").value="100",document.getElementById("pixelate-value").value="4",document.getElementById("tint-opacity").value="0.5",document.getElementById("transparency-value").value="0",document.getElementById("contrast-value").value="1.00";var t,e=canvas.getActiveObject(),i=null===canvas.getActiveGroup();if(null!==e&&(i?fabric.util.toArray(document.getElementsByClassName("filter-checkbox")).forEach(function(t){t.disabled=!1}):fabric.util.toArray(document.getElementsByClassName("filter-checkbox")).forEach(function(t){t.disabled=!0})),null!==e&&i){for(t=0;e.filters&&t<e.filters.length;t++){var n;"Convolute"!==e.filters[t].type?n="#"+e.filters[t].type.toLowerCase():e.filters[t].matrix[0]===1/9?n="#blur":0===e.filters[t].matrix[0]?n="#sharpen":1===e.filters[t].matrix[0]&&(n="#emboss"),$(n).prop("checked",!0),$(n+"-color")&&$(n+"-color").spectrum("enable"),"undefined"!=typeof e.filters[t].color&&$(n+"-color").spectrum("set",e.filters[t].color),"RemoveWhite"===e.filters[t].type&&(document.getElementById("remove-white-threshold").value=e.filters[t].threshold,document.getElementById("remove-white-distance").value=e.filters[t].distance),"Brightness"===e.filters[t].type&&(document.getElementById("brightness-value").value=e.filters[t].brightness),"Noise"===e.filters[t].type&&(document.getElementById("noise-value").value=e.filters[t].noise),"GradientTransparency"===e.filters[t].type&&(document.getElementById("gradient-transparency-value").value=e.filters[t].threshold),"Pixelate"===e.filters[t].type&&(document.getElementById("pixelate-value").value=e.filters[t].blocksize),"Tint"===e.filters[t].type&&(document.getElementById("tint-opacity").value=e.filters[t].opacity),"Contrast"===e.filters[t].type&&(document.getElementById("contrast-value").value=e.filters[t].contrast),"Blend"===e.filters[t].type&&($("#blend-mode").prop("disabled",!1),document.getElementById("blend-mode").value=e.filters[t].mode)}"undefined"!=typeof e.opacity&&(1!==e.opacity&&$("#transparency").prop("checked",!0),document.getElementById("transparency-value").value=1-e.opacity)}}function updateFilterCheckbox_deselect(){fabric.util.toArray(document.getElementsByClassName("filter-checkbox")).forEach(function(t){t.checked=!1,t.disabled=!0}),$("#tint-color").spectrum("disable"),$("#multiply-color").spectrum("disable"),$("#blend-color").spectrum("disable"),$(".filter-input-color").spectrum("set",""),$("#blend-mode").prop("disabled",!0),document.getElementById("remove-white-threshold").value="60",document.getElementById("remove-white-distance").value="10",document.getElementById("brightness-value").value="0",document.getElementById("noise-value").value="100",document.getElementById("gradient-transparency-value").value="100",document.getElementById("pixelate-value").value="4",document.getElementById("tint-opacity").value="0.5",document.getElementById("transparency-value").value="0",document.getElementById("contrast-value").value="1.00"}function rotateSide(t){currentWidth=$("#canvas").css("width"),currentWidth=currentWidth.match(/\d+/)[0],currentWidth=Number(currentWidth),currentHeight=$("#canvas").css("height"),currentHeight=currentHeight.match(/\d+/)[0],currentHeight=Number(currentHeight);var e=$("#fastActionContainerID").css("height");e=e.match(/\d+/)[0],e=Number(e);var i=0;e>currentHeight&&(i=e-currentHeight);var n=currentWidth/canvas.getWidth(),r=currentHeight/canvas.getHeight();if(.5>n||.5>r){var o=r>n?12/n:12/r;t.set({borderColor:"black",cornerSize:o,rotatingPointOffset:155,transparentCorners:!1,borderOpacityWhenMoving:.4})}t.angle=t.angle%360,t.angle>=335||t.angle<=74?(t.oCoords.tl.x<0?btn.style.left="-35px":btn.style.left=t.oCoords.tl.x*n-btnWidth/2-40+"px",t.oCoords.tl.y*r<0?btn.style.top=-Number(currentHeight)-i+"px":btn.style.top=t.oCoords.tl.y*r-btnHeight/2-currentHeight-i+"px"):t.angle>=75&&t.angle<=150?(t.oCoords.bl.x*n<0?btn.style.left="-35px":btn.style.left=t.oCoords.bl.x*n-btnWidth/2-40+"px",t.oCoords.bl.y*r<0?btn.style.top=-Number(currentHeight)-i-8+"px":btn.style.top=t.oCoords.bl.y*r-btnHeight/2-currentHeight-i+"px"):t.angle>=151&&t.angle<=240?(t.oCoords.br.x*n<0?btn.style.left="-35px":btn.style.left=t.oCoords.br.x*n-btnWidth/2-40+"px",t.oCoords.br.y*r<0?btn.style.top=-Number(currentHeight)-i-8+"px":btn.style.top=t.oCoords.br.y*r-btnHeight/2-currentHeight-i+"px"):(t.oCoords.tr.x*n<0?btn.style.left="-35px":btn.style.left=t.oCoords.tr.x*n-btnWidth/2-40+"px",t.oCoords.tr.y*r<0?btn.style.top=-Number(currentHeight-i)-8+"px":btn.style.top=t.oCoords.tr.y*r-btnHeight/2-currentHeight-i+"px")}function positionBtn(t){t.width/t.canvasWidth<=.4&&(btn.style.width=10,btn.style.height=10),crop.disableActionButtons!==!0?(btn.style.visibility="visible",rotateSide(t)):btn.style.visibility="hidden"}function performCrop(t){null!==crop.el&&(canvas.remove(crop.el),crop.el=null,null!==crop.cropObject&&canvas.setActiveObject(crop.cropObject)),crop.startCropFunction(t)&&($("#sortable").children().prop("disabled",!0).addClass("disabled"),$("#galleryDelete").prop("disabled",!0).addClass("disabled"),$("#galleryCenter").prop("disabled",!0).addClass("disabled"),$("#cropToolButton").removeClass("disabled"),cropDisableButtons())}function zoomObjectFunction(t,e){var i;i=t.angle%90===0?(t.angle+5e-4)/180*Math.PI:t.angle/180*Math.PI;var n=t.width*t.scaleX,r=t.height*t.scaleY,o=Math.sin(i),s=Math.cos(i),a=o/s,l=n/o+(r-n/a)*s,c=-1*(r-n/a)*o;t.scaleX*=e,t.scaleY*=e;var h=e*l,u=e*c;t.left-=(u-c)/2,t.top-=(h-l)/2,t.setCoords()}function addImageFromURL(t,e,i,n){(""===imageLink||e)&&(imageLink=t),n=n||0,$("#import").removeAttr("disabled"),$("#backgroundColorPicker").spectrum("enable"),$("#templateDropdown").prop("disabled",!1).removeClass("disabled");var r=document.getElementById("fastActionContainerID");r.style.pointerEvents="auto",fabric.Image.fromURL(t,function(r){var o,s;e===!0&&(""==$("#projectTitleEditor").val()&&self.getProjectTitle(t),r.width>750||r.height>750?(canvas.setWidth(r.width),canvas.setHeight(r.height),canvas.canvasWidth=r.width,canvas.canvasHeight=r.height,canvas.setDimensions({width:r.width,height:r.height},{backstoreOnly:!0}),Number(r.width)>Number(r.height)?(o=750/r.width*r.height,
canvas.setDimensions({width:"750px",height:o+"px"},{cssOnly:!0})):(s=750/r.height*r.width,canvas.setDimensions({width:s+"px",height:"750px"},{cssOnly:!0}))):(canvas.setWidth(r.width),canvas.setHeight(r.height),canvas.canvasWidth=r.width,canvas.canvasHeight=r.height,canvas.setDimensions({width:r.width,height:r.height},{backstoreOnly:!1}))),""!==i.width?(canvas.canvasWidth=i.width,canvas.canvasHeight=i.height,canvas.setWidth(i.width),canvas.setHeight(i.height),(i.width>750||i.height>750)&&(canvas.setDimensions({width:i.width,height:i.height},{backstoreOnly:!1}),Number(canvas.width)>Number(canvas.height)?(o=750/canvas.width*canvas.height,canvas.setDimensions({width:"750px",height:o+"px"},{cssOnly:!0})):(s=750/canvas.height*canvas.width,canvas.setDimensions({width:s+"px",height:"750px"},{cssOnly:!0}))),i.title&&(canvas.templateTitle=i.title)):n=0,$("#fade").show();var a=r.getSrc(),l=projectTitle||"blank",c={action:"firstImage",file:a,firstImage:e,imageTitle:l};$.post(ajaxurl,c,function(t){if("false"!==t){new fabric.Image.fromURL(t,function(t){if(currentWidth=$("canvas").css("width"),currentHeight=$("canvas").css("height"),t.set({top:0,left:0,cropLeft:0,cropTop:0,cropWidth:0,cropHeight:0,stroke:"#000000",strokeWidth:0}),(t.width*t.scaleX>canvas.width||t.height*t.scaleY>canvas.height)&&(t.width*t.scaleX-canvas.width>=t.height*t.scaleY-canvas.height?(t.scaleX=canvas.width/t.width,t.scaleY=t.scaleX):(t.scaleX=canvas.height/t.height,t.scaleY=t.scaleX)),canvas.add(t),canvas.centerObject(t),canvas.renderAll(),e===!0){var i=JSON.stringify(canvas.toJSON(canvasItems));databaseImageSrc=r.getSrc();var o={action:"addQuery",file:databaseImageSrc,jsonInfo:i,commandHistory:JSON.stringify(commandHistory),queryAction:"select",projectTitle:projectTitle};$.post(ajaxurl,o,function(t){getCommandHistory(imageLink,n),commandHistory.clean(""),$("#fade").hide()})}else addImageRenderList();$("span.dimmensionDisplay","#canvasDimmensionDisplay").text(parseInt(canvas.getWidth())+" x "+parseInt(canvas.getHeight()))})}else{if(e===!0){var i=JSON.stringify(canvas.toJSON(canvasItems));databaseImageSrc=r.getSrc(),commandHistory.length<1&&commandHistory.push("");var o={action:"addQuery",file:databaseImageSrc,jsonInfo:i,commandHistory:JSON.stringify(commandHistory),queryAction:"select",projectTitle:projectTitle};$.post(ajaxurl,o,function(t){var e=t.replace(/\\\\n/g,"\\n").replace(/\\\\r/g,"\\r").replace(/\\\\t/g,"\\t").replace(/\\"/g,'"').replace(/\\'/g,"'").replace(/\\\\/g,"\\");canvas.clear();var i=JSON.parse(e);"undefined"==typeof i.templateTitle?DWWPSettings.templateTitle=i.objects[0].templateTitle:DWWPSettings.templateTitle=i.templateTitle,DWWPSettings.templateWidth=i.canvasWidth,DWWPSettings.templateHeight=i.canvasHeight,canvas.canvasWidth=i.canvasWidth,canvas.canvasHeight=i.canvasHeight,canvas.lineWidth=i.lineWidth,canvas.borderStrokeStyle=i.borderStrokeStyle,canvas.templateTitle=i.templateTitle,i.objects.forEach(function(t){var e=t.cropType;e&&(t.clipTo=crop.getClipTo(e))}),canvas.loadFromJSON(i,renderAndLoadCommandHistoryFunction)})}else(r.width*r.scaleX>canvas.width||r.height*r.scaleY>canvas.height)&&(r.width*r.scaleX-canvas.width>=r.height*r.scaleY-canvas.height?(r.scaleX=canvas.width/r.width,r.scaleY=r.scaleX):(r.scaleX=canvas.height/r.height,r.scaleY=r.scaleX)),r.set({top:0,left:0,cropLeft:0,cropTop:0,cropWidth:0,cropHeight:0,canvasWidth:canvas.getWidth(),canvasHeight:canvas.getHeight(),stroke:"#000000",strokeWidth:0}),canvas.add(r),self.saveCommandHistory("Add Image"),$("#fade").hide();$("span.dimmensionDisplay","#canvasDimmensionDisplay").text(parseInt(canvas.getWidth())+" x "+parseInt(canvas.getHeight()))}})})}function copySingleImageFunction(){var t=$.extend({},canvas.getActiveObject());copiedImage={left:t.left+10,top:t.top+10,image:t}}function pasteSingleImageFunction(){if(copiedImage){var t=copiedImage.image;t.left=copiedImage.left,t.top=copiedImage.top,canvas.add(t),canvas.setActiveObject(t),copiedImage.image=$.extend({},copiedImage.image),copiedImage.left+=10,copiedImage.top+=10,self.saveCommandHistory("Paste Image")}}function getCommandHistory(t,e){e=e||0;var i={action:"getCommandHistory",file:t};$.post(ajaxurl,i,function(t){var i,n;if("[]"!==t&&"false"!==t&&" "!==t){var r=t.replace(/\\\\n/g,"\\n").replace(/\\\\r/g,"\\r").replace(/\\\\t/g,"\\t").replace(/\\"/g,'"').replace(/\\'/g,"'").replace(/\\\\/g,"\\");for(fullCommandHistory=JSON.parse(r),commandHistory=JSON.parse(r),i=document.getElementById("log");i.firstChild;)i.removeChild(i.firstChild);for(n=0;n<commandHistory.length;n++)addCommandView(n)}else{canvas.toJSON(canvasItems);for(self.saveCommandHistory("Open Image"),i=document.getElementById("log");i.firstChild;)i.removeChild(i.firstChild);for(n=0;n<commandHistory.length;n++)addCommandView(n)}0!==e&&self.applyTemplateFunction(e[0],e[1],e[2])})}function createClickListener(t,e,i){t.on("click",function(t){i?e(i):e()})}function squareSumRoot(t,e){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))}function squareSum(t,e){return Math.pow(t,2)+Math.pow(e,2)}function setCanvasWidth(t,e){t.style.width=e}function setCanvasHeight(t,e){t.style.height=e}function clickAddImage(){$(window).load(function(){var t=wp.media({title:"Upload Image",multiple:!1,frame:"select",library:{type:"image"}}).open().on("select",function(e){var i=t.state().get("selection").first(),n=i.toJSON().url;""===imageLink?(imageLink=n,addImageFromURL(n,!0,templateSettings)):(templateSettings.title="",templateSettings.width="",templateSettings.height="",addImageFromURL(n,!1,templateSettings)),canvas.renderAll()});$("#media-attachment-date-filters").css("width","200px")})}var idOfImageInGallery,imagesOfGalleryBox,prevIndex,newIndex,difference,filterIsApplied,textId=0,projectTitle,galleryShouldBeUpdated=!0,imageScaleValue,imageRotateValue,created=!1,crop=new InitializeCropping;window.onerror=function(t,e,i,n,r){r&&r.stack||(r={},r.stack=t);var o={action:"logError",error:t+" at "+e+":"+i+", "+n,stackTrace:r.stack};return $.post(ajaxurl,o),!1};var self={},fastAction=document.getElementById("fastActionContainerID");Date.now||(Date.now=function(){return(new Date).getTime()}),fabric.Image.filters.Contrast=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:"Contrast",initialize:function(t){t||(t={}),this.contrast=t.contrast||0},applyTo:function(t){var e,i,n,r,o,s,a,l=Math.max(0,this.contrast+1),c=t.getContext("2d"),h=c.getImageData(0,0,t.width,t.height),u=h.data,f=t.width*t.height,d=4*f;for(n=l,r=128*-l+128;f--;)(o=u[d-=4]*n+r)>255?u[d]=255:0>o?u[d]=0:u[d]=o,(s=u[e=d+1]*n+r)>255?u[e]=255:0>s?u[e]=0:u[e]=s,(a=u[i=d+2]*n+r)>255?u[i]=255:0>a?u[i]=0:u[i]=a;c.putImageData(h,0,0)},toObject:function(){return $.extend(this.callSuper("toObject"),{contrast:this.contrast})}}),fabric.Image.filters.Contrast.fromObject=function(t,e){return new fabric.Image.filters.Contrast(t)},$(document).ajaxStart(function(){openModal()}).ajaxStop(function(){closeModal()}),$(document).ready(function(){function t(t){for(var e=0;e<imagesOfGalleryBox.length;e++)t.id===imagesOfGalleryBox[e].id&&($("#sortable li").eq(e).remove(),imagesOfGalleryBox.splice(e,1),e=imagesOfGalleryBox.length)}crop.setCanvas(canvas),model=_initializeKnockout(),_initializeSpectrum(),_initializeTypography(),createClickListener(divButtons.undoTab(),undoFunction),createClickListener(divButtons.redoTab(),redoFunction),createClickListener(divButtons.changeCanvasBackgroundButton(),changeCanvasBackgroundFunction),createClickListener(divButtons.sendErrorTab(),sendErrorFunction),$("#sendErrorDialog").dialog({resizable:!1,width:400,height:300,modal:!0,autoOpen:!1,buttons:{"Send Report":function(t){if(created){var e={action:"logError",error:"User Reported Error",stackTrace:$("#sendErrorText").val(),sendLog:!0};$.post(ajaxurl,e),$("#sendErrorDialog").dialog("close")}},Cancel:function(t){$("#sendErrorDialog").dialog("close")}}}),$("#previewImageDialog").dialog({resizable:!0,modal:!0,autoOpen:!1});var e=$(".ui-dialog-buttonpane").find("button");e.addClass("button button-primary"),$(e[0]).text("Send Report"),$(e[1]).text("Cancel"),$("#ui-id-1").parent().addClass("errorDialogOverride"),$("<br>").insertBefore("#sendErrorDialog");var i=$(".ui-dialog-titlebar-close");i.removeClass("ui-dialog-titlebar-close").addClass("button-link media-modal-close"),i.append($("<span class='media-modal-icon'></span>")),$("#transformToolOptions").accordion({header:"> div > h3",heightStyle:"content"}),$("#transformToolOptions").draggable(),$("#borderToolOptions").draggable();var n=document.getElementById("templateDropdown");n.addEventListener("change",function(t){optionCheck(),$("#templateDropdown").blur()}),$("#upload-btn").click(function(t){t.preventDefault();var e=wp.media({title:"Upload Image",multiple:!1,frame:"select",library:{type:"image"}}).open().on("select",function(t){var i=e.state().get("selection").first(),n=i.toJSON().url;""===imageLink?(DWWPSettings.imageLink=n,imageLink=n,addImageFromURL(n,!0,templateSettings)):imageLink===n?window.alert("You cannot add the main image again to the canvas."):(templateSettings.title="",templateSettings.width="",templateSettings.height="",addImageFromURL(n,!1,templateSettings)),canvas.renderAll()});$("#media-attachment-date-filters").css("width","200px")}),$("#borderImageWidthValue").change(function(){ImageFunctions.applyImageBorder()}),$("#borderCanvasWidthValue").change(function(){ImageFunctions.applyCanvasBorder()}),$("#templateDropdownNewProject").change(function(){"createTemplate"===$(this).find("option:selected").val()?($("#newTemplateContainer").slideDown(),$("#createTemplateTitle").prop("required",!0),$("#createTemplateWidth").prop("required",!0),$("#createTemplateHeight").prop("required",!0)):($("#newTemplateContainer").slideUp(),$("#createTemplateTitle").prop("required",!1),$("#createTemplateWidth").prop("required",!1),$("#createTemplateHeight").prop("required",!1))}),$(".button-wrap").on("click",function(){$(this).toggleClass("button-active")}),$("#resizeButton").hover(function(){$("#resizeOptions").slideDown("fast")}),$("#resizeOptions").bind("mouseleave",function(){$("#resizeOptions").slideUp("medium")}),canvas.on("after:render",function(t){canvas.lineWidth&&self.drawCanvasBorderFunction()}),canvas.on("selection:created",function(t){t.target.forEachObject(function(t){t.hasBorders=!1}),canvas.renderAll()}),$("#borderToolOptions").hide(),$("#borderImageStyleValue").spectrum("set","black"),$("#borderImageStyleValue").spectrum("enable"),canvas.on("object:added",function(t){$("#sortable").empty(),imagesOfGalleryBox=[],idOfImageInGallery=-1,textId=0;for(var e=canvas.getObjects(),i=0;i<e.length;i++){idOfImageInGallery++,e[i].id=idOfImageInGallery;var n=document.createElement("li");n.id=e[i].id;var r=document.createElement("div");if("i-text"===e[i].type){textId++;var o=document.createElement("p");o.className="textInGallery",o.id="textInGallery"+textId,o.innerHTML="Text "+textId,r.appendChild(o),n.appendChild(r),$("#sortable").prepend(n),imagesOfGalleryBox.unshift(n)}else if("image"===e[i].type){var s=document.createElement("img");s.src=e[i].getSrc();var a=97/e[i].width,l=60/e[i].height;e[i].width<=97&&e[i].height<=60?(s.width=e[i].width,s.length=e[i].height):l>=a?(s.width=e[i].width*a,s.length=e[i].height*a):(s.width=e[i].width*l,s.length=e[i].height*l),r.appendChild(s),n.appendChild(r),$("#sortable").prepend(n),imagesOfGalleryBox.unshift(n)}}canvas.getActiveObject()&&canvas.fire("object:selected")}),canvas.on("after:render",function(t){if(filterIsApplied||galleryShouldBeUpdated){filterIsApplied=!1,$("#sortable").empty(),imagesOfGalleryBox=[],idOfImageInGallery=-1,textId=0;for(var e=canvas.getObjects(),i=0;i<e.length;i++){idOfImageInGallery++,e[i].id=idOfImageInGallery;var n=document.createElement("li");n.id=e[i].id;var r=document.createElement("div");if("i-text"===e[i].type){textId++;var o=document.createElement("p");o.className="textInGallery",o.id="textInGallery"+textId,o.innerHTML="Text "+textId,r.appendChild(o),n.appendChild(r),$("#sortable").prepend(n),imagesOfGalleryBox.unshift(n)}else if("image"===e[i].type){var s=document.createElement("img");s.src=e[i].getSrc();var a=97/e[i].width,l=60/e[i].height;e[i].width<=97&&e[i].height<=60?(s.width=e[i].width,s.length=e[i].height):l>=a?(s.width=e[i].width*a,s.length=e[i].height*a):(s.width=e[i].width*l,s.length=e[i].height*l),r.appendChild(s),n.appendChild(r),$("#sortable").prepend(n),imagesOfGalleryBox.unshift(n)}}canvas.getActiveObject()&&canvas.fire("object:selected")}$("#saveBox").css("top",$("#wpadminbar").height()+"px")}),canvas.on("object:selected",function(t){var e=canvas.getActiveObject();if(e){e.hasBorders=!0,galleryShouldBeUpdated=!1;for(var i=0;i<imagesOfGalleryBox.length;i++)parseInt(imagesOfGalleryBox[i].id)===e.id&&($("#sortable li").eq(i).addClass("ui-selected"),$("#sortable li").eq(i).siblings().removeClass("ui-selected"));crop.el||(areObjectsOfType("image")||areObjectsOfType("i-text"))&&(areObjectsOfType("image")&&self.enableToolSetButtons(),$("#galleryDelete").prop("disabled",!1).removeClass("disabled"),$("#galleryCenter").prop("disabled",!1).removeClass("disabled")),canvas.getActiveGroup()?(positionBtn(canvas.getActiveGroup()),$("#sortable").children().removeClass("ui-selected"),$("#galleryDelete").prop("disabled",!0).addClass("disabled"),$("#galleryCenter").prop("disabled",!0).addClass("disabled")):($("#galleryDelete").prop("disabled",!1).removeClass("disabled"),$("#galleryCenter").prop("disabled",!1).removeClass("disabled"),initializeTransformOption())}}),canvas.on("selection:cleared",function(t){if(galleryShouldBeUpdated=!0,self.disableToolSetButtons(),$("#galleryDelete").prop("disabled",!0).addClass("disabled"),$("#galleryCenter").prop("disabled",!0).addClass("disabled"),$("#sortable").children().removeClass("ui-selected"),canvas.getObjects()&&0!==canvas.getObjects().length){for(var e=canvas.getObjects(),i=imagesOfGalleryBox.slice(0),n=0;n<e.length;n++)for(var r=0;r<i.length;r++)e[n].id===i[r].id&&(imagesOfGalleryBox[n]=i[r]);for(imagesOfGalleryBox.reverse(),$("#sortable").empty(),n=0;n<imagesOfGalleryBox.length;n++)$("#sortable").append(imagesOfGalleryBox[n])}btn.style.visibility="hidden"}),$("#sortable").on("click","li",function(){$(this).siblings().removeClass("ui-selected");for(var t,e=parseInt($(this).attr("id")),i=0;i<canvas.getObjects().length;i++)canvas.getObjects()[i].id===e&&(t=canvas.getObjects()[i],i=canvas.getObjects().length);canvas.setActiveObject(t)}),$("#sortable").sortable({opacity:.9,items:"> li",handle:"div",tolerance:"pointer",placeholder:"ui-state-highlight-gallery",start:function(t,e){prevIndex=e.item.index()},update:function(t,e){newIndex=e.item.index();var i,n,r,o;if(newIndex>prevIndex){for(difference=newIndex-prevIndex,i=canvas.getObjects().length-1,n=canvas.getObjects()[i-prevIndex],r=0;difference>r;r++)canvas.sendBackwards(n);for(r=prevIndex;newIndex>r;r++)o=imagesOfGalleryBox[r+1],imagesOfGalleryBox[r+1]=imagesOfGalleryBox[r],imagesOfGalleryBox[r]=o;1===difference?self.saveCommandHistory(difference+" Layer Back"):self.saveCommandHistory(difference+" Layers Back")}else if(prevIndex>newIndex){for(difference=prevIndex-newIndex,i=canvas.getObjects().length-1,n=canvas.getObjects()[i-prevIndex],r=0;difference>r;r++)canvas.bringForward(n);for(r=prevIndex;r>newIndex;r--)o=imagesOfGalleryBox[r-1],imagesOfGalleryBox[r-1]=imagesOfGalleryBox[r],imagesOfGalleryBox[r]=o;1===difference?self.saveCommandHistory(difference+" Layer Forward"):self.saveCommandHistory(difference+" Layers Forward")}}}),$("#galleryDelete").click(function(e){var i=canvas.getActiveObject();i&&(t(i),canvas.remove(i),btn.style.visibility="hidden","i-text"===i.type?self.saveCommandHistory("Remove Text"):self.saveCommandHistory("Remove Image"))}),$("#galleryCenter").click(function(t){var e=canvas.getActiveObject();e&&(e.set({borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",cornerSize:12,transparentCorners:!0}),canvas.centerObject(e),e.setCoords(),positionBtn(e),self.saveCommandHistory("Center Image"))}),$("#galleryDelete").prop("disabled",!0).addClass("disabled"),$("#galleryCenter").prop("disabled",!0).addClass("disabled"),$("#upload-btn").hover(function(t){$("#upload-btn").animate({color:"#0073AA"},"fast")},function(t){$("#upload-btn").animate({color:"#EEEEEE"},"fast")}),setupDragAndDrop()}),$(window).bind("beforeunload",function(){var t=$("#projectTitleEditor").val();return"undefined"==typeof commandHistory[commandHistory.length-1]||"Save Image"===commandHistory[commandHistory.length-1].saveAction&&projectTitle&&t===projectTitle?void 0:"You have unsaved changes to your project. Are you sure you want to leave?"}),self.projectCloseFunction=function(){var t=window.location.pathname+"?page=imageEditorPage.php";window.location.href=t},$("#cropToolOptions").hide();var databaseImageSrc,commandHistory=[],fullCommandHistory=[],undoArray=[],copiedImage,useTimestampChange=!1;$("#inline-btn").attr("src",DWWPSettings.path+"/remove.png");var paged=DWWPSettings.paged,postID=DWWPSettings.postID,imageLink=DWWPSettings.imageLink,createdNewImage=DWWPSettings.projectTitle,templateSettings={title:DWWPSettings.templateTitle,width:DWWPSettings.templateWidth,height:DWWPSettings.templateHeight},applyTemplate,canvasItems=["cropLeft","cropTop","cropWidth","cropHeight","canvasWidth","canvasHeight","templateTitle","borderCropTop","borderCropLeft","borderCropWidth","borderCropHeight","lineWidth","lastCrop","borderStrokeStyle","scaleX","scaleY","cropType","filters","opacity","filters_count","left","top","stroke","strokeWidth","cropPoints","cropAngle"],model;self.applyTemplateFunction=function(t,e,i){canvas.canvasWidth=t,canvas.canvasHeight=e,canvas.templateTitle=i,canvas.deactivateAll().renderAll(),btn.style.visibility="hidden";var n=t+","+e+","+i;$("#templateDropdown option[value='"+n+"']").length>0?$("#templateDropdown option[value='"+n+"']").attr("selected",!0):$("#templateDropdown option[value='']").attr("selected",!0),templateSettings.title=i,templateSettings.width=t,templateSettings.height=e,canvas.setWidth(t),canvas.setHeight(e);var r=canvas.getObjects();r[0].canvasWidth=templateSettings.width,r[0].canvasHeight=templateSettings.height,r[0].templateTitle=templateSettings.title,canvas.canvasWidth=templateSettings.width,canvas.canvasHeight=templateSettings.height,canvas.templateTitle=templateSettings.title;for(var o=0;o<canvas.getObjects().length;o++){var s=canvas.getObjects()[o];(s.width*s.scaleX>canvas.width||s.height*s.scaleY>canvas.height)&&(s.width*s.scaleX-canvas.width>=s.height*s.scaleY-canvas.height?(s.scaleX=canvas.width/s.width,s.scaleY=s.scaleX):(s.scaleX=canvas.height/s.height,s.scaleY=s.scaleX)),self.centerFunction(s)}self.disableToolSetButtons(),btn.style.visibility="hidden",$("span.dimmensionDisplay","#canvasDimmensionDisplay").text(parseInt(canvas.getWidth())+" x "+parseInt(canvas.getHeight())),""===imageLink&&clickAddImage(),renderFunction(),updateFilterCSS(),self.saveCommandHistory("Apply Template")};var splitBtn=$(".x-split-button");Array.prototype.clean=function(t){for(var e=0;e<this.length;e++)this[e]===t&&(this.splice(e,1),e--);return this},self.saveCommandHistory=function(t){var e=canvas.toJSON(canvasItems);e.saveAction=t,e.timestamp=getJSDate(),useTimestampChange!==!1&&(commandHistory.length=parseInt(useTimestampChange)+1,undoArray=[],useTimestampChange=!1),commandHistory.push(e),commandHistory.clean("");for(var i=document.getElementById("log");i.firstChild;)i.removeChild(i.firstChild);for(var n=0;n<commandHistory.length;n++)addCommandView(n)};var currentWidth,currentHeight;currentWidth=$("canvas").css("width"),currentHeight=$("canvas").css("height");var imageUndoChecker=[],canvas=new fabric.Canvas("canvas",{stateful:!1});canvas.borderStrokeStyle="black";var context=document.getElementById("canvas"),filter=fabric.Image.filters;fabric.util.toArray(document.getElementsByClassName("filter-input")).forEach(function(t){t.disabled=!0}),$("#blend-mode").prop("disabled",!0),$("#filter-controls").hide(),$("#filter-controls").draggable(),self.showFilters=function(){updateFilterCSS(),$("#filter-controls").toggle()},$("#grayscale").on("change",function(){applyFilter(0,this.checked&&new filter.Grayscale),self.saveCommandHistory("Apply Filter")}),$("#invert").on("click",function(){applyFilter(1,this.checked&&new filter.Invert),self.saveCommandHistory("Apply Filter")}),$("#removewhite").on("click",function(){applyFilter(2,this.checked&&new filter.RemoveWhite({threshold:document.getElementById("remove-white-threshold").value,distance:document.getElementById("remove-white-distance").value})),self.saveCommandHistory("Apply Filter")}),$("#remove-white-threshold").on("change",function(){applyFilterValue(2,"threshold",this.value),self.saveCommandHistory("Apply Filter")}),$("#remove-white-distance").on("change",function(){applyFilterValue(2,"distance",this.value),self.saveCommandHistory("Apply Filter")}),$("#sepia").on("click",function(){applyFilter(3,this.checked&&new filter.Sepia),self.saveCommandHistory("Apply Filter")}),$("#sepia2").on("click",function(){applyFilter(4,this.checked&&new filter.Sepia2),self.saveCommandHistory("Apply Filter")}),$("#brightness").on("click",function(){applyFilter(5,this.checked&&new filter.Brightness({brightness:parseInt(document.getElementById("brightness-value").value,10)})),self.saveCommandHistory("Apply Filter")}),$("#brightness-value").on("change",function(){applyFilterValue(5,"brightness",parseInt(this.value,10)),self.saveCommandHistory("Apply Filter")}),$("#noise").on("click",function(){applyFilter(6,this.checked&&new filter.Noise({noise:parseInt(document.getElementById("noise-value").value,10)})),self.saveCommandHistory("Apply Filter")}),$("#noise-value").on("change",function(){applyFilterValue(6,"noise",parseInt(this.value,10)),self.saveCommandHistory("Apply Filter")}),$("#gradienttransparency").on("click",function(){applyFilter(7,this.checked&&new filter.GradientTransparency({threshold:parseInt(document.getElementById("gradient-transparency-value").value,10)})),self.saveCommandHistory("Apply Filter")}),$("#gradient-transparency-value").on("change",function(){applyFilterValue(7,"threshold",parseInt(this.value,10)),self.saveCommandHistory("Apply Filter")}),$("#pixelate").on("click",function(){applyFilter(8,this.checked&&new filter.Pixelate({blocksize:parseInt(document.getElementById("pixelate-value").value,10)})),self.saveCommandHistory("Apply Filter")}),$("#pixelate-value").on("change",function(){applyFilterValue(8,"blocksize",parseInt(this.value,10)),self.saveCommandHistory("Apply Filter")}),$("#blur").on("click",function(){applyFilter(9,this.checked&&new filter.Convolute({matrix:[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]})),self.saveCommandHistory("Apply Filter")}),$("#sharpen").on("click",function(){applyFilter(10,this.checked&&new filter.Convolute({matrix:[0,-1,0,-1,5,-1,0,-1,0]})),self.saveCommandHistory("Apply Filter")}),$("#emboss").on("click",function(){applyFilter(11,this.checked&&new filter.Convolute({matrix:[1,1,1,1,.7,-1,-1,-1,-1]})),self.saveCommandHistory("Apply Filter")}),$("#tint").on("click",function(){applyFilter(12,this.checked&&new filter.Tint({color:document.getElementById("tint-color").value,opacity:parseFloat(document.getElementById("tint-opacity").value)})),self.saveCommandHistory("Apply Filter")}),$("#tint-color").on("change",function(){applyFilterValue(12,"color",this.value),self.saveCommandHistory("Apply Filter")}),$("#tint-opacity").on("change",function(){applyFilterValue(12,"opacity",parseFloat(this.value)),self.saveCommandHistory("Apply Filter")}),$("#multiply").on("click",function(){applyFilter(13,this.checked&&new filter.Multiply({color:document.getElementById("multiply-color").value})),self.saveCommandHistory("Apply Filter")}),$("#multiply-color").on("change",function(){applyFilterValue(13,"color",this.value),self.saveCommandHistory("Apply Filter")}),$("#blend").on("click",function(){applyFilter(14,this.checked&&new filter.Blend({color:document.getElementById("blend-color").value,mode:document.getElementById("blend-mode").value})),document.getElementById("blend-mode").value="add",self.saveCommandHistory("Apply Filter")}),$("#blend-mode").on("change",function(){applyFilterValue(14,"mode",this.value),self.saveCommandHistory("Apply Filter")}),$("#blend-color").on("change",function(){applyFilterValue(14,"color",this.value),self.saveCommandHistory("Apply Filter")}),$("#transparency").on("change",function(){document.getElementById("transparency-value").value="0.0";var t=canvas.getActiveObject();t.setOpacity(1),canvas.renderAll(),self.saveCommandHistory("Change Opacity")}),$("#transparency-value").on("change",function(){var t=canvas.getActiveObject();t.setOpacity(parseFloat(1-this.value,10)),canvas.renderAll(),self.saveCommandHistory("Change Opacity")}),$("#contrast").on("change",function(){applyFilter(15,this.checked&&new filter.Contrast({contrast:document.getElementById("contrast-value").value})),self.saveCommandHistory("Apply Filter")}),$("#contrast-value").on("change",function(){applyFilterValue(15,"contrast",this.value),self.saveCommandHistory("Apply Filter")});var lastSelected=null;canvas.on("object:selected",function(){self.enableToolSetButtons(),updateFilterCheckbox_select(),updateFilterControl(),lastSelected!==canvas.getActiveObject()&&(lastSelected=canvas.getActiveObject(),$("#borderImageWidthValue").val(canvas.getActiveObject().strokeWidth.toString()),$("#borderImageStyleValue").spectrum("set",canvas.getActiveObject().stroke))}),canvas.on("selection:cleared",function(){updateFilterCheckbox_deselect(),updateFilterControl(),lastSelected=null}),canvas.on("object:added",function(t){var e=canvas.getObjects(),i=document.getElementById("templateDropdown");if(null!==e&&0!==e.length)if(e[0].templateTitle&&""===i.value){var n=e[0].canvasWidth+","+e[0].canvasHeight+","+e[0].templateTitle;$("#templateDropdown").val(n)}else if(""!==i.value){var r=i.value.split(","),o=parseInt(r[0]),s=parseInt(r[1]);e[0].canvasWidth=o,e[0].canvasHeight=s,e[0].templateTitle=r[2],canvas.templateTitle=r[2]}}),canvas.on("mouse:down",function(t){if(areObjectsOfType("image")&&t.target){crop.el&&null!==crop.el?self.disableToolSetButtons():self.enableToolSetButtons();var e=t.target;imageUndoChecker.left=e.left,imageUndoChecker.top=e.top,imageUndoChecker.scaleX=e.scaleX,imageUndoChecker.scaleY=e.scaleY,imageUndoChecker.angle=e.angle,("undefined"!=typeof e.startingX||"undefined"!=typeof e.startingY)&&(e.startingX=void 0,e.startingY=void 0,e.lockMovementY=!1,e.lockMovementX=!1),positionBtn(e),e.on("moving",function(t){if(t.e.shiftKey===!0){("undefined"==typeof this.startingX||"undefined"==typeof this.startingY)&&(this.startingX=this.left,this.startingY=this.top);var i=Math.abs(this.left-this.startingX),n=Math.abs(this.top-this.startingY);(i>25||n>25)&&(i>n?(this.top=this.startingY,this.lockMovementY=!0):(this.left=this.startingX,this.lockMovementX=!0))}else("undefined"!=typeof e.startingX||"undefined"!=typeof e.startingY)&&(e.startingX=void 0,e.startingY=void 0,e.lockMovementY=!1,e.lockMovementX=!1);btn.style.visibility="hidden"}),e.on("scaling",function(){btn.style.visibility="hidden",this.lockUniScaling=!0,t.e.altKey===!0&&t.e.shiftKey===!0&&(this.lockUniScaling=!1),canvas.getActiveGroup()||initializeTransformOption()}),e.on("rotating",function(){btn.style.visibility="hidden",canvas.getActiveGroup()||initializeTransformOption()}),positionBtn(e)}}),canvas.on("mouse:up",function(t){if(t.target){var e=t.target;areObjectsOfType("image")&&(e.lockMovementX=!1,e.lockMovementY=!1,e.on("scaling",function(){this.lockUniScaling=!0}))}});var tabs=$("#tabs").tabs();tabs.find(".ui-tabs-nav").sortable({axis:"x",stop:function(){tabs.tabs("refresh")}});var btn=document.getElementById("inline-btn"),btnWidth=5,btnHeight=5;canvas.on("mouse:move",function(t){}),self.drawCanvasBorderFunction=function(){var t=document.getElementById("canvas").getContext("2d");t.lineWidth=canvas.lineWidth,canvas.borderStrokeStyle&&(t.strokeStyle=canvas.borderStrokeStyle),t.beginPath(),t.moveTo(0,0),t.lineTo(canvas.width,0),t.lineTo(canvas.width,canvas.height),t.lineTo(0,canvas.height),t.lineTo(0,0),t.stroke()},self.centerFunction=function(t){t?(canvas.centerObject(t),t.setCoords(),positionBtn(t)):canvas.getActiveGroup()?(t=canvas.getActiveGroup(),canvas.centerObject(t),t.setCoords(),positionBtn(t),canvas.getActiveGroup().active=!1,canvas.setActiveGroup(t),self.saveCommandHistory("Center Image")):(t=canvas.getActiveObject(),t.set({borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",cornerSize:12,transparentCorners:!0}),canvas.centerObject(t),t.setCoords(),positionBtn(t),self.saveCommandHistory("Center Image"))},self.positionBtn=function(t){return positionBtn(t)},canvas.on("object:modified",function(){var t=canvas.getActiveObject()?canvas.getActiveObject():canvas.getActiveGroup();if(t){var e=document.getElementById("inline-btn");e.style.visibility="visible",positionBtn(t)}}),canvas.on("object:moving",function(){var t=document.getElementById("inline-btn");t.style.visibility="hidden"}),canvas.on("object:scaling",function(){var t=document.getElementById("inline-btn");t.style.visibility="hidden"}),canvas.on("object:rotating",function(){var t=document.getElementById("inline-btn");t.style.visibility="hidden"}),canvas.on("object:selected",function(){var t=canvas.getActiveObject()?canvas.getActiveObject():canvas.getActiveGroup();if(t){var e=document.getElementById("inline-btn");e.style.visibility="visible",positionBtn(t)}}),self.circleCrop=function(){performCrop("circle")},self.squareCrop=function(){performCrop("square")},self.freeFormCrop=function(){performCrop("freeForm")},self.removeImages=function(){canvas.getActiveGroup()?(canvas.getActiveGroup().forEachObject(function(t){removeFromGalleryBox(t),canvas.remove(t)}),canvas.discardActiveGroup().renderAll(),self.saveCommandHistory("Remove Objects")):canvas.getActiveObject()&&(removeFromGalleryBox(canvas.getActiveObject()),canvas.remove(canvas.getActiveObject()),"i-text"===canvas.getActiveObject.type?self.saveCommandHistory("Remove Text"):self.saveCommandHistory("Remove Image")),btn.style.visibility="hidden",canvas.renderAll()};var rotateFunction=function(t){var e;e=canvas.getActiveGroup()?canvas.getActiveGroup():canvas.getActiveObject();var i=e.getAngle();e.setAngle(i+t),e.setCoords(),canvas.renderAll(),positionBtn(e),self.saveCommandHistory("Rotate Image")},thumb=new crop.CropZone({fill:"transparent",width:150,height:150,hasControls:!0,hasBorders:!0,originX:"left",originY:"top",cornerColor:"#444",cornerSize:8,transparentCorners:!1,lockRotation:!0,hasRotatingPoint:!1}),ThumbnailLeft,ThumbnailTop,originalView=function(){self.enableMenuButtons(),crop.disableActionButtons=!1,thumb.selectable=!1,ThumbnailLeft=thumb.left,ThumbnailTop=thumb.top,canvas.remove(thumb);for(var t=0;t<canvas.getObjects().length;t++)canvas.item(t).selectable=!0},thumbnailView=function(){crop.disableActionButtons=!0,btn.style.visibility="hidden";for(var t=0;t<canvas.getObjects().length;t++)canvas.item(t).selectable=!1;self.disableMenuButtons(),thumb.selectable=!0,canvas.add(thumb),canvas.setActiveObject(thumb),ThumbnailLeft=thumb.left,ThumbnailTop=thumb.top};self.disableMenuButtons=function(){$("#import").prop("disabled",!0).addClass("disabled"),$("#upload-btn").prop("disabled",!0).addClass("disabled"),$("#backgroundColorPicker").spectrum("disable"),$("#undoTab").prop("disabled",!0).addClass("disabled"),$("#redoTab").prop("disabled",!0).addClass("disabled"),$("#save").prop("disabled",!0).addClass("disabled"),$("#copySave").prop("disabled",!0).addClass("disabled"),$("#preview").prop("disabled",!0).addClass("disabled"),$("#saveDropdown").prop("disabled",!0).addClass("disabled"),$("#templateDropdown").prop("disabled",!0).addClass("disabled")},self.enableMenuButtons=function(){$("#sortable").children().prop("disabled",!1).removeClass("disabled"),$("#import").prop("disabled",!1).removeClass("disabled"),$("#upload-btn").prop("disabled",!1).removeClass("disabled"),$("#backgroundColorPicker").spectrum("enable"),
$("#undoTab").prop("disabled",!1).removeClass("disabled"),$("#redoTab").prop("disabled",!1).removeClass("disabled"),$("#save").prop("disabled",!1).removeClass("disabled"),$("#copySave").prop("disabled",!1).removeClass("disabled"),$("#preview").prop("disabled",!1).removeClass("disabled"),$("#saveDropdown").prop("disabled",!1).removeClass("disabled"),$("#templateDropdown").prop("disabled",!1).removeClass("disabled")};var cropDisableButtons=function(){$("#zoomInButton").prop("disabled",!0).addClass("disabled"),$("#forwardToolButton").prop("disabled",!0).addClass("disabled"),$("#frontToolButton").prop("disabled",!0).addClass("disabled"),$("#centerToolButton").prop("disabled",!0).addClass("disabled"),$("#flipVToolButton").prop("disabled",!0).addClass("disabled"),$("#zoomOutButton").prop("disabled",!0).addClass("disabled"),$("#backwardToolButton").prop("disabled",!0).addClass("disabled"),$("#backToolButton").prop("disabled",!0).addClass("disabled"),$("#transformToolButton").prop("disabled",!0).addClass("disabled"),$("#flipHToolButton").prop("disabled",!0).addClass("disabled"),$("#showFiltersControl").prop("disabled",!0).addClass("disabled"),$("#filter-controls").hide(),$("#textButton").prop("disabled",!0).addClass("disabled"),$("#borderToolButton").prop("disabled",!0).addClass("disabled")};self.toggleCrop=function(){if(crop.startCropFunction()){var t=$("#cropToolButton"),e=$("#cropToolButton").position(),i=$("#cropToolOptions");if(i.css({top:e.top+20,left:e.left+t.width()+55}),$("#cropToolOptions").is(":visible")?($("#cropToolButton").removeClass("highlightOption"),$("#sortable").children().prop("disabled",!1).removeClass("disabled"),$("#galleryDelete").prop("disabled",!1).removeClass("disabled"),$("#galleryCenter").prop("disabled",!1).removeClass("disabled"),$("#upload-btn").prop("disabled",!1).removeClass("disabled")):($("#freeformCropOption").removeClass("cropSelected"),$("#squareCropOption").removeClass("cropSelected"),$("#circleCropOption").removeClass("cropSelected"),$("#sortable").children().prop("disabled",!0).addClass("disabled"),$("#galleryDelete").prop("disabled",!0).addClass("disabled"),$("#galleryCenter").prop("disabled",!0).addClass("disabled"),$("#cropToolButton").removeClass("disabled"),$("#cropToolButton").addClass("highlightOption")),cropDisableButtons(),i.toggle(),"none"===$("#cropToolOptions").css("display")){var n=canvas.getActiveObject();null!==n&&(self.enableToolSetButtons(),self.enableMenuButtons())}}},self.toggleBorder=function(){var t=$("#borderToolButton"),e=$("#borderToolButton").position(),i=$("#borderToolOptions");i.css({top:e.top+20,left:e.left+t.width()+55}),$("#borderToolOptions").is(":visible")?$("#borderToolButton").removeClass("highlightOption"):($("#borderToolButton").prop("disabled",!1).removeClass("disabled"),$("#borderToolButton").addClass("highlightOption"),canvas.lineWidth?$("#borderCanvasWidthValue").val(canvas.lineWidth):$("#borderCanvasWidthValue").val(0),$("#borderCanvasStyleValue").spectrum("set",canvas.borderStrokeStyle)),i.toggle()},self.toggleText=function(t){var e=!1,i=$("#textOptions"),n=$("#textButton"),r=n.position();return t?($("#textButton").prop("disabled",!1).removeClass("disabled"),"block"===i.css("display")?e=!0:(i.css({top:r.top+20+"px",left:r.left+2*n.width()+45+"px"}),i.css("display","block")),fastAction.style.pointerEvents="auto"):i.css("display","none"),e},self.toggleTransform=function(){var t=$("#transformToolButton"),e=$("#transformToolButton").position(),i=$("#transformToolOptions");i.css({top:e.top,left:e.left+t.width()+55}),initializeTransformOption(),$("#transformToolOptions").is(":visible")?$("#transformToolButton").removeClass("highlightOption"):($("#transformToolButton").removeClass("disabled"),$("#transformToolButton").addClass("highlightOption")),i.toggle()};var initializeTransformOption=function(t){if(t=t||canvas.getActiveObject(),!t)return window.alert("Please select an object or layer"),void $("#transformToolOptions").toggle();var e=t.height+t.width,i=t.height*t.scaleY+t.width*t.scaleX,n=i/e;$("#imageScale").val(100*n);imageRotateValue=t.angle,$("#imageRotate").val(t.angle)};self.flipXFunction=function(){var t;t=canvas.getActiveGroup()?canvas.getActiveGroup():canvas.getActiveObject(),t.flipX=!t.flipX,t.setCoords(),canvas.renderAll(),canvas.renderAll(),positionBtn(t),self.saveCommandHistory("Flip H")},self.flipYFunction=function(){var t;t=canvas.getActiveGroup()?canvas.getActiveGroup():canvas.getActiveObject(),t.flipY=!t.flipY,t.setCoords(),canvas.renderAll(),canvas.renderAll(),positionBtn(t),self.saveCommandHistory("Flip V")},self.bottomFunction=function(){canvas.getActiveGroup()?canvas.getActiveGroup().forEachObject(function(t){canvas.sendToBack(t)}):(canvas.sendToBack(canvas.getActiveObject()),sendImageBackToEndInGalleryBox(canvas.getActiveObject())),self.saveCommandHistory("Send to Back")},self.topFunction=function(){canvas.getActiveGroup()?canvas.getActiveGroup().forEachObject(function(t){canvas.bringToFront(canvas.getActiveObject(t))}):(canvas.bringToFront(canvas.getActiveObject()),sendImageForwardToFrontInGalleryBox(canvas.getActiveObject())),self.saveCommandHistory("Send to Front")},self.downFunction=function(){canvas.getActiveGroup()?canvas.getActiveGroup().forEachObject(function(t){canvas.sendBackwards(t)}):(canvas.sendBackwards(canvas.getActiveObject()),sendImageBackInGalleryBox(canvas.getActiveObject())),self.saveCommandHistory("1 Layer Back")},self.zoomInFunction=function(t){var e=1.05;t&&(e=1/e);var i=canvas.getActiveObject()||canvas.getActiveGroup();if("group"===i.type){i.forEachObject(function(t){zoomObjectFunction(t,e),positionBtn(t),initializeTransformOption(t)});var n=i.objects[0];i.removeWithUpdate(n),i.addWithUpdate(n)}else zoomObjectFunction(i,e),positionBtn(i),initializeTransformOption();canvas.renderAll(),t?self.saveCommandHistory("Zoom Out"):self.saveCommandHistory("Zoom In")},self.zoomOutFunction=function(){self.zoomInFunction(!0)};var addCommandView=function(t){var e=$("#log"),i=$("<li></li>",{arg:t,style:"font-size: small",text:commandHistory[t].timestamp+" - "+commandHistory[t].saveAction,on:{click:function(){loadFromTimestamp($(this).attr("arg"))}}});"Save Image"===commandHistory[t].saveAction&&i.addClass("saveCommand"),"Apply Template"===commandHistory[t].saveAction&&i.addClass("templateCommand"),i.appendTo($("#log")),e.scrollTop(e[0].scrollHeight)},loadFromTimestamp=function(t){var e=commandHistory[t];if(e.objects.forEach(function(t){var e=t.cropType;e&&(t.clipTo=crop.getClipTo(e))}),null!==e&&!$("#cropToolOptions").is(":visible")){if(useTimestampChange=t,canvas.clear(),templateSettings.title="",templateSettings.width="",templateSettings.height="",null!==e.templateTitle){var i=e.width+","+e.height+","+e.templateTitle;$("#templateDropdown option[value='"+i+"']").length>0?$("#templateDropdown").val(i):$("#templateDropdown").val("")}else $("#templateDropdown").val("");null!==e.canvasHeight&&null!==e.canvasWidth&&(canvas.canvasWidth=e.canvasWidth,canvas.canvasHeight=e.canvasHeight,canvas.templateTitle=e.templateTitle),e.lineWidth?canvas.lineWidth=e.lineWidth:canvas.lineWidth=0,e.borderStrokeStyle?canvas.borderStrokeStyle=e.borderStrokeStyle:canvas.borderStrokeStyle="#000000",updateFilterCSS(),canvas.loadFromJSON(e,renderFunction),btn.style.visibility="hidden",self.disableToolSetButtons()}};self.upFunction=function(){canvas.getActiveGroup()?canvas.getActiveGroup().forEachObject(function(t){canvas.bringForward(t)}):(canvas.bringForward(canvas.getActiveObject()),sendImageFowardInGalleryBox(canvas.getActiveObject())),self.saveCommandHistory("1 Layer Forward")},Mousetrap.bind(["ctrl+s","meta+s"],function(t){t.preventDefault?t.preventDefault():t.returnValue=!1,self.exportAndSaveCanvasFunction("save")}),Mousetrap.bind(["ctrl+z","meta+z"],function(t){t.preventDefault?t.preventDefault():t.returnValue=!1,undoFunction()}),$("#imageScale").keyup(function(t){if(13===t.keyCode&&canvas.getActiveObject()&&imageScaleValue!==$("#imageScale").val()){imageScaleValue=$("#imageScale").val();var e=canvas.getActiveObject();e.originX="center",e.originY="center",e.top=e.top+e.height*e.scaleY/2,e.left=e.left+e.width*e.scaleX/2,e.scaleX=$("#imageScale").val()/100,e.scaleY=$("#imageScale").val()/100,e.originX="left",e.originY="top",e.top=e.top-e.height*e.scaleY/2,e.left=e.left-e.width*e.scaleX/2,e.setCoords(),e.setCoords(),canvas.renderAll(),canvas.renderAll(),positionBtn(e),self.saveCommandHistory("Scale Image")}}),$("#imageRotate").keyup(function(t){if(13===t.keyCode&&canvas.getActiveObject()&&imageRotateValue!==$("#imageRotate").val()){imageRotateValue=$("#imageRotate").val();var e=canvas.getActiveObject();e.setAngle($("#imageRotate").val()),e.setCoords(),canvas.renderAll(),self.saveCommandHistory("Rotate Image")}}),Mousetrap.bind(["ctrl+shift+z","meta+shift+z"],function(t){t.preventDefault?t.preventDefault():t.returnValue=!1,redoFunction()}),Mousetrap.bind("up up down down left right left right b a enter",function(t){window.alert("Cha too ma leia kahnkee, ya ee eema loh kah yah lee.\nMy pee kah soo")},"keyup"),Mousetrap.bind(["ctrl+c","meta+c"],function(t){canvas.getActiveObject()?copySingleImageFunction():copiedImage=null}),Mousetrap.bind(["ctrl+v","meta+v"],function(t){pasteSingleImageFunction()}),Mousetrap.bind(["del"],function(t){crop.el||(canvas.getActiveObject()||canvas.getActiveGroup())&&self.removeImages()});var undoFunction=function(){if(commandHistory.length>1&&!$("#cropToolOptions").is(":visible")){undoArray.push(commandHistory.pop());var t=[];t=commandHistory.pop(),commandHistory.push(t);for(var e=document.getElementById("log");e.firstChild;)e.removeChild(e.firstChild);for(var i=0;i<commandHistory.length;i++)addCommandView(i);JSON.stringify(t);canvas.clear(),loadFromTimestamp(commandHistory.length-1)}},redoFunction=function(){if(undoArray.length>0&&!$("#cropToolOptions").is(":visible")){var t=[];t=undoArray.pop(),commandHistory.push(t);for(var e=document.getElementById("log");e.firstChild;)e.removeChild(e.firstChild);for(var i=0;i<commandHistory.length;i++)addCommandView(i);JSON.stringify(t);canvas.clear(),btn.style.visibility="hidden",loadFromTimestamp(commandHistory.length-1)}};self.applyImageBorder=function(){var t=$("#borderImageWidthValue").val();t?t>=0?(canvas.getActiveObject().strokeWidth=parseInt(t),canvas.renderAll()):window.alert("Please provide a valid value for the border"):canvas.getActiveObject().strokeWidth=0,self.saveCommandHistory("Change Image Border Width")},self.applyCanvasBorder=function(){var t=parseInt($("#borderCanvasWidthValue").val());t?t>=0?canvas.lineWidth=t:window.alert("Please provide a valid value for the border"):canvas.lineWidth=0,self.saveCommandHistory("Change Canvas Border Width"),canvas.renderAll()};var divButtons={undoTab:function(){return $("#undoTab")},redoTab:function(){return $("#redoTab")},changeCanvasBackgroundButton:function(){return $("#changeCanvasBackground")},sendErrorTab:function(){return $("#sendErrorTab")}},importFunction=function(t){if(t||(t=window.prompt("Please enter the link to the image you would like to import")),null!==t){var e=DWWPSettings.pathToUpload.path,i=DWWPSettings.pathToUpload.url,n={action:"import",file:t,upload:e};$.post(ajaxurl,n,function(e){var n=t.split("/");n=n.pop(),i+="/";var r=i.concat(n);addImageFromURL(r,!1,templateSettings),canvas.renderAll(),self.saveCommandHistory("Add Image")})}};self.exportAndViewFunction=function(){canvas.getActiveObject()&&(canvas.getActiveObject().active=!1,canvas.renderAll());var t=Canvas2Image.saveAsPNG(context,!0);$("#previewImageDialog img").attr("src",t.src);var e=$("#previewImageDialog");e.css("z-index",20),e.parent().find(".ui-dialog-titlebar").removeClass("ui-widget-header");var i=parseInt(canvas.width)+75,n=parseInt(canvas.height)+75;i>1024&&(i=1024),n>720&&(n=720),e.dialog({width:i,height:n}),e.dialog("open"),$(".ui-dialog").css("z-index",10),$(".ui-widget-overlay").css("position","fixed"),$(".ui-widget-overlay").css("z-index",9),canvas.getActiveObject()&&(canvas.getActiveObject().active=!0,canvas.renderAll())},self.exportAndSaveCanvasFunction=function(t){var e=$("#projectTitleEditor").val();if(!projectTitle&&""===e)return void window.alert("Please enter a title for the project.");var i=model.currentCanvas();if(i.title=e,model.availableProjects.refresh(),model.currentCanvas(i),canvas.getActiveObject())var n=canvas.getActiveObject().id;else if(canvas.getActiveGroup())var r=canvas.getActiveGroup();canvas.deactivateAllWithDispatch().renderAll(),canvas.renderAll();var o=JSON.stringify(canvas.toJSON(canvasItems)),s=Canvas2Image.saveAsPNG(context,!0);context.parentNode.appendChild(s),s.id="canvasimage";var a=$("#canvasimage").attr("src");context.parentNode.removeChild(s);var l=$("#wpcontent").height();$("#fade").css("height",l+"px"),$("#fade").show();var c={action:"export",postID:postID,base64data:a,image:databaseImageSrc,queryAction:t};$.post(ajaxurl,c,function(e){var i=e.split("|");if(databaseImageSrc=i[0],"copy"===t){if($("#saveBox").fadeIn({duration:1e3}).delay(2e3).fadeOut({duration:1e3}),null!==n)canvas.setActiveObject(canvas.item(n)),canvas.renderAll();else if(null!==r){r=r._objects;for(var s=[],a=0;a<r.length;a++)s.push(canvas.item(r[a].id));canvas.setActiveGroup(new fabric.Group(s)).renderAll(),canvas.renderAll()}$.ajax({url:imageLink,headers:{Pragma:"no-cache",Expires:-1,"Cache-Control":"no-cache"}})}else{self.saveCommandHistory("Save Image");var l=JSON.stringify(commandHistory);projectTitle=$("#projectTitleEditor").val();var c={action:"addQuery",file:databaseImageSrc,jsonInfo:o,commandHistory:l,projectTitle:projectTitle,queryAction:"update"};$.post(ajaxurl,c,function(t){var e=t.replace(/\\\\n/g,"\\n").replace(/\\\\r/g,"\\r").replace(/\\\\t/g,"\\t").replace(/\\"/g,'"').replace(/\\'/g,"'").replace(/\\\\/g,"\\");canvas.clear();var i=JSON.parse(e);i.objects.forEach(function(t){var e=t.cropType;e&&(t.clipTo=crop.getClipTo(e))}),canvas.loadFromJSON(i,function(){if(renderFunction(),$("#fade").hide(),$("#saveBox").fadeIn({duration:1e3}).delay(2e3).fadeOut({duration:1e3}),void 0!==n)canvas.setActiveObject(canvas.item(n)),canvas.renderAll();else if(void 0!==r){r=r._objects;for(var t=[],e=0;e<r.length;e++)t.push(canvas.item(r[e].id));canvas.setActiveGroup(new fabric.Group(t)).renderAll(),canvas.renderAll()}}),$.ajax({url:imageLink,headers:{Pragma:"no-cache",Expires:-1,"Cache-Control":"no-cache"}})})}})};var addImageRenderList=function(){renderFunction(),canvas.renderAll(),self.saveCommandHistory("Add Image"),""!==templateSettings.title&&self.applyTemplateFunction(templateSettings.width,templateSettings.height,templateSettings.title)},renderAndLoadCommandHistoryFunction=function(){renderFunction(),getCommandHistory(imageLink,applyTemplate),commandHistory.clean("")},renderFunction=function(){if(canvas.canvasWidth>750||canvas.canvasHeight>750){if(Number(canvas.canvasWidth)>Number(canvas.canvasHeight)){var t=750/canvas.canvasWidth*canvas.canvasHeight;canvas.setDimensions({width:"750px",height:t+"px"},{cssOnly:!0})}else{var e=750/canvas.canvasHeight*canvas.canvasWidth;canvas.setDimensions({width:e+"px",height:"750px"},{cssOnly:!0})}canvas.setDimensions({width:canvas.canvasWidth,height:canvas.canvasHeight},{backstoreOnly:!0})}else canvas.setDimensions({width:canvas.canvasWidth,height:canvas.canvasHeight});var i;""!==canvas.templateTitle&&(i=canvas.canvasWidth+","+canvas.canvasHeight+","+canvas.templateTitle,$("#templateDropdown option[value='"+i+"']").length>0?$("#templateDropdown option[value='"+i+"']").attr("selected",!0):$("#templateDropdown option[value='']").attr("selected",!0)),$("#backgroundColorPicker").spectrum("set",canvas.backgroundColor),$("#canvasManagementTab .sp-preview-inner")&&$("#canvasManagementTab .sp-preview-inner").css("background-color",canvas.backgroundColor),canvas.renderAll(),$("span.dimmensionDisplay","#canvasDimmensionDisplay").text(parseInt(canvas.getWidth())+" x "+parseInt(canvas.getHeight()));var n=canvas.getObjects().length,r=function(){n--,0===n&&canvas.renderAll()};canvas.forEachObject(function(t){"image"===t.type&&t.filters?(t.applyFilters(r),filterIsApplied=!0):r()}),$("#fade").hide()},changeCanvasBackgroundFunction=function(){canvas.backgroundColor="rgba(0,0,255,0.3)",canvas.renderAll()};self.selectExistingProject=function(t){$("#fastActionContainerID").css("display","inline-block"),imageLink=t,self.enableToolSetButtons(),self.getProjectTitle(imageLink),applyTemplate=0,addImageFromURL(imageLink,!0,templateSettings),model.selectProject(imageLink)},self.trySelectExistingProject=function(t){if(imageLink!==t){var e=!0;if("Save Image"===commandHistory[commandHistory.length-1].saveAction&&projectTitle&&$("#projectTitleEditor").val()===projectTitle||(e=window.confirm("You have unsaved changes to your project. Are you sure you want to load a new project?")),e)return self.selectExistingProject(t),t}return imageLink},self.clickExistingProject=function(){var t=document.getElementById("existingProjectContainer");t.style.visibility="visible";var e={action:"getExistingProjectTable"};$.post(ajaxurl,e,function(t){$("#existingProjectContainer").append(t),$("#existingProjectContainer").css("height","auto");var e=$("#existingProjectContainer").height();e-=670,$("#existingProjectContainer").css("height","100vh"),$("#wpfooter").css("position","relative"),$("#wpfooter").css("margin-top",e+"px")})},self.checkNewProjectInfo=function(){var t=wp.media({title:"Upload Image",multiple:!1,frame:"select",library:{type:"image"}}).open().on("select",function(e){var i=t.state().get("selection").first(),n=i.toJSON().url;$("#newProjectContainer").css("display","none"),$("#fade").hide(),$("#wpfooter").css("margin-top","0px"),$("#projectTitleEditor").val(""),projectTitle=$("#projectTitle").val();var r={action:"createNewFromExistingProject",url:n,title:projectTitle};$.post(ajaxurl,r,function(t){model.addProject({guid:t,title:projectTitle}),model.selectProject(t),canvas.clear(),$("#projectTitleEditor").val(""),canvas.backgroundColor="transparent",canvas.borderStrokeStyle="black",canvas.lineWidth=0;for(var e=document.getElementById("log");e.firstChild;)e.removeChild(e.firstChild);commandHistory.length=0;var i=document.getElementById("templateDropdownNewProject").value;if(i&&"createTemplate"!==i)i=i.split(","),templateSettings.width=i[0],templateSettings.height=i[1],templateSettings.title=i[2],applyTemplate=i,addImageFromURL(t,!0,templateSettings,i);else{templateSettings.title=document.getElementById("createTemplateTitle").value,templateSettings.width=document.getElementById("createTemplateWidth").value,templateSettings.height=document.getElementById("createTemplateHeight").value,$("#createTemplateTitle").val(""),$("#createTemplateWidth").val(""),$("#createTemplateHeight").val(""),$("#newTemplateContainer").slideUp(),$("#createTemplateTitle").prop("required",!1),$("#createTemplateWidth").prop("required",!1),$("#createTemplateHeight").prop("required",!1),i=[templateSettings.width,templateSettings.height,templateSettings.title];var n={action:"addNewTemplate",title:templateSettings.title,width:templateSettings.width,height:templateSettings.height};$.post(ajaxurl,n,function(e){var n={action:"dropdownChoices"};$.post(ajaxurl,n,function(e){$("#templateDropdownNewProject").append(e),$("#templateDropdown").append(e),applyTemplate=i,addImageFromURL(t,!0,templateSettings,i)})})}})});$("#media-attachment-date-filters").css("width","200px"),$("#fastActionContainerID").css("display","inline-block")},self.deleteExistingProject=function(t){var e=window.confirm("Are you sure you wish to delete this project?\n\nThis action cannot be undone.");if(e){var i={action:"deleteExistingProject",image_id:parseInt(t)};$.post(ajaxurl,i,function(e){model.removeProject(e),$("#record_"+t).remove();var i=$(".displaying-num:eq(0)"),n=parseInt(i.text().split(" ")[0])-1;1===n?(i.text("1 item"),$(".displaying-num:eq(1)").text("1 item")):(i.text(n+" items"),$(".displaying-num:eq(1)").text(n+" items"))})}},self.clickNewProject=function(){var t=$("#wpwrap").height();$("#fade").css("height",t+"px"),$("#fade").show(),$("#loading-image").hide();var e=document.getElementById("newProjectContainer");e.style.visibility="visible",e.style.display="",$("#projectTitle").val(""),$("#templateDropdownNewProject").val(""),$("#templateDropdown").prop("disabled",!1).removeClass("disabled")},self.cancelNewProject=function(){$("#fade").hide(),$("#loading-image").show(),$("#createTemplateTitle").val(""),$("#createTemplateWidth").val(""),$("#createTemplateHeight").val(""),$("#newTemplateContainer").slideUp(),$("#createTemplateTitle").prop("required",!1),$("#createTemplateWidth").prop("required",!1),$("#createTemplateHeight").prop("required",!1);var t=document.getElementById("newProjectContainer");t.style.visibility="hidden",model.selectProject(imageLink)},self.getProjectTitle=function(t){var e={action:"getProjectTitle",file:t};$.post(ajaxurl,e,function(t){t?($("#projectTitleEditor").val(t),projectTitle=t):(projectTitle=$("#projectTitle").val(),$("#projectTitleEditor").val(projectTitle))})};var isLogged=!1;Mousetrap.bind("left",function(t){if(t.preventDefault(),canvas.getActiveObject()||canvas.getActiveGroup()){var e=canvas.getActiveObject()?canvas.getActiveObject():canvas.getActiveGroup();e.setLeft(e.getLeft()-1),e.setCoords(),positionBtn(e),canvas.getActiveObject()?(canvas.getActiveObject().active=!1,canvas.setActiveObject(e)):(canvas.getActiveGroup().active=!1,canvas.setActiveGroup(e)),canvas.renderAll(),isLogged=!0}},"keydown"),Mousetrap.bind("right",function(t){if(t.preventDefault(),canvas.getActiveObject()||canvas.getActiveGroup()){var e=canvas.getActiveObject()?canvas.getActiveObject():canvas.getActiveGroup();e.setLeft(e.getLeft()+1),e.setCoords(),positionBtn(e),canvas.getActiveObject()?(canvas.getActiveObject().active=!1,canvas.setActiveObject(e)):(canvas.getActiveGroup().active=!1,canvas.setActiveGroup(e)),canvas.renderAll(),isLogged=!0}},"keydown"),Mousetrap.bind("down",function(t){if(t.preventDefault(),canvas.getActiveObject()||canvas.getActiveGroup()){var e=canvas.getActiveObject()?canvas.getActiveObject():canvas.getActiveGroup();e.setTop(e.getTop()+1),e.setCoords(),positionBtn(e),canvas.getActiveObject()?(canvas.getActiveObject().active=!1,canvas.setActiveObject(e)):(canvas.getActiveGroup().active=!1,canvas.setActiveGroup(e)),canvas.renderAll(),isLogged=!0}},"keydown"),Mousetrap.bind("up",function(t){if(t.preventDefault(),canvas.getActiveObject()||canvas.getActiveGroup()){var e=canvas.getActiveObject()?canvas.getActiveObject():canvas.getActiveGroup();e.setTop(e.getTop()-1),e.setCoords(),positionBtn(e),canvas.getActiveObject()?(canvas.getActiveObject().active=!1,canvas.setActiveObject(e)):(canvas.getActiveGroup().active=!1,canvas.setActiveGroup(e)),canvas.renderAll(),isLogged=!0}},"keydown"),$(document).on("keyup",function(t){(t.keyCode===$.ui.keyCode.LEFT||t.keyCode===$.ui.keyCode.RIGHT||t.keyCode===$.ui.keyCode.UP||t.keyCode===$.ui.keyCode.DOWN)&&(canvas.getActiveObject()||canvas.getActiveGroup())&&areObjectsOfType("image")&&isLogged?(crop.el||self.saveCommandHistory("Move Image"),isLogged=!1):(t.keyCode===$.ui.keyCode.LEFT||t.keyCode===$.ui.keyCode.RIGHT||t.keyCode===$.ui.keyCode.UP||t.keyCode===$.ui.keyCode.DOWN)&&(canvas.getActiveObject()||canvas.getActiveGroup())&&areObjectsOfType("i-text")&&isLogged?(self.saveCommandHistory("Move Text"),isLogged=!1):isLogged&&(crop.el||self.saveCommandHistory("Move Objects"),isLogged=!1)}),self.disableToolSetButtons=function(){$("#zoomInButton").prop("disabled",!0).addClass("disabled"),$("#forwardToolButton").prop("disabled",!0).addClass("disabled"),$("#frontToolButton").prop("disabled",!0).addClass("disabled"),$("#centerToolButton").prop("disabled",!0).addClass("disabled"),$("#flipVToolButton").prop("disabled",!0).addClass("disabled"),$("#zoomOutButton").prop("disabled",!0).addClass("disabled"),$("#backwardToolButton").prop("disabled",!0).addClass("disabled"),$("#backToolButton").prop("disabled",!0).addClass("disabled"),$("#transformToolButton").prop("disabled",!0).addClass("disabled"),$("#flipHToolButton").prop("disabled",!0).addClass("disabled"),$("#showFiltersControl").prop("disabled",!0).addClass("disabled"),$("#filter-controls").hide(),$("#cropToolButton").prop("disabled",!0).addClass("disabled"),$("#borderToolOptions").is(":visible")&&($("#borderToolButton").removeClass("highlightOption"),$("#borderToolOptions").toggle()),$("#transformToolOptions").is(":visible")&&($("#transformToolButton").removeClass("highlightOption"),$("#transformToolOptions").toggle()),$("#borderToolButton").prop("disabled",!0).addClass("disabled"),fastAction.style.pointerEvents="none",""!==imageLink&&(document.getElementById("textButton").style.pointerEvents="auto")},self.enableToolSetButtons=function(){var t=canvas.getActiveGroup(),e=0;if(null===t)$("#zoomInButton").prop("disabled",!1).removeClass("disabled"),$("#zoomOutButton").prop("disabled",!1).removeClass("disabled"),$("#forwardToolButton").prop("disabled",!1).removeClass("disabled"),$("#frontToolButton").prop("disabled",!1).removeClass("disabled"),$("#backwardToolButton").prop("disabled",!1).removeClass("disabled"),$("#backToolButton").prop("disabled",!1).removeClass("disabled"),$("#showFiltersControl").prop("disabled",!1).removeClass("disabled"),$("#cropToolButton").prop("disabled",!1).removeClass("disabled"),$("#textButton").prop("disabled",!1).removeClass("disabled"),$("#borderToolButton").prop("disabled",!1).removeClass("disabled"),$("#centerToolButton").prop("disabled",!1).removeClass("disabled"),$("#flipVToolButton").prop("disabled",!1).removeClass("disabled"),$("#transformToolButton").prop("disabled",!1).removeClass("disabled"),$("#flipHToolButton").prop("disabled",!1).removeClass("disabled");else{self.disableToolSetButtons();for(var i=0;t&&i<t._objects.length;i++)if("image"!==t._objects[i].type){e=1;break}0===e&&($("#zoomInButton").prop("disabled",!1).removeClass("disabled"),$("#zoomOutButton").prop("disabled",!1).removeClass("disabled"),$("#centerToolButton").prop("disabled",!1).removeClass("disabled"),$("#flipVToolButton").prop("disabled",!1).removeClass("disabled"),$("#flipHToolButton").prop("disabled",!1).removeClass("disabled"))}fastAction.style.pointerEvents="auto",document.getElementById("textButton").style.pointerEvents="auto"};var optionCheck=function(){var t=document.getElementById("templateDropdown").value;t&&(t=t.split(","),self.applyTemplateFunction(t[0],t[1],t[2]))},globals={canvas:function(){return canvas},context:function(){return context},divButtons:function(){return divButtons},tabs:function(){return tabs},canvasItems:function(){return canvasItems},crop:function(){return crop},model:function(){return model}};if($("#saveBox").hide(),""!==imageLink){if(imageLink=imageLink.replace(/(.*)(-[0-9]+x[0-9]+)\b(.)(.*)/g,"$1$3$4"),$("#fastActionContainerID").css("display","inline-block"),self.enableToolSetButtons(),self.enableToolSetButtons(),""==templateSettings.width||""==templateSettings.height||""==templateSettings.title)var applyTemplate=0;else var applyTemplate=[templateSettings.width,templateSettings.height,templateSettings.title];var data={action:"dropdownChoices"};$.post(ajaxurl,data,function(data){$("#templateDropdownNewProject").append(data),$("#templateDropdown").append(data),""!==createdNewImage&&(model.addProject({guid:imageLink,title:createdNewImage}),model.selectProject(imageLink),projectTitle=createdNewImage),$("#projectTitleEditor").val(projectTitle),addImageFromURL(imageLink,!0,templateSettings,applyTemplate);var data2={action:"getProjectList"};$.post(ajaxurl,data2,function(data){eval(data),model.selectProject(imageLink)})})}canvas.backgroundColor="rgba(0, 0, 0, 0)";var image2=new Image;return image2.src=canvas.toDataURL(),canvas.renderAll(),$.extend({},self,globals)}(jQuery,fabric);var _initializeSpectrum=function(){"use strict";var t=ImageFunctions.canvas(),e=t.backgroundColor||"rgba(0,0,0,0)";$("#backgroundColorPicker").spectrum({color:e,showInput:!0,className:"spectrum-canvas-background-color",showPalette:!0,showSelectionPalette:!0,maxSelectionSize:10,preferredFormat:"rgb",localStorageKey:"spectrum.demo",clickoutFiresChange:!0,move:function(e){t.backgroundColor=e.toRgbString(),ImageFunctions.saveCommandHistory("Change Background Color"),t.renderAll()},palette:[["rgba(0, 0, 0, 0)","rgb(0, 0, 0)","rgb(67, 67, 67)","rgb(102, 102, 102)","rgb(204, 204, 204)","rgb(217, 217, 217)","rgb(255, 255, 255)"],["rgb(152, 0, 0)","rgb(255, 0, 0)","rgb(255, 153, 0)","rgb(255, 255, 0)","rgb(0, 255, 0)","rgb(0, 255, 255)","rgb(74, 134, 232)","rgb(0, 0, 255)","rgb(153, 0, 255)","rgb(255, 0, 255)"],["rgb(230, 184, 175)","rgb(244, 204, 204)","rgb(252, 229, 205)","rgb(255, 242, 204)","rgb(217, 234, 211)","rgb(208, 224, 227)","rgb(201, 218, 248)","rgb(207, 226, 243)","rgb(217, 210, 233)","rgb(234, 209, 220)","rgb(221, 126, 107)","rgb(234, 153, 153)","rgb(249, 203, 156)","rgb(255, 229, 153)","rgb(182, 215, 168)","rgb(162, 196, 201)","rgb(164, 194, 244)","rgb(159, 197, 232)","rgb(180, 167, 214)","rgb(213, 166, 189)","rgb(204, 65, 37)","rgb(224, 102, 102)","rgb(246, 178, 107)","rgb(255, 217, 102)","rgb(147, 196, 125)","rgb(118, 165, 175)","rgb(109, 158, 235)","rgb(111, 168, 220)","rgb(142, 124, 195)","rgb(194, 123, 160)","rgb(166, 28, 0)","rgb(204, 0, 0)","rgb(230, 145, 56)","rgb(241, 194, 50)","rgb(106, 168, 79)","rgb(69, 129, 142)","rgb(60, 120, 216)","rgb(61, 133, 198)","rgb(103, 78, 167)","rgb(166, 77, 121)","rgb(91, 15, 0)","rgb(102, 0, 0)","rgb(120, 63, 4)","rgb(127, 96, 0)","rgb(39, 78, 19)","rgb(12, 52, 61)","rgb(28, 69, 135)","rgb(7, 55, 99)","rgb(32, 18, 77)","rgb(76, 17, 48)"]]});var i;$("#borderImageStyleValue").spectrum({color:"black",showInput:!0,className:"borderImageSpectrum",showPalette:!0,showSelectionPalette:!0,maxSelectionSize:10,preferredFormat:"rgb",localStorageKey:"spectrum.demo",clickoutFiresChange:!0,show:function(t){i=t.toRgbString()},change:function(e){t.getActiveObject().stroke=e.toRgbString(),t.renderAll()},hide:function(e){i!==e.toRgbString()&&(t.getActiveObject().stroke=e.toRgbString(),t.renderAll(),ImageFunctions.saveCommandHistory("Change Image Border Color"))},palette:[["rgb(0, 0, 0)","rgb(67, 67, 67)","rgb(102, 102, 102)","rgb(204, 204, 204)","rgb(217, 217, 217)","rgb(255, 255, 255)"],["rgb(152, 0, 0)","rgb(255, 0, 0)","rgb(255, 153, 0)","rgb(255, 255, 0)","rgb(0, 255, 0)","rgb(0, 255, 255)","rgb(74, 134, 232)","rgb(0, 0, 255)","rgb(153, 0, 255)","rgb(255, 0, 255)"],["rgb(230, 184, 175)","rgb(244, 204, 204)","rgb(252, 229, 205)","rgb(255, 242, 204)","rgb(217, 234, 211)","rgb(208, 224, 227)","rgb(201, 218, 248)","rgb(207, 226, 243)","rgb(217, 210, 233)","rgb(234, 209, 220)","rgb(221, 126, 107)","rgb(234, 153, 153)","rgb(249, 203, 156)","rgb(255, 229, 153)","rgb(182, 215, 168)","rgb(162, 196, 201)","rgb(164, 194, 244)","rgb(159, 197, 232)","rgb(180, 167, 214)","rgb(213, 166, 189)","rgb(204, 65, 37)","rgb(224, 102, 102)","rgb(246, 178, 107)","rgb(255, 217, 102)","rgb(147, 196, 125)","rgb(118, 165, 175)","rgb(109, 158, 235)","rgb(111, 168, 220)","rgb(142, 124, 195)","rgb(194, 123, 160)","rgb(166, 28, 0)","rgb(204, 0, 0)","rgb(230, 145, 56)","rgb(241, 194, 50)","rgb(106, 168, 79)","rgb(69, 129, 142)","rgb(60, 120, 216)","rgb(61, 133, 198)","rgb(103, 78, 167)","rgb(166, 77, 121)","rgb(91, 15, 0)","rgb(102, 0, 0)","rgb(120, 63, 4)","rgb(127, 96, 0)","rgb(39, 78, 19)","rgb(12, 52, 61)","rgb(28, 69, 135)","rgb(7, 55, 99)","rgb(32, 18, 77)","rgb(76, 17, 48)"]]});var n;$("#borderCanvasStyleValue").spectrum({color:"black",showInput:!0,className:"borderCanvasSpectrum",showPalette:!0,showSelectionPalette:!0,maxSelectionSize:10,preferredFormat:"rgb",localStorageKey:"spectrum.demo",clickoutFiresChange:!0,show:function(t){n=t.toRgbString()},change:function(e){t.borderStrokeStyle=e.toRgbString(),t.renderAll()},hide:function(e){n!==e.toRgbString()&&(t.borderStrokeStyle=e.toRgbString(),t.renderAll(),ImageFunctions.saveCommandHistory("Change Canvas Border Color"))},palette:[["rgb(0, 0, 0)","rgb(67, 67, 67)","rgb(102, 102, 102)","rgb(204, 204, 204)","rgb(217, 217, 217)","rgb(255, 255, 255)"],["rgb(152, 0, 0)","rgb(255, 0, 0)","rgb(255, 153, 0)","rgb(255, 255, 0)","rgb(0, 255, 0)","rgb(0, 255, 255)","rgb(74, 134, 232)","rgb(0, 0, 255)","rgb(153, 0, 255)","rgb(255, 0, 255)"],["rgb(230, 184, 175)","rgb(244, 204, 204)","rgb(252, 229, 205)","rgb(255, 242, 204)","rgb(217, 234, 211)","rgb(208, 224, 227)","rgb(201, 218, 248)","rgb(207, 226, 243)","rgb(217, 210, 233)","rgb(234, 209, 220)","rgb(221, 126, 107)","rgb(234, 153, 153)","rgb(249, 203, 156)","rgb(255, 229, 153)","rgb(182, 215, 168)","rgb(162, 196, 201)","rgb(164, 194, 244)","rgb(159, 197, 232)","rgb(180, 167, 214)","rgb(213, 166, 189)","rgb(204, 65, 37)","rgb(224, 102, 102)","rgb(246, 178, 107)","rgb(255, 217, 102)","rgb(147, 196, 125)","rgb(118, 165, 175)","rgb(109, 158, 235)","rgb(111, 168, 220)","rgb(142, 124, 195)","rgb(194, 123, 160)","rgb(166, 28, 0)","rgb(204, 0, 0)","rgb(230, 145, 56)","rgb(241, 194, 50)","rgb(106, 168, 79)","rgb(69, 129, 142)","rgb(60, 120, 216)","rgb(61, 133, 198)","rgb(103, 78, 167)","rgb(166, 77, 121)","rgb(91, 15, 0)","rgb(102, 0, 0)","rgb(120, 63, 4)","rgb(127, 96, 0)","rgb(39, 78, 19)","rgb(12, 52, 61)","rgb(28, 69, 135)","rgb(7, 55, 99)","rgb(32, 18, 77)","rgb(76, 17, 48)"]]
}),$(".borderImageSpectrum .sp-cancel").on("click",function(){t.getActiveObject().stroke=i,$(this).spectrum("set",i),t.renderAll()}),$(".borderCanvasSpectrum .sp-cancel").on("click",function(){t.borderStrokeStyle=n,$(this).spectrum("set",n),t.renderAll()}),$(".borderImageSpectrum .sp-choose").remove(),$(".borderCanvasSpectrum .sp-choose").remove(),$(".borderImageSpectrum").prop("title","Image Border Color"),$(".borderCanvasSpectrum").prop("title","Canvas Border Color"),$(".spectrum-canvas-background-color .sp-cancel").on("click",function(){t.backgroundColor=$("#backgroundColorPicker").spectrum("get").toRgbString(),t.renderAll(),ImageFunctions.saveCommandHistory("Change background color")}),$(".spectrum-canvas-background-color .sp-choose").remove(),$("#tint-color").spectrum({color:"",showInput:!0,allowEmpty:!0,disabled:!0,preferredFormat:"rgb"}),$("#multiply-color").spectrum({color:"",showInput:!0,allowEmpty:!0,disabled:!0,preferredFormat:"rgb"}),$("#blend-color").spectrum({color:"",showInput:!0,allowEmpty:!0,disabled:!0,preferredFormat:"rgb"})},$=jQuery,model;ko.bindingHandlers.clickableSelect={init:function(t,e,i,n,r){"use strict";$(t).change(function(){model.active&&!model.currentCanvas()?ImageFunctions.clickNewProject():model.active&&model.changeProject()})}},ko.bindingHandlers.sortableList={init:function(t,e,i,n,r){"use strict";$(t).sortable({placeholder:"ui-state-highlight",tolerance:"intersect",update:function(t,e){var i=(e.item.data(),ko.utils.arrayIndexOf(e.item.parent().children(),e.item[0]));model.moveTabByName(e.item.context.innerHTML,i)}})}},ko.bindingHandlers.slideVisible={update:function(t,e,i){"use strict";var n=e(),r=ko.unwrap(n);i.get("slideDuration")||400;if(r===!0){$(t).slideDown(0);var o=document.getElementById("log");o.scrollTop=o.scrollHeight}else $(t).slideUp(0)}},ko.observableArray.fn.refresh=function(){model.active=!1;var t=this().slice(0);this([]),this(t),model.active=!0};var _initializeKnockout=function(){"use strict";return model=new ImageFunctionViewModel,ko.applyBindings(model),model.tabs.push({name:"Add Images",html:"<div id='galleryTop' style='width=100%'><div id='gallery' style='width:95%'><div id='upload-btn' style='border-width: 0px;' class='dashicons dashicons-plus-alt' title='Add Image'></div><ul id='sortable'></ul></div><div id = 'galleryButtonSet'><div id='galleryDelete' class='fastActionButton' title='Delete Image'><span class='dashicons dashicons-trash galleryDashicons'></span></div><div id='galleryCenter' class='fastActionButton' title='Center Image'><span class='dashicons dashicons-align-center galleryDashicons'></span></div></div></div>",imageClass:"dashicons-before dashicons-images-alt",active:ko.observable(!0)}),model.tabs.push({name:"Canvas Management",html:"<div id='canvasManagementTab' style='width: 100%; text-align:left; height:50px;background-color: #F6FBFE;'><div style='display:inline-block; top: 32px; padding-right: 15px; padding-top: 10px; padding-left: 5px;'><div id='templateLabel' style='float: left; line-height:30px; padding-right: 5px;'>Project Size:</div><select id='templateDropdown'><option disabled hidden selected value='''></option></select></div><div style='display:inline-block; top: 32px; padding-left: 15px'><div id='canvasBackgroundLabel' style='float: left; line-height: 30px; padding-right: 5px;'>Canvas Background:</div><input type='text' id='backgroundColorPicker'/></div>",imageClass:"dashicons-before dashicons-camera",active:ko.observable(!0)}),model.tabs.push({name:"History",html:"<div id='HistoryTab' style='width: 100%;'><div class='block' style='width: 100%;'><div style='width: 60px; height: 92px; float: left; position: relative; left: 0px; top: 0px;'><div style='width: 60px; height: 46px;'><div id='undoTab' title='Undo' style='position: relative; left: 15px; top: 6px; height: 30px; width: 30px; margin-top: 0px; margin-left: 0px;' class='fastActionButton'><span class='dashicons dashicons-undo'></span></div></div><div style='width: 60px; height: 46px;'><div id='redoTab' title='Redo' style='position: relative; left: 15px; top: 6px; height: 30px; width: 30px; margin-top: 0px; margin-left: 0px;' class='fastActionButton'><span class='dashicons dashicons-redo'></div></div></div><ul style='height: 92px; left: 0px; top: 0px; overflow-y: scroll; border-style: solid; border-width: 1px; background-color: #FFFFFF;' id='log'></ul></div>",imageClass:"dashicons-before dashicons-backup",active:ko.observable(!0)}),model.tabs.push({name:"Support",html:"<div id='feedbackTab' style='width: 100%; text-align:left; height:50px;background-color: #F6FBFE;'><div style='width: 90px; display:inline-block; top: 32px; padding-left: 5px; padding-top: 10px;'><a href='https://digiwidgets.com/tutorials' target='_blank'><input type='button' class='button button-primary' value='Tutorials' /></a></div><div style='width: 140px; display:inline-block; top: 32px; padding-left: 5px; padding-top: 10px;'><a href='https://www.digiwidgets.com/feedback' target='_blank'><input type='button' class='button button-primary' value='Send Feedback' /></a></div><div id='sendErrorTab' style='width: 200px; display:inline-block; top: 32px;'><input type='button' class='button button-primary' value='Send Error Report' /></div></div>",imageClass:"dashicons-before dashicons-testimonial",active:ko.observable(!0)}),model.chosenId(model.tabs()[0]),model},WebFontConfig={google:{families:["Abel:n4","Amatic SC:n4","Arimo:n4,i4","Arvo:n4,i4","Bevan:n4","Bitter:n4,i4","Black Ops One:n4","Boogaloo:n4","Bree Serif:n4","Calligraffitti:n4","Cantata One:n4","Cardo:n4,i4","Changa One:n4,i4","Cherry Cream Soda:n4","Chewy:n4","Comfortaa:n4,i4","Coming Soon:n4","Covered By Your Grace:n4","Crafty Girls:n4","Crete Round:n4,i4","Crimson Text:n4,i4","Cuprum:n4,i4","Dancing Script:n4","Dosis:n4","Droid Sans:n4","Droid Serif:n4,i4","Francois One:n4","Fredoka One:n4","The Girl Next Door:n4","Gloria Hallelujah:n4","Happy Monkey:n4","Indie Flower:n4","Josefin Slab:n4,i4","Judson:n4,i4","Kreon:n4","Lato:n4,i4","Leckerli One:n4","Lobster:n4","Lobster Two:n4","Lora:n4,i4","Luckiest Guy:n4","Merriweather:n4,i4","Metamorphous:n4","Montserrat:n4","Noticia Text:n4,i4","Nova Square:n4","Nunito:n4","Old Standard TT:n4,i4","Open Sans:n4,i4","Oswald:n4","Pacifico:n4","Passion One:n4","Patrick Hand:n4","Permanent Marker:n4","Play:n4","Playfair Display:n4,i4","Poiret One:n4","PT Sans:n4,i4","PT Sans Narrow:n4","PT Serif:n4,i4","Raleway:n4","Righteous:n4","Roboto:n4,i4","Roboto Condensed:n4,i4","Rock Salt:n4","Rokkitt:n4","Sanchez:n4,i4","Satisfy:n4","Schoolbell:n4","Shadows Into Light:n4","Source Sans Pro:n4,i4","Special Elite:n4","Squada One:n4","Tangerine:n4","Ubuntu:n4,i4","Unkempt:n4","Vollkorn:n4,i4","Walter Turncoat:n4","Yanone Kaffeesatz:n4"]}};!function(){"use strict";var t=document.createElement("script");t.src=("https:"===document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",t.type="text/javascript",t.async="true";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}();var _initializeTypography=function(){"use strict";function t(t){if(!l.getActiveObject()&&!l.getActiveGroup())return!1;var e=l.getActiveGroup();if(e){e=l.getActiveGroup();var i=!0;return e.forEachObject(function(e){return e.type!==t?void(i=!1):void 0}),i}var n=l.getActiveObject();return n.type===t}function e(){var e=l.getActiveObject()||l.getActiveGroup();if(e&&ImageFunctions.positionBtn(e),f=!1,fabric.util.removeListener(fabric.document,"mouseup",l._onMouseUp),t("i-text")){var i,r=l.getActiveObject();if(r)u&&(i=r.fontSize*r.scaleX,r.setFontSize(parseInt(i,10)),r.setScaleX(1),r.setScaleY(1),r.setCoords(),u=!1,ImageFunctions.saveCommandHistory("Change text's size"));else if(u){var s=l.getActiveGroup();i=o("fontSize")*s.scaleX,n("fontSize",parseInt(i,10)),s.setScaleX(1),s.setScaleY(1),ImageFunctions.saveCommandHistory("Change text's size"),u=!1}c&&(ImageFunctions.saveCommandHistory("Move Text"),c=!1),h&&(ImageFunctions.saveCommandHistory("Rotate Text"),h=!1)}else t("image")?(c&&(ImageFunctions.saveCommandHistory("Move Image"),c=!1),h&&(ImageFunctions.saveCommandHistory("Rotate Image"),h=!1),u&&(ImageFunctions.saveCommandHistory("Scale Image"),u=!1)):t("rect")||t("circle")||(c&&(ImageFunctions.saveCommandHistory("Move Objects"),c=!1),h&&(ImageFunctions.saveCommandHistory("Rotate Objects"),h=!1),u&&(ImageFunctions.saveCommandHistory("Scale Objects"),u=!1))}function i(){$("#text-fill-color").spectrum({color:"",showInput:!0,className:"spectrum-text-fill-color",showPalette:!0,preferredFormat:"rgb",move:function(t){n("fill",t.toRgbString()),ImageFunctions.saveCommandHistory("Change text's fill color")},palette:[["rgb(0, 0, 0)","rgb(255, 255, 255)","rgb(255, 0, 255)","rgb(0, 128, 128)"],["rgb(255, 165, 0)","rgb(0, 255, 0)","rgb(255, 0, 0)","rgb(0, 0, 255)"],["rgb(0, 128, 0)","rgb(128, 0, 0)","rgb(0, 0, 128)","rgb(128, 128, 0)"],["rgb(192, 0, 0)","rgb(255, 255, 0)","rgb(128, 128, 128)","rgb(128, 0, 128)"]]}),$(".spectrum-text-fill-color .sp-cancel").on("click",function(){n("fill",$("#text-fill-color").spectrum("get").toRgbString()),ImageFunctions.saveCommandHistory("Cancel text's fill color")}),$(".spectrum-text-fill-color .sp-choose").remove(),$("#text-background-color").spectrum({color:"",showInput:!0,className:"spectrum-text-background-color",showPalette:!0,preferredFormat:"rgb",move:function(t){n("backgroundColor",t.toRgbString()),ImageFunctions.saveCommandHistory("Change text's background color")},palette:[["rgb(0, 0, 0)","rgb(255, 255, 255)","rgb(255, 0, 255)","rgb(0, 128, 128)"],["rgb(255, 165, 0)","rgb(0, 255, 0)","rgb(255, 0, 0)","rgb(0, 0, 255)"],["rgb(0, 128, 0)","rgb(128, 0, 0)","rgb(0, 0, 128)","rgb(128, 128, 0)"],["rgb(192, 0, 0)","rgb(255, 255, 0)","rgb(128, 128, 128)","rgb(128, 0, 128)"],["rgba(0, 0, 0, 0)"]]}),$(".spectrum-text-background-color .sp-cancel").on("click",function(){n("backgroundColor",$("#text-background-color").spectrum("get").toRgbString()),ImageFunctions.saveCommandHistory("Cancel text's background color")}),$(".spectrum-text-background-color .sp-choose").remove()}function n(t,e){if(l.getActiveObject()||l.getActiveGroup()){var i,n;l.getActiveObject()?(i=r("object"))(t,e):(n=r("group"))(t,e)}}function r(t){return"object"===t?function(t,e){var i=l.getActiveObject();i[t]=e,i.setCoords(),l.renderAll()}:"group"===t?function(t,e){var i=l.getActiveGroup();i.forEachObject(function(i){i[t]=e,i.setCoords()}),l.renderAll()}:void 0}function o(t){if(l.getActiveObject()||l.getActiveGroup()){var e,i;return l.getActiveObject()?(e=s("object"))(t):(i=s("group"))(t)}}function s(t){return"object"===t?function(t){var e=l.getActiveObject();return e[t]}:"group"===t?function(t){var e,i,n=l.getActiveGroup(),r=!0;"fontWeight"===t&&(i="normal");var o=[];if(n.forEachObject(function(n){return void 0===n[t]||""===n[t]||n[t]===i?void(r=!1):(e=n[t],void o.push(n[t]))}),r===!1)return"";var s=!0;return o.forEach(function(t){return o[0]!==t?void(s=!1):void 0}),s===!1?"fontSize"===t?Math.min.apply(Math,o):"":o[0]}:void 0}function a(){var t=["Abel","Amatic SC","Arial","Arimo","Arvo","Bevan","Bitter","Black Ops One","Boogaloo","Bree Serif","Calligraffitti","Cantata One","Cardo","Changa One","Cherry Cream Soda","Chewy","Comfortaa","Coming Soon","Covered By Your Grace","Crafty Girls","Crete Round","Crimson Text","Cuprum","Dancing Script","Dosis","Droid Sans","Droid Serif","Francois One","Fredoka One","Gloria Hallelujah","Happy Monkey","Impact","Indie Flower","Josefin Slab","Judson","Kreon","Lato","Leckerli One","Lobster","Lobster Two","Lora","Luckiest Guy","Merriweather","Metamorphous","Montserrat","Noticia Text","Nova Square","Nunito","Old Standard TT","Open Sans","Oswald","Pacifico","Passion One","Patrick Hand","Permanent Marker","Play","Playfair Display","Poiret One","PT Sans","PT Sans Narrow","PT Serif","Raleway","Righteous","Roboto","Roboto Condensed","Rock Salt","Rokkitt","Sanchez","Satisfy","Schoolbell","Shadows Into Light","Source Sans Pro","Special Elite","Squada One","Tangerine","The Girl Next Door","Times New Roman","Ubuntu","Unkempt","Verdana","Vollkorn","Walter Turncoat","Yanone Kaffeesatz"],e="http://fonts.googleapis.com/css?family=";t.forEach(function(t){e=e+t.replace(" ","+")+"n4,n7,i4,i7|"}),e=e.substring(0,e.length-1),t.forEach(function(t){$(".font-family-list").append('<option><a style="font-family:'+t+';" data-val="'+t+'" href="#">'+t+"</a></option>")})}a(),i();var l=ImageFunctions.canvas();l.on("object:added",function(t){"image"===t.target.type&&$("#textButton").prop("disabled",!1).removeClass("disabled")}),$("#textButton").on("click",function(t){var e=$(this);t.preventDefault(),e.hasClass("highlightOption")?(e.removeClass("highlightOption"),l.defaultCursor="default"):(e.addClass("highlightOption"),l.defaultCursor="crosshair",l.on("mouse:down",function(t){if(e.hasClass("highlightOption")){var i=l.getPointer(t.e),n=new fabric.IText("Your Text Here",{left:i.x,top:i.y,fill:"#000000"});n.on("editing:entered",function(t){this.previousText=this.text}),n.on("editing:exited",function(t){this.previousText&&this.previousText!==this.text&&ImageFunctions.saveCommandHistory("Edit Text"),this.previousText=null}),l.add(n),l.setActiveObject(n),e.removeClass("highlightOption"),l.defaultCursor="default",ImageFunctions.saveCommandHistory("Add Text")}}))}),$("#toolbar button").each(function(){var t=$(this).data("control");switch(t){case"bold":$(this).click(function(t){var e=o("fontWeight");n("fontWeight","bold"===e?"":"bold"),ImageFunctions.saveCommandHistory("Bold Text"),$(this).toggleClass("active"),t.preventDefault()});break;case"italic":$(this).click(function(){var t=o("fontStyle");n("fontStyle","italic"===t?"":"italic"),ImageFunctions.saveCommandHistory("Italicize text"),$(this).toggleClass("active")});break;case"underline":$(this).click(function(){var t=o("textDecoration");t.indexOf("underline")>-1?t=t.replace("underline",""):t+="underline",n("textDecoration",t),ImageFunctions.saveCommandHistory("Underline text"),$(this).toggleClass("active")})}}),$(".font-family-list").on("change",function(){var t=$(this).val();n("fontFamily",t),ImageFunctions.saveCommandHistory("Change text's font family")}),$(".control-prop").each(function(){var t=$(this).data("control");switch(t){case"font-size":$(this).change(function(){n("fontSize",parseInt($(this).val(),10)),ImageFunctions.saveCommandHistory("Change text's font size")})}}),$("#font-line-height").change(function(){n("lineHeight",$(this).val());var t=l.getActiveObject()||l.getActiveGroup();t.setCoords(),ImageFunctions.saveCommandHistory("Change text line height")}),l.on("object:selected",function(e){if(t("image"))ImageFunctions.toggleText(!1);else if(t("i-text")){ImageFunctions.disableToolSetButtons(),ImageFunctions.toggleText(!0)&&($("#toolbar .btn, #toolbar input").prop("disabled",!1),$("#text-fill-color").spectrum("enable"),$("#text-fill-color").spectrum("set",o("fill")||"rgb(0, 0, 0)"),$("#text-background-color").spectrum("enable"),$("#text-background-color").spectrum("set",o("backgroundColor")||"rgba(0,0,0,0)"));var i;if(l.getActiveObject()){if(i=l.getActiveObject(),1!==i.scaleX){var n=i.fontSize*i.scaleX;i.fontSize=parseInt(n,10),i.scaleX=1,i.scaleY=1}}else l.getActiveGroup()&&(i=l.getActiveGroup(),1!==o("scaleX")&&i.forEachObject(function(t){if(1!==t.scaleX){var e=t.fontSize*t.scaleX;t.fontSize=parseInt(e,10),t.scaleX=1,t.scaleY=1}}));$("#font-size").val(o("fontSize")),$("#font-family select").val(o("fontFamily")),o("textDecoration").indexOf("underline")>-1?$('[data-control="underline"]').addClass("active"):$('[data-control="underline"]').removeClass("active"),"bold"===o("fontWeight")?$('[data-control="bold"]').addClass("active"):$('[data-control="bold"]').removeClass("active"),"italic"===o("fontStyle")?$('[data-control="italic"]').addClass("active"):$('[data-control="italic"]').removeClass("active"),$("#font-line-height").val(o("lineHeight")),i.setCoords()}else ImageFunctions.toggleText(!1)}).on("selection:cleared",function(){$("#textButton").hasClass("highlightOption")||ImageFunctions.toggleText(!1)});var c,h,u,f=!1;l.on("object:scaling",function(i){var n;if(t("i-text")){var r=l.getActiveObject();if(r)n=r.fontSize*r.scaleX,$("#font-size").val(parseInt(n,10));else{var s=l.getActiveGroup();n=o("fontSize")*s.scaleX,$("#font-size").val(parseInt(n,10))}}t("rect")||t("circle")||(u=!0,f||(l.on("mouse:up",e),f=!0))}).on("object:moving",function(i){t("rect")||t("circle")||(c=!0,f||(l.on("mouse:up",e),f=!0))}).on("object:rotating",function(t){h=!0,f||(l.on("mouse:up",e),f=!0)}),$("#textOptions").draggable()};